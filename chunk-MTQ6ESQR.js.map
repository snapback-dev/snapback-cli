{"version":3,"sources":["../../../packages/contracts/dist/auth/errors.js","../../../packages/contracts/dist/auth/session.js","../../../packages/contracts/dist/auth/api.js","../../../packages/contracts/dist/eventBus.emitter.js","../../../packages/contracts/dist/types/analysis.js","../../../packages/contracts/dist/events/core.js","../../../packages/contracts/dist/events/accountability.js","../../../packages/contracts/dist/logger.js","../../../packages/contracts/dist/feature-manager.js","../../../packages/contracts/dist/observability/types.js","../../../packages/contracts/dist/schemas.js","../../../packages/contracts/dist/workspace/workspace-resolution.js","../../../packages/contracts/dist/session.js","../../../packages/contracts/dist/session/file-modification.js","../../../packages/contracts/dist/signals/index.js","../../../packages/contracts/dist/types/config.js","../../../packages/contracts/dist/types/protection.js","../../../packages/contracts/dist/types/snapshot.js","../../../packages/contracts/dist/dashboard/metrics.js","../../../packages/intelligence/src/knowledge/query-classifier.ts","../../../packages/intelligence/src/types/advisory.ts","../../../packages/intelligence/src/utils/logger.ts","../../../packages/intelligence/src/advisory/rules/ConsecutiveModificationRule.ts","../../../packages/intelligence/src/advisory/rules/FragileFileRule.ts","../../../packages/intelligence/src/advisory/rules/GenericSuggestionsRule.ts","../../../packages/intelligence/src/advisory/rules/LoopDetectionRule.ts","../../../packages/intelligence/src/advisory/rules/SkippedTestRule.ts","../../../packages/intelligence/src/advisory/rules/ViolationHistoryRule.ts","../../../packages/intelligence/src/advisory/AdvisoryEngine.ts","../../../packages/intelligence/src/composer/types.ts","../../../packages/intelligence/src/composer/budget.ts","../../../packages/intelligence/src/composer/allocation.ts","../../../packages/intelligence/src/composer/cache.ts","../../../packages/intelligence/src/composer/constraints.ts","../../../packages/intelligence/src/composer/determinism.ts","../../../packages/intelligence/src/composer/scoring.ts","../../../packages/intelligence/src/composer/explainability.ts","../../../packages/intelligence/src/composer/fingerprint.ts","../../../packages/intelligence/src/composer/rendering.ts","../../../packages/intelligence/src/composer/replay.ts","../../../packages/intelligence/src/composer/selection.ts","../../../packages/intelligence/src/composer/Composer.ts","../../../packages/intelligence/src/confidence/ConfidenceCalculator.ts","../../../packages/intelligence/src/storage/JsonlStore.ts","../../../packages/intelligence/src/context/ContextEngine.ts","../../../packages/intelligence/src/context/SemanticRetriever.ts","../../../packages/intelligence/src/domain/bundles/api.ts","../../../packages/intelligence/src/domain/bundles/auth.ts","../../../packages/intelligence/src/domain/bundles/daemon.ts","../../../packages/intelligence/src/knowledge/frameworks/astro.ts","../../../packages/intelligence/src/knowledge/frameworks/express.ts","../../../packages/intelligence/src/knowledge/frameworks/nestjs.ts","../../../packages/intelligence/src/knowledge/frameworks/nextjs.ts","../../../packages/intelligence/src/knowledge/frameworks/react-vite.ts","../../../packages/intelligence/src/knowledge/registry.ts","../../../packages/intelligence/src/patterns/GapAnalyzer.ts","../../../packages/intelligence/src/patterns/matchers/error-handling.ts","../../../packages/intelligence/src/patterns/matchers/performance.ts","../../../packages/intelligence/src/patterns/matchers/security.ts","../../../packages/intelligence/src/patterns/matchers/testing.ts","../../../packages/intelligence/src/patterns/matchers/index.ts","../../../packages/intelligence/src/patterns/PatternDetector.ts","../../../packages/intelligence/src/fingerprint/WorkspaceProfiler.ts","../../../packages/intelligence/src/types/learning.ts","../../../packages/intelligence/src/learning/LearningEngine.ts","../../../packages/intelligence/src/learning/ViolationTracker.ts","../../../packages/intelligence/src/types/session.ts","../../../packages/intelligence/src/session/LoopDetector.ts","../../../packages/intelligence/src/session/SessionManager.ts","../../../packages/intelligence/src/storage/ConfigStore.ts","../../../packages/intelligence/src/types/config.ts","../../../packages/intelligence/src/types/validation.ts","../../../packages/intelligence/src/validation/DynamicConfidenceCalculator.ts","../../../packages/intelligence/src/policy/detectors/SecretDetector.ts","../../../packages/intelligence/src/validation/layers/BiomeLayer.ts","../../../packages/intelligence/src/validation/layers/TypeScriptCompilerLayer.ts","../../../packages/intelligence/src/validation/layers/index.ts","../../../packages/intelligence/src/validation/ValidationPipeline.ts","../../../packages/intelligence/src/vitals/BehaviorTracker.ts","../../../packages/intelligence/src/vitals/constants.ts","../../../packages/intelligence/src/vitals/learning/PhaseDetector.ts","../../../packages/intelligence/src/types/vitals-learning.ts","../../../packages/intelligence/src/vitals/learning/ThresholdCalibrator.ts","../../../packages/intelligence/src/vitals/learning/TrajectoryPredictor.ts","../../../packages/intelligence/src/vitals/learning/UserBehaviorLearner.ts","../../../packages/intelligence/src/vitals/OxygenSensor.ts","../../../packages/intelligence/src/vitals/PressureGauge.ts","../../../packages/intelligence/src/vitals/PulseTracker.ts","../../../packages/intelligence/src/vitals/TemperatureMonitor.ts","../../../packages/intelligence/src/vitals/WorkspaceVitals.ts","../../../packages/intelligence/src/Intelligence.ts","../../../packages/intelligence/src/knowledge/confidence.ts","../../../packages/intelligence/src/knowledge/embeddings.ts","../../../packages/intelligence/src/knowledge/retriever.ts","../../../packages/intelligence/src/knowledge/store.ts","../../../packages/intelligence/src/policy/detectors/MockDetector.ts","../../../packages/intelligence/src/policy/detectors/PhantomDependencyDetector.ts","../../../packages/intelligence/src/policy/PolicyEngine.ts","../../../packages/intelligence/src/policy/SarifFormatter.ts","../../../packages/intelligence/src/policy/index.ts","../../../packages/intelligence/src/types/fragility.ts"],"names":["AuthErrorCodeSchema","z","enum","AuthErrorSchema","object","code","message","string","details","record","unknown","optional","UserRoleSchema","nullable","AuthUserSchema","id","email","name","image","url","emailVerified","boolean","createdAt","coerce","date","updatedAt","role","SessionSchema","userId","expiresAt","userAgent","ipAddress","SessionWithUserSchema","session","user","discriminatedUnion","status","literal","PasswordSchema","min","regex","EmailSchema","toLowerCase","trim","password","max","success","error","rememberMe","default","union","null","currentPassword","newPassword","provider","callbackURL","SnapBackEvent","QoSLevel","process","env","MCP_QUIET","SeveritySchema","RiskSeveritySchema","ValidationSeveritySchema","BaseIssueSchema","severity","type","line","number","fix","extend","file","column","snippet","rule","passed","issues","array","duration","CircuitBreakerStateEnumSchema","state","failures","threshold","lastFailure","cooldownMs","extendZodWithOpenApi","EVENT_VERSION","BaseEventSchema","event_version","openapi","example","timestamp","Date","now","SaveAttemptSchema","event","properties","protection","description","file_kind","reason","ai_present","ai_burst","outcome","SnapshotCreatedSchema","session_id","snapshot_id","bytes_original","bytes_stored","dedup_hit","latency_ms","SessionFinalizedSchema","files","triggers","duration_ms","highest_severity","ai_assist_level","ai_confidence_score","ai_provider","ai_large_insert_count","int","ai_total_chars","context","any","IssueCreatedSchema","issue_id","recommendation","IssueResolvedSchema","resolution","SessionRestoredSchema","files_restored","time_to_restore_ms","PolicyChangedSchema","pattern","from","to","source","AuthProviderSelectedSchema","trigger","AuthBrowserOpenedSchema","method","AuthCodeEntrySchema","code_format","time_to_enter_ms","attempts","code_length","AuthApprovalReceivedSchema","polling_attempts","total_wait_ms","device_code_expired","WelcomeFeatureViewedSchema","feature","position","WelcomeActionTriggeredSchema","action","time_viewed_ms","PerceivedHelpSchema","ActualChangesSchema","files_modified","lines_added","lines_removed","snapshots_used","PreventedIssuesSchema","rollbacks_avoided","pattern_violations_caught","skipped_tests_flagged","TierSchema","session_duration_ms","perceived_help","actual_changes","prevented_issues","tier","_loggerFactory","getLoggerFactory","LogLevel","createLogger","options","level","INFO","timestamps","formatMessage","levelStr","prefix","toISOString","formatMeta","meta","Error","stack","JSON","stringify","debug","DEBUG","console","info","warn","WARN","ERROR","SpanStatusCode","SpanKind","DiffChangeSchema","added","removed","value","count","RiskScoreSchema","score","factors","metrics","trends","insights","snapshotRecommendations","shouldCreateSnapshot","urgency","suggestedTiming","risk","content","changes","before","after","RetrySchema","retries","factor","jitter","CircuitSchema","enabled","errorThresholdPercentage","volumeThreshold","timeoutMs","resetMs","rollingCountMs","rollingCountBuckets","maxConcurrent","retry","circuit","batch","size","maxWaitMs","debounceMs","awaitWriteFinish","stabilityThreshold","pollInterval","ignored","createDefaultWorkspace","repoPath","workspaceId","workspaceName","permissions","read","write","manage","invite","resolvedFrom","generateCacheKey","SessionSchemaVersion","ChangeOpSchema","EOLTypeSchema","SessionTriggerSchema","SessionChangeSchema","p","op","hOld","hNew","sizeBefore","nonnegative","sizeAfter","mtimeBefore","mtimeAfter","modeBefore","modeAfter","eolBefore","eolAfter","schema","sessionId","startedAt","datetime","endedAt","workspaceUri","changeCount","filesChanged","snapshots","activeOnly","finalizedOnly","limit","positive","offset","idleMs","flushBatchSize","flushIntervalMs","useVSCodeWatcher","ignorePatterns","consent","ModificationSourceSchema","ModificationTypeSchema","path","linesChanged","aiAttributed","aiTool","fromIntelligenceFileModification","mod","extensionIds","velocity","charCount","AiDetectionOutputSchema","tool","confidence","indicators","ThreatPatternSchema","ThreatDetectionOutputSchema","threatCount","patterns","filePath","BurstDetectionOutputSchema","isBurst","ComplexityFileInputSchema","lineCount","ComplexityAnalysisOutputSchema","avgComplexity","maxComplexity","highComplexityFiles","fileCount","signal","triggered","signals","ai","threats","burst","complexity","overallRisk","riskLevel","triggeredSignals","processingTimeMs","SignalTypeSchema","ConfigFileTypeSchema","SupportedLanguageSchema","FileBaselineSchema","hash","language","critical","baseline","valid","metadata","errors","warnings","autoDetect","watchChanges","autoProtect","customPatterns","includePatterns","excludePatterns","ProtectionLevelSchema","icon","label","color","themeColor","ProtectedFileSchema","addedAt","PatternRuleSchema","ProtectionConfigSchema","defaultLevel","autoProtectConfigs","config","persistRegistry","registryPath","isProtected","__rewriteRelativeImportExtension","preserveJsx","test","replace","m","tsx","d","ext","cm","SnapshotTriggerSchema","SnapshotOriginSchema","SnapshotReasonCodeSchema","CheckpointTypeSchema","SnapshotSchema","version","fileContents","FileStateSchema","encrypted","iv","tag","algorithm","SnapshotFileRefV2Schema","blobHash","fileStates","iconColor","protected","origin","timeSinceLastChangeMs","FileDiffSchema","operation","linesAdded","linesRemoved","preview","currentChecksum","snapshotChecksum","DiffPreviewSchema","totalFiles","filesCreated","filesModified","filesDeleted","totalLinesAdded","totalLinesRemoved","diffs","ConflictReportSchema","restoredFiles","diffPreview","conflicts","verification","allVerified","results","verified","checksum","expected","enableDeduplication","namingStrategy","maxSnapshots","lastModified","totalSize","riskScore","tags","seq","parentSeq","parentId","anchorFile","compressionRatio","storageSizeBytes","reasons","aiDetection","detected","taskId","schemaVersion","blob","period","start","end","fileStats","total","byLanguage","byRisk","snapshotStats","frequency","averageSize","activity","createSnapshotStorage","basePath","StorageBrokerAdapter","storage","initialize","create","data","snapshot","Math","random","toString","slice","save","retrieve","get","list","restore","_targetPath","dryRun","String","PROTECTION_STATUSES","RECENT_ACTIVITY_ACTIONS","AI_TOOLS","RecentActivitySchema","ai_tool","AIActivityBreakdownSchema","copilot","cursor","claude","windsurf","DashboardMetricsSchema","protection_status","total_snapshots","total_recoveries","files_protected","ai_detection_rate","recent_activity","ai_breakdown","DashboardMetricsErrorSchema","normalizedQuery","query","weights","WEIGHT_CONFIGS","factual","calculateFactualScore","conceptual","calculateConceptualScore","exploratory","calculateExploratoryScore","entries","a","b","winningType","winningScore","secondScore","margin","calculateComplexity","buildReason","lowerQuery","PATTERNS","indicatorCount","words","length","hasComparison","includes","acronymCount","hasCodeIdentifier","match","scoreStr","Object","scores","map","s","complexityStr","sum","semantic","abs","filter","wordCount","complexityScore","hasMultipleClauses","hasConditional","questionCount","hasSequence","hasPossessive","isSimpleLookup","isSingleEntity","shouldRetrieve","topK","useReranking","useExpansion","synonyms","term","synonym","expanded","push","keyword","prefixes","classifyQuery","getWeightsForType","validateWeights","getRetrievalStrategy","CODE_SYNONYMS","expandQuery","maxWarnings","maxSuggestions","maxRelatedFiles","includeSessionContext","includeFileHistory","priority","ctx","generate","__name","suggestion","fragility","FRAGILITY_THRESHOLDS","MODERATE","isTestFile","isCodeFile","GenericSuggestionsRule","suggestions","category","loopsDetected","SkippedTestRule","allSkipped","filesWithSkipped","result","parsed","skipped","totalSkipped","recentViolations","violationsByFile","existing","violation","uniqueTypes","types","rules","DEFAULT_ADVISORY_CONFIG","ConsecutiveModificationRule","registerRule","FragileFileRule","LoopDetectionRule","ViolationHistoryRule","right","left","floor","mid","summary","relatedFiles","fileHistory","logger","ruleId","limitedSuggestions","sort","limitedRelatedFiles","generateFileHistory","generateSummary","sessionContext","toolCallCount","undefined","modificationsThisSession","fragilityScore","maxModFile","maxMods","fragilityLevel","modificationsToday","rollbacksThisWeek","lastModifiedBy","policy","local","structure","retrieved","history","constraint","rule_doc","local_diff","recent_edit","symbol_context","dependency_graph","test_context","semantic_match","session_history","learning","text","defaultTokenCounter","totalTokens","lanes","sumMins","lane","validateBudgetConfig","getLanesByPriority","byLane","candidates","candidate","set","groupByLane","sumTokenEstimates","allocateMinBudgets","allocation","shortfalls","pool","laneCandidates","available","laneMin","allocated","requested","selectWithinBudget","alreadySelected","selected","rejected","usage","tokenEstimate","totalUsed","tokens","laneMax","COMPOSER_VERSION","CACHE_TTL_MS","computeCacheKey","inputs","normalized","update","digest","computeCandidateDigest","sorted","createHash","join","computeConstraintsDigest","mustInclude","mustExclude","constraints","c","pinned","laneRequirements","r","computeBudgetConfigDigest","SelectionCache","cache","ttlMs","entry","delete","key","hitRate","pruned","workspaceFingerprint","triggerEvent","commitish","candidateDigest","rulesDigest","budgetConfigDigest","constraintsDigest","composerVersion","buildCacheKeyInputs","regexPattern","RegExp","matchGlob","artifact","matcher","matches","findMatchingConstraint","getPath","isExcluded","isPinned","isMustInclude","quantizeRelevance","Number","round","clamped","RELEVANCE_PRECISION","lanePriorityA","LANE_PRIORITIES","lanePriorityB","kindPriorityB","KIND_PRIORITIES","kind","kindPriorityA","tieBreaker","normalizedRecency","SCORING_WEIGHTS","recency","computeScore","scoreAndSort","scored","validateScoringWeights","keys","laneBreakdown","laneSelected","laneConfig","selectedCount","budgetUsed","laneUsage","budgetMax","topArtifacts","totalCandidates","rejections","summaryParts","topRejections","detail","pinnedCount","mustIncludeCount","constraintCounts","excludedCount","excluded","performance","candidateCount","cacheHit","buildExplanation","exp","withCacheHit","generateWorkspaceSecret","randomUUID","hashObject","renderArtifact","ref","exactTokenCount","countTokens","shrunk","renderArtifacts","refs","rendered","reduce","getTotalTokens","targetTokens","current","stratA","stratB","SHRINK_STRATEGIES","overflow","newTarget","saved","shrunkArtifact","shrinkToFit","applyShrinkStrategy","strategy","lines","split","startIndex","remaining","newContent","originalTokenCount","shrinkStrategy","truncateOldest","keepSignatures","signatures","inBody","braceDepth","trimmed","openBraces","closeBraces","startsWith","collapseSummary","itemCount","summaryNote","totalItems","currentEntry","i","entryContent","entryTokens","kept","unshift","droppedNote","droppedCount","dropEntries","generateLogId","emitDecisionLog","budgetConfig","selectedArtifacts","budgetAllocation","totalTokensUsed","actualTokens","rankings","cacheKey","durationMs","toRef","selectArtifacts","selectedIds","Set","afterExclude","exclusion","pinConstraint","mustIncludeConstraint","allocationDetails","eligible","budgetResult","add","computeSelectionCacheKey","components","str","char","charCodeAt","resolveConfig","cacheTtlMs","startTime","cacheKeyInputs","cached","explanation","selection","tokenCounter","actualTotal","finalRendered","selectedCandidates","rejectionReason","find","generateCandidates","tempSource","clear","workspaceSecret","allCandidates","sources","emitDecisionLogs","createComposer","syntax","security","biome","completeness","dependencies","high","medium","low","noAST","noSecurity","noCompleteness","noArchitecture","full","autoMerge","quickReview","totalWeight","weightedScore","weight","ANALYZER_WEIGHTS","breakdown","analyzer","analyzerResults","issue","penalty","SEVERITY_PENALTIES","maxPossibleConfidence","hasCriticalIssues","RECOMMENDATION_THRESHOLDS","COVERAGE_CAPS","astParsed","maxConfidence","parts","coverage","gaps","criticalIssues","flatMap","highIssues","totalIssues","avgCoverage","securityChecked","analyzerIds","completenessChecked","has","architectureChecked","filesCoverage","existsSync","filepath","loadJsonl","appendJsonl","dir","dirname","fs","mkdirSync","recursive","appendFileSync","appendJsonlAsync","writeFile","writeJsonl","records","writeFileSync","generateId","contractsGenerateId","configStore","initialized","effectiveKeywords","keywords","architecture","loadArchitecture","loadConstraints","loadPatterns","contextSections","filterRelevantSections","hardRules","extractHardRules","getRecentViolations","relevantLearnings","getRelevantLearnings","task","hint","stopWords","lowerKeywords","k","relevantSections","sections","section","some","kw","lowerSection","hardRulesMatch","violationsPath","violations","v","f","prevention","learningsPath","learnings","l","Array","isArray","violationCount","learningCount","embedder","db","rootDir","dbPath","contextFiles","DEFAULT_CONTEXT_FILES","SQL","initSqlJs","fileBuffer","readFileSync","Database","_err","buffer","Buffer","pipeline","indexed","fullPath","splitIntoSections","stmt","prepare","bind","row","existingContent","estimateTokens","embeddingBlob","Uint8Array","Float32Array","step","getAsObject","embedding","tokensUsed","sectionsIncluded","embeddingArray","byteOffset","totalDbTokens","pooling","normalize","dotProduct","normA","normB","denominator","currentHeader","currentContent","sectionContent","header","ceil","totalSections","countStmt","cnt","filesStmt","saveDb","close","required","detectWith","astPattern","failureMessage","fixSuggestion","applicableTo","createIssueId","idx","findIndex","findLine","daemonPatterns","detect","isDaemon","hasSIGINT","hasSIGTERM","hasUnixSocket","setsPermissions","readsData","hasLimit","isDaemonStart","hasLock","hasUncaughtHandler","isHttpServer","hasHealthEndpoint","hasServer","hasGracefulShutdown","importance","detection","docs","requiredDocumentation","purpose","expectedSections","directories","template","nextjsConfig","reactViteConfig","expressConfig","nestjsConfig","astroConfig","FRAMEWORK_CONFIGS","getAllFrameworks","FRAMEWORK_MAP","getFramework","getFrameworksByCategory","isValidFramework","detectFrameworks","detectedFrameworks","evaluateFramework","detectPrimaryFramework","frameworks","matchedWeight","matchedIndicators","detectedVersion","indicator","matched","checkIndicator","packageJson","devDependencies","filePaths","scripts","values","script","checkFileContent","coverageThreshold","includeOptional","frameworkConfig","expectedPatterns","relevantExpected","identifyGaps","detectionResult","strengths","isPositive","antiPatterns","foundPatterns","calculateScore","recommendations","generateRecommendations","totalExpected","patternsFound","patternsMissing","antiPatternsFound","criticalGaps","g","recommendedGaps","optionalGaps","profile","locations","loc","strength","missingPatterns","scannedFiles","found","patternId","patternName","getRecommendation","effort","estimateEffort","autoFixable","affectedFiles","importanceToSeverity","criticalPenalty","highPenalty","antiPatternPenalty","coverageScore","gap","patternCategoryToRecommendationCategory","title","actions","target","autoApply","healthImpact","antiPattern","estimatedTime","effortToTime","beforeMatch","regexMatch","index","createMatch","errorBoundaryMatcher","thenPattern","afterMatch","tryCatchMatcher","expressErrorMiddlewareMatcher","nestjsExceptionFilterMatcher","unhandledPromiseMatcher","globalErrorHandlerMatcher","reactMemoMatcher","lazyLoadingMatcher","imageOptimizationMatcher","largeBundleMatcher","cachingMatcher","asyncInLoopMatcher","compressionMatcher","helmetMatcher","corsMatcher","rateLimitMatcher","sqlInjectionMatcher","xssMatcher","hardcodedSecretsMatcher","inputValidationMatcher","authGuardMatcher","unitTestMatcher","vagueAssertionMatcher","integrationTestMatcher","reactTestingLibraryMatcher","e2eTestMatcher","mockingMatcher","coverageConfigMatcher","errorHandlingMatchers","securityMatchers","testingMatchers","performanceMatchers","createBuiltInMatchers","matchers","workspaceRoot","include","useAst","fileTimeout","matchersToRun","matcherIds","Map","relative","checkedPatterns","matcherAppliesToFile","fastGlob","ignore","exclude","absolute","onlyFiles","AbortController","timeout","setTimeout","controller","stats","encoding","clearTimeout","allMatches","relativePath","globToRegex","escaped","calculateStrength","uniqueFiles","avgConfidence","findMissingPatterns","foundIds","detectPatterns","maxFilesForLanguageDetection","skipDirectories","readPackageJson","getFilePaths","detectPackageManager","analyzeExistingContext","languages","analyzeLanguages","analyzeStructure","detectedPatterns","GapAnalyzer","root","framework","packageManager","existingContext","healthScore","packageJsonPath","parse","cwd","dot","lockfile","extensionToLanguage","extname","languageMap","extensions","percentage","sourceDirectories","testDirectories","configFiles","isMonorepo","monorepoTool","firstDir","totalLinesEstimate","codeFiles","hasContextDirectory","contextDirs","contextPath","qualityScore","fullContextPath","stat","readFile","quality","assessFileQuality","extractSections","headingPattern","hasPlaceholders","calculateContextQuality","good","outdated","empty","PatternDetector","maxFiles","calculateHealthScore","patternScore","highGaps","authentication","PROMOTE_TO_PATTERN","ADD_AUTOMATION","interactionsPath","goldenPath","learningsDir","interaction","interactions","updated","addedToGolden","feedback","correct","addToGoldenDataset","classifyQueryType","goldenExample","queryType","output","contextUsed","checkGoldenPromotion","forType","solution","input","golden","withFeedback","humanFeedback","queryTypeBreakdown","totalInteractions","feedbackReceived","correctRate","goldenExamples","shouldPromote","shouldAutomate","automatedAt","PROMOTION_THRESHOLDS","promotedAt","whatHappened","whyItHappened","wrongExample","correctExample","byType","readyForAutomation","readyForPromotion","maxToolCalls","maxConsecutiveSameTool","maxFileModifications","maxConsecutiveSameFile","sessionTimeoutMs","maxTurns","circuitBreakerThreshold","circuitBreakerCooldownMs","SEMANTIC_THRESHOLD","CONFIDENCE_THRESHOLD_HALT","CONFIDENCE_THRESHOLD_WARN","evidence","semanticResult","detectSemanticLoop","structuralResult","maxConsecutive","maxTool","sequence","isAlternating","toolCalls","maxSimilarity","recentCalls","j","call1","call2","similarity","args1","str2","args2","str1","tokens2","intersection","tokens1","args","sessions","limits","loopDetector","persistencePath","autosaveEnabled","DEFAULT_SESSION_LIMITS","autosave","loadSessions","catch","lastActivity","turnCount","fileModifications","consecutiveModifications","loopDetection","dedupKeys","consecutiveSameTool","semanticCache","circuitBreakers","riskReasons","getSession","ToolCallSchema","breaker","cooldownExpired","cooldownRemaining","consecutive","shift","call","toolNames","FileModificationSchema","consecutiveCount","updateRiskLevel","toolCallRate","fileModCount","loopResult","circuitBreakerTrips","previousLevel","newLevel","toolCounts","mostCalledTool","uniqueTools","currentLoopResult","timedOut","halted","totalToolCalls","filesTouched","peakRiskLevel","analytics","age","toolName","fromEntries","jsonl","loaded","archPath","constraintsPath","patternsPath","resolvePath","patternsDir","constraintsFile","violationsFile","embeddingsDb","enableSemanticSearch","enhancedValidation","enableLearningLoop","enableAutoPromotion","sessionLimits","sessionPersistence","advisoryConfig","AUTO_MERGE","QUICK_REVIEW","FULL_REVIEW","warning","DEFAULT_WEIGHTS","customWeights","layers","layer","layerWeight","severityWeight","getSeverityWeight","totalPenalty","layerName","findings","cleanedLines","removeMultiLineComments","SECRET_PATTERNS","lineNum","originalLine","matchAll","isInSingleLineComment","entropy","calculateEntropy","calculateRiskScore","freq","len","log2","stringPattern","substring","testPatterns","inComment","cleanedLine","endIndex","beforePosition","finding","totalScore","severityWeights","tempDir","mkdtemp","tempFile","execBiome","parseBiomeOutput","force","Promise","stdout","stderr","spawn","shell","stdio","proc","reject","resolve","err","diagnostics","diagnosticToIssue","diag","mapSeverity","location","span","beforeOffset","noUnusedImports","noUnusedVariables","noNonNullAssertion","noExplicitAny","useBlockStatements","noConsole","fileName","execTsc","parseTscOutput","tsCode","parseInt","getSuggestedFix","codeMatch","TS2322","TS2339","TS2345","TS2304","TS2531","TS2532","TS7006","TS2307","TS2341","TS2551","TS2769","SyntaxLayer","validate","closeBrackets","openBrackets","closeParens","openParens","anyMatches","nonNullMatches","hasSadPath","hasEdgeCase","hasErrorCase","paths","hasHappyPath","secretDetector","checkUnsafeFunctions","checkPrivacyViolations","checkEvalUsage","secretResult","adaptSecretFinding","findLineForMatch","unsafe","SecurityLayer","UNSAFE_FUNCTION_PATTERNS","lastIndex","toUpperCase","pkg","checkSyncFileIO","checkAwaitInLoop","checkNestedLoops","checkMemoryLeaks","checkReDoS","checkSpawnShellOption","forAwaitPattern","nestedForPattern","forWithForEachPattern","nestedForEachPattern","PerformanceLayer","spawnShellPattern","ok","ValidationError","confidenceCalculator","useDynamicConfidence","opts","customLayers","TypeLayer","TestLayer","ArchitectureLayer","DependencyLayer","BiomeLayer","TypeScriptCompilerLayer","layerResults","calculateConfidence","overall","focusPoints","failFast","CriticalValidationError","layerResult","allCriticalIssues","CONFIDENCE_THRESHOLDS","ValidationPipeline","flattenIssues","sessionStart","edits","tests","aiSuggestions","fileSaves","initialTime","linesDeleted","accepted","sessionDuration","totalSuggestions","acceptedSuggestions","rejectedSuggestions","aiAcceptanceRate","totalLinesChanged","sessionMinutes","churnRate","totalTests","passedTests","testPassRate","avgTimeBetweenEdits","intervals","fileSaveCount","aiSuggestionsShown","aiSuggestionsAccepted","aiSuggestionsRejected","saves","TRAJECTORY_THRESHOLDS","hotfix","intervalMultiplier","maxLinesBeforeSnapshot","riskMultiplier","recommendedIntervalMinutes","aiAdjustedIntervalMinutes","refactor","release","cachedPhase","lastBranch","override","phase","branchName","matchedPattern","thresholds","PHASE_THRESHOLDS","inferredPhase","detectPhase","expiryMinutes","overrides","clearCache","getOverride","active","pulseMultiplier","temperatureMultiplier","pressureMultiplier","oxygenMultiplier","clamp","ThresholdCalibrator","learner","observationCount","thresholdAdjustments","DEFAULT_THRESHOLD_ADJUSTMENTS","riskTolerance","typicalPulseLevel","snapshotFrequency","lastCalibratedAt","observations","getObservations","totalObservations","calculateStatus","calculateRiskTolerance","calculateTypicalPulseLevel","calculateAdjustments","CALIBRATION_THRESHOLDS","aggressiveRatio","lateSnapshots","earlyRatio","countConfidence","behaviors","earlySnapshots","alignedSnapshots","missedRecommendations","consistency","maxBehavior","entropyPenalty","baseMultiplier","clampedMultiplier","reset","TrajectoryPredictor","maxHistory","createDefaultForecast","getCurrentTrajectory","trend","calculateTrend","in5Minutes","predictTrajectoryAt","in10Minutes","timeToStateChange","calculateTimeToStateChange","recentHistory","pressureRate","oxygenRate","temperatureTrend","pulseTrend","calculateRate","oxygen","calculateTemperatureTrend","calculatePulseTrend","last","valueDelta","getValue","timeDeltaMinutes","first","delta","recent","recentRate","currentPressure","pressure","projectedPressure","targetPressure","timeMinutes","pressureDelta","generateId2","UserBehaviorLearner","classifyTiming","calculateUrgency","observation","vitals","userCreatedSnapshot","vitalsRecommended","urgencyAtTime","timing","trajectory","riskProfile","avgPressureAtSnapshot","avgOxygenAtSnapshot","early","o","late","missed","snapshotObs","avgPressure","avgOxygen","inferRiskProfile","aligned","missedRatio","lateRatio","staleMinutes","criticalWeight","DEFAULT_OXYGEN_CONFIG","modifiedFiles","recordSnapshot","staleThreshold","covered","stale","isCritical","isCriticalFile","snapshotTime","coveragePercentage","staleSnapshots","modified","CRITICAL_FILE_PATTERNS","baseRate","criticalMultiplier","decayOnSnapshot","maxPressure","changeBasedPressure","unsnapshotedChanges","lastSnapshotTime","criticalFilesTouched","DEFAULT_PRESSURE_CONFIG","increment","multiplier","minutesSinceSnapshot","timePressure","totalPressure","timeSinceLastSnapshot","getState","shouldSnapshot","educational","criticalFiles","primary","elevated","racing","windowSeconds","DEFAULT_PULSE_CONFIG","pruneOld","changesPerMinute","cutoff","warm","hot","burning","decaySeconds","aiEvents","humanEvents","DEFAULT_TEMPERATURE_CONFIG","aiPercentage","detectedTool","human","t","pulse","temperature","calibrator","predictor","phaseDetector","currentBranch","DEFAULT_VITALS_CONFIG","TemperatureMonitor","PressureGauge","OxygenSensor","PhaseDetector","behaviorTracker","BehaviorTracker","instance","WorkspaceVitals","instances","recordChange","recordModification","isAI","checkAndEmit","recordAIActivity","pulseData","tempData","getLevel","pressureData","oxygenData","should","snapshotDecision","blockedOps","safeOps","snapshotReason","riskyFiles","safeOperations","blockedOperations","getSuggestion","tempMultiplier","cold","decision","recordObservation","recordSnapshots","getAdjustedThresholds","recordEdit","recordTest","recordAISuggestion","getMetadata","getThresholdMultiplier","requiresFrequentSnapshots","phaseMultiplier","getPhaseThresholdMultiplier","criticalPressure","latestPressure","earliestPressure","pressureTrend","emit","contextEngine","validationPipeline","learningEngine","violationTracker","sessionManager","advisoryEngine","ConfigStore","ContextEngine","enhanced","ViolationTracker","SessionManager","quickCheck","report","recordFeedback","interactionId","getAgentGuidance","recordBehavior","tryGet","getCalibratedThresholds","getForecast","getBehaviorStats","getCalibrationProfile","resetLearning","recordFileSave","getBehavioralMetadata","startSession","recordToolCall","recordFileModification","getAnalytics","getFileModifications","IntelligenceConfigSchema","store","retrieval","calculateRetrievalConfidence","historical","calculateHistoricalConfidence","calculateActionConfidence","crossAgreement","semanticSimilarity","retrievalFactors","successRate","recentUsage","contextMatch","bestRank","getOutcomeStats","chunkId","testFail","successes","hasRecentOutcome","chunk","chunkText","taskType","fileMatches","violationMatches","testPass","violationPrevented","lastOutcome","outcome_type","latestDate","last_at","run","outcomeType","adr","deprecated","superseded","calculateMetadataBoost","sourceWeight","SOURCE_TYPE_WEIGHTS","authorityScore","authority","statusPenalty","STATUS_PENALTIES","statusFactor","updatedDate","daysSinceUpdate","recencyFactor","LN2","RECENCY_HALF_LIFE_DAYS","boost","calculateHistoricalBoost","usageBonus","recentSuccess","recentOutcomes","recentRatio","baseScore","historicalSignals","retrievalComponent","historicalComponent","metadataComponent","combined","calculateRerankingScore","items","item","originalScore","rerankScore","batchRerankingScores","getConfidenceLevel","embeddingPipeline","isLoading","loadPromise","MODEL_NAME","EMBEDDING_DIM","getEmbeddingPipeline","progress_callback","log","truncated","pipe","getEmbedding","cosineSimilarity","magnitude","preloadEmbeddings","semanticWeight","keywordWeight","minConfidence","candidateMultiplier","DEFAULT_CONFIG","candidateLimit","semanticResults","keywordResults","semanticSearch","keywordSearch","withConfidence","filtered","elapsed","classification","originalWeights","semanticCandidates","keywordCandidates","fusedCount","latencyMs","searchSemantic","rank","rrfScore","getChunk","historicalConfidence","actionConfidence","retrievalConfidence","inBoth","sim","inMemory","pragma","initSchema","exec","word","chunk_id","embeddedStmt","totalStmt","withEmbedding","missing","queryEmbedding","allEmbeddings","getAllEmbeddings","topIds","totalChunks","source_type","created_at","countMap","totalCount","successCount","recentStmt","recentRows","accessCount","chunkIds","getHistoricalSignals","chunkCounts","chunkMap","isSuccess","newAuthority","baseAuthority","isTestOrConfigFile","detectTestImports","detectMockPatterns","importPattern","importPath","testLib","TEST_IMPORTS","isLargeStructure","allowedPatterns","next","usageReport","phantomDeps","totalDeps","allDeps","dep","declaredIn","packageName","extractPackageName","exceptions","deps","ratio","detector","mockDetector","phantomDependencyDetector","MockDetector","PhantomDependencyDetector","defaultAction","totalFindings","isDetectorEnabled","determineAction","events","byDetector","secret","mock","highestAction","hasSeverity","getHigherAction","watch","block","toolVersion","toolUri","addRulesForEvent","sarifResult","convertFindingToResult","$schema","runs","driver","informationUri","deduplicateRules","shortDescription","defaultConfiguration","helpUri","convertSecretFinding","convertMockFinding","convertPhantomDependencyFinding","mapSeverityToLevel","artifactLocation","region","startLine","startColumn","seen","deduplicated","sarif","formatter","SarifFormatter","toSarif","require","blockOn","pathRules","POLICY_ETAG","effectiveConfig","DEFAULT_POLICY","effectiveBlockOn","matchesGlob","glob","effectiveThresholds","implicitBlockOn","issueCounts","getSeverity","rulesHit","rules_hit","policyVersion","etag","evaluate","criticalRatio","highRatio","mediumRatio","lowRatio","thresholdProximity","loadPolicyConfig","configPath","configContent","rollbackWindowDays","minRollbacksForFragile","coChangeThreshold","quickRollbackThresholdMs","scoreDecayRate"],"mappings":";;;;;;;;;;;;;;;;;;;;AAcO,IAAMA,mBAAAA,GAAsBC,EAAEC,IAAAA,CAAK;AACtC,EAAA,qBAAA;AACA,EAAA,gBAAA;AACA,EAAA,oBAAA;AACA,EAAA,iBAAA;AACA,EAAA,cAAA;AACA,EAAA,cAAA;AACA,EAAA,eAAA;AACA,EAAA,qBAAA;AACA,EAAA,eAAA;AACA,EAAA,eAAA;AACA,EAAA,aAAA;AACA,EAAA,eAAA;AACA,EAAA;AACH,CAAA,CAAA;AAkBM,IAAMC,eAAAA,GAAkBF,EAAEG,MAAAA,CAAO;EACpCC,IAAAA,EAAML,mBAAAA;AACNM,EAAAA,OAAAA,EAASL,EAAEM,MAAAA,EAAM;EACjBC,OAAAA,EAASP,CAAAA,CAAEQ,OAAOR,CAAAA,CAAEM,MAAAA,IAAUN,CAAAA,CAAES,OAAAA,EAAO,CAAA,CAAIC,QAAAA;AAC/C,CAAA,CAAA;ACxCO,IAAMC,cAAAA,GAAiBX,EAAEC,IAAAA,CAAK;AAAC,EAAA,OAAA;AAAS,EAAA,MAAA;AAAQ,EAAA;AAAS,CAAA,CAAA,CAAEW,QAAAA,EAAQ;AAOnE,IAAMC,cAAAA,GAAiBb,EAAEG,MAAAA,CAAO;AACnCW,EAAAA,EAAAA,EAAId,EAAEM,MAAAA,EAAM;EACZS,KAAAA,EAAOf,CAAAA,CAAEM,MAAAA,EAAM,CAAGS,KAAAA,EAAK;EACvBC,IAAAA,EAAMhB,CAAAA,CAAEM,MAAAA,EAAM,CAAGM,QAAAA,EAAQ;AACzBK,EAAAA,KAAAA,EAAOjB,EAAEM,MAAAA,EAAM,CAAGY,KAAG,CAAGN,QAAAA,GAAWF,QAAAA,EAAQ;AAC3CS,EAAAA,aAAAA,EAAenB,EAAEoB,OAAAA,EAAO;EACxBC,SAAAA,EAAWrB,CAAAA,CAAEsB,OAAOC,IAAAA,EAAI;EACxBC,SAAAA,EAAWxB,CAAAA,CAAEsB,OAAOC,IAAAA,EAAI;;AAExBE,EAAAA,IAAAA,EAAMd,eAAeD,QAAAA;AACzB,CAAA,CAAA;AAOO,IAAMgB,aAAAA,GAAgB1B,EAAEG,MAAAA,CAAO;AAClCW,EAAAA,EAAAA,EAAId,EAAEM,MAAAA,EAAM;AACZqB,EAAAA,MAAAA,EAAQ3B,EAAEM,MAAAA,EAAM;EAChBsB,SAAAA,EAAW5B,CAAAA,CAAEsB,OAAOC,IAAAA,EAAI;EACxBF,SAAAA,EAAWrB,CAAAA,CAAEsB,OAAOC,IAAAA,EAAI;EACxBC,SAAAA,EAAWxB,CAAAA,CAAEsB,OAAOC,IAAAA,EAAI;;AAExBM,EAAAA,SAAAA,EAAW7B,CAAAA,CAAEM,MAAAA,EAAM,CAAGM,QAAAA,GAAWF,QAAAA,EAAQ;AACzCoB,EAAAA,SAAAA,EAAW9B,CAAAA,CAAEM,MAAAA,EAAM,CAAGM,QAAAA,GAAWF,QAAAA;AACrC,CAAA,CAAA;AAgBO,IAAMqB,qBAAAA,GAAwB/B,EAAEG,MAAAA,CAAO;EAC1C6B,OAAAA,EAASN,aAAAA;EACTO,IAAAA,EAAMpB;AACV,CAAA,CAAA;AA2B+Bb,CAAAA,CAAEkC,kBAAAA,CAAmB,QAAA,EAAU;AAC1DlC,EAAAA,CAAAA,CAAEG,MAAAA,CAAO;IACLgC,MAAAA,EAAQnC,CAAAA,CAAEoC,QAAQ,eAAA,CAAA;IAClBH,IAAAA,EAAMpB,cAAAA;IACNmB,OAAAA,EAASN;GACb,CAAA;AACA1B,EAAAA,CAAAA,CAAEG,MAAAA,CAAO;IACLgC,MAAAA,EAAQnC,CAAAA,CAAEoC,QAAQ,iBAAA;GACtB,CAAA;AACApC,EAAAA,CAAAA,CAAEG,MAAAA,CAAO;IACLgC,MAAAA,EAAQnC,CAAAA,CAAEoC,QAAQ,SAAA;GACtB;AACH,CAAA;;;ACjFM,IAAMC,iBAAiBrC,CAAAA,CACzBM,MAAAA,GACAgC,GAAAA,CAAI,CAAA,EAAG,wCAAA,CAAA,CACPC,KAAAA,CAAM,OAAA,EAAS,qDAAA,EACfA,KAAAA,CAAM,OAAA,EAAS,qDAAA,CAAA,CACfA,KAAAA,CAAM,SAAS,2CAAA,CAAA;AAMb,IAAMC,WAAAA,GAAcxC,EAAEM,MAAAA,EAAM,CAAGS,MAAM,uBAAA,CAAA,CAAyB0B,WAAAA,EAAW,CAAGC,IAAAA,EAAI;AAapD1C,EAAEG,MAAAA,CAAO;EACxCY,KAAAA,EAAOyB,WAAAA;EACPG,QAAAA,EAAUN,cAAAA;EACVrB,IAAAA,EAAMhB,CAAAA,CAAEM,MAAAA,EAAM,CAAGgC,GAAAA,CAAI,CAAA,EAAG,kBAAA,CAAA,CAAoBM,GAAAA,CAAI,GAAA,EAAK,kBAAA,CAAA,CAAoBF,IAAAA;AAC7E,CAAA;AAgBoC1C,CAAAA,CAAEkC,kBAAAA,CAAmB,SAAA,EAAW;AAChElC,EAAAA,CAAAA,CAAEG,MAAAA,CAAO;IACL0C,OAAAA,EAAS7C,CAAAA,CAAEoC,QAAQ,IAAA,CAAA;IACnBH,IAAAA,EAAMpB;GACV,CAAA;AACAb,EAAAA,CAAAA,CAAEG,MAAAA,CAAO;IACL0C,OAAAA,EAAS7C,CAAAA,CAAEoC,QAAQ,KAAA,CAAA;IACnBU,KAAAA,EAAO5C;GACX;AACH,CAAA;AAiBkCF,EAAEG,MAAAA,CAAO;EACxCY,KAAAA,EAAOyB,WAAAA;AACPG,EAAAA,QAAAA,EAAU3C,CAAAA,CAAEM,MAAAA,EAAM,CAAGgC,GAAAA,CAAI,GAAG,sBAAA,CAAA;AAC5BS,EAAAA,UAAAA,EAAY/C,EAAEoB,OAAAA,EAAO,CAAGV,QAAAA,EAAQ,CAAGsC,QAAQ,KAAA;AAC/C,CAAA;AAiBoChD,CAAAA,CAAEkC,kBAAAA,CAAmB,SAAA,EAAW;AAChElC,EAAAA,CAAAA,CAAEG,MAAAA,CAAO;IACL0C,OAAAA,EAAS7C,CAAAA,CAAEoC,QAAQ,IAAA,CAAA;IACnBH,IAAAA,EAAMpB,cAAAA;AACNmB,IAAAA,OAAAA,EAAShC,EAAEG,MAAAA,CAAO;AACdW,MAAAA,EAAAA,EAAId,EAAEM,MAAAA,EAAM;MACZsB,SAAAA,EAAW5B,CAAAA,CAAEsB,OAAOC,IAAAA;KACxB;GACJ,CAAA;AACAvB,EAAAA,CAAAA,CAAEG,MAAAA,CAAO;IACL0C,OAAAA,EAAS7C,CAAAA,CAAEoC,QAAQ,KAAA,CAAA;IACnBU,KAAAA,EAAO5C;GACX;AACH,CAAA;AAgBuCF,EAAEiD,KAAAA,CAAM;AAAClB,EAAAA,qBAAAA;AAAuB/B,EAAAA,CAAAA,CAAEkD,IAAAA;AAAO,CAAA;AAM5ClD,CAAAA,CAAEkC,kBAAAA,CAAmB,SAAA,EAAW;AACjElC,EAAAA,CAAAA,CAAEG,MAAAA,CAAO;IACL0C,OAAAA,EAAS7C,CAAAA,CAAEoC,QAAQ,IAAA;GACvB,CAAA;AACApC,EAAAA,CAAAA,CAAEG,MAAAA,CAAO;IACL0C,OAAAA,EAAS7C,CAAAA,CAAEoC,QAAQ,KAAA,CAAA;IACnBU,KAAAA,EAAO5C;GACX;AACH,CAAA;AAcyCF,EAAEG,MAAAA,CAAO;EAC/Ca,IAAAA,EAAMhB,CAAAA,CAAEM,MAAAA,EAAM,CAAGgC,GAAAA,CAAI,CAAA,CAAA,CAAGM,GAAAA,CAAI,GAAA,CAAA,CAAKF,IAAAA,EAAI,CAAGhC,QAAAA,EAAQ;AAChDO,EAAAA,KAAAA,EAAOjB,CAAAA,CAAEM,MAAAA,EAAM,CAAGY,GAAAA,GAAMR,QAAAA;AAC5B,CAAA;AAI2CV,CAAAA,CAAEkC,kBAAAA,CAAmB,SAAA,EAAW;AACvElC,EAAAA,CAAAA,CAAEG,MAAAA,CAAO;IACL0C,OAAAA,EAAS7C,CAAAA,CAAEoC,QAAQ,IAAA,CAAA;IACnBH,IAAAA,EAAMpB;GACV,CAAA;AACAb,EAAAA,CAAAA,CAAEG,MAAAA,CAAO;IACL0C,OAAAA,EAAS7C,CAAAA,CAAEoC,QAAQ,KAAA,CAAA;IACnBU,KAAAA,EAAO5C;GACX;AACH,CAAA;AAM0CF,EAAEG,MAAAA,CAAO;AAChDgD,EAAAA,eAAAA,EAAiBnD,CAAAA,CAAEM,MAAAA,EAAM,CAAGgC,GAAAA,CAAI,GAAG,8BAAA,CAAA;EACnCc,WAAAA,EAAaf;AACjB,CAAA;AAI4CrC,CAAAA,CAAEkC,kBAAAA,CAAmB,SAAA,EAAW;AACxElC,EAAAA,CAAAA,CAAEG,MAAAA,CAAO;IACL0C,OAAAA,EAAS7C,CAAAA,CAAEoC,QAAQ,IAAA;GACvB,CAAA;AACApC,EAAAA,CAAAA,CAAEG,MAAAA,CAAO;IACL0C,OAAAA,EAAS7C,CAAAA,CAAEoC,QAAQ,KAAA,CAAA;IACnBU,KAAAA,EAAO5C;GACX;AACH,CAAA;AAMuCF,EAAEG,MAAAA,CAAO;AAC7CkD,EAAAA,QAAAA,EAAUrD,EAAEC,IAAAA,CAAK;AAAC,IAAA,QAAA;AAAU,IAAA;AAAS,GAAA,CAAA;AACrCqD,EAAAA,WAAAA,EAAatD,CAAAA,CAAEM,MAAAA,EAAM,CAAGY,GAAAA,GAAMR,QAAAA;AAClC,CAAA;AC7MO,IAAI6C,aAAAA;AACV,CAAA,SAAUA,cAAAA,EAAa;AACpBA,EAAAA,cAAAA,CAAc,kBAAA,CAAA,GAAsB,kBAAA;AACpCA,EAAAA,cAAAA,CAAc,kBAAA,CAAA,GAAsB,kBAAA;AACpCA,EAAAA,cAAAA,CAAc,mBAAA,CAAA,GAAuB,mBAAA;AACrCA,EAAAA,cAAAA,CAAc,iBAAA,CAAA,GAAqB,0BAAA;AACnCA,EAAAA,cAAAA,CAAc,oBAAA,CAAA,GAAwB,oBAAA;AACtCA,EAAAA,cAAAA,CAAc,gBAAA,CAAA,GAAoB,gBAAA;AAClCA,EAAAA,cAAAA,CAAc,kBAAA,CAAA,GAAsB,kBAAA;AACpCA,EAAAA,cAAAA,CAAc,oBAAA,CAAA,GAAwB,oBAAA;AACtCA,EAAAA,cAAAA,CAAc,oBAAA,CAAA,GAAwB,oBAAA;AAC1C,CAAA,EAAGA,aAAAA,KAAkBA,aAAAA,GAAgB,EAAC,CAAA,CAAA;AAE/B,IAAIC,QAAAA;AACV,CAAA,SAAUA,SAAAA,EAAQ;AACfA,EAAAA,SAAAA,CAASA,SAAAA,CAAS,aAAA,CAAA,GAAiB,CAAA,CAAA,GAAK,aAAA;AACxCA,EAAAA,SAAAA,CAASA,SAAAA,CAAS,eAAA,CAAA,GAAmB,CAAA,CAAA,GAAK,eAAA;AAC1CA,EAAAA,SAAAA,CAASA,SAAAA,CAAS,cAAA,CAAA,GAAkB,CAAA,CAAA,GAAK,cAAA;AAC7C,CAAA,EAAGA,QAAAA,KAAaA,QAAAA,GAAW,EAAC,CAAA,CAAA;AAEVC,OAAAA,CAAQC,GAAAA,CAAIC,cAAc,GAAA,IAAOF,OAAAA,CAAQC,IAAIC,SAAAA,KAAc;ACZtE,IAAMC,cAAAA,GAAiB5D,EAAEC,IAAAA,CAAK;AAAC,EAAA,UAAA;AAAY,EAAA,MAAA;AAAQ,EAAA,QAAA;AAAU,EAAA,KAAA;AAAO,EAAA;AAAO,CAAA,CAAA;AAM3E,IAAM4D,kBAAAA,GAAqB7D,EAAEC,IAAAA,CAAK;AAAC,EAAA,UAAA;AAAY,EAAA,MAAA;AAAQ,EAAA,QAAA;AAAU,EAAA;AAAM,CAAA,CAAA;AAKvE,IAAM6D,wBAAAA,GAA2B9D,EAAEC,IAAAA,CAAK;AAAC,EAAA,UAAA;AAAY,EAAA,SAAA;AAAW,EAAA;AAAO,CAAA,CAAA;AAgCvE,IAAM8D,eAAAA,GAAkB/D,EAAEG,MAAAA,CAAO;;AAEpC6D,EAAAA,QAAAA,EAAUhE,EAAEiD,KAAAA,CAAM;AAACW,IAAAA,cAAAA;AAAgBE,IAAAA;AAAyB,GAAA,CAAA;;AAE5DG,EAAAA,IAAAA,EAAMjE,EAAEM,MAAAA,EAAM;;AAEdD,EAAAA,OAAAA,EAASL,EAAEM,MAAAA,EAAM;;EAEjB4D,IAAAA,EAAMlE,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA,EAAQ;;EAEzB0D,GAAAA,EAAKpE,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA;AACpB,CAAA,CAAA;AAKqCqD,gBAAgBM,MAAAA,CAAO;EACxDL,QAAAA,EAAUF;AACd,CAAA;AAKmCC,gBAAgBM,MAAAA,CAAO;;AAEtDvD,EAAAA,EAAAA,EAAId,EAAEM,MAAAA,EAAM;;EAEZ0D,QAAAA,EAAUJ,cAAAA;;EAEVU,IAAAA,EAAMtE,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;;EAEzB6D,MAAAA,EAAQvE,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA,EAAQ;;EAE3B8D,OAAAA,EAASxE,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;;EAE5B+D,IAAAA,EAAMzE,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA;AACrB,CAAA;AAIsCV,EAAEG,MAAAA,CAAO;;AAE3CuE,EAAAA,MAAAA,EAAQ1E,EAAEoB,OAAAA,EAAO;;EAEjBuD,MAAAA,EAAQ3E,CAAAA,CAAE4E,MAAMb,eAAAA,CAAAA;;EAEhBc,QAAAA,EAAU7E,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA;AACzB,CAAA;AAIO,IAAMoE,6BAAAA,GAAgC9E,EAAEC,IAAAA,CAAK;AAAC,EAAA,QAAA;AAAU,EAAA,MAAA;AAAQ,EAAA;AAAY,CAAA,CAAA;AAK1CD,EAAEG,MAAAA,CAAO;;EAE9C4E,KAAAA,EAAOD,6BAAAA;;AAEPE,EAAAA,QAAAA,EAAUhF,EAAEmE,MAAAA,EAAM;;AAElBc,EAAAA,SAAAA,EAAWjF,EAAEmE,MAAAA,EAAM;;EAEnBe,WAAAA,EAAalF,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA,EAAQ;;AAEhCyE,EAAAA,UAAAA,EAAYnF,EAAEmE,MAAAA;AAClB,CAAA;;;AC3HAiB,oBAAAA,CAAqBpF,CAAAA,CAAAA;AAEd,IAAMqF,aAAAA,GAAgB,OAAA;AAEtB,IAAMC,eAAAA,GAAkBtF,EAAEG,MAAAA,CAAO;AACpCoF,EAAAA,aAAAA,EAAevF,EAAEM,MAAAA,EAAM,CAAG0C,OAAAA,CAAQqC,aAAAA,EAAeG,OAAAA,CAAQ;IAAEC,OAAAA,EAAS;GAAQ,CAAA;EAC5EC,SAAAA,EAAW1F,CAAAA,CACNmE,QAAM,CACNnB,OAAAA,CAAQ,MAAM2C,IAAAA,CAAKC,GAAAA,EAAG,CAAA,CACtBJ,OAAAA,CAAQ;IAAEC,OAAAA,EAAS;GAAc;AAC1C,CAAA,CAAA;AAEO,IAAMI,iBAAAA,GAAoBP,gBAAgBjB,MAAAA,CAAO;EACpDyB,KAAAA,EAAO9F,CAAAA,CAAEoC,QAAQ,cAAA,CAAA;AACjB2D,EAAAA,UAAAA,EAAY/F,EAAEG,MAAAA,CAAO;AACjB6F,IAAAA,UAAAA,EAAYhG,EAAEC,IAAAA,CAAK;AAAC,MAAA,OAAA;AAAS,MAAA,MAAA;AAAQ,MAAA;AAAQ,KAAA,CAAA,CAAEuF,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAAuC,CAAA;AAC7GjC,IAAAA,QAAAA,EAAUhE,EACLC,IAAAA,CAAK;AAAC,MAAA,KAAA;AAAO,MAAA,QAAA;AAAU,MAAA,MAAA;AAAQ,MAAA;AAAW,KAAA,CAAA,CAC1CuF,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAAgC,CAAA;IAC5DC,SAAAA,EAAWlG,CAAAA,CAAEM,MAAAA,EAAM,CAAGkF,OAAAA,CAAQ;MAAES,WAAAA,EAAa,8BAAA;MAAgCR,OAAAA,EAAS;KAAa,CAAA;IACnGU,MAAAA,EAAQnG,CAAAA,CAAEM,MAAAA,EAAM,CAAGkF,OAAAA,CAAQ;MACvBS,WAAAA,EAAa,6BAAA;MACbR,OAAAA,EAAS;KACb,CAAA;IACAW,UAAAA,EAAYpG,CAAAA,CAAEoB,OAAAA,EAAO,CAAGoE,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAA0C,CAAA;IACzFI,QAAAA,EAAUrG,CAAAA,CAAEoB,OAAAA,EAAO,CAAGoE,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAAiD,CAAA;AAC9FK,IAAAA,OAAAA,EAAStG,EAAEC,IAAAA,CAAK;AAAC,MAAA,OAAA;AAAS,MAAA,UAAA;AAAY,MAAA;AAAU,KAAA,CAAA,CAAEuF,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAA8B;GAC3G;AACJ,CAAA,CAAA,CAAGT,QAAQ,kBAAA,CAAA;AAEJ,IAAMe,qBAAAA,GAAwBjB,gBAAgBjB,MAAAA,CAAO;EACxDyB,KAAAA,EAAO9F,CAAAA,CAAEoC,QAAQ,kBAAA,CAAA;AACjB2D,EAAAA,UAAAA,EAAY/F,EAAEG,MAAAA,CAAO;IACjBqG,UAAAA,EAAYxG,CAAAA,CAAEM,MAAAA,EAAM,CAAGkF,OAAAA,CAAQ;MAAES,WAAAA,EAAa,mCAAA;MAAqCR,OAAAA,EAAS;KAAa,CAAA;IACzGgB,WAAAA,EAAazG,CAAAA,CAAEM,MAAAA,EAAM,CAAGkF,OAAAA,CAAQ;MAAES,WAAAA,EAAa,oCAAA;MAAsCR,OAAAA,EAAS;KAAa,CAAA;IAC3GiB,cAAAA,EAAgB1G,CAAAA,CAAEmE,MAAAA,EAAM,CAAGqB,OAAAA,CAAQ;MAAES,WAAAA,EAAa,oCAAA;MAAsCR,OAAAA,EAAS;KAAK,CAAA;IACtGkB,YAAAA,EAAc3G,CAAAA,CAAEmE,MAAAA,EAAM,CAAGqB,OAAAA,CAAQ;MAAES,WAAAA,EAAa,sCAAA;MAAwCR,OAAAA,EAAS;KAAI,CAAA;IACrGmB,SAAAA,EAAW5G,CAAAA,CAAEoB,OAAAA,EAAO,CAAGoE,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAAoC,CAAA;IAClFY,UAAAA,EAAY7G,CAAAA,CACPmE,MAAAA,EAAM,CACNqB,OAAAA,CAAQ;MAAES,WAAAA,EAAa,mDAAA;MAAqDR,OAAAA,EAAS;KAAG;GACjG;AACJ,CAAA,CAAA,CAAGD,QAAQ,sBAAA,CAAA;AAEJ,IAAMsB,sBAAAA,GAAyBxB,gBAAgBjB,MAAAA,CAAO;EACzDyB,KAAAA,EAAO9F,CAAAA,CAAEoC,QAAQ,mBAAA,CAAA;AACjB2D,EAAAA,UAAAA,EAAY/F,EAAEG,MAAAA,CAAO;IACjBqG,UAAAA,EAAYxG,CAAAA,CAAEM,MAAAA,EAAM,CAAGkF,OAAAA,CAAQ;MAAES,WAAAA,EAAa,mCAAA;MAAqCR,OAAAA,EAAS;KAAa,CAAA;AACzGsB,IAAAA,KAAAA,EAAO/G,EACF4E,KAAAA,CAAM5E,CAAAA,CAAEM,MAAAA,EAAM,EACdkF,OAAAA,CAAQ;MAAES,WAAAA,EAAa,8BAAA;MAAgCR,OAAAA,EAAS;AAAC,QAAA,cAAA;AAAgB,QAAA;;KAAgB,CAAA;AACtGuB,IAAAA,QAAAA,EAAUhH,EAAE4E,KAAAA,CAAM5E,CAAAA,CAAEM,MAAAA,EAAM,EAAIkF,OAAAA,CAAQ;MAClCS,WAAAA,EAAa,oDAAA;MACbR,OAAAA,EAAS;AAAC,QAAA,cAAA;AAAgB,QAAA;;KAC9B,CAAA;IACAwB,WAAAA,EAAajH,CAAAA,CAAEmE,MAAAA,EAAM,CAAGqB,OAAAA,CAAQ;MAAES,WAAAA,EAAa,yCAAA;MAA2CR,OAAAA,EAAS;KAAO,CAAA;IAC1GW,UAAAA,EAAYpG,CAAAA,CAAEoB,OAAAA,EAAO,CAAGoE,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAAyC,CAAA;IACxFI,QAAAA,EAAUrG,CAAAA,CAAEoB,OAAAA,EAAO,CAAGoE,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAAiD,CAAA;AAC9FiB,IAAAA,gBAAAA,EAAkBlH,EACbC,IAAAA,CAAK;AAAC,MAAA,MAAA;AAAQ,MAAA,KAAA;AAAO,MAAA,QAAA;AAAU,MAAA,MAAA;AAAQ,MAAA;AAAW,KAAA,CAAA,CAClDuF,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAA4C,CAAA;;AAExEkB,IAAAA,eAAAA,EAAiBnH,EACZC,IAAAA,CAAK;AAAC,MAAA,MAAA;AAAQ,MAAA,OAAA;AAAS,MAAA,QAAA;AAAU,MAAA,OAAA;AAAS,MAAA;KAAU,CAAA,CACpDS,QAAAA,GACA8E,OAAAA,CAAQ;MAAES,WAAAA,EAAa,mDAAA;MAAqDR,OAAAA,EAAS;KAAS,CAAA;IACnG2B,mBAAAA,EAAqBpH,CAAAA,CAChBmE,MAAAA,EAAM,CACN7B,GAAAA,CAAI,CAAA,CAAA,CACJM,GAAAA,CAAI,EAAA,CAAA,CACJlC,QAAAA,EAAQ,CACR8E,OAAAA,CAAQ;MAAES,WAAAA,EAAa,0CAAA;MAA4CR,OAAAA,EAAS;KAAI,CAAA;AACrF4B,IAAAA,WAAAA,EAAarH,EACRC,IAAAA,CAAK;AAAC,MAAA,QAAA;AAAU,MAAA,QAAA;AAAU,MAAA,SAAA;AAAW,MAAA;KAAO,CAAA,CAC5CS,QAAAA,GACA8E,OAAAA,CAAQ;MAAES,WAAAA,EAAa,2BAAA;MAA6BR,OAAAA,EAAS;KAAS,CAAA;IAC3E6B,qBAAAA,EAAuBtH,CAAAA,CAClBmE,MAAAA,EAAM,CACNoD,GAAAA,EAAG,CACHjF,IAAI,CAAA,CAAA,CACJ5B,QAAAA,EAAQ,CACR8E,OAAAA,CAAQ;MAAES,WAAAA,EAAa,oCAAA;MAAsCR,OAAAA,EAAS;KAAE,CAAA;IAC7E+B,cAAAA,EAAgBxH,CAAAA,CACXmE,MAAAA,EAAM,CACNoD,GAAAA,EAAG,CACHjF,IAAI,CAAA,CAAA,CACJ5B,QAAAA,EAAQ,CACR8E,OAAAA,CAAQ;MAAES,WAAAA,EAAa,sCAAA;MAAwCR,OAAAA,EAAS;KAAK,CAAA;IAClFgC,OAAAA,EAASzH,CAAAA,CACJQ,MAAAA,CAAOR,CAAAA,CAAEM,MAAAA,EAAM,EAAIN,CAAAA,CAAE0H,GAAAA,EAAG,CAAA,CACxBhH,QAAAA,EAAQ,CACR8E,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAAqC;GACrE;AACJ,CAAA,CAAA,CAAGT,QAAQ,uBAAA,CAAA;AAEJ,IAAMmC,kBAAAA,GAAqBrC,gBAAgBjB,MAAAA,CAAO;EACrDyB,KAAAA,EAAO9F,CAAAA,CAAEoC,QAAQ,eAAA,CAAA;AACjB2D,EAAAA,UAAAA,EAAY/F,EAAEG,MAAAA,CAAO;IACjByH,QAAAA,EAAU5H,CAAAA,CAAEM,MAAAA,EAAM,CAAGkF,OAAAA,CAAQ;MAAES,WAAAA,EAAa,iCAAA;MAAmCR,OAAAA,EAAS;KAAc,CAAA;IACtGe,UAAAA,EAAYxG,CAAAA,CAAEM,MAAAA,EAAM,CAAGkF,OAAAA,CAAQ;MAAES,WAAAA,EAAa,mCAAA;MAAqCR,OAAAA,EAAS;KAAa,CAAA;IACzGS,SAAAA,EAAWlG,CAAAA,CACNM,MAAAA,EAAM,CACNkF,OAAAA,CAAQ;MAAES,WAAAA,EAAa,2CAAA;MAA6CR,OAAAA,EAAS;KAAa,CAAA;AAC/FxB,IAAAA,IAAAA,EAAMjE,EAAEC,IAAAA,CAAK;AAAC,MAAA,QAAA;AAAU,MAAA,MAAA;AAAQ,MAAA;AAAU,KAAA,CAAA,CAAEuF,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAAyB,CAAA;AAC5FjC,IAAAA,QAAAA,EAAUH,mBAAmB2B,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAAwB,CAAA;IAC5E4B,cAAAA,EAAgB7H,CAAAA,CAAEM,MAAAA,EAAM,CAAGkF,OAAAA,CAAQ;MAC/BS,WAAAA,EAAa,wCAAA;MACbR,OAAAA,EAAS;KACb,CAAA;IACAgC,OAAAA,EAASzH,CAAAA,CAAEQ,MAAAA,CAAOR,CAAAA,CAAEM,MAAAA,EAAM,EAAIN,CAAAA,CAAE0H,GAAAA,EAAG,CAAA,CAAIhH,QAAAA,EAAQ,CAAG8E,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAAmC;GAChH;AACJ,CAAA,CAAA,CAAGT,QAAQ,mBAAA,CAAA;AAEJ,IAAMsC,mBAAAA,GAAsBxC,gBAAgBjB,MAAAA,CAAO;EACtDyB,KAAAA,EAAO9F,CAAAA,CAAEoC,QAAQ,gBAAA,CAAA;AACjB2D,EAAAA,UAAAA,EAAY/F,EAAEG,MAAAA,CAAO;IACjByH,QAAAA,EAAU5H,CAAAA,CAAEM,MAAAA,EAAM,CAAGkF,OAAAA,CAAQ;MAAES,WAAAA,EAAa,iCAAA;MAAmCR,OAAAA,EAAS;KAAc,CAAA;AACtGsC,IAAAA,UAAAA,EAAY/H,EAAEC,IAAAA,CAAK;AAAC,MAAA,OAAA;AAAS,MAAA,SAAA;AAAW,MAAA;AAAc,KAAA,CAAA,CAAEuF,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAA6B;GAChH;AACJ,CAAA,CAAA,CAAGT,QAAQ,oBAAA,CAAA;AAEJ,IAAMwC,qBAAAA,GAAwB1C,gBAAgBjB,MAAAA,CAAO;EACxDyB,KAAAA,EAAO9F,CAAAA,CAAEoC,QAAQ,kBAAA,CAAA;AACjB2D,EAAAA,UAAAA,EAAY/F,EAAEG,MAAAA,CAAO;IACjBqG,UAAAA,EAAYxG,CAAAA,CAAEM,MAAAA,EAAM,CAAGkF,OAAAA,CAAQ;MAAES,WAAAA,EAAa,mCAAA;MAAqCR,OAAAA,EAAS;KAAa,CAAA;AACzGwC,IAAAA,cAAAA,EAAgBjI,EACX4E,KAAAA,CAAM5E,CAAAA,CAAEM,MAAAA,EAAM,EACdkF,OAAAA,CAAQ;MAAES,WAAAA,EAAa,kCAAA;MAAoCR,OAAAA,EAAS;AAAC,QAAA,cAAA;AAAgB,QAAA;;KAAgB,CAAA;IAC1GyC,kBAAAA,EAAoBlI,CAAAA,CACfmE,MAAAA,EAAM,CACNqB,OAAAA,CAAQ;MAAES,WAAAA,EAAa,mDAAA;MAAqDR,OAAAA,EAAS;KAAK,CAAA;IAC/FU,MAAAA,EAAQnG,CAAAA,CACHM,MAAAA,EAAM,CACNkF,OAAAA,CAAQ;MAAES,WAAAA,EAAa,oCAAA;MAAsCR,OAAAA,EAAS;KAA0B;GACzG;AACJ,CAAA,CAAA,CAAGD,QAAQ,sBAAA,CAAA;AAEJ,IAAM2C,mBAAAA,GAAsB7C,gBAAgBjB,MAAAA,CAAO;EACtDyB,KAAAA,EAAO9F,CAAAA,CAAEoC,QAAQ,gBAAA,CAAA;AACjB2D,EAAAA,UAAAA,EAAY/F,EAAEG,MAAAA,CAAO;IACjBiI,OAAAA,EAASpI,CAAAA,CAAEM,MAAAA,EAAM,CAAGkF,OAAAA,CAAQ;MAAES,WAAAA,EAAa,yCAAA;MAA2CR,OAAAA,EAAS;KAAQ,CAAA;AACvG4C,IAAAA,IAAAA,EAAMrI,EACDC,IAAAA,CAAK;AAAC,MAAA,OAAA;AAAS,MAAA,MAAA;AAAQ,MAAA,OAAA;AAAS,MAAA,aAAA;AAAe,MAAA,iBAAA;AAAmB,MAAA;AAAU,KAAA,CAAA,CAC5EuF,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAA4B,CAAA;AACxDqC,IAAAA,EAAAA,EAAItI,EACCC,IAAAA,CAAK;AAAC,MAAA,OAAA;AAAS,MAAA,MAAA;AAAQ,MAAA,OAAA;AAAS,MAAA,aAAA;AAAe,MAAA,eAAA;AAAiB,MAAA;AAAQ,KAAA,CAAA,CACxEuF,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAAuB,CAAA;IACnDsC,MAAAA,EAAQvI,CAAAA,CAAEM,MAAAA,EAAM,CAAGkF,OAAAA,CAAQ;MAAES,WAAAA,EAAa,6BAAA;MAA+BR,OAAAA,EAAS;KAAM,CAAA;IACxFgC,OAAAA,EAASzH,CAAAA,CACJQ,MAAAA,CAAOR,CAAAA,CAAEM,MAAAA,EAAM,EAAIN,CAAAA,CAAE0H,GAAAA,EAAG,CAAA,CACxBhH,QAAAA,EAAQ,CACR8E,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAA2C;GAC3E;AACJ,CAAA,CAAA,CAAGT,QAAQ,oBAAA,CAAA;AAKJ,IAAMgD,0BAAAA,GAA6BlD,gBAAgBjB,MAAAA,CAAO;EAC7DyB,KAAAA,EAAO9F,CAAAA,CAAEoC,QAAQ,wBAAA,CAAA;AACjB2D,EAAAA,UAAAA,EAAY/F,EAAEG,MAAAA,CAAO;AACjBkD,IAAAA,QAAAA,EAAUrD,EAAEC,IAAAA,CAAK;AAAC,MAAA,OAAA;AAAS,MAAA;AAAc,KAAA,CAAA,CAAEuF,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAAmC,CAAA;AACrGwC,IAAAA,OAAAA,EAASzI,EACJC,IAAAA,CAAK;AAAC,MAAA,eAAA;AAAiB,MAAA,UAAA;AAAY,MAAA;AAAO,KAAA,CAAA,CAC1CuF,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAAgC;GAChE;AACJ,CAAA,CAAA,CAAGT,QAAQ,2BAAA,CAAA;AAEJ,IAAMkD,uBAAAA,GAA0BpD,gBAAgBjB,MAAAA,CAAO;EAC1DyB,KAAAA,EAAO9F,CAAAA,CAAEoC,QAAQ,qBAAA,CAAA;AACjB2D,EAAAA,UAAAA,EAAY/F,EAAEG,MAAAA,CAAO;AACjBwI,IAAAA,MAAAA,EAAQ3I,EACHC,IAAAA,CAAK;AAAC,MAAA,kBAAA;AAAoB,MAAA,WAAA;AAAa,MAAA;AAAQ,KAAA,CAAA,CAC/CuF,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAA8B,CAAA;IAC1DpD,OAAAA,EAAS7C,CAAAA,CAAEoB,OAAAA,EAAO,CAAGoE,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAA0C,CAAA;AACtFnD,IAAAA,KAAAA,EAAO9C,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,GAAW8E,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAA0C;GAClG;AACJ,CAAA,CAAA,CAAGT,QAAQ,wBAAA,CAAA;AAEJ,IAAMoD,mBAAAA,GAAsBtD,gBAAgBjB,MAAAA,CAAO;EACtDyB,KAAAA,EAAO9F,CAAAA,CAAEoC,QAAQ,iBAAA,CAAA;AACjB2D,EAAAA,UAAAA,EAAY/F,EAAEG,MAAAA,CAAO;AACjB0I,IAAAA,WAAAA,EAAa7I,EACRC,IAAAA,CAAK;AAAC,MAAA,OAAA;AAAS,MAAA,eAAA;AAAiB,MAAA;AAAe,KAAA,CAAA,CAC/CuF,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAAsC,CAAA;IAClE6C,gBAAAA,EAAkB9I,CAAAA,CAAEmE,MAAAA,EAAM,CAAGqB,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAA+C,CAAA;IACnG8C,QAAAA,EAAU/I,CAAAA,CAAEmE,QAAM,CAAGoD,GAAAA,GAAMjF,GAAAA,CAAI,CAAA,EAAGkD,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAAiD,CAAA;AAC1G+C,IAAAA,WAAAA,EAAahJ,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAG7G,QAAAA,GAAW8E,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAA6B;GACjG;AACJ,CAAA,CAAA,CAAGT,QAAQ,oBAAA,CAAA;AAEJ,IAAMyD,0BAAAA,GAA6B3D,gBAAgBjB,MAAAA,CAAO;EAC7DyB,KAAAA,EAAO9F,CAAAA,CAAEoC,QAAQ,wBAAA,CAAA;AACjB2D,EAAAA,UAAAA,EAAY/F,EAAEG,MAAAA,CAAO;IACjB+I,gBAAAA,EAAkBlJ,CAAAA,CACbmE,QAAM,CACNoD,GAAAA,GACAjF,GAAAA,CAAI,CAAA,EACJkD,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAA6C,CAAA;IACzEkD,aAAAA,EAAenJ,CAAAA,CAAEmE,MAAAA,EAAM,CAAGqB,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAAiD,CAAA;IAClGmD,mBAAAA,EAAqBpJ,CAAAA,CAAEoB,OAAAA,EAAO,CAAGoE,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAAsC;GAClG;AACJ,CAAA,CAAA,CAAGT,QAAQ,2BAAA,CAAA;AAEJ,IAAM6D,0BAAAA,GAA6B/D,gBAAgBjB,MAAAA,CAAO;EAC7DyB,KAAAA,EAAO9F,CAAAA,CAAEoC,QAAQ,wBAAA,CAAA;AACjB2D,EAAAA,UAAAA,EAAY/F,EAAEG,MAAAA,CAAO;IACjBmJ,OAAAA,EAAStJ,CAAAA,CAAEM,MAAAA,EAAM,CAAGkF,OAAAA,CAAQ;MAAES,WAAAA,EAAa,qCAAA;MAAuCR,OAAAA,EAAS;KAAe,CAAA;IAC1G8D,QAAAA,EAAUvJ,CAAAA,CAAEmE,QAAM,CAAGoD,GAAAA,GAAMjF,GAAAA,CAAI,CAAA,EAAGkD,OAAAA,CAAQ;MAAES,WAAAA,EAAa,8BAAA;MAAgCR,OAAAA,EAAS;KAAE,CAAA;AACpGgD,IAAAA,OAAAA,EAASzI,EACJC,IAAAA,CAAK;AAAC,MAAA,YAAA;AAAc,MAAA,OAAA;AAAS,MAAA;AAAS,KAAA,CAAA,CACtCuF,OAAAA,CAAQ;MAAES,WAAAA,EAAa;KAAsC;GACtE;AACJ,CAAA,CAAA,CAAGT,QAAQ,2BAAA,CAAA;AAEJ,IAAMgE,4BAAAA,GAA+BlE,gBAAgBjB,MAAAA,CAAO;EAC/DyB,KAAAA,EAAO9F,CAAAA,CAAEoC,QAAQ,0BAAA,CAAA;AACjB2D,EAAAA,UAAAA,EAAY/F,EAAEG,MAAAA,CAAO;IACjBsJ,MAAAA,EAAQzJ,CAAAA,CAAEM,MAAAA,EAAM,CAAGkF,OAAAA,CAAQ;MAAES,WAAAA,EAAa,0BAAA;MAA4BR,OAAAA,EAAS;KAAU,CAAA;IACzF6D,OAAAA,EAAStJ,CAAAA,CAAEM,MAAAA,EAAM,CAAGkF,OAAAA,CAAQ;MAAES,WAAAA,EAAa,oCAAA;MAAsCR,OAAAA,EAAS;KAAe,CAAA;IACzGiE,cAAAA,EAAgB1J,CAAAA,CACXmE,MAAAA,EAAM,CACNqB,OAAAA,CAAQ;MAAES,WAAAA,EAAa,+CAAA;MAAiDR,OAAAA,EAAS;KAAK;GAC/F;AACJ,CAAA,CAAA,CAAGD,QAAQ,6BAAA,CAAA;AAEoBxF,CAAAA,CAAEkC,kBAAAA,CAAmB,OAAA,EAAS;AACzD2D,EAAAA,iBAAAA;AACAU,EAAAA,qBAAAA;AACAO,EAAAA,sBAAAA;AACAa,EAAAA,kBAAAA;AACAG,EAAAA,mBAAAA;AACAE,EAAAA,qBAAAA;AACAG,EAAAA,mBAAAA;AACAK,EAAAA,0BAAAA;AACAE,EAAAA,uBAAAA;AACAE,EAAAA,mBAAAA;AACAK,EAAAA,0BAAAA;AACAI,EAAAA,0BAAAA;AACAG,EAAAA;AACH,CAAA;;;AChODpE,oBAAAA,CAAqBpF,CAAAA,CAAAA;AAOd,IAAM2J,mBAAAA,GAAsB3J,EAC9BC,IAAAA,CAAK;AAAC,EAAA,eAAA;AAAiB,EAAA,UAAA;AAAY,EAAA,YAAA;AAAc,EAAA;AAAU,CAAA,CAAA,CAC3DuF,OAAAA,CAAQ;EAAES,WAAAA,EAAa;AAAgD,CAAA,CAAA;AAU5E,IAAM2D,mBAAAA,GAAsB5J,EACvBG,MAAAA,CAAO;EACR0J,cAAAA,EAAgB7J,CAAAA,CACXmE,QAAM,CACNoD,GAAAA,GACAjF,GAAAA,CAAI,CAAA,EACJkD,OAAAA,CAAQ;IAAES,WAAAA,EAAa,yCAAA;IAA2CR,OAAAA,EAAS;GAAE,CAAA;EAClFqE,WAAAA,EAAa9J,CAAAA,CAAEmE,QAAM,CAAGoD,GAAAA,GAAMjF,GAAAA,CAAI,CAAA,EAAGkD,OAAAA,CAAQ;IAAES,WAAAA,EAAa,mBAAA;IAAqBR,OAAAA,EAAS;GAAI,CAAA;EAC9FsE,aAAAA,EAAe/J,CAAAA,CAAEmE,QAAM,CAAGoD,GAAAA,GAAMjF,GAAAA,CAAI,CAAA,EAAGkD,OAAAA,CAAQ;IAAES,WAAAA,EAAa,qBAAA;IAAuBR,OAAAA,EAAS;GAAG,CAAA;EACjGuE,cAAAA,EAAgBhK,CAAAA,CACXmE,QAAM,CACNoD,GAAAA,GACAjF,GAAAA,CAAI,CAAA,EACJkD,OAAAA,CAAQ;IAAES,WAAAA,EAAa,yCAAA;IAA2CR,OAAAA,EAAS;GAAE;AACtF,CAAA,CAAA,CACKD,QAAQ,eAAA,CAAA;AAIb,IAAMyE,qBAAAA,GAAwBjK,EACzBG,MAAAA,CAAO;EACR+J,iBAAAA,EAAmBlK,CAAAA,CACdmE,QAAM,CACNoD,GAAAA,GACAjF,GAAAA,CAAI,CAAA,EACJkD,OAAAA,CAAQ;IAAES,WAAAA,EAAa,oCAAA;IAAsCR,OAAAA,EAAS;GAAE,CAAA;EAC7E0E,yBAAAA,EAA2BnK,CAAAA,CACtBmE,QAAM,CACNoD,GAAAA,GACAjF,GAAAA,CAAI,CAAA,EACJkD,OAAAA,CAAQ;IAAES,WAAAA,EAAa,yCAAA;IAA2CR,OAAAA,EAAS;GAAE,CAAA;EAClF2E,qBAAAA,EAAuBpK,CAAAA,CAClBmE,QAAM,CACNoD,GAAAA,GACAjF,GAAAA,CAAI,CAAA,EACJkD,OAAAA,CAAQ;IAAES,WAAAA,EAAa,qCAAA;IAAuCR,OAAAA,EAAS;GAAE;AAClF,CAAA,CAAA,CACKD,QAAQ,iBAAA,CAAA;AAIb,IAAM6E,UAAAA,GAAarK,EAAEC,IAAAA,CAAK;AAAC,EAAA,MAAA;AAAQ,EAAA,MAAA;AAAQ,EAAA,MAAA;AAAQ,EAAA;AAAa,CAAA,CAAA,CAAEuF,OAAAA,CAAQ;EAAES,WAAAA,EAAa;AAA2B,CAAA,CAAA;AAO1EX,gBAAgBjB,MAAAA,CAAO;EAC7DyB,KAAAA,EAAO9F,CAAAA,CAAEoC,QAAQ,4BAAA,CAAA;AACjB2D,EAAAA,UAAAA,EAAY/F,EAAEG,MAAAA,CAAO;;IAEjBqG,UAAAA,EAAYxG,CAAAA,CAAEM,MAAAA,EAAM,CAAGkF,OAAAA,CAAQ;MAAES,WAAAA,EAAa,2BAAA;MAA6BR,OAAAA,EAAS;KAAa,CAAA;IACjG6E,mBAAAA,EAAqBtK,CAAAA,CAChBmE,QAAM,CACNoD,GAAAA,GACAjF,GAAAA,CAAI,CAAA,EACJkD,OAAAA,CAAQ;MAAES,WAAAA,EAAa,kCAAA;MAAoCR,OAAAA,EAAS;KAAQ,CAAA;;IAEjF8E,cAAAA,EAAgBZ,mBAAAA;;IAEhBa,cAAAA,EAAgBZ,mBAAAA;IAChBa,gBAAAA,EAAkBR,qBAAAA;;IAElBS,IAAAA,EAAML;GACV;AACJ,CAAA,CAAA,CAAG7E,QAAQ,2BAAA;;;AC5FX,IAAImF,cAAAA,GAAiB,IAAA;AAoBrB,SAASC,gBAAAA,GAAAA;AACL,EAAA,OAAOD,cAAAA;AACX;AAFSC,MAAAA,CAAAA,gBAAAA,EAAAA,kBAAAA,CAAAA;AAMF,IAAIC,QAAAA;AACV,CAAA,SAAUA,SAAAA,EAAQ;AACfA,EAAAA,SAAAA,CAASA,SAAAA,CAAS,OAAA,CAAA,GAAW,CAAA,CAAA,GAAK,OAAA;AAClCA,EAAAA,SAAAA,CAASA,SAAAA,CAAS,MAAA,CAAA,GAAU,CAAA,CAAA,GAAK,MAAA;AACjCA,EAAAA,SAAAA,CAASA,SAAAA,CAAS,MAAA,CAAA,GAAU,CAAA,CAAA,GAAK,MAAA;AACjCA,EAAAA,SAAAA,CAASA,SAAAA,CAAS,OAAA,CAAA,GAAW,CAAA,CAAA,GAAK,OAAA;AAClCA,EAAAA,SAAAA,CAASA,SAAAA,CAAS,QAAA,CAAA,GAAY,CAAA,CAAA,GAAK,QAAA;AACvC,CAAA,EAAGA,QAAAA,KAAaA,QAAAA,GAAW,EAAC,CAAA,CAAA;AAcrB,SAASC,aAAaC,OAAAA,EAAO;AAOhC,EAAA,MAAM,EAAE/J,IAAAA,EAAMgK,KAAAA,GAAQH,SAASI,IAAAA,EAAMC,UAAAA,GAAa,OAAK,GAAKH,OAAAA;AAC5D,EAAA,MAAMI,aAAAA,mBAAgB,MAAA,CAAA,CAACC,QAAAA,EAAU/K,OAAAA,KAAAA;AAC7B,IAAA,MAAMgL,MAAAA,GAASH,aAAa,CAAA,CAAA,EAAA,iBAAI,IAAIvF,MAAAA,EAAO2F,WAAAA,EAAW,CAAA,EAAA,CAAA,GAAS,EAAA;AAC/D,IAAA,OAAO,GAAGD,MAAAA,CAAAA,CAAAA,EAAUrK,IAAAA,CAAAA,EAAAA,EAASoK,QAAAA,KAAa/K,OAAAA,CAAAA,CAAAA;EAC9C,CAAA,EAHsB,eAAA,CAAA;AAItB,EAAA,MAAMkL,UAAAA,2BAAcC,IAAAA,KAAAA;AAChB,IAAA,IAAI,CAACA,IAAAA,EAAM;AACP,MAAA,OAAO,EAAA;AACX,IAAA;AACA,IAAA,IAAIA,gBAAgBC,KAAAA,EAAO;AACvB,MAAA,OAAO;AAAcD,SAAAA,EAAAA,IAAAA,CAAKnL,OAAO;AAAcmL,SAAAA,EAAAA,IAAAA,CAAKE,KAAK,CAAA,CAAA;AAC7D,IAAA;AACA,IAAA,IAAI;AACA,MAAA,OAAO;AACfC,EAAAA,EAAAA,IAAAA,CAAKC,SAAAA,CAAUJ,IAAAA,EAAM,IAAA,EAAM,CAAA,CAAA,CAAA,CAAA;IACvB,CAAA,CAAA,MACM;AACF,MAAA,OAAO,6CAAA;AACX,IAAA;EACJ,CAAA,EAdmB,YAAA,CAAA;AAenB,EAAA,OAAO;AACHK,IAAAA,KAAAA,CAAMxL,SAASmL,IAAAA,EAAI;AACf,MAAA,IAAIR,KAAAA,IAASH,SAASiB,KAAAA,EAAO;AACzBC,QAAAA,OAAAA,CAAQF,MAAMV,aAAAA,CAAc,OAAA,EAAS9K,OAAAA,CAAAA,GAAWkL,UAAAA,CAAWC,IAAAA,CAAAA,CAAAA;AAC/D,MAAA;AACJ,IAAA,CAAA;AACAQ,IAAAA,IAAAA,CAAK3L,SAASmL,IAAAA,EAAI;AACd,MAAA,IAAIR,KAAAA,IAASH,SAASI,IAAAA,EAAM;AACxBc,QAAAA,OAAAA,CAAQC,KAAKb,aAAAA,CAAc,MAAA,EAAQ9K,OAAAA,CAAAA,GAAWkL,UAAAA,CAAWC,IAAAA,CAAAA,CAAAA;AAC7D,MAAA;AACJ,IAAA,CAAA;AACAS,IAAAA,IAAAA,CAAK5L,SAASmL,IAAAA,EAAI;AACd,MAAA,IAAIR,KAAAA,IAASH,SAASqB,IAAAA,EAAM;AACxBH,QAAAA,OAAAA,CAAQE,KAAKd,aAAAA,CAAc,MAAA,EAAQ9K,OAAAA,CAAAA,GAAWkL,UAAAA,CAAWC,IAAAA,CAAAA,CAAAA;AAC7D,MAAA;AACJ,IAAA,CAAA;AACA1I,IAAAA,KAAAA,CAAMzC,SAASmL,IAAAA,EAAI;AACf,MAAA,IAAIR,KAAAA,IAASH,SAASsB,KAAAA,EAAO;AACzBJ,QAAAA,OAAAA,CAAQjJ,MAAMqI,aAAAA,CAAc,OAAA,EAAS9K,OAAAA,CAAAA,GAAWkL,UAAAA,CAAWC,IAAAA,CAAAA,CAAAA;AAC/D,MAAA;AACJ,IAAA;AACJ,GAAA;AACJ;AAjDgBV,MAAAA,CAAAA,YAAAA,EAAAA,cAAAA,CAAAA;;;ACxDDA,YAAAA,CAAa;EAAE9J,IAAAA,EAAM,iBAAA;AAAmBgK,EAAAA,KAAAA,EAAOH,QAAAA,CAASI;AAAK,CAAA;;;ACOrE,IAAImB,cAAAA;AACV,CAAA,SAAUA,eAAAA,EAAc;AAErBA,EAAAA,eAAAA,CAAeA,eAAAA,CAAe,OAAA,CAAA,GAAW,CAAA,CAAA,GAAK,OAAA;AAE9CA,EAAAA,eAAAA,CAAeA,eAAAA,CAAe,IAAA,CAAA,GAAQ,CAAA,CAAA,GAAK,IAAA;AAE3CA,EAAAA,eAAAA,CAAeA,eAAAA,CAAe,OAAA,CAAA,GAAW,CAAA,CAAA,GAAK,OAAA;AAClD,CAAA,EAAGA,cAAAA,KAAmBA,cAAAA,GAAiB,EAAC,CAAA,CAAA;AAIjC,IAAIC,QAAAA;AACV,CAAA,SAAUA,SAAAA,EAAQ;AACfA,EAAAA,SAAAA,CAASA,SAAAA,CAAS,UAAA,CAAA,GAAc,CAAA,CAAA,GAAK,UAAA;AACrCA,EAAAA,SAAAA,CAASA,SAAAA,CAAS,QAAA,CAAA,GAAY,CAAA,CAAA,GAAK,QAAA;AACnCA,EAAAA,SAAAA,CAASA,SAAAA,CAAS,QAAA,CAAA,GAAY,CAAA,CAAA,GAAK,QAAA;AACnCA,EAAAA,SAAAA,CAASA,SAAAA,CAAS,UAAA,CAAA,GAAc,CAAA,CAAA,GAAK,UAAA;AACrCA,EAAAA,SAAAA,CAASA,SAAAA,CAAS,UAAA,CAAA,GAAc,CAAA,CAAA,GAAK,UAAA;AACzC,CAAA,EAAGA,QAAAA,KAAaA,QAAAA,GAAW,EAAC,CAAA,CAAA;AC5BrB,IAAMC,gBAAAA,GAAmBtM,EAAEG,MAAAA,CAAO;AACrCoM,EAAAA,KAAAA,EAAOvM,EAAEoB,OAAAA,EAAO,CAAGV,QAAAA,EAAQ,CAAGsC,QAAQ,KAAA,CAAA;AACtCwJ,EAAAA,OAAAA,EAASxM,EAAEoB,OAAAA,EAAO,CAAGV,QAAAA,EAAQ,CAAGsC,QAAQ,KAAA,CAAA;AACxCyJ,EAAAA,KAAAA,EAAOzM,EAAEM,MAAAA,EAAM;EACfoM,KAAAA,EAAO1M,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA;AACtB,CAAA,CAAA;AAoBO,IAAMiM,eAAAA,GAAkB3M,EAAEG,MAAAA,CAAO;AACpCyM,EAAAA,KAAAA,EAAO5M,EAAEmE,MAAAA,EAAM,CAAG7B,IAAI,CAAA,CAAA,CAAGM,IAAI,EAAA,CAAA;AAC7BiK,EAAAA,OAAAA,EAAS7M,CAAAA,CAAE4E,KAAAA,CAAM5E,CAAAA,CAAEM,MAAAA,EAAM,CAAA;EACzB0D,QAAAA,EAAUH;AACd,CAAA,CAAA;AASuC7D,EAAEG,MAAAA,CAAO;AAC5C2M,EAAAA,OAAAA,EAAS9M,EAAEQ,MAAAA,CAAOR,CAAAA,CAAEM,QAAM,EAAIN,CAAAA,CAAEmE,QAAM,CAAA;EACtC4I,MAAAA,EAAQ/M,CAAAA,CAAEQ,MAAAA,CAAOR,CAAAA,CAAEM,MAAAA,EAAM,EAAIN,EAAE4E,KAAAA,CAAM5E,CAAAA,CAAEmE,MAAAA,EAAM,CAAA,CAAA;AAC7C6I,EAAAA,QAAAA,EAAUhN,CAAAA,CAAE4E,KAAAA,CAAM5E,CAAAA,CAAEM,MAAAA,EAAM,CAAA;AAC1BoF,EAAAA,SAAAA,EAAW1F,EAAEmE,MAAAA,EAAM;AACnB8I,EAAAA,uBAAAA,EAAyBjN,EACpBG,MAAAA,CAAO;AACR+M,IAAAA,oBAAAA,EAAsBlN,EAAEoB,OAAAA,EAAO;AAC/B+E,IAAAA,MAAAA,EAAQnG,EAAEM,MAAAA,EAAM;IAChB6M,OAAAA,EAAStJ,kBAAAA;AACTuJ,IAAAA,eAAAA,EAAiBpN,EAAEM,MAAAA;AACvB,GAAA,EACKI,QAAAA;AACT,CAAA;AACwCV,EAAEG,MAAAA,CAAO;AAC7CsI,EAAAA,OAAAA,EAASzI,CAAAA,CAAEM,MAAAA,EAAM,CAAG0C,OAAAA,CAAQ,QAAA,CAAA;EAC5BqK,IAAAA,EAAMrN,CAAAA,CAAEmE,QAAM,CAAG7B,GAAAA,CAAI,CAAA,CAAA,CAAGM,GAAAA,CAAI,EAAA,CAAA,CAAIlC,QAAAA,EAAQ;EACxC4M,OAAAA,EAAStN,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;AAC5BqG,EAAAA,KAAAA,EAAO/G,EAAE4E,KAAAA,CAAM5E,CAAAA,CAAEM,MAAAA,EAAM,EAAII,QAAAA;AAC/B,CAAA;AAC0CV,EAAEG,MAAAA,CAAO;AAC/CsI,EAAAA,OAAAA,EAASzI,CAAAA,CAAEM,MAAAA,EAAM,CAAG0C,OAAAA,CAAQ,QAAA,CAAA;EAC5BqK,IAAAA,EAAMrN,CAAAA,CAAEmE,QAAM,CAAG7B,GAAAA,CAAI,CAAA,CAAA,CAAGM,GAAAA,CAAI,EAAA,CAAA,CAAIlC,QAAAA,EAAQ;EACxC4M,OAAAA,EAAStN,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA;AACxB,CAAA;AACgCV,EAAEG,MAAAA,CAAO;AACrCW,EAAAA,EAAAA,EAAId,EAAEM,MAAAA,EAAM;AACZoF,EAAAA,SAAAA,EAAW1F,EAAEmE,MAAAA,EAAM;AACnBqH,EAAAA,IAAAA,EAAMxL,EACDG,MAAAA,CAAO;IACRsI,OAAAA,EAASzI,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;IAC5B2M,IAAAA,EAAMrN,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA;AACrB,GAAA,EACKA,QAAAA;AACT,CAAA;AACqCV,EAAEG,MAAAA,CAAO;EAC1CoN,OAAAA,EAASvN,CAAAA,CAAE4E,MAAM0H,gBAAAA;AACrB,CAAA;AACkCtM,EAAEG,MAAAA,CAAO;AACvCqN,EAAAA,MAAAA,EAAQxN,EAAEQ,MAAAA,CAAOR,CAAAA,CAAEM,QAAM,EAAIN,CAAAA,CAAE0H,KAAG,CAAA;AAClC+F,EAAAA,KAAAA,EAAOzN,EAAEQ,MAAAA,CAAOR,CAAAA,CAAEM,QAAM,EAAIN,CAAAA,CAAE0H,KAAG;AACrC,CAAA;AACiC1H,EAAEG,MAAAA,CAAO;AACtCE,EAAAA,OAAAA,EAASL,EAAEM,MAAAA,EAAM;EACjBF,IAAAA,EAAMJ,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;EACzBH,OAAAA,EAASP,CAAAA,CAAE0H,GAAAA,EAAG,CAAGhH,QAAAA;AACrB,CAAA;AAEO,IAAMgN,WAAAA,GAAc1N,EAAEG,MAAAA,CAAO;EAChCwN,OAAAA,EAAS3N,CAAAA,CAAEmE,QAAM,CAAGoD,GAAAA,GAAMjF,GAAAA,CAAI,CAAA,CAAA,CAAGU,OAAAA,CAAQ,CAAA,CAAA;AACzC4K,EAAAA,MAAAA,EAAQ5N,EAAEmE,MAAAA,EAAM,CAAG7B,IAAI,CAAA,CAAA,CAAGU,QAAQ,CAAA,CAAA;AAClCV,EAAAA,GAAAA,EAAKtC,EAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,EAAG,CAAGvE,QAAQ,GAAA,CAAA;AAC9BJ,EAAAA,GAAAA,EAAK5C,EAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,EAAG,CAAGvE,QAAQ,IAAA,CAAA;AAC9B6K,EAAAA,MAAAA,EAAQ7N,CAAAA,CAAEoB,OAAAA,EAAO,CAAG4B,OAAAA,CAAQ,IAAA;AAChC,CAAA,CAAA;AACO,IAAM8K,aAAAA,GAAgB9N,EAAEG,MAAAA,CAAO;AAClC4N,EAAAA,OAAAA,EAAS/N,CAAAA,CAAEoB,OAAAA,EAAO,CAAG4B,OAAAA,CAAQ,IAAA,CAAA;AAC7BgL,EAAAA,wBAAAA,EAA0BhO,CAAAA,CAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,EAAG,CAAGjF,GAAAA,CAAI,CAAA,CAAA,CAAGM,GAAAA,CAAI,GAAA,CAAA,CAAKI,OAAAA,CAAQ,EAAA,CAAA;EACnEiL,eAAAA,EAAiBjO,CAAAA,CAAEmE,QAAM,CAAGoD,GAAAA,GAAMjF,GAAAA,CAAI,CAAA,CAAA,CAAGU,OAAAA,CAAQ,EAAA,CAAA;AACjDkL,EAAAA,SAAAA,EAAWlO,EAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,EAAG,CAAGvE,QAAQ,GAAA,CAAA;AACpCmL,EAAAA,OAAAA,EAASnO,EAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,EAAG,CAAGvE,QAAQ,GAAA,CAAA;AAClCoL,EAAAA,cAAAA,EAAgBpO,EAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,EAAG,CAAGvE,QAAQ,GAAA,CAAA;AACzCqL,EAAAA,mBAAAA,EAAqBrO,EAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,EAAG,CAAGvE,QAAQ,CAAA;AAClD,CAAA,CAAA;AACyBhD,EAAEG,MAAAA,CAAO;AAC9B+N,EAAAA,SAAAA,EAAWlO,EAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,EAAG,CAAGvE,QAAQ,GAAA,CAAA;EACpCsL,aAAAA,EAAetO,CAAAA,CAAEmE,QAAM,CAAGoD,GAAAA,GAAMjF,GAAAA,CAAI,CAAA,CAAA,CAAGU,OAAAA,CAAQ,CAAA,CAAA;EAC/CuL,KAAAA,EAAOb,WAAAA;EACPc,OAAAA,EAASV,aAAAA;AACTW,EAAAA,KAAAA,EAAOzO,EAAEG,MAAAA,CAAO;IACZuO,IAAAA,EAAM1O,CAAAA,CAAEmE,QAAM,CAAGoD,GAAAA,GAAMjF,GAAAA,CAAI,CAAA,CAAA,CAAGU,OAAAA,CAAQ,CAAA,CAAA;AACtC2L,IAAAA,SAAAA,EAAW3O,EAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,EAAG,CAAGvE,QAAQ,GAAA;GACxC;AACJ,CAAA;AAC6BhD,EAAEG,MAAAA,CAAO;AAClCyO,EAAAA,UAAAA,EAAY5O,EAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,EAAG,CAAGvE,QAAQ,GAAA,CAAA;AACrC6L,EAAAA,gBAAAA,EAAkB7O,EAAEG,MAAAA,CAAO;AACvB2O,IAAAA,kBAAAA,EAAoB9O,EAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,EAAG,CAAGvE,QAAQ,GAAA,CAAA;AAC7C+L,IAAAA,YAAAA,EAAc/O,EAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,EAAG,CAAGvE,QAAQ,EAAA;GAC3C,CAAA;AACAgM,EAAAA,OAAAA,EAAShP,EAAE4E,KAAAA,CAAM5E,CAAAA,CAAEM,MAAAA,EAAM,EAAI0C,OAAAA,CAAQ;AAAC,IAAA;AAA8D,GAAA;AACxG,CAAA;;;AC9GO,SAASiM,sBAAAA,CAAuBtN,QAAQuN,QAAAA,EAAQ;AACnD,EAAA,OAAO;AACHC,IAAAA,WAAAA,EAAa,cAAcxN,MAAAA,CAAAA,CAAAA;IAC3ByN,aAAAA,EAAe,oBAAA;AACfF,IAAAA,QAAAA;AACAvN,IAAAA,MAAAA;IACA0N,WAAAA,EAAa;MACTC,IAAAA,EAAM,IAAA;MACNC,KAAAA,EAAO,IAAA;MACPC,MAAAA,EAAQ,IAAA;MACRC,MAAAA,EAAQ;AACZ,KAAA;IACAC,YAAAA,EAAc;AAClB,GAAA;AACJ;AAdgBT,MAAAA,CAAAA,sBAAAA,EAAAA,wBAAAA,CAAAA;AAwBT,SAASU,gBAAAA,CAAiBT,UAAUvN,MAAAA,EAAM;AAC7C,EAAA,OAAO,CAAA,qBAAA,EAAwBA,MAAAA,CAAAA,CAAAA,EAAUuN,QAAAA,CAAAA,CAAAA;AAC7C;AAFgBS,MAAAA,CAAAA,gBAAAA,EAAAA,kBAAAA,CAAAA;ACjBT,IAAMC,oBAAAA,GAAuB,eAAA;AAI7B,IAAMC,cAAAA,GAAiB7P,EAAEC,IAAAA,CAAK;AAAC,EAAA,SAAA;AAAW,EAAA,UAAA;AAAY,EAAA,SAAA;AAAW,EAAA;AAAU,CAAA,CAAA;AAI3E,IAAM6P,aAAAA,GAAgB9P,EAAEC,IAAAA,CAAK;AAAC,EAAA,IAAA;AAAM,EAAA;AAAO,CAAA,CAAA;AAI3C,IAAM8P,oBAAAA,GAAuB/P,EAAEC,IAAAA,CAAK;AAAC,EAAA,WAAA;AAAa,EAAA,YAAA;AAAc,EAAA,QAAA;AAAU,EAAA;AAAgB,CAAA,CAAA;AAY1F,IAAM+P,mBAAAA,GAAsBhQ,EAAEG,MAAAA,CAAO;;AAExC8P,EAAAA,CAAAA,EAAGjQ,EAAEM,MAAAA,EAAM;;EAEX4P,EAAAA,EAAIL,cAAAA;;EAEJxH,IAAAA,EAAMrI,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;;EAEzByP,IAAAA,EAAMnQ,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;;EAEzB0P,IAAAA,EAAMpQ,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;;AAEzB2P,EAAAA,UAAAA,EAAYrQ,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAG+I,WAAAA,GAAc5P,QAAAA,EAAQ;;AAEnD6P,EAAAA,SAAAA,EAAWvQ,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAG+I,WAAAA,GAAc5P,QAAAA,EAAQ;;AAElD8P,EAAAA,WAAAA,EAAaxQ,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAG+I,WAAAA,GAAc5P,QAAAA,EAAQ;;AAEpD+P,EAAAA,UAAAA,EAAYzQ,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAG+I,WAAAA,GAAc5P,QAAAA,EAAQ;;AAEnDgQ,EAAAA,UAAAA,EAAY1Q,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAG+I,WAAAA,GAAc5P,QAAAA,EAAQ;;AAEnDiQ,EAAAA,SAAAA,EAAW3Q,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAG+I,WAAAA,GAAc5P,QAAAA,EAAQ;;AAElDkQ,EAAAA,SAAAA,EAAWd,cAAcpP,QAAAA,EAAQ;;AAEjCmQ,EAAAA,QAAAA,EAAUf,cAAcpP,QAAAA;AAC5B,CAAA,CAAA;AAauCV,EAAEG,MAAAA,CAAO;;EAE5C2Q,MAAAA,EAAQ9Q,CAAAA,CAAEoC,QAAQwN,oBAAAA,CAAAA;;AAElBmB,EAAAA,SAAAA,EAAW/Q,EAAEM,MAAAA,EAAM;;EAEnB0Q,SAAAA,EAAWhR,CAAAA,CAAEM,MAAAA,EAAM,CAAG2Q,QAAAA,EAAQ;;AAE9BC,EAAAA,OAAAA,EAASlR,CAAAA,CAAEM,MAAAA,EAAM,CAAG2Q,QAAAA,GAAWvQ,QAAAA,EAAQ;;AAEvCyQ,EAAAA,YAAAA,EAAcnR,EAAEM,MAAAA,EAAM;;EAEtBU,IAAAA,EAAMhB,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;;EAEzBsG,QAAAA,EAAUhH,CAAAA,CAAE4E,MAAMmL,oBAAAA,CAAAA;;AAElBqB,EAAAA,WAAAA,EAAapR,CAAAA,CAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,GAAM+I,WAAAA,EAAW;;EAEzCe,YAAAA,EAAcrR,CAAAA,CAAE4E,MAAMoL,mBAAAA,CAAAA;;AAEtBsB,EAAAA,SAAAA,EAAWtR,EAAE4E,KAAAA,CAAM5E,CAAAA,CAAEM,MAAAA,EAAM,EAAII,QAAAA;AACnC,CAAA;AAIoCV,EAAEG,MAAAA,CAAO;AACzC4Q,EAAAA,SAAAA,EAAW/Q,EAAEM,MAAAA,EAAM;EACnB0Q,SAAAA,EAAWhR,CAAAA,CAAEM,MAAAA,EAAM,CAAG2Q,QAAAA,EAAQ;AAC9BC,EAAAA,OAAAA,EAASlR,CAAAA,CAAEM,MAAAA,EAAM,CAAG2Q,QAAAA,GAAWvQ,QAAAA,EAAQ;EACvCM,IAAAA,EAAMhB,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;AACzB0Q,EAAAA,WAAAA,EAAapR,CAAAA,CAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,GAAM+I,WAAAA,EAAW;EACzCtJ,QAAAA,EAAUhH,CAAAA,CAAE4E,MAAMmL,oBAAAA;AACtB,CAAA;AAIoC/P,EAAEG,MAAAA,CAAO;;EAEzCgR,YAAAA,EAAcnR,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;;EAEjC6Q,UAAAA,EAAYvR,CAAAA,CAAEoB,OAAAA,EAAO,CAAGV,QAAAA,EAAQ;;EAEhC8Q,aAAAA,EAAexR,CAAAA,CAAEoB,OAAAA,EAAO,CAAGV,QAAAA,EAAQ;;EAEnC+M,KAAAA,EAAOzN,CAAAA,CAAEuB,IAAAA,EAAI,CAAGb,QAAAA,EAAQ;;EAExB8M,MAAAA,EAAQxN,CAAAA,CAAEuB,IAAAA,EAAI,CAAGb,QAAAA,EAAQ;;AAEzB+Q,EAAAA,KAAAA,EAAOzR,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAGmK,QAAAA,GAAWhR,QAAAA,EAAQ;;AAE3CiR,EAAAA,MAAAA,EAAQ3R,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAG+I,WAAAA,GAAc5P,QAAAA;AAC3C,CAAA;AAI0CV,EAAEG,MAAAA,CAAO;;AAE/CgR,EAAAA,YAAAA,EAAcnR,EAAEM,MAAAA,EAAM;;AAEtB0G,EAAAA,QAAAA,EAAUhH,CAAAA,CAAE4E,KAAAA,CAAMmL,oBAAAA,CAAAA,CAAsB/M,OAAAA,CAAQ;AAAC,IAAA;AAAY,GAAA,CAAA;;EAE7DhC,IAAAA,EAAMhB,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA;AACrB,CAAA;AAI0CV,EAAEG,MAAAA,CAAO;;AAE/CgR,EAAAA,YAAAA,EAAcnR,EAAEM,MAAAA,EAAM;;EAEtBsR,MAAAA,EAAQ5R,CAAAA,CACHmE,QAAM,CACNoD,GAAAA,GACAmK,QAAAA,EAAQ,CACR1O,OAAAA,CAAQ,EAAA,GAAK,GAAA,CAAA;;EAElB6O,cAAAA,EAAgB7R,CAAAA,CAAEmE,QAAM,CAAGoD,GAAAA,GAAMmK,QAAAA,EAAQ,CAAG1O,QAAQ,EAAA,CAAA;;EAEpD8O,eAAAA,EAAiB9R,CAAAA,CAAEmE,QAAM,CAAGoD,GAAAA,GAAMmK,QAAAA,EAAQ,CAAG1O,QAAQ,GAAA,CAAA;;AAErD+O,EAAAA,gBAAAA,EAAkB/R,CAAAA,CAAEoB,OAAAA,EAAO,CAAG4B,OAAAA,CAAQ,IAAA,CAAA;;AAEtCgP,EAAAA,cAAAA,EAAgBhS,EACX4E,KAAAA,CAAM5E,CAAAA,CAAEM,MAAAA,EAAM,EACd0C,OAAAA,CAAQ;AACT,IAAA,iBAAA;AACA,IAAA,UAAA;AACA,IAAA,SAAA;AACA,IAAA,UAAA;AACA,IAAA,aAAA;AACA,IAAA,SAAA;AACA,IAAA,OAAA;AACA,IAAA,OAAA;AACA,IAAA,OAAA;AACA,IAAA;AACH,GAAA,CAAA;;AAED0H,EAAAA,IAAAA,EAAM1K,EAAEC,IAAAA,CAAK;AAAC,IAAA,MAAA;AAAQ,IAAA;AAAO,GAAA,CAAA,CAAE+C,QAAQ,MAAA,CAAA;;AAEvCiP,EAAAA,OAAAA,EAASjS,CAAAA,CAAEoB,OAAAA,EAAO,CAAG4B,OAAAA,CAAQ,KAAA;AACjC,CAAA;ACnKO,IAAMkP,wBAAAA,GAA2BlS,EAAEC,IAAAA,CAAK;AAAC,EAAA,WAAA;AAAa,EAAA,KAAA;AAAO,EAAA,QAAA;AAAU,EAAA;AAAM,CAAA,CAAA;AAO7E,IAAMkS,sBAAAA,GAAyBnS,EAAEC,IAAAA,CAAK;AAAC,EAAA,QAAA;AAAU,EAAA,QAAA;AAAU,EAAA;AAAS,CAAA,CAAA;AAMrCD,EAAEG,MAAAA,CAAO;;AAE3CiS,EAAAA,IAAAA,EAAMpS,CAAAA,CAAEM,MAAAA,EAAM,CAAGgC,GAAAA,CAAI,GAAG,sBAAA,CAAA;;AAExBoD,EAAAA,SAAAA,EAAW1F,CAAAA,CAAEmE,MAAAA,EAAM,CAAGuN,QAAAA,CAAS,4BAAA,CAAA;;EAE/BzN,IAAAA,EAAMkO,sBAAAA;;EAENE,YAAAA,EAAcrS,CAAAA,CAAEmE,QAAM,CAAGoD,GAAAA,GAAM+I,WAAAA,EAAW,CAAGtN,QAAQ,CAAA,CAAA;;AAErDsP,EAAAA,YAAAA,EAActS,CAAAA,CAAEoB,OAAAA,EAAO,CAAG4B,OAAAA,CAAQ,KAAA,CAAA;;AAElCuP,EAAAA,MAAAA,EAAQvS,EAAEM,MAAAA,EAAM,CAAGM,QAAAA,EAAQ,CAAGoC,QAAQ,IAAA,CAAA;;EAEtCuF,MAAAA,EAAQ2J;AACZ,CAAA;AAoCO,SAASM,gCAAAA,CAAiCC,GAAAA,EAAKlK,MAAAA,GAAS,WAAA,EAAW;AACtE,EAAA,OAAO;AACH6J,IAAAA,IAAAA,EAAMK,GAAAA,CAAIL,IAAAA;AACV1M,IAAAA,SAAAA,EAAW+M,GAAAA,CAAI/M,SAAAA;AACfzB,IAAAA,IAAAA,EAAMwO,GAAAA,CAAIxO,IAAAA;AACVoO,IAAAA,YAAAA,EAAcI,IAAIJ,YAAAA,IAAgB,CAAA;IAClCC,YAAAA,EAAc,KAAA;IACdC,MAAAA,EAAQ,IAAA;AACRhK,IAAAA;AACJ,GAAA;AACJ;AAVgBiK,MAAAA,CAAAA,gCAAAA,EAAAA,kCAAAA,CAAAA;AC/DsBxS,EAAEG,MAAAA,CAAO;;EAE3CuS,YAAAA,EAAc1S,CAAAA,CAAE4E,MAAM5E,CAAAA,CAAEM,MAAAA,EAAM,CAAA,CAAI0C,OAAAA,CAAQ,EAAE,CAAA;;EAE5CsK,OAAAA,EAAStN,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;;AAE5BiS,EAAAA,QAAAA,EAAU3S,CAAAA,CAAEmE,MAAAA,EAAM,CAAGmM,WAAAA,GAAc5P,QAAAA,EAAQ;;AAE3CkS,EAAAA,SAAAA,EAAW5S,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAG+I,WAAAA,GAAc5P,QAAAA;AAC9C,CAAA;AAIO,IAAMmS,uBAAAA,GAA0B7S,EAAEG,MAAAA,CAAO;;EAE5C2S,IAAAA,EAAM9S,CAAAA,CAAEM,MAAAA,EAAM,CAAGM,QAAAA,EAAQ;;AAEzBmS,EAAAA,UAAAA,EAAY/S,EAAEmE,MAAAA,EAAM,CAAG7B,IAAI,CAAA,CAAA,CAAGM,IAAI,CAAA,CAAA;;AAElC+F,EAAAA,MAAAA,EAAQ3I,EAAEC,IAAAA,CAAK;AAAC,IAAA,WAAA;AAAa,IAAA,UAAA;AAAY,IAAA,SAAA;AAAW,IAAA;AAAW,GAAA,CAAA,CAAEW,QAAAA,EAAQ;;AAEzEoS,EAAAA,UAAAA,EAAYhT,EAAE4E,KAAAA,CAAM5E,CAAAA,CAAEM,MAAAA,EAAM,EAAII,QAAAA;AACpC,CAAA,CAAA;AAS0CV,EAAEG,MAAAA,CAAO;;AAE/CmN,EAAAA,OAAAA,EAAStN,EAAEM,MAAAA;AACf,CAAA;AAIO,IAAM2S,mBAAAA,GAAsBjT,EAAEG,MAAAA,CAAO;;AAExC8F,EAAAA,WAAAA,EAAajG,EAAEM,MAAAA,EAAM;;AAErB0D,EAAAA,QAAAA,EAAUhE,EAAEmE,MAAAA,EAAM,CAAG7B,IAAI,CAAA,CAAA,CAAGM,IAAI,CAAA;AACpC,CAAA,CAAA;AAIO,IAAMsQ,2BAAAA,GAA8BlT,EAAEG,MAAAA,CAAO;;AAEhDgT,EAAAA,WAAAA,EAAanT,CAAAA,CAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,GAAM+I,WAAAA,EAAW;;EAEzC8C,QAAAA,EAAUpT,CAAAA,CAAE4E,MAAMqO,mBAAAA,CAAAA;;AAElBjP,EAAAA,QAAAA,EAAUhE,EAAEC,IAAAA,CAAK;AAAC,IAAA,MAAA;AAAQ,IAAA,KAAA;AAAO,IAAA,QAAA;AAAU,IAAA,MAAA;AAAQ,IAAA;AAAW,GAAA,CAAA;;AAE9D2M,EAAAA,KAAAA,EAAO5M,EAAEmE,MAAAA,EAAM,CAAG7B,IAAI,CAAA,CAAA,CAAGM,IAAI,EAAA;AACjC,CAAA,CAAA;AASyC5C,EAAEG,MAAAA,CAAO;;AAE9CkT,EAAAA,QAAAA,EAAUrT,EAAEM,MAAAA,EAAM;;AAElBsS,EAAAA,SAAAA,EAAW5S,CAAAA,CAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,GAAM+I,WAAAA,EAAW;;AAEvC5K,EAAAA,SAAAA,EAAW1F,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAGmK,QAAAA,GAAWhR,QAAAA;AAC3C,CAAA;AAIO,IAAM4S,0BAAAA,GAA6BtT,EAAEG,MAAAA,CAAO;;AAE/CoT,EAAAA,OAAAA,EAASvT,EAAEoB,OAAAA,EAAO;;EAElBuR,QAAAA,EAAU3S,CAAAA,CAAEmE,MAAAA,EAAM,CAAGmM,WAAAA,EAAW;;AAEhC+C,EAAAA,QAAAA,EAAUrT,EAAEM,MAAAA,EAAM;;AAElBsS,EAAAA,SAAAA,EAAW5S,CAAAA,CAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,GAAM+I,WAAAA,EAAW;;AAEvC5K,EAAAA,SAAAA,EAAW1F,CAAAA,CAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,GAAMmK,QAAAA;AAChC,CAAA,CAAA;AAOO,IAAM8B,yBAAAA,GAA4BxT,EAAEG,MAAAA,CAAO;;AAE9CiS,EAAAA,IAAAA,EAAMpS,EAAEM,MAAAA,EAAM;;AAEdgN,EAAAA,OAAAA,EAAStN,EAAEM,MAAAA,EAAM;;AAEjBmT,EAAAA,SAAAA,EAAWzT,CAAAA,CAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,GAAM+I,WAAAA;AAChC,CAAA,CAAA;AAI6CtQ,EAAEG,MAAAA,CAAO;;EAElD4G,KAAAA,EAAO/G,CAAAA,CAAE4E,MAAM4O,yBAAAA;AACnB,CAAA;AAIO,IAAME,8BAAAA,GAAiC1T,EAAEG,MAAAA,CAAO;;AAEnDwT,EAAAA,aAAAA,EAAe3T,EAAEmE,MAAAA,EAAM,CAAG7B,IAAI,CAAA,CAAA,CAAGM,IAAI,CAAA,CAAA;;AAErCgR,EAAAA,aAAAA,EAAe5T,EAAEmE,MAAAA,EAAM,CAAG7B,IAAI,CAAA,CAAA,CAAGM,IAAI,CAAA,CAAA;;AAErCiR,EAAAA,mBAAAA,EAAqB7T,CAAAA,CAAE4E,KAAAA,CAAM5E,CAAAA,CAAEM,MAAAA,EAAM,CAAA;;AAErCwT,EAAAA,SAAAA,EAAW9T,CAAAA,CAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,GAAM+I,WAAAA,EAAW;;AAEvC7D,EAAAA,KAAAA,EAAOzM,EAAEmE,MAAAA,EAAM,CAAG7B,IAAI,CAAA,CAAA,CAAGM,IAAI,CAAA;AACjC,CAAA,CAAA;AAS8C5C,EAAEG,MAAAA,CAAO;;EAEnDuS,YAAAA,EAAc1S,CAAAA,CAAE4E,MAAM5E,CAAAA,CAAEM,MAAAA,EAAM,CAAA,CAAI0C,OAAAA,CAAQ,EAAE,CAAA;;AAE5CsK,EAAAA,OAAAA,EAAStN,EAAEM,MAAAA,EAAM;;AAEjB+S,EAAAA,QAAAA,EAAUrT,EAAEM,MAAAA,EAAM;;AAElBmT,EAAAA,SAAAA,EAAWzT,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAG+I,WAAAA,GAAc5P,QAAAA,EAAQ;;AAElDkS,EAAAA,SAAAA,EAAW5S,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAG+I,WAAAA,GAAc5P,QAAAA,EAAQ;;AAElDiS,EAAAA,QAAAA,EAAU3S,CAAAA,CAAEmE,MAAAA,EAAM,CAAGmM,WAAAA,GAAc5P,QAAAA,EAAQ;;AAE3CgF,EAAAA,SAAAA,EAAW1F,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAGmK,QAAAA,GAAWhR,QAAAA;AAC3C,CAAA;AAIkCV,EAAEG,MAAAA,CAAO;;AAEvC4T,EAAAA,MAAAA,EAAQ/T,EAAEC,IAAAA,CAAK;AAAC,IAAA,IAAA;AAAM,IAAA,SAAA;AAAW,IAAA,OAAA;AAAS,IAAA;AAAa,GAAA,CAAA;;AAEvDwM,EAAAA,KAAAA,EAAOzM,EAAEmE,MAAAA,EAAM;;AAEf6P,EAAAA,SAAAA,EAAWhU,EAAEoB,OAAAA;AACjB,CAAA;AAI+CpB,EAAEG,MAAAA,CAAO;;AAEpD8T,EAAAA,OAAAA,EAASjU,EAAEG,MAAAA,CAAO;IACd+T,EAAAA,EAAIrB,uBAAAA;IACJsB,OAAAA,EAASjB,2BAAAA;AACTkB,IAAAA,KAAAA,EAAOd,2BAA2B5S,QAAAA,EAAQ;IAC1C2T,UAAAA,EAAYX;GAChB,CAAA;;AAEAY,EAAAA,WAAAA,EAAatU,EAAEmE,MAAAA,EAAM,CAAG7B,IAAI,CAAA,CAAA,CAAGM,IAAI,CAAA,CAAA;;AAEnC2R,EAAAA,SAAAA,EAAWvU,EAAEC,IAAAA,CAAK;AAAC,IAAA,KAAA;AAAO,IAAA,QAAA;AAAU,IAAA,MAAA;AAAQ,IAAA;AAAW,GAAA,CAAA;;EAEvDuU,gBAAAA,EAAkBxU,CAAAA,CAAE4E,KAAAA,CAAM5E,CAAAA,CAAEC,IAAAA,CAAK;AAAC,IAAA,IAAA;AAAM,IAAA,SAAA;AAAW,IAAA,OAAA;AAAS,IAAA;GAAa,CAAA,CAAA;;EAEzEwU,gBAAAA,EAAkBzU,CAAAA,CAAEmE,MAAAA,EAAM,CAAGmM,WAAAA;AACjC,CAAA;AAOO,IAAMoE,gBAAAA,GAAmB1U,EAAEC,IAAAA,CAAK;AAAC,EAAA,IAAA;AAAM,EAAA,SAAA;AAAW,EAAA,OAAA;AAAS,EAAA,YAAA;AAAc,EAAA;AAAgB,CAAA,CAAA;AAI/DD,EAAEG,MAAAA,CAAO;;AAEtCC,EAAAA,IAAAA,EAAMJ,EAAEM,MAAAA,EAAM;;AAEdD,EAAAA,OAAAA,EAASL,EAAEM,MAAAA,EAAM;;AAEjByT,EAAAA,MAAAA,EAAQW,iBAAiBhU,QAAAA;AAC7B,CAAA;ACpNO,IAAMiU,oBAAAA,GAAuB3U,EAAEC,IAAAA,CAAK;AACvC,EAAA,SAAA;AACA,EAAA,YAAA;AACA,EAAA,SAAA;AACA,EAAA,OAAA;AACA,EAAA,aAAA;AACA,EAAA,SAAA;AACA,EAAA,WAAA;AACA,EAAA,UAAA;AACA,EAAA;AACH,CAAA,CAAA;AAIM,IAAM2U,uBAAAA,GAA0B5U,EAAEC,IAAAA,CAAK;AAAC,EAAA,YAAA;AAAc,EAAA,YAAA;AAAc,EAAA,QAAA;AAAU,EAAA;AAAY,CAAA,CAAA;AAI1F,IAAM4U,kBAAAA,GAAqB7U,EAAEG,MAAAA,CAAO;AACvCiS,EAAAA,IAAAA,EAAMpS,EAAEM,MAAAA,EAAM;AACdwU,EAAAA,IAAAA,EAAM9U,EAAEM,MAAAA,EAAM;AACdoF,EAAAA,SAAAA,EAAW1F,EAAEmE,MAAAA,EAAM;AACnBuK,EAAAA,IAAAA,EAAM1O,EAAEmE,MAAAA;AACZ,CAAA,CAAA;AAIgCnE,EAAEG,MAAAA,CAAO;AACrCiS,EAAAA,IAAAA,EAAMpS,EAAEM,MAAAA,EAAM;EACd2D,IAAAA,EAAM0Q,oBAAAA;EACNI,QAAAA,EAAUH,uBAAAA;AACVI,EAAAA,QAAAA,EAAUhV,CAAAA,CAAEoB,OAAAA,EAAO,CAAG4B,OAAAA,CAAQ,KAAA,CAAA;AAC9BiS,EAAAA,QAAAA,EAAUJ,mBAAmBnU,QAAAA;AACjC,CAAA;AAIwCV,EAAEG,MAAAA,CAAO;AAC7C8D,EAAAA,IAAAA,EAAMjE,EAAEM,MAAAA,EAAM;AACd8R,EAAAA,IAAAA,EAAMpS,EAAEM,MAAAA,EAAM;AACdU,EAAAA,IAAAA,EAAMhB,EAAEM,MAAAA,EAAM;AACd0U,EAAAA,QAAAA,EAAUhV,CAAAA,CAAEoB,OAAAA,EAAO,CAAG4B,OAAAA,CAAQ,KAAA;AAClC,CAAA;AAIuChD,EAAEG,MAAAA,CAAO;AAC5CmN,EAAAA,OAAAA,EAAStN,EAAE0H,GAAAA,EAAG;AACdwN,EAAAA,KAAAA,EAAOlV,EAAEoB,OAAAA,EAAO;EAChB0B,KAAAA,EAAO9C,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;EAC1ByU,QAAAA,EAAUnV,CAAAA,CAAEQ,OAAOR,CAAAA,CAAEM,MAAAA,IAAUN,CAAAA,CAAE0H,GAAAA,EAAG,CAAA,CAAIhH,QAAAA;AAC5C,CAAA;AAI4CV,EAAEG,MAAAA,CAAO;AACjD+U,EAAAA,KAAAA,EAAOlV,EAAEoB,OAAAA,EAAO;EAChBgU,MAAAA,EAAQpV,CAAAA,CAAE4E,MAAM5E,CAAAA,CAAEM,MAAAA,EAAM,CAAA,CAAI0C,OAAAA,CAAQ,EAAE,CAAA;EACtCqS,QAAAA,EAAUrV,CAAAA,CAAE4E,MAAM5E,CAAAA,CAAEM,MAAAA,EAAM,CAAA,CAAI0C,OAAAA,CAAQ,EAAE;AAC5C,CAAA;AAIkChD,EAAEG,MAAAA,CAAO;AACvC8D,EAAAA,IAAAA,EAAMjE,EAAEC,IAAAA,CAAK;AAAC,IAAA,OAAA;AAAS,IAAA,UAAA;AAAY,IAAA;AAAU,GAAA,CAAA;AAC7CqE,EAAAA,IAAAA,EAAMtE,EAAEM,MAAAA,EAAM;AACdoF,EAAAA,SAAAA,EAAW1F,EAAEmE,MAAAA,EAAM;AACnB8Q,EAAAA,QAAAA,EAAUJ,mBAAmBnU,QAAAA;AACjC,CAAA;AAI0CV,EAAEG,MAAAA,CAAO;AAC/CmV,EAAAA,UAAAA,EAAYtV,CAAAA,CAAEoB,OAAAA,EAAO,CAAG4B,OAAAA,CAAQ,IAAA,CAAA;AAChCuS,EAAAA,YAAAA,EAAcvV,CAAAA,CAAEoB,OAAAA,EAAO,CAAG4B,OAAAA,CAAQ,IAAA,CAAA;AAClCwS,EAAAA,WAAAA,EAAaxV,CAAAA,CAAEoB,OAAAA,EAAO,CAAG4B,OAAAA,CAAQ,IAAA,CAAA;AACjCyS,EAAAA,cAAAA,EAAgBzV,EAAE4E,KAAAA,CAAM5E,CAAAA,CAAE0H,GAAAA,EAAG,EAAIhH,QAAAA;AACrC,CAAA;AAI6CV,EAAEG,MAAAA,CAAO;AAClD4N,EAAAA,OAAAA,EAAS/N,EAAEoB,OAAAA,EAAO;AAClBgS,EAAAA,QAAAA,EAAUpT,EAAE4E,KAAAA,CAAM5E,CAAAA,CAAEM,MAAAA,EAAM,EAAII,QAAAA,EAAQ;EACtCuE,SAAAA,EAAWjF,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA,EAAQ;AAC9BgV,EAAAA,eAAAA,EAAiB1V,EAAE4E,KAAAA,CAAM5E,CAAAA,CAAEM,MAAAA,EAAM,EAAII,QAAAA,EAAQ;AAC7CiV,EAAAA,eAAAA,EAAiB3V,EAAE4E,KAAAA,CAAM5E,CAAAA,CAAEM,MAAAA,EAAM,EAAII,QAAAA;AACzC,CAAA;ACpFO,IAAMkV,qBAAAA,GAAwB5V,EAAEC,IAAAA,CAAK;AAAC,EAAA,OAAA;AAAS,EAAA,MAAA;AAAQ,EAAA;AAAQ,CAAA,CAAA;AAIzBD,EAAEG,MAAAA,CAAO;EAClD6K,KAAAA,EAAO4K,qBAAAA;AACPC,EAAAA,IAAAA,EAAM7V,EAAEM,MAAAA,EAAM;AACdwV,EAAAA,KAAAA,EAAO9V,EAAEM,MAAAA,EAAM;AACf2F,EAAAA,WAAAA,EAAajG,EAAEM,MAAAA,EAAM;AACrByV,EAAAA,KAAAA,EAAO/V,EAAEM,MAAAA,EAAM;EACf0V,UAAAA,EAAYhW,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA;AAC3B,CAAA;AAiCO,IAAMuV,mBAAAA,GAAsBjW,EAAEG,MAAAA,CAAO;AACxCiS,EAAAA,IAAAA,EAAMpS,EAAEM,MAAAA,EAAM;EACd0K,KAAAA,EAAO4K,qBAAAA;EACPzP,MAAAA,EAAQnG,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;AAC3BwV,EAAAA,OAAAA,EAASlW,EAAEuB,IAAAA,EAAI;EACf6G,OAAAA,EAASpI,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA;AACxB,CAAA,CAAA;AAIO,IAAMyV,iBAAAA,GAAoBnW,EAAEG,MAAAA,CAAO;AACtCiI,EAAAA,OAAAA,EAASpI,EAAEM,MAAAA,EAAM;EACjB0K,KAAAA,EAAO4K,qBAAAA;EACPzP,MAAAA,EAAQnG,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;AAC3BqN,EAAAA,OAAAA,EAAS/N,CAAAA,CAAEoB,OAAAA,EAAO,CAAG4B,OAAAA,CAAQ,IAAA;AACjC,CAAA,CAAA;AAIO,IAAMoT,sBAAAA,GAAyBpW,EAAEG,MAAAA,CAAO;AAC3CiT,EAAAA,QAAAA,EAAUpT,EAAE4E,KAAAA,CAAMuR,iBAAAA,CAAAA,CAAmBnT,OAAAA,CAAQ,EAAE,CAAA;EAC/CqT,YAAAA,EAAcT,qBAAAA,CAAsB5S,QAAQ,OAAA,CAAA;AAC5C+K,EAAAA,OAAAA,EAAS/N,CAAAA,CAAEoB,OAAAA,EAAO,CAAG4B,OAAAA,CAAQ,IAAA,CAAA;AAC7BsT,EAAAA,kBAAAA,EAAoBtW,CAAAA,CAAEoB,OAAAA,EAAO,CAAG4B,OAAAA,CAAQ,IAAA;AAC5C,CAAA,CAAA;AAI8ChD,EAAEG,MAAAA,CAAO;AACnDoW,EAAAA,MAAAA,EAAQH,uBAAuB1V,QAAAA,EAAQ;AACvC8V,EAAAA,eAAAA,EAAiBxW,CAAAA,CAAEoB,OAAAA,EAAO,CAAG4B,OAAAA,CAAQ,IAAA,CAAA;EACrCyT,YAAAA,EAAczW,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA;AAC7B,CAAA;AAI2CV,EAAEG,MAAAA,CAAO;AAChDuW,EAAAA,WAAAA,EAAa1W,EAAEoB,OAAAA,EAAO;AACtB4J,EAAAA,KAAAA,EAAO4K,sBAAsBlV,QAAAA,EAAQ;EACrCyF,MAAAA,EAAQnG,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;AAC3B4D,EAAAA,IAAAA,EAAM2R,oBAAoBvV,QAAAA;AAC9B,CAAA;AC5FA,IAAIiW,gCAAAA,GAAsF,SAAUvE,IAAAA,EAAMwE,WAAAA,EAAW;AACjH,EAAA,IAAgC,UAAA,CAAWC,IAAAA,CAAKzE,IAAAA,CAAAA,EAAO;AACnD,IAAA,OAAOA,IAAAA,CAAK0E,QAAQ,kDAAA,EAAoD,SAAUC,GAAGC,GAAAA,EAAKC,CAAAA,EAAGC,KAAKC,EAAAA,EAAE;AAChG,MAAA,OAAOH,GAAAA,GAA6B,KAAA,GAAQC,MAAM,CAACC,GAAAA,IAAO,CAACC,EAAAA,CAAAA,GAAMJ,IAAKE,CAAAA,GAAIC,GAAAA,GAAM,GAAA,GAAMC,EAAAA,CAAG1U,aAAW,GAAK,IAAA;IAC7G,CAAA,CAAA;AACJ,EAAA;AACA,EAAA,OAAO2P,IAAAA;AACX,CAAA;AAWO,IAAMgF,qBAAAA,GAAwBpX,EAAEC,IAAAA,CAAK;AACxC,EAAA,QAAA;AACA,EAAA,MAAA;AACA,EAAA,WAAA;AACA,EAAA,aAAA;AACA,EAAA,aAAA;AACA,EAAA,UAAA;AACA,EAAA,UAAA;AACA,EAAA,eAAA;AACA,EAAA,aAAA;AACA,EAAA,gBAAA;AACA,EAAA,aAAA;AACA,EAAA,aAAA;AACA,EAAA,iBAAA;AACA,EAAA;AACH,CAAA,CAAA;AAKM,IAAMoX,oBAAAA,GAAuBrX,EAAEC,IAAAA,CAAK;AAAC,EAAA,QAAA;AAAU,EAAA,MAAA;AAAQ,EAAA,aAAA;AAAe,EAAA,UAAA;AAAY,EAAA,aAAA;AAAe,EAAA;AAAY,CAAA,CAAA;AAK7G,IAAMqX,wBAAAA,GAA2BtX,EAAEC,IAAAA,CAAK;AAC3C,EAAA,aAAA;AACA,EAAA,mBAAA;AACA,EAAA,eAAA;AACA,EAAA,WAAA;AACA,EAAA,eAAA;AACA,EAAA,aAAA;AACA,EAAA,cAAA;AACA,EAAA,YAAA;AACA,EAAA;AACH,CAAA,CAAA;AAOM,IAAMsX,oBAAAA,GAAuBvX,EAAEC,IAAAA,CAAK;AAAC,EAAA,KAAA;AAAO,EAAA,MAAA;AAAQ,EAAA;AAAe,CAAA,CAAA;AAuBnE,IAAMuX,cAAAA,GAAiBxX,EAAEG,MAAAA,CAAO;AACnCW,EAAAA,EAAAA,EAAId,EAAEM,MAAAA,EAAM;AACZoF,EAAAA,SAAAA,EAAW1F,EAAEmE,MAAAA,EAAM;AACnBsT,EAAAA,OAAAA,EAASzX,EAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ,CAAGsC,QAAQ,KAAA,CAAA;EACvCwI,IAAAA,EAAMxL,CAAAA,CAAEQ,OAAOR,CAAAA,CAAEM,MAAAA,IAAUN,CAAAA,CAAE0H,GAAAA,EAAG,CAAA,CAAIhH,QAAAA,EAAQ;AAC5CqG,EAAAA,KAAAA,EAAO/G,EAAE4E,KAAAA,CAAM5E,CAAAA,CAAEM,MAAAA,EAAM,EAAII,QAAAA,EAAQ;EACnCgX,YAAAA,EAAc1X,CAAAA,CAAEQ,OAAOR,CAAAA,CAAEM,MAAAA,IAAUN,CAAAA,CAAEM,MAAAA,EAAM,CAAA,CAAII,QAAAA;AACnD,CAAA,CAAA;AAUO,IAAMiX,eAAAA,GAAkB3X,EAAEG,MAAAA,CAAO;AACpCiS,EAAAA,IAAAA,EAAMpS,EAAEM,MAAAA,EAAM;AACdgN,EAAAA,OAAAA,EAAStN,EAAEM,MAAAA,EAAM;;EAEjBwU,IAAAA,EAAM9U,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;;EAEzBgO,IAAAA,EAAM1O,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA,EAAQ;;AAEzBkX,EAAAA,SAAAA,EAAW5X,EACNG,MAAAA,CAAO;;AAER0X,IAAAA,EAAAA,EAAI7X,EAAEM,MAAAA,EAAM;;AAEZwX,IAAAA,GAAAA,EAAK9X,EAAEM,MAAAA,EAAM;;IAEbyX,SAAAA,EAAW/X,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA;AAC1B,GAAA,EACKA,QAAAA;AACT,CAAA,CAAA;AAKO,IAAMsX,uBAAAA,GAA0BhY,EAAEG,MAAAA,CAAO;;AAE5C8X,EAAAA,QAAAA,EAAUjY,EAAEM,MAAAA,EAAM;;AAElBoO,EAAAA,IAAAA,EAAM1O,EAAEmE,MAAAA;AACZ,CAAA,CAAA;AAImCnE,EAAEG,MAAAA,CAAO;AACxCW,EAAAA,EAAAA,EAAId,EAAEM,MAAAA,EAAM;AACZoF,EAAAA,SAAAA,EAAW1F,EAAEmE,MAAAA,EAAM;EACnB4C,KAAAA,EAAO/G,CAAAA,CAAE4E,MAAM+S,eAAAA;AACnB,CAAA;AAKkCH,eAAenT,MAAAA,CAAO;AACpDrD,EAAAA,IAAAA,EAAMhB,EAAEM,MAAAA,EAAM;AACd4X,EAAAA,UAAAA,EAAYlY,CAAAA,CAAE4E,KAAAA,CAAM+S,eAAAA,CAAAA,CAAiBjX,QAAAA,EAAQ;AAC7CgW,EAAAA,WAAAA,EAAa1W,EAAEoB,OAAAA,EAAO;EACtByU,IAAAA,EAAM7V,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;EACzByX,SAAAA,EAAWnY,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA;AAC1B,CAAA;AAIqCV,EAAEG,MAAAA,CAAO;AAC1CW,EAAAA,EAAAA,EAAId,EAAEM,MAAAA,EAAM;AACZU,EAAAA,IAAAA,EAAMhB,EAAEM,MAAAA,EAAM;AACdoF,EAAAA,SAAAA,EAAW1F,EAAEmE,MAAAA,EAAM;AACnBuS,EAAAA,WAAAA,EAAa1W,EAAEoB,OAAAA;AACnB,CAAA;AAI+BpB,EAAEG,MAAAA,CAAO;AACpCiS,EAAAA,IAAAA,EAAMpS,EAAEM,MAAAA,EAAM;AACdgN,EAAAA,OAAAA,EAAStN,EAAEM,MAAAA,EAAM;AACjBmJ,EAAAA,MAAAA,EAAQzJ,EAAEC,IAAAA,CAAK;AAAC,IAAA,KAAA;AAAO,IAAA,QAAA;AAAU,IAAA;AAAS,GAAA;AAC9C,CAAA;AAK2CD,EAAEG,MAAAA,CAAO;;EAEhD8F,WAAAA,EAAajG,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;;EAEhC0X,SAAAA,EAAWpY,CAAAA,CAAEoB,OAAAA,EAAO,CAAGV,QAAAA,EAAQ;;AAE/B+H,EAAAA,OAAAA,EAAS2O,sBAAsB1W,QAAAA,EAAQ;;AAEvC2X,EAAAA,MAAAA,EAAQhB,qBAAqB3W,QAAAA,EAAQ;;EAErC4X,qBAAAA,EAAuBtY,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA;AACtC,CAAA;AAIqCV,EAAEG,MAAAA,CAAO;EAC1CkT,QAAAA,EAAUrT,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;EAC7B8M,MAAAA,EAAQxN,CAAAA,CAAEuB,IAAAA,EAAI,CAAGb,QAAAA,EAAQ;EACzB+M,KAAAA,EAAOzN,CAAAA,CAAEuB,IAAAA,EAAI,CAAGb,QAAAA,EAAQ;EACxB0X,SAAAA,EAAWpY,CAAAA,CAAEoB,OAAAA,EAAO,CAAGV,QAAAA,EAAQ;AAC/B+Q,EAAAA,KAAAA,EAAOzR,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAGmK,QAAAA,GAAWhR,QAAAA,EAAQ;AAC3CiR,EAAAA,MAAAA,EAAQ3R,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAG+I,WAAAA,GAAc5P,QAAAA;AAC3C,CAAA;AAIO,IAAM6X,cAAAA,GAAiBvY,EAAEG,MAAAA,CAAO;AACnCiS,EAAAA,IAAAA,EAAMpS,EAAEM,MAAAA,EAAM;AACdkY,EAAAA,SAAAA,EAAWxY,EAAEC,IAAAA,CAAK;AAAC,IAAA,QAAA;AAAU,IAAA,QAAA;AAAU,IAAA;AAAS,GAAA,CAAA;AAChDwY,EAAAA,UAAAA,EAAYzY,EAAEmE,MAAAA,EAAM;AACpBuU,EAAAA,YAAAA,EAAc1Y,EAAEmE,MAAAA,EAAM;AACtBwU,EAAAA,OAAAA,EAAS3Y,EAAEM,MAAAA,EAAM;EACjBsY,eAAAA,EAAiB5Y,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;EACpCmY,gBAAAA,EAAkB7Y,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA;AACjC,CAAA,CAAA;AAIO,IAAMoY,iBAAAA,GAAoB9Y,EAAEG,MAAAA,CAAO;AACtC4Y,EAAAA,UAAAA,EAAY/Y,EAAEmE,MAAAA,EAAM;AACpB6U,EAAAA,YAAAA,EAAchZ,EAAEmE,MAAAA,EAAM;AACtB8U,EAAAA,aAAAA,EAAejZ,EAAEmE,MAAAA,EAAM;AACvB+U,EAAAA,YAAAA,EAAclZ,EAAEmE,MAAAA,EAAM;AACtBgV,EAAAA,eAAAA,EAAiBnZ,EAAEmE,MAAAA,EAAM;AACzBiV,EAAAA,iBAAAA,EAAmBpZ,EAAEmE,MAAAA,EAAM;EAC3BkV,KAAAA,EAAOrZ,CAAAA,CAAE4E,MAAM2T,cAAAA;AACnB,CAAA,CAAA;AAIO,IAAMe,oBAAAA,GAAuBtZ,EAAEG,MAAAA,CAAO;AACzCiS,EAAAA,IAAAA,EAAMpS,EAAEM,MAAAA,EAAM;AACd6F,EAAAA,MAAAA,EAAQnG,EAAEM,MAAAA,EAAM;AAChBsY,EAAAA,eAAAA,EAAiB5Y,EAAEM,MAAAA,EAAM;AACzBuY,EAAAA,gBAAAA,EAAkB7Y,EAAEM,MAAAA;AACxB,CAAA,CAAA;AAI2CN,EAAEG,MAAAA,CAAO;AAChD0C,EAAAA,OAAAA,EAAS7C,EAAEoB,OAAAA,EAAO;AAClBmY,EAAAA,aAAAA,EAAevZ,CAAAA,CAAE4E,KAAAA,CAAM5E,CAAAA,CAAEM,MAAAA,EAAM,CAAA;AAC/B8U,EAAAA,MAAAA,EAAQpV,EAAE4E,KAAAA,CAAM5E,CAAAA,CAAEM,MAAAA,EAAM,EAAII,QAAAA,EAAQ;AACpC8Y,EAAAA,WAAAA,EAAaV,kBAAkBpY,QAAAA,EAAQ;AACvC+Y,EAAAA,SAAAA,EAAWzZ,CAAAA,CAAE4E,KAAAA,CAAM0U,oBAAAA,CAAAA,CAAsB5Y,QAAAA,EAAQ;AACjDgZ,EAAAA,YAAAA,EAAc1Z,EACTG,MAAAA,CAAO;AACRwZ,IAAAA,WAAAA,EAAa3Z,EAAEoB,OAAAA,EAAO;IACtBwY,OAAAA,EAAS5Z,CAAAA,CAAE4E,KAAAA,CAAM5E,CAAAA,CAAEG,MAAAA,CAAO;AACtBiS,MAAAA,IAAAA,EAAMpS,EAAEM,MAAAA,EAAM;AACduZ,MAAAA,QAAAA,EAAU7Z,EAAEoB,OAAAA,EAAO;AACnB0Y,MAAAA,QAAAA,EAAU9Z,EAAEM,MAAAA,EAAM;AAClByZ,MAAAA,QAAAA,EAAU/Z,EAAEM,MAAAA;AAChB,KAAA,CAAA;AACJ,GAAA,EACKI,QAAAA;AACT,CAAA;AAI2CV,EAAEG,MAAAA,CAAO;AAChD6Z,EAAAA,mBAAAA,EAAqBha,CAAAA,CAAEoB,OAAAA,EAAO,CAAG4B,OAAAA,CAAQ,IAAA,CAAA;AACzCiX,EAAAA,cAAAA,EAAgBja,EAAEC,IAAAA,CAAK;AAAC,IAAA,KAAA;AAAO,IAAA,UAAA;AAAY,IAAA,WAAA;AAAa,IAAA;AAAS,GAAA,CAAA,CAAE+C,QAAQ,UAAA,CAAA;AAC3EwS,EAAAA,WAAAA,EAAaxV,CAAAA,CAAEoB,OAAAA,EAAO,CAAG4B,OAAAA,CAAQ,KAAA,CAAA;AACjCkX,EAAAA,YAAAA,EAAcla,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAGmK,QAAAA,GAAWhR,QAAAA;AAC9C,CAAA;AAMkCV,EAAEG,MAAAA,CAAO;AACvCW,EAAAA,EAAAA,EAAId,EAAEM,MAAAA,EAAM;AACZ8R,EAAAA,IAAAA,EAAMpS,EAAEM,MAAAA,EAAM;EACdwU,IAAAA,EAAM9U,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;EACzBgO,IAAAA,EAAM1O,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA,EAAQ;EACzBqU,QAAAA,EAAU/U,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;AAC7B2M,EAAAA,IAAAA,EAAMV,gBAAgBjM,QAAAA,EAAQ;EAC9ByZ,YAAAA,EAAcna,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA,EAAQ;EACjCW,SAAAA,EAAWrB,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA;AAC1B,CAAA;AAKsCV,EAAEG,MAAAA,CAAO;;AAE3CW,EAAAA,EAAAA,EAAId,EAAEM,MAAAA,EAAM;AACZoF,EAAAA,SAAAA,EAAW1F,EAAEmE,MAAAA,EAAM;AACnB2P,EAAAA,SAAAA,EAAW9T,EAAEmE,MAAAA,EAAM;;EAEnBiW,SAAAA,EAAWpa,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA,EAAQ;AAC9B2Z,EAAAA,SAAAA,EAAW1N,gBAAgBjM,QAAAA,EAAQ;AACnC4Z,EAAAA,IAAAA,EAAMta,EAAE4E,KAAAA,CAAM5E,CAAAA,CAAEM,MAAAA,EAAM,EAAII,QAAAA,EAAQ;;;AAGlC6Z,EAAAA,GAAAA,EAAKva,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAGmK,QAAAA,GAAWhR,QAAAA,EAAQ;;EAEzC8Z,SAAAA,EAAWxa,CAAAA,CAAEmE,QAAM,CAAGoD,GAAAA,GAAMmK,QAAAA,EAAQ,CAAG9Q,QAAAA,EAAQ,CAAGF,QAAAA,EAAQ;;AAE1D+Z,EAAAA,QAAAA,EAAUza,CAAAA,CAAEM,MAAAA,EAAM,CAAGM,QAAAA,GAAWF,QAAAA,EAAQ;;AAExCuD,EAAAA,IAAAA,EAAMsT,qBAAqB7W,QAAAA,EAAQ;;EAEnCga,UAAAA,EAAY1a,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;;;EAG/B4X,qBAAAA,EAAuBtY,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA,EAAQ;;EAE1Cia,gBAAAA,EAAkB3a,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA,EAAQ;;EAErCka,gBAAAA,EAAkB5a,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA,EAAQ;;;AAGrC2X,EAAAA,MAAAA,EAAQhB,qBAAqB3W,QAAAA,EAAQ;;AAErCma,EAAAA,OAAAA,EAAS7a,CAAAA,CAAE4E,KAAAA,CAAM0S,wBAAAA,CAAAA,CAA0B5W,QAAAA,EAAQ;;AAEnDoa,EAAAA,WAAAA,EAAa9a,EACRG,MAAAA,CAAO;AACR4a,IAAAA,QAAAA,EAAU/a,EAAEoB,OAAAA,EAAO;IACnB0R,IAAAA,EAAM9S,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;IACzBqS,UAAAA,EAAY/S,CAAAA,CAAEmE,QAAM,CAAG7B,GAAAA,CAAI,CAAA,CAAA,CAAGM,GAAAA,CAAI,CAAA,CAAA,CAAGlC,QAAAA;AACzC,GAAA,EACKA,QAAAA,EAAQ;;;EAGbqQ,SAAAA,EAAW/Q,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;;EAE9Bsa,MAAAA,EAAQhb,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;;EAE3BM,IAAAA,EAAMhB,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;EACzBmV,IAAAA,EAAM7V,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA;AACrB,CAAA;AAewCV,EAAEG,MAAAA,CAAO;;EAE7C8a,aAAAA,EAAejb,CAAAA,CAAEoC,QAAQ,CAAA,CAAA;;AAEzBtB,EAAAA,EAAAA,EAAId,EAAEM,MAAAA,EAAM;;AAEZia,EAAAA,GAAAA,EAAKva,CAAAA,CAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,GAAMmK,QAAAA,EAAQ;;AAE9B8I,EAAAA,SAAAA,EAAWxa,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAGmK,QAAAA,GAAW9Q,QAAAA,EAAQ;;EAE/C6Z,QAAAA,EAAUza,CAAAA,CAAEM,MAAAA,EAAM,CAAGM,QAAAA,EAAQ;;AAE7B8E,EAAAA,SAAAA,EAAW1F,EAAEmE,MAAAA,EAAM;;AAEnBnD,EAAAA,IAAAA,EAAMhB,EAAEM,MAAAA,EAAM;;EAEd2D,IAAAA,EAAMsT,oBAAAA;;AAENmD,EAAAA,UAAAA,EAAY1a,EAAEM,MAAAA,EAAM;;AAEpByG,EAAAA,KAAAA,EAAO/G,CAAAA,CAAEQ,MAAAA,CAAOR,CAAAA,CAAEM,MAAAA,IAAU0X,uBAAAA,CAAAA;;AAE5B7C,EAAAA,QAAAA,EAAUnV,EACLG,MAAAA,CAAO;;IAERka,SAAAA,EAAWra,CAAAA,CAAEmE,QAAM,CAAG7B,GAAAA,CAAI,CAAA,CAAA,CAAGM,GAAAA,CAAI,CAAA,CAAA,CAAGlC,QAAAA,EAAQ;;AAE5C2X,IAAAA,MAAAA,EAAQhB,qBAAqB3W,QAAAA,EAAQ;;AAErCma,IAAAA,OAAAA,EAAS7a,CAAAA,CAAE4E,KAAAA,CAAM0S,wBAAAA,CAAAA,CAA0B5W,QAAAA,EAAQ;;AAEnDoa,IAAAA,WAAAA,EAAa9a,EACRG,MAAAA,CAAO;AACR4a,MAAAA,QAAAA,EAAU/a,EAAEoB,OAAAA,EAAO;MACnB0R,IAAAA,EAAM9S,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;MACzBqS,UAAAA,EAAY/S,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA;AAC3B,KAAA,EACKA,QAAAA,EAAQ;;IAEbqQ,SAAAA,EAAW/Q,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;;IAE9Bsa,MAAAA,EAAQhb,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;;IAE3B4X,qBAAAA,EAAuBtY,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA;AACtC,GAAA,EACKA,QAAAA;AACT,CAAA;AAIwCV,EAAEG,MAAAA,CAAO;;AAE7CW,EAAAA,EAAAA,EAAId,EAAEM,MAAAA,EAAM;;AAEZoF,EAAAA,SAAAA,EAAW1F,EAAEmE,MAAAA,EAAM;;AAEnBnD,EAAAA,IAAAA,EAAMhB,EAAEM,MAAAA,EAAM;;AAEdmI,EAAAA,OAAAA,EAASzI,EAAEC,IAAAA,CAAK;AAAC,IAAA,MAAA;AAAQ,IAAA,QAAA;AAAU,IAAA,aAAA;AAAe,IAAA;AAAW,GAAA,CAAA;;AAE7Dya,EAAAA,UAAAA,EAAY1a,EAAEM,MAAAA,EAAM;;AAEpByG,EAAAA,KAAAA,EAAO/G,EAAEQ,MAAAA,CAAOR,CAAAA,CAAEM,MAAAA,EAAM,EAAIN,EAAEG,MAAAA,CAAO;AACjC+a,IAAAA,IAAAA,EAAMlb,EAAEM,MAAAA,EAAM;AACdoO,IAAAA,IAAAA,EAAM1O,EAAEmE,MAAAA;AACZ,GAAA,CAAA,CAAA;;AAEAgR,EAAAA,QAAAA,EAAUnV,EACLG,MAAAA,CAAO;IACRka,SAAAA,EAAWra,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA,EAAQ;AAC9Boa,IAAAA,WAAAA,EAAa9a,EACRG,MAAAA,CAAO;AACR4a,MAAAA,QAAAA,EAAU/a,EAAEoB,OAAAA,EAAO;MACnB0R,IAAAA,EAAM9S,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;MACzBqS,UAAAA,EAAY/S,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA;AAC3B,KAAA,EACKA,QAAAA,EAAQ;IACbqQ,SAAAA,EAAW/Q,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA,EAAQ;IAC9Bsa,MAAAA,EAAQhb,CAAAA,CAAEM,MAAAA,EAAM,CAAGI,QAAAA;AACvB,GAAA,EACKA,QAAAA;AACT,CAAA;AA+BuCV,EAAEG,MAAAA,CAAO;AAC5CgP,EAAAA,WAAAA,EAAanP,EAAEM,MAAAA,EAAM;AACrB6a,EAAAA,MAAAA,EAAQnb,EAAEG,MAAAA,CAAO;AACbib,IAAAA,KAAAA,EAAOpb,EAAEmE,MAAAA,EAAM;AACfkX,IAAAA,GAAAA,EAAKrb,EAAEmE,MAAAA;GACX,CAAA;EACAkJ,IAAAA,EAAMV,eAAAA;AACN2O,EAAAA,SAAAA,EAAWtb,EAAEG,MAAAA,CAAO;AAChBob,IAAAA,KAAAA,EAAOvb,EAAEmE,MAAAA,EAAM;AACfqX,IAAAA,UAAAA,EAAYxb,EAAEQ,MAAAA,CAAOR,CAAAA,CAAEM,QAAM,EAAIN,CAAAA,CAAEmE,QAAM,CAAA;AACzCsX,IAAAA,MAAAA,EAAQzb,EAAEQ,MAAAA,CAAOR,CAAAA,CAAEM,QAAM,EAAIN,CAAAA,CAAEmE,QAAM;GACzC,CAAA;AACAuX,EAAAA,aAAAA,EAAe1b,EAAEG,MAAAA,CAAO;AACpBob,IAAAA,KAAAA,EAAOvb,EAAEmE,MAAAA,EAAM;AACfwX,IAAAA,SAAAA,EAAW3b,EAAEmE,MAAAA,EAAM;IACnByX,WAAAA,EAAa5b,CAAAA,CAAEmE,MAAAA,EAAM,CAAGzD,QAAAA;GAC5B,CAAA;AACAuM,EAAAA,uBAAAA,EAAyBjN,EAAEG,MAAAA,CAAO;AAC9B+M,IAAAA,oBAAAA,EAAsBlN,EAAEoB,OAAAA,EAAO;AAC/B+E,IAAAA,MAAAA,EAAQnG,EAAEM,MAAAA,EAAM;IAChB6M,OAAAA,EAAStJ,kBAAAA;AACTuJ,IAAAA,eAAAA,EAAiBpN,EAAEM,MAAAA;GACvB,CAAA;AACAyM,EAAAA,MAAAA,EAAQ/M,EAAEG,MAAAA,CAAO;IACbkN,IAAAA,EAAMrN,CAAAA,CAAE4E,KAAAA,CAAM5E,CAAAA,CAAEG,MAAAA,CAAO;AACnBuF,MAAAA,SAAAA,EAAW1F,EAAEmE,MAAAA,EAAM;AACnByI,MAAAA,KAAAA,EAAO5M,EAAEmE,MAAAA;AACb,KAAA,CAAA,CAAA;IACA0X,QAAAA,EAAU7b,CAAAA,CAAE4E,KAAAA,CAAM5E,CAAAA,CAAEG,MAAAA,CAAO;AACvBuF,MAAAA,SAAAA,EAAW1F,EAAEmE,MAAAA,EAAM;AACnBuI,MAAAA,KAAAA,EAAO1M,EAAEmE,MAAAA;AACb,KAAA,CAAA;GACJ;AACJ,CAAA;AASA,eAAsB2X,sBAAsBC,QAAAA,EAAQ;AAGhD,EAAA,IAAI;AACA,IAAA,MAAM,EAAEC,oBAAAA,EAAoB,GAAK,MAAM,OAAOrF,iCAAiC,uBAAA,CAAA,CAAA;AAE/E,IAAA,MAAMsF,OAAAA,GAAU,IAAID,oBAAAA,CAAqB,CAAA,EAAGD,QAAAA,CAAAA,sBAAAA,CAAgC,CAAA;AAC5E,IAAA,MAAME,QAAQC,UAAAA,EAAU;AACxB,IAAA,OAAO;AACHC,MAAAA,MAAAA,gCAAeC,IAAAA,KAAAA;AACX,QAAA,MAAMC,QAAAA,GAAW;AACbvb,UAAAA,EAAAA,EAAI,CAAA,KAAA,EAAQ6E,IAAAA,CAAKC,GAAAA,EAAG,IAAM0W,IAAAA,CAAKC,MAAAA,EAAM,CAAGC,QAAAA,CAAS,EAAA,CAAA,CAAIC,KAAAA,CAAM,CAAA,EAAG,CAAA,CAAA,CAAA,CAAA;AAC9D/W,UAAAA,SAAAA,EAAWC,KAAKC,GAAAA,EAAG;UACnB6R,OAAAA,EAAS,KAAA;UACTjM,IAAAA,EAAM;YACF,GAAG4Q,IAAAA;AACHhE,YAAAA,SAAAA,EAAWgE,KAAKhE,SAAAA,IAAa,KAAA;AAC7BnS,YAAAA,WAAAA,EAAamW,KAAKnW,WAAAA,IAAe;AACrC;AACJ,SAAA;AACA,QAAA,MAAMgW,OAAAA,CAAQS,KAAKL,QAAAA,CAAAA;AACnB,QAAA,OAAOA,QAAAA;MACX,CAAA,EAbQ,QAAA,CAAA;AAcRM,MAAAA,QAAAA,gCAAiB7b,EAAAA,KAAAA;AACb,QAAA,OAAO,MAAMmb,OAAAA,CAAQW,GAAAA,CAAI9b,EAAAA,CAAAA;MAC7B,CAAA,EAFU,UAAA,CAAA;AAGV+b,MAAAA,IAAAA,kBAAM,MAAA,CAAA,YAAA;AACF,QAAA,OAAO,MAAMZ,QAAQY,IAAAA,EAAI;MAC7B,CAAA,EAFM,MAAA,CAAA;MAGNC,OAAAA,kBAAS,MAAA,CAAA,OAAOhc,EAAAA,EAAIic,WAAAA,EAAahS,OAAAA,KAAAA;AAG7B,QAAA,MAAMsR,QAAAA,GAAW,MAAMJ,OAAAA,CAAQW,GAAAA,CAAI9b,EAAAA,CAAAA;AACnC,QAAA,IAAI,CAACub,QAAAA,EAAU;AACX,UAAA,OAAO;YACHxZ,OAAAA,EAAS,KAAA;AACT0W,YAAAA,aAAAA,EAAe,EAAA;YACfnE,MAAAA,EAAQ;AAAC,cAAA,CAAA,SAAA,EAAYtU,EAAAA,CAAAA,UAAAA;;AACzB,WAAA;AACJ,QAAA;AACA,QAAA,IAAIiK,SAASiS,MAAAA,EAAQ;AACjB,UAAA,OAAO;YACHna,OAAAA,EAAS,IAAA;YACT0W,aAAAA,EAAe8C,QAAAA,CAAStV,SAAS,EAAA;AACjCqO,YAAAA,MAAAA,EAAQ;AACZ,WAAA;AACJ,QAAA;AACA,QAAA,OAAO;UACHvS,OAAAA,EAAS,IAAA;UACT0W,aAAAA,EAAe8C,QAAAA,CAAStV,SAAS,EAAA;AACjCqO,UAAAA,MAAAA,EAAQ;AACZ,SAAA;MACJ,CAAA,EAvBS,SAAA;AAwBb,KAAA;AACJ,EAAA,CAAA,CAAA,OACOtS,KAAAA,EAAO;AACV,IAAA,MAAM,IAAI2I,KAAAA,CAAM,CAAA,uCAAA,EAA0C3I,KAAAA,YAAiB2I,KAAAA,GAAQ3I,MAAMzC,OAAAA,GAAU4c,MAAAA,CAAOna,KAAAA,CAAAA,CAAAA,iEAAAA,CACtG,CAAA;AACR,EAAA;AACJ;AA3DsBgZ,MAAAA,CAAAA,qBAAAA,EAAAA,uBAAAA,CAAAA;AC3df,IAAMoB,mBAAAA,GAAsB;AAAC,EAAA,QAAA;AAAU,EAAA;;AAKvC,IAAMC,uBAAAA,GAA0B;AAAC,EAAA,kBAAA;AAAoB,EAAA,oBAAA;AAAsB,EAAA;;AAI3E,IAAMC,QAAAA,GAAW;AAAC,EAAA,SAAA;AAAW,EAAA,QAAA;AAAU,EAAA,QAAA;AAAU,EAAA;;AAajD,IAAMC,oBAAAA,GAAuBrd,EAAEG,MAAAA,CAAO;AACzCuF,EAAAA,SAAAA,EAAW1F,CAAAA,CAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,GAAMmK,QAAAA,EAAQ;EACpCjI,MAAAA,EAAQzJ,CAAAA,CAAEC,KAAKkd,uBAAAA,CAAAA;AACf7Y,EAAAA,IAAAA,EAAMtE,CAAAA,CAAEM,MAAAA,EAAM,CAAGgC,GAAAA,CAAI,CAAA,CAAA;AACrBgb,EAAAA,OAAAA,EAAStd,CAAAA,CAAEC,IAAAA,CAAKmd,QAAAA,CAAAA,CAAU1c,QAAAA;AAC9B,CAAA,CAAA;AAaO,IAAM6c,yBAAAA,GAA4Bvd,EAAEG,MAAAA,CAAO;AAC9Cqd,EAAAA,OAAAA,EAASxd,CAAAA,CAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,GAAM+I,WAAAA,EAAW;AACrCmN,EAAAA,MAAAA,EAAQzd,CAAAA,CAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,GAAM+I,WAAAA,EAAW;AACpCoN,EAAAA,MAAAA,EAAQ1d,CAAAA,CAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,GAAM+I,WAAAA,EAAW;AACpCqN,EAAAA,QAAAA,EAAU3d,EAAEmE,MAAAA,EAAM,CAAGoD,KAAG,CAAG+I,WAAAA,GAAc5P,QAAAA;AAC7C,CAAA,CAAA;AAoCO,IAAMkd,sBAAAA,GAAyB5d,EAAEG,MAAAA,CAAO;EAC3C0d,iBAAAA,EAAmB7d,CAAAA,CAAEC,KAAKid,mBAAAA,CAAAA;AAC1BY,EAAAA,eAAAA,EAAiB9d,CAAAA,CAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,GAAM+I,WAAAA,EAAW;AAC7CyN,EAAAA,gBAAAA,EAAkB/d,CAAAA,CAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,GAAM+I,WAAAA,EAAW;AAC9C0N,EAAAA,eAAAA,EAAiBhe,CAAAA,CAAEmE,MAAAA,EAAM,CAAGoD,GAAAA,GAAM+I,WAAAA,EAAW;AAC7C2N,EAAAA,iBAAAA,EAAmBje,EAAEmE,MAAAA,EAAM,CAAG7B,IAAI,CAAA,CAAA,CAAGM,IAAI,GAAA,CAAA;AACzCsb,EAAAA,eAAAA,EAAiBle,CAAAA,CAAE4E,KAAAA,CAAMyY,oBAAAA,CAAAA,CAAsBza,IAAI,EAAA,CAAA;EACnDub,YAAAA,EAAcZ;AAClB,CAAA,CAAA;AAKO,IAAMa,2BAAAA,GAA8Bpe,EAAEG,MAAAA,CAAO;EAChD2C,KAAAA,EAAO9C,CAAAA,CAAEoC,QAAQ,IAAA,CAAA;AACjBhC,EAAAA,IAAAA,EAAMJ,EAAEC,IAAAA,CAAK;AAAC,IAAA,cAAA;AAAgB,IAAA,WAAA;AAAa,IAAA;AAAiB,GAAA,CAAA;AAC5DI,EAAAA,OAAAA,EAASL,EAAEM,MAAAA;AACf,CAAA,CAAA;AAK8CN,EAAEiD,KAAAA,CAAM;AAAC2a,EAAAA,sBAAAA;AAAwBQ,EAAAA;AAA4B,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACmDpG,CAAA,CAAA;AACN,SAAMC,cAAAA,KAAAA,EAAkBC;AAExB,EAAA,MAAKD,eAAAA,GAAiB,MAAA,IAAA,EAAA;AACrB,EAAA,IAAA,CAAA,eAAA,EAAO;AACNpa,IAAAA,OAAAA;MACAoQ,IAAAA,EAAAA,aAAAA;MACAtB,UAAAA,EAAY,QAAA;MACZwL,UAAAA,EAASC,GAAAA;AACTrY,MAAAA,OAAAA,EAAQ,cAAA,CAAA,WAAA;MACT,MAAA,EAAA;AACD,KAAA;AAGA,EAAA;AACCsY,EAAAA,MAAAA,MAAAA,GAASC;AACTC,IAAAA,OAAAA,EAAAA,sBAAYC,eAAyBP,CAAAA;AACrCQ,IAAAA,UAAAA,EAAAA,yBAAaC,eAA0BT,CAAAA;AACxC,IAAA,WAAA,EAAA,0BAAA,eAAA;AAGA,GAAA;AACAU,EAAAA,MAAAA,OAAAA,GAAcC,MAAAA,CAASC,OAAAA,CAAOD,MAAI,CAAA;AAElC,EAAA,OAAA,CAAOE,IAAAA,CAAAA,CAAAA,CAAAA,EAAAA,CAAAA,KAAaC,EAAAA,CAAAA,CAAAA,GAAAA,CAAAA,CAAAA,CAAAA,CAAAA,CAAAA;AACpB,EAAA,MAAM,CAAA,WAAA,EAAGC,YAAuB,CAAA,GAAA,QAAA,CAAA,CAAA;AAGhC,EAAA,MAAMC,GAAAA,WAASF,CAAAA,GAAAA,QAAeC,CAAAA,CAAAA;AAC9B,EAAA,MAAMrM,SAAAA,YAAAA,GAAsB,WAAA;AAG5B,EAAA,MAAMsB,aAAaiL,IAAAA,CAAAA,GAAAA,CAAAA,IAAAA,EAAAA,GAAAA,GAAoBjB,SAAAA,GAAAA,CAAAA;AAGvC,EAAA,MAAMlY,UAAAA,GAASoZ,oBAAYL,eAAab,CAAAA;AAExC,EAAA,MAAA,MAAA,GAAO,WAAA,CAAA,WAAA,EAAA,eAAA,EAAA,QAAA,UAAA,CAAA;AACNpa,EAAAA,OAAAA;IACAoQ,IAAAA,EAAAA,WAAAA;AACAtB,IAAAA,UAAAA;AACAwL,IAAAA,UAAAA;AACApY,IAAAA,OAAAA,EAAAA,eAAAA,WAAAA,CAAAA;AACD,IAAA;AACD,GAAA;AAKA;AAhDOkY,MAAAA,CAAAA,aAAAA,EAAAA,eAAAA,CAAAA;AAiDN,SAAIzR,sBAAQ,KAAA,EAAA;AACZ,EAAA,IAAA,KAAA,GAAM4S,CAAAA;AAGN,EAAA,MAAA,UAAA,GAAWpX,MAAWqX,WAAAA,EAAShB;AAC9B,EAAA,KAAA,MAAIrW,OAAAA,IAAakW,QAAAA,CAAQ,OAAA,CAAA,QAAA,EAAA;AACxB1R,IAAAA,IAAAA,OAAAA,CAAS,IAAA,CAAA,KAAA,CAAA,EAAA;AACT,MAAA,KAAA,IAAA,IAAA;AACD,MAAA;AACD,IAAA;AAGA,EAAA;AACA,EAAA,IAAA,cAAA,GAAWxE,CAAAA;AACV,EAAA,KAAA,MAAIA,OAAAA,IAAakW,QAAAA,CAAQ,OAAA,CAAA,UAAA,EAAA;AACxBoB,IAAAA,IAAAA,OAAAA,CAAAA,IAAAA,CAAAA,KAAAA,CAAAA,EAAAA;AACD,MAAA,cAAA,EAAA;AACD,IAAA;AAEA,EAAA;AACC9S,EAAAA,IAAAA,iBAAgB0P,CAAAA,EAAKha;AACtB,IAAA,KAAA,IAAA,OAAA,IAAA,CAAA,GAAA,CAAA,cAAA,GAAA,CAAA,EAAA,CAAA,CAAA,GAAA,GAAA;AAGA,EAAA;AACC,EAAA,KAAA,MAAI8F,OAAAA,IAAakW,QAAAA,CAAQ,OAAA,CAAA,eAAA,EAAA;AACxB1R,IAAAA,IAAAA,OAAAA,CAAS,IAAA,CAAA,KAAA,CAAA,EAAA;AACV,MAAA,KAAA,IAAA,IAAA;AACD,IAAA;AAGA,EAAA;AACA,EAAA,MAAI+S,KAAAA,GAAMC,KAAAA,CAAU,KAAA,CAAKD,KAAMC,CAAAA;AAC9BhT,EAAAA,IAAAA,MAAAA,MAAAA,IAAS,CAAA,IAAA,MAAA,MAAA,IAAA,CAAA,IAAA,QAAA,CAAA,EAAA;AACV,IAAA,KAAA,IAAA,IAAA;AAGA,EAAA;AACA,EAAA,MAAMiT,gBACLL,KAAAA,CAAAA,KAAAA,CAAWM,gBAAS,CAAA,IACpBN,EAAAA,EAAAA,MAAAA;AAMD5S,EAAAA,MAAAA,aAAAA,GAASmT,WAAgBF,QAAAA,CAAgB,IAAA,KAAO,UAAA,CAAA,QAAA,CAAA,QAAA,CAAA,IAAA,UAAA,CAAA,QAAA,CAAA,SAAA,CAAA,IAAA,UAAA,CAAA,QAAA,CAAA,WAAA,CAAA,IAAA,UAAA,CAAA,SAAA,UAAA,CAAA,IAAA,UAAA,CAAA,QAAA,CAAA,SAAA,CAAA;AAGhD,EAAA,KAAA,IAAI,YAAA,IAAA,gBAAA,IAAA,GAAA,IAAA,CAAA;AACHjT,EAAAA,IAAAA,+DAAAA,CAAS,IAAA,CAAA,KAAA,CAAA,EAAA;AACV,IAAA,KAAA,IAAA,GAAA;AAEA,EAAA;AACD,EAAA,OAAA,IAAA,CAAA,GAAA,CAAA,CAAA,EAAA,KAAA,CAAA;AAKA;AA3DKA,MAAAA,CAAAA,qBAAAA,EAAAA,uBAAAA,CAAAA;AA4DJ,SAAIA,yBAAQ,KAAA,EAAA;AACZ,EAAA,IAAA,KAAA,GAAM4S,CAAAA;AAGN,EAAA,MAAA,UAAA,GAAWpX,MAAWqX,WAAAA,EAASd;AAC9B,EAAA,KAAA,MAAIvW,OAAAA,IAAakW,QAAAA,CAAQ,UAAA,CAAA,QAAA,EAAA;AACxB1R,IAAAA,IAAAA,OAAAA,CAAS,IAAA,CAAA,KAAA,CAAA,EAAA;AACT,MAAA,KAAA,IAAA,IAAA;AACD,MAAA;AACD,IAAA;AAGA,EAAA;AACA,EAAA,IAAA,cAAA,GAAWxE,CAAAA;AACV,EAAA,KAAA,MAAIA,OAAAA,IAAakW,QAAAA,CAAQ,UAAA,CAAA,UAAA,EAAA;AACxBoB,IAAAA,IAAAA,OAAAA,CAAAA,IAAAA,CAAAA,KAAAA,CAAAA,EAAAA;AACD,MAAA,cAAA,EAAA;AACD,IAAA;AACA,EAAA;AACC9S,EAAAA,IAAAA,iBAAgB0P,CAAAA,EAAKha;AACtB,IAAA,KAAA,IAAA,OAAA,IAAA,CAAA,GAAA,CAAA,cAAA,GAAA,CAAA,EAAA,CAAA,CAAA,GAAA,IAAA;AAGA,EAAA;AACA,EAAA,MAAIqd,KAAAA,GAAMC,KAAAA,CAAS,KAAA,CAAG,KAAA,CAAA;AACrBhT,EAAAA,IAAAA,KAAAA,CAAAA,SAAS,CAAA,EAAA;AACV,IAAA,KAAA,IAAA,IAAA;AAGA,EAAA;AACCA,EAAAA,IAAAA,4BAAAA,CAAS,IAAA,CAAA,KAAA,CAAA,EAAA;AACV,IAAA,KAAA,IAAA,GAAA;AAGA,EAAA;AACCA,EAAAA,IAAAA,yBAAAA,CAAS,IAAA,CAAA,KAAA,CAAA,EAAA;AACV,IAAA,KAAA,IAAA,IAAA;AAGA,EAAA;AACCA,EAAAA,IAAAA,SAAAA,CAAS,IAAA,CAAA,KAAA,CAAA,EAAA;AACV,IAAA,KAAA,IAAA,GAAA;AAIA,EAAA;AACC,EAAA,IAAA,iBAAA,CAAMoT,IAAAA,CAAAA,KAAoB,CAAA,EAAA;AAC1B,IAAA,MAAIA,oBAAmB,yBAAA,CAAA,IAAA,CAAA,KAAA,CAAA,IAAA,mBAAA,CAAA,KAAA,KAAA,CAAA;AACtBpT,IAAAA,IAAAA,iBAAAA,EAAS;AACV,MAAA,KAAA,IAAA,IAAA;AACD,IAAA;AAGA,EAAA;AACCA,EAAAA,IAAAA,UAAAA,CAAS,QAAA,CAAA,eAAA,CAAA,EAAA;AACV,IAAA,KAAA,IAAA,GAAA;AAGA,EAAA;AACCA,EAAAA,IAAAA,UAAAA,CAAS,QAAA,CAAA,WAAA,CAAA,IAAA,UAAA,CAAA,QAAA,CAAA,UAAA,CAAA,IAAA,UAAA,CAAA,QAAA,CAAA,WAAA,CAAA,EAAA;AACV,IAAA,KAAA,IAAA,IAAA;AAGA,EAAA;AAKA,EAAA,MAAMmT,aAAAA,GAAgBzB,UAAAA,CAAM2B,QAAAA,CAAM,MAAA,KAAA,UAAA,CAAyBL,QAAAA,CAAAA,UAAAA,CAAAA,IAAAA,WAAAA,QAAAA,CAAAA,oBAAAA,CAAAA,IAAAA,UAAAA,CAAAA,SAAAA,UAAAA,CAAAA;AAC3D,EAAA,MAAIC,gBAAiBE,KAAAA,CAAAA,KAAAA,CAAAA,gBAAkB,CAAA,IAAA,EAAA,EAAA,MAAA;AACtCnT,EAAAA,IAAAA,aAAAA,IAAS,eAAA,CAAA,EAAA;AACV,IAAA,KAAA,IAAA,GAAA;AAGA,EAAA;AACCA,EAAAA,IAAAA,+BAAAA,CAAS,IAAA,CAAA,KAAA,CAAA,EAAA;AACV,IAAA,KAAA,IAAA,IAAA;AAEA,EAAA;AACD,EAAA,OAAA,IAAA,CAAA,GAAA,CAAA,CAAA,EAAA,KAAA,CAAA;AAKA;AApFKA,MAAAA,CAAAA,wBAAAA,EAAAA,0BAAAA,CAAAA;AAqFJ,SAAIA,0BAAQ,KAAA,EAAA;AAGZ,EAAA,IAAA,KAAA,GAAWxE,IAAAA;AACV,EAAA,KAAA,MAAIA,OAAAA,IAAakW,QAAAA,CAAQ,WAAA,CAAA,QAAA,EAAA;AACxB1R,IAAAA,IAAAA,OAAAA,CAAS,IAAA,CAAA,KAAA,CAAA,EAAA;AACT,MAAA,KAAA,IAAA,IAAA;AACD,MAAA;AACD,IAAA;AAGA,EAAA;AACC,EAAA,KAAA,MAAIxE,OAAAA,IAAakW,QAAAA,CAAQ,WAAA,CAAA,UAAA,EAAA;AACxB1R,IAAAA,IAAAA,OAAAA,CAAS,IAAA,CAAA,KAAA,CAAA,EAAA;AACV,MAAA,KAAA,IAAA,IAAA;AACD,IAAA;AAGA,EAAA;AACA,EAAA,MAAI+S,KAAAA,GAAMC,KAAAA,CAAU,KAAA,CAAKD,KAAMC,CAAAA;AAC9BhT,EAAAA,IAAAA,KAAAA,CAAAA,MAAAA,IAAS,CAAA,IAAA,KAAA,CAAA,UAAA,CAAA,EAAA;AACV,IAAA,KAAA,IAAA,GAAA;AAGA,EAAA;AACCA,EAAAA,IAAAA,MAAAA,IAAAA,CAAS,KAAA,CAAA,IAAA,KAAA,CAAA,UAAA,CAAA,EAAA;AACV,IAAA,KAAA,IAAA,GAAA;AAEA,EAAA;AACD,EAAA,OAAA,IAAA,CAAA,GAAA,CAAA,CAAA,EAAA,KAAA,CAAA;AAKA;AAlCKA,MAAAA,CAAAA,yBAAAA,EAAAA,2BAAAA,CAAAA;AAwCJ,SAAMsT,WAAAA,CAAWC,IAAAA,EAAOpB,KAAAA,EAAQqB,MAAAA,EAC9BC,UAAAA,EAASC;AAGX,EAAA,MAAMC,QAAAA,GAAAA,OAAgB,OAAA,CAAIlM,MAAAA,EAAAA,GAAAA,CAAAA,CAAAA,CAAAA,CAAAA,EAAAA,CAAAA,MAAAA,CAAAA,EAAAA,CAAAA,IAAAA,CAAAA,CAAAA,OAAAA,CAAAA,CAAAA,CAAAA,CAAAA,CAAAA,CAAAA,CAAAA,IAAAA,CAAAA,IAAAA,CAAAA;AAE1B,EAAA,MAAA,aAAA,GAAQpQ,IAAAA,UAAAA,CAAAA,CAAAA,CAAAA;UACF,IAAA;IACJ,KAAA,SAAA;AACC,MAAA,IAAA,yBAAA,CAAO,IAAA,CAAA,KAAA,CAAA,EAAiCsc;AACzC,QAAA,OAAA,CAAA,8BAAA,EAAA,aAAA,CAAA,EAAA,EAAA,QAAA,CAAA,CAAA,CAAA;AACA,MAAA;AACC,MAAA,IAAA,oCAAA,CAAiCA,IAAAA,CAAAA,KAAAA,CAAAA,EAAkBL;AACpD,QAAA,OAAA,CAAA,uBAAA,EAAA,aAAA,CAAA,EAAA,EAAA,QAAA,CAAA,CAAA,CAAA;AACA,MAAA;AAED,MAAA,OAAK,CAAA,wBAAA,EAAA,aAAA,CAAA,EAAA,EAAA,QAAA,CAAA,CAAA,CAAA;IACJ,KAAA,YAAA;AACC,MAAA,IAAA,UAAA,CAAO,IAAA,CAAA,KAAA,CAAA,EAAkBK;AAC1B,QAAA,OAAA,CAAA,eAAA,EAAA,aAAA,CAAA,EAAA,EAAA,QAAA,CAAA,CAAA,CAAA;AACA,MAAA;AACC,MAAA,IAAA,cAAA,CAAO,IAAA,CAAA,KAAA,CAAA,EAAuBA;AAC/B,QAAA,OAAA,CAAA,oBAAA,EAAA,aAAA,CAAA,EAAA,EAAA,QAAA,CAAA,CAAA,CAAA;AACA,MAAA;AAED,MAAA,OAAK,CAAA,sBAAA,EAAA,aAAA,CAAA,EAAA,EAAA,QAAA,CAAA,CAAA,CAAA;IACJ,KAAA,aAAA;AACF,MAAA,OAAA,CAAA,oBAAA,EAAA,aAAA,CAAA,EAAA,EAAA,QAAA,CAAA,CAAA,CAAA;AACD;AAKO;AAjCAL,MAAAA,CAAAA,WAAAA,EAAAA,aAAAA,CAAAA;AAkCN,SAAO,kBAAA,IAAA,EAAA;AAAE,EAAA,OAAG1B;AAAqB,IAAA,GAAA,eAAA,IAAA;AAClC,GAAA;AAKO;AANC,MAAA,CAAA,iBAAA,EAAA,mBAAA,CAAA;AAOP,SAAMgC,gBAAcC,OAAAA,EAAWlC;AAC/B,EAAA,MAAA,GAAA,GAAYmC,OAAAA,CAAIF,QAAAA,GAAa,OAAA,CAAA,OAAA;AAC9B,EAAA,OAAA,IAAA,CAAA,GAAA,CAAA,GAAA,GAAA,CAAA,CAAA,GAAA,IAAA;AAYO;AAdAA,MAAAA,CAAAA,eAAAA,EAAAA,iBAAAA,CAAAA;AAeN,SAAMb,oBAAoB,KAAA,EAAOgB;AACjC,EAAA,MAAMC,KAAAA,GAAAA,KAAAA,CAAYjB,KAAAA,CAAMC,KAAAA,CAAAA,CAAAA,OAAAA,CAAAA,CAAAA,KAAAA,CAAAA,CAAAA,MAAAA,GAAAA,CAAAA,CAAAA;AAExB,EAAA,MAAIiB,YAAAA,KAAAA,CAAkB,MAAA;AAGtB,EAAA,IAAID,eAAAA,GAAe,CAAA;AAClBC,EAAAA,IAAAA,YAAAA,CAAAA,EAAAA;AACD,IAAA,eAAA,IAAWD,GAAAA;EACVC,CAAAA,MAAAA,IAAAA,SAAAA,IAAmB,CAAA,IAAA,SAAA,IAAA,EAAA,EAAA;AACpB,IAAA,eAAA,IAAWD,GAAAA;AACVC,EAAAA,CAAAA,MAAAA,IAAAA,YAAmB,EAAA,EAAA;AACpB,IAAA,eAAA,IAAWD,GAAAA;AACVC,EAAAA,CAAAA,MAAAA,IAAAA,YAAmB,EAAA,EAAA;AACpB,IAAA,eAAA,IAAA,GAAA;AAGA,EAAA;AACA,EAAA,MAAIC,kBAAAA,GAAoB,0CAAA,CAAA,IAAA,CAAA,KAAA,CAAA;AACvBD,EAAAA,IAAAA,kBAAAA,EAAmB;AACpB,IAAA,eAAA,IAAA,IAAA;AAGA,EAAA;AACA,EAAA,MAAIhB,aAAAA,GAAe,6EAAA,CAAA,IAAA,CAAA,KAAA,CAAA;AAClBgB,EAAAA,IAAAA,aAAAA,EAAAA;AACD,IAAA,eAAA,IAAA,IAAA;AAGA,EAAA;AACA,EAAA,MAAIE,cAAAA,GAAgB,mDAAA,CAAA,IAAA,CAAA,KAAA,CAAA;AACnBF,EAAAA,IAAAA,cAAAA,EAAAA;AACD,IAAA,eAAA,IAAA,GAAA;AAGA,EAAA;AACA,EAAA,MAAIG,iBAAmB,KAAA,CAAA,KAAA,CAAA,KAAA,CAAA,IAAA,EAAA,EAAA,MAAA;AACtBH,EAAAA,IAAAA,gBAAAA,CAAAA,EAAmB;AACpB,IAAA,eAAA,IAAA,GAAA;AAGA,EAAA;AACA,EAAA,MAAII,WAAAA,GAAa,8DAAA,CAAA,IAAA,CAAA,KAAA,CAAA;AAChBJ,EAAAA,IAAAA,WAAAA,EAAAA;AACD,IAAA,eAAA,IAAA,IAAA;AAGA,EAAA;AACA,EAAA,MAAIK,gBAAiBN,UAAAA,CAAY,IAAA,CAAG,KAAA,CAAA,IAAA,kBAAA,CAAA,KAAA,KAAA,CAAA;AACnCC,EAAAA,IAAAA,aAAAA,IAAmB,YAAA,CAAA,EAAA;AACpB,IAAA,eAAA,IAAA,GAAA;AAGA,EAAA;AACA,EAAA,MAAIM,cAAAA,GAAgB,sDAAA,CAAA,IAAA,CAAA,KAAA,CAAA;AACnBN,EAAAA,IAAAA,cAAAA,EAAAA;AACD,IAAA,eAAA,IAAA,GAAA;AAGA,EAAA;AACA,EAAA,MAAIO,cAAAA,GAAgB,aAAA,CAAA,IAAA,YAAA,CAAA,KAAA,KAAA,CAAA,CAAA,KAAA,EAAA,CAAA;AACnBP,EAAAA,IAAAA,cAAAA,EAAAA;AACD,IAAA,eAAA,IAAA,GAAA;AAIA,EAAA;AACC,EAAA,IAAA,kBAAO,GAAA,EAAA;AACR,IAAA,OAAA,QAAA;AACA,EAAA;AACC,EAAA,IAAA,mBAAO,IAAA,EAAA;AACR,IAAA,OAAA,UAAA;AACA,EAAA;AACD,EAAA,OAAA,SAAA;AAYO;AArFAlB,MAAAA,CAAAA,mBAAAA,EAAAA,qBAAAA,CAAAA;AA2FN,SAAItL,oBAAAA,CAAe,UAAA,EAAYtB,IAAAA,EAAa,UAAA,EAAM;AACjD,EAAA,IAAA,UAAA,KAAO,QAAA,IAAA,UAAA,GAAA,IAAA,EAAA;AACNsO,IAAAA,OAAAA;MACAC,cAAAA,EAAM,KAAA;MACNC,IAAAA,EAAAA,CAAAA;MACAC,YAAAA,EAAc,KAAA;MACf,YAAA,EAAA;AACD,KAAA;AAEA,EAAA;AACC,EAAA,IAAA,eAAO,QAAA,EAAA;AACNH,IAAAA,OAAAA;MACAC,cAAAA,EAAM,IAAA;MACNC,IAAAA,EAAAA,CAAAA;MACAC,YAAAA,EAAc,KAAA;MACf,YAAA,EAAA;AACD,KAAA;AAGA,EAAA;AACC,EAAA,IAAA,eAAO,UAAA,EAAA;AACNH,IAAAA,OAAAA;MACAC,cAAAA,EAAM,IAAA;MACNC,IAAAA,EAAAA,EAAAA;MACAC,YAAAA,EAAcvd,IAAAA;AACf,MAAA,YAAA,EAAA,IAAA,KAAA;AACD,KAAA;AAGA,EAAA;AACCod,EAAAA,OAAAA;IACAC,cAAAA,EAAM,IAAA;IACNC,IAAAA,EAAAA,EAAAA;IACAC,YAAAA,EAAc,IAAA;IACf,YAAA,EAAA;AACD,GAAA;AA2BO;AA9DFnN,MAAAA,CAAAA,oBAAAA,EAAAA,sBAAAA,CAAAA;AAgEJ,SAAIpQ,WAAAA,CAAS,OAAW,IAAA,EAAA;AACvB,EAAA,IAAA,SAAO,SAAA,EAAA;AAACqa,IAAAA,OAAAA;;;AAGT,EAAA;AAAkBA,EAAAA,MAAAA,QAAAA,GAAAA;;;AAGlB,EAAA,MAAA,UAAA,GAAkBmD,MAAAA,WAAAA,EAAatB;AAC9B,EAAA,KAAA,MAAIX,CAAAA,IAAAA,EAAWM,QAAS4B,KAAAA,MAAAA,CAAO,OAAA,CAAA,aAAA,CAAA,EAAA;AAE9B,IAAA,IAAA,UAAA,CAAMC,QAAAA,CAAUF,IAAS,CAAA,EAAA;AACzB,MAAA,MAAIE,OAAAA,GAAS,SAAA,CAAA,CAAA;AACZC,MAAAA,IAAAA,OAAAA,EAASC;AACV,QAAA,QAAA,CAAA,IAAA,CAAA,KAAA,CAAA,OAAA,CAAA,IAAA,MAAA,CAAA,CAAA,GAAA,EAAA,IAAA,CAAA,GAAA,CAAA,EAAA,IAAA,CAAA,EAAA,OAAA,CAAA,CAAA;AACD,MAAA;AACD,IAAA;AAGA,EAAA;AACD,EAAA,OAAA,QAAA,CAAA,KAAA,CAAA,CAAA,EAAA,CAAA,CAAA;AA3nBA;AAwmBK5d,MAAAA,CAAAA,WAAAA,EAAAA,aAAAA,CAAAA;AAxmBL,IAAA,cAAA;AAAA,IAAA,QAAA;AAAA,IAAA;;EAwDA,mCAAA,GAAiF;AACvE,IAAA,cAAA,GAAA;AAAEwc,MAAAA,OAAAA,EAAAA;QAAeqB,QAAAA,EAAS,GAAA;QAAI,OAAA,EAAA;AACvCnD,OAAAA;AAAwB,MAAA,UAAA,EAAA;QAAKmD,QAAAA,EAAS,GAAA;QAAI,OAAA,EAAA;AAC1CjD,OAAAA;AAAyB,MAAA,WAAA,EAAA;QAAKiD,QAAAA,EAAS,GAAA;QAAI,OAAA,EAAA;AAC5C;AAKMrC,KAAAA;;;AAGJsC,MAAAA,OAAAA,EAAAA;QACC,QAAA,EAAA;AACA,UAAA,gBAAA;AACA,UAAA,aAAA;AACA,UAAA,iBAAA;AACA,UAAA,YAAA;AACA,UAAA,YAAA;AACA,UAAA,eAAA;AACA,UAAA,8BAAA;AACA,UAAA,gBAAA;AACA,UAAA,WAAA;AACA,UAAA,UAAA;;;;QAIA,UAAA,EAAA;AACA,UAAA,yBAAA;AACA,UAAA,mBAAA;AACA,UAAA,cAAA;AACA,UAAA,oCAAA;AACA,UAAA,mBAAA;AACA,UAAA,yDAAA;AACA,UAAA,wBAAA;AACA,UAAA,gBAAA;AACA,UAAA,YAAA;AACA,UAAA,oDAAA;AACA,UAAA,oBAAA;;;;QAIA,eAAA,EAAA;AACA,UAAA,YAAA;AACA,UAAA,eAAA;AACA,UAAA,WAAA;AACA,UAAA,WAAA;AACA,UAAA,eAAA;AACA,UAAA,YAAA;AACA,UAAA,aAAA;AACA,UAAA,YAAA;AACA,UAAA,UAAA;AACA,UAAA,UAAA;AACA,UAAA,cAAA;AACA,UAAA,cAAA;AACA,UAAA,iBAAA;AACA,UAAA,aAAA;AACA,UAAA,UAAA;AACA,UAAA,aAAA;AACA,UAAA,cAAA;;;;;AAMS,MAAA,UAAA,EAAA;QACT,QAAA,EAAA;AACA,UAAA,UAAA;AACA,UAAA,cAAA;AACA,UAAA,mFAAA;AACA,UAAA,iBAAA;AACA,UAAA,iBAAA;AACA,UAAA,eAAA;AACA,UAAA,cAAA;;;QAGA,UAAA,EAAA;AACA,UAAA,mEAAA;AACA,UAAA,yDAAA;AACA,UAAA,4CAAA;AACA,UAAA,6CAAA;AACA,UAAA,wCAAA;AACA,UAAA,gDAAA;AACA,UAAA,+BAAA;AACA,UAAA,4CAAA;;;;;AAMS,MAAA,WAAA,EAAA;QAAC,QAAA,EAAA;AAA0B,UAAA,wBAAA;AAA2B,UAAA,yBAAA;;;QAE/D,UAAA,EAAA;AACA,UAAA,0DAAA;AACA,UAAA,uCAAA;;;AAGH;AAiBgBC,KAAAA;AAiDPtD,IAAAA,OAAAA,CAAAA,eAAAA,eAAAA,CAAAA;AA4DAE,IAAAA,OAAAA,CAAAA,uBAAAA,uBAAAA,CAAAA;AAqFAE,IAAAA,OAAAA,CAAAA,0BAAAA,0BAAAA,CAAAA;AAmCAS,IAAAA,OAAAA,CAAAA,2BAAAA,2BAAAA,CAAAA;AAuCO0C,IAAAA,OAAAA,CAAAA,aAAAA,aAAAA,CAAAA;AAOAC,IAAAA,OAAAA,CAAAA,mBAAAA,mBAAAA,CAAAA;AAeA5C,IAAAA,OAAAA,CAAAA,iBAAAA,iBAAAA,CAAAA;AAsFA6C,IAAAA,OAAAA,CAAAA,qBAAAA,qBAAAA,CAAAA;AA+CHC,IAAAA,OAAAA,CAAAA,sBAA0C,sBAAA,CAAA;AAC5C,IAAA,aAAA,GAAA;MAAC,QAAA,EAAA;AAAU,QAAA,QAAA;AAAM,QAAA,IAAA;AAAQ,QAAA,MAAA;AAAW,QAAA,SAAA;;;MACtC,KAAA,EAAA;AAAQ,QAAA,MAAA;AAAa,QAAA,WAAA;AAAU,QAAA,QAAA;;;MAC/B,KAAA,EAAA;AAAa,QAAA,WAAA;AAAO,QAAA,KAAA;AAAS,QAAA,OAAA;AAAW,QAAA,SAAA;;;MACvC,MAAA,EAAA;AAAW,QAAA,SAAA;AAAW,QAAA,SAAA;AAAO,QAAA,KAAA;;;MAC7B,MAAA,EAAA;AAAiB,QAAA,eAAA;AAAY,QAAA,UAAA;AAAW,QAAA,SAAA;;;MAC3C,GAAA,EAAA;AAAY,QAAA,UAAA;AAAS,QAAA,OAAA;AAAW,QAAA,SAAA;;;MAC3B,QAAA,EAAA;AAAM,QAAA,IAAA;AAAS,QAAA,OAAA;AAAe,QAAA,aAAA;;;MAClC,IAAA,EAAA;AAAQ,QAAA,MAAA;AAAa,QAAA,WAAA;AAAa,QAAA,WAAA;;;MAC7B,SAAA,EAAA;AAAU,QAAA,QAAA;AAAW,QAAA,SAAA;AAAU,QAAA,QAAA;;;MACnC,KAAA,EAAA;AAAQ,QAAA,MAAA;AAAS,QAAA,OAAA;AAAW,QAAA,SAAA;;;AAWrBC,KAAAA;;;;IC3aftU,uBAAAA,GAAS;EACTuU,OAAAA,EAAAA,IAAAA;EACAC,WAAAA,EAAAA,CAAAA;EACAC,cAAAA,EAAAA,CAAAA;EACAC,eAAAA,EAAAA,CAAAA;EACAC,qBAAAA,EAAoB,IAAA;EACrB,kBAAA,EAAA;ACpLO;AACN1hB,IAAAA,OAAAA,GAAM,YAAA,CAAA;EACNkK,IAAAA,EAAAA,cAAAA;EACD,UAAA,EAAA,OAAA,CAAA,IAAA,QAAA,KAAA;;ICNCpK,2BAAAA,GAAI;EACJ6hB,EAAAA,EAAAA,kCAAAA;EACAla,QAAAA,EAAAA,CAAAA;EACC,OAAA,kBAAmBiE,OAAAA,CAAUkW,CAAAA,GAAAA,KAAI5gB;AAChC,IAAA,KAAA,MAAI0K,CAAAA,OAAY,KAAA,CAAA,IAAA,IAAA,OAAA,CAAA,4BAAA,CAAA,SAAA,EAAA;AACf,MAAA,IAAA,SAAO,CAAA,EAAA;AACR,QAAA,OAAA,IAAA;AACD,MAAA;AACA,IAAA;AACD,IAAA,OAPS,KAAA;AAQTmW,EAAAA,CAAAA,EAAAA,SAAAA,CAAAA;EACC,QAAA,kBAAoCC,OAAAA,CAAA,CAAA,GAAA,KAAA;AAEpC,IAAA,MAAA,WAAYxe,EAAMoI;AACjB,IAAA,KAAA,MAAIA,CAAAA,MAAY,KAAA,CAAA,IAAA,IAAA,OAAA,CAAA,4BAAA,CAAA,SAAA,EAAA;AACf2I,MAAAA,IAAAA,SAASwM,CAAAA,EAAK;iBACN,IAAA,CAAA;UACPzhB,KAAAA,EAAM,SAAA;UACNC,IAAAA,EAAAA,2BAAAA;AACAiE,UAAAA,OAAAA,EAAAA,iBAAAA,KAAAA,CAAAA,mBAAAA,CAAAA;AACAye,UAAAA,IAAAA;UACD,UAAA,EAAA;SACD,CAAA;AACD,MAAA;AAEA,IAAA;AAAS1N,IAAAA,OAAAA;AAAS,MAAA;AACnB,KAAA;AACD,EAAA,CAAA,EAAA,UAAA;;;;ECvBO,IAAA,EAAA,GAAA;;EAGP,QAAA,EAAA;AAEO,CAAA;IACNvU,eAAAA,GAAI;EACJ6hB,EAAAA,EAAAA,sBAAAA;EACAla,QAAAA,EAAAA,CAAAA;EACC,OAAA,kBAAmBmE,OAAAA,CAAUgW,CAAAA,GAAAA,KAAII;AAChC,IAAA,KAAA,MAAIpW,CAAAA,KAAAA,EAAQqW,KAAAA,KAAAA,GAAAA,CAAAA,SAAAA,CAAqBC,SAAU,EAAA;AAC1C,MAAA,IAAA,KAAA,GAAO,qBAAA,QAAA,EAAA;AACR,QAAA,OAAA,IAAA;AACD,MAAA;AACA,IAAA;AACD,IAAA,OAPS,KAAA;AAQTL,EAAAA,CAAAA,EAAAA,SAAAA,CAAAA;EACC,QAAA,kBAAoCC,OAAAA,CAAA,CAAA,GAAA,KAAA;AAEpC,IAAA,MAAA,WAAYxe,EAAMsI;AACjB,IAAA,KAAA,MAAIA,CAAAA,IAAAA,EAAQqW,KAAAA,KAAAA,GAAAA,CAAAA,SAAAA,CAA2B,SAAA,EAAA;AACtC5N,MAAAA,IAAAA,KAAAA,GAASwM,qBAAK,IAAA,EAAA;iBACN,IAAA,CAAA;UACPzhB,KAAAA,EAAM,OAAA;UACNC,IAAAA,EAAAA,cAAAA;AACAiE,UAAAA,OAAAA,EAAAA,CAAAA,+BAAAA,EAAAA,CAAAA,KAAAA,GAAAA,GAAAA,EAAAA,OAAAA,CAAAA,CAAAA,CAAAA,CAAAA,EAAAA,CAAAA;AACAye,UAAAA,IAAAA;UACD,UAAA,EAAA;SACD,CAAA;MACC1N,CAAAA,MAAAA,IAASwM,KAAAA,GAAK,qBAAA,QAAA,EAAA;iBACN,IAAA,CAAA;UACPzhB,KAAAA,EAAM,SAAA;UACNC,IAAAA,EAAAA,cAAAA;AACAiE,UAAAA,OAAAA,EAAAA,CAAAA,mCAAAA,EAAAA,CAAAA,KAAAA,GAAAA,GAAAA,EAAAA,OAAAA,CAAAA,CAAAA,CAAAA,CAAAA,EAAAA,CAAAA;AACAye,UAAAA,IAAAA;UACD,UAAA,EAAA;SACD,CAAA;AACD,MAAA;AAEA,IAAA;AAAS1N,IAAAA,OAAAA;AAAS,MAAA;AACnB,KAAA;AACD,EAAA,CAAA,EAAA,UAAA;;ACtCA,IAAM8N,wBAAAA,GAAAA,EAAAA;AACN,IAAMC,UAAAA,mBAAaN,OAAAA,CAAA,CAACxe,SAA0B,iCAAA,CAA3B,IAAA,CAAA,IAAA,CAAA,EAAA,YAAA,CAAA;AAEZ,IAAM+e,UAAAA,mBAAuCP,OAAAA,CAAA,CAAA,SAAA,oBAAA,CAAA,IAAA,CAAA,IAAA,CAAA,EAAA,YAAA,CAAA;IACnDhiB,sBAAAA,GAAI;EACJ6hB,EAAAA,EAAAA,qBAAAA;EACAla,QAAAA,EAAAA,EAAAA;AACAoa,EAAAA,OAAAA,kBAAAA,OAAAA,CAAAA,MAAWD,IAAAA,EAAAA,SAAAA,CAAAA;EACV,QAAA,kBAA2CE,OAAAA,CAAA,CAAA,GAAA,KAAA;AAG3C,IAAA,MAAIF,cAAYrO,EAAAA;AACf+O,IAAAA,IAAAA,IAAAA,OAAAA,CAAYzB,SAAAA,KAAK,YAAA,GAAA,CAAA,OAAA,CAAA,cAAA,MAAA,EAAA;kBACV,IAAA,CAAA;QACNc,IAAAA,EAAAA,mCAAAA;QACA5P,QAAAA,EAAAA,CAAAA;QACAwQ,UAAAA,EAAU,GAAA;QACVxc,QAAAA,EAAO6b,UAAAA;AACR,QAAA,KAAA,EAAA,GAAA,CAAA;OACD,CAAA;AAGA,IAAA;AACCU,IAAAA,IAAAA,GAAAA,CAAAA,KAAAA,CAAYzB,IAAAA,CAAK,CAAA,CAAA,KAAA,UAAA,CAAA,CAAA,CAAA,IAAA,CAAA,UAAA,CAAA,CAAA,CAAA,CAAA,EAAA;kBACV,IAAA,CAAA;QACNc,IAAAA,EAAAA,6BAAAA;QACA5P,QAAAA,EAAAA,CAAAA;QACAwQ,UAAAA,EAAU,GAAA;QACX,QAAA,EAAA;OACD,CAAA;AAGA,IAAA;AACCD,IAAAA,IAAAA,GAAAA,CAAAA,OAAAA,CAAYzB,aAAAA,GAAK,wBAAA,EAAA;kBACV,IAAA,CAAA;QACNc,IAAAA,EAAAA,+DAAAA;QACA5P,QAAAA,EAAAA,CAAAA;QACAwQ,UAAAA,EAAU,GAAA;QACX,QAAA,EAAA;OACD,CAAA;AAEA,IAAA;AAASD,IAAAA,OAAAA;AAAY,MAAA;AACtB,KAAA;AACD,EAAA,CAAA,EAAA,UAAA;;IClDCxiB,iBAAAA,GAAI;EACJ6hB,EAAAA,EAAAA,wBAAAA;EACAla,QAAAA,EAAAA,CAAAA;EACC,OAAA,kBAAmB+a,OAAAA,CAAAA,CAAAA,GAAAA,KAAgB;AACpC,IAAA,OAFS,GAAA,CAAA,QAAA,aAAA,GAAA,CAAA;AAGTX,EAAAA,CAAAA,EAAAA,SAAAA,CAAAA;EACC,QAAA,kBAAoCC,OAAAA,CAAA,CAAA,GAAA,KAAA;AAEpC,IAAA,MAAIF,WAAYY,EAAAA;AACfnO,IAAAA,IAAAA,GAAAA,CAAAA,OAAAA,CAAc,aAAA,GAAA,CAAA,EAAA;eACN,IAAA,CAAA;QACPjV,KAAAA,EAAM,OAAA;QACNC,IAAAA,EAAAA,eAAAA;QACA0iB,OAAAA,EAAAA,CAAAA,EAAY,GAAA,CAAA,OAAA,CAAA,aAAA,CAAA,KAAA,EAAA,IAAA,OAAA,CAAA,aAAA,GAAA,CAAA,GAAA,GAAA,GAAA,EAAA,CAAA,oBAAA,CAAA;QACb,UAAA,EAAA;OACD,CAAA;AAEA,IAAA;AAAS1N,IAAAA,OAAAA;AAAS,MAAA;AACnB,KAAA;AACD,EAAA,CAAA,EAAA,UAAA;ACXA;AACC,SAAOhC,YAASyM,QAAAA,EAAS;AAC1B,EAAA,OAAA,QAAA,CAAA,QAAA,CAAA,QAAA,CAAA,IAAA,QAAA,CAAA,SAAA,QAAA,CAAA,IAAA,QAAA,CAAA,QAAA,CAAA,WAAA,CAAA;AAFSqD;AACD9P,MAAAA,CAAAA,WAAAA,EAAAA,aAAAA,CAAAA;AAYDyP,OAAAA,CAAMW,aAAAA,YAAgC,CAAA;IAC5C3iB,eAAAA,GAAI;EACJ6hB,EAAAA,EAAAA,sBAAAA;;;;;EAMC,OAAA,kBAAsBQ,OAAAA,CAAAA,CADbP,GAAAA,KAAAA;AAEV,IAAA,OAFS,GAAA,CAAA,KAAA,CAAA,IAAA,CAAA,WAAA,CAAA;;;;;EAQR,QAAA,kBAA2CE,OAAAA,CAAA,CADjCF,GAAAA,KAAAA;AAEV,IAAA,MAAMc,cAAkC,EAAA;AACxC,IAAA,MAAMC,aAAAA,EAAAA;AAGN,IAAA,MAAA,mBAAuB5c,EAAAA;AACtB,IAAA,KAAA,MAAKoc,IAAAA,IAAW7e,IAAAA,KAAAA,EAAO;AACtB,MAAA,IAAA,CAAA,WAAA,CAAA,IAAA,CAAA,EAAA;AACD,QAAA;AAEA,MAAA;AAIC,MAAA,IAAA;AACA,QAAA,MAAKlE,OAAM,GAAA,CAAA,IAAA;AAEV,QAAA,IAAA,CAAA,IAAA,EAAA;AACD,UAAA;AAEA,QAAA;AACA,QAAA,MAAIwjB,MAAAA,GAAOC,kBAAAA,CAAiBC,IAAAA,EAAQlE,IAAAA,CAAAA;AACnC8D,QAAAA,IAAAA,MAAAA,CAAAA,MAAAA,IAAgBE,MAAAA,CAAAA,OAAAA,CAAAA,SAAAA,CAAAA,EAAAA;AAChBD,UAAAA,UAAAA,CAAAA,KAAAA,MAAsBrf,CAAAA;AACvB,UAAA,gBAAA,CAAA,KAAA,IAAA,CAAA;AACD,QAAA;MAAS,CAAA,CAAA,MAAA;AACV,MAAA;AAGA,IAAA;AAEA,IAAA,MAAIyf,YAAAA,GAAiB,UAAA,CAAG,MAAA,CAAA,CAAA,GAAA,EAAA,MAAA,GAAA,GAAA,CAAA,CAAA,OAAA,CAAA,MAAA,EAAA,CAAA,CAAA;AACvB,IAAA,IAAA,iBAAO,CAAA,EAAA;AAAET,MAAAA,OAAAA;AAAgB,QAAA,WAAA,EAAA;AAC1B,OAAA;AAGA,IAAA;AACA,IAAA,IAAIS,QAAAA;AACHpB,IAAAA,IAAAA,gBAAW,CAAA,EAAA;AACZ,MAAA,QAAA,GAAWoB,CAAAA;AACVpB,IAAAA,CAAAA,MAAAA,IAAAA,gBAAW,CAAA,EAAA;AACZ,MAAA,QAAA,GAAO,CAAA;IACNA,CAAAA,MAAAA;AACD,MAAA,QAAA,GAAA,CAAA;AAGA,IAAA;AAGAW,IAAAA,MAAAA,SAAAA,GAAiB,gBAAA,CAAA,MAAA,IAAA,CAAA,GAAA,gBAAA,CAAA,KAAA,IAAA,CAAA,GAAA,CAAA,EAAA,gBAAA,CAAA,MAAA,CAAA,MAAA,CAAA;gBACV,IAAA,CAASS;MACfpB,IAAAA,EAAAA,CAAAA,MAAAA,EAAAA,YAAAA,CAAAA,aAAAA,EAAAA,YAAAA,GAAAA,IAAAA,GAAAA,GAAAA,EAAAA,OAAAA,SAAAA,CAAAA,2DAAAA,CAAAA;AACA5P,MAAAA,QAAAA;MACAwQ,UAAAA,EAAU,GAAA;MACVxc,QAAAA,EAAO4c,SAAAA;MACR,KAAA,EAAA;KAEA,CAAA;AAASL,IAAAA,OAAAA;AAAY,MAAA;AACtB,KAAA;AACD,EAAA,CAAA,EAAA,UAAA;;IC/FCxiB,oBAAAA,GAAI;EACJ6hB,EAAAA,EAAAA,2BAAAA;EACAla,QAAAA,EAAAA,CAAAA;EACC,OAAA,kBAAWub,OAAAA,CAAiBpE,CAAAA,GAAAA,KAAS;AACtC,IAAA,OAFS,GAAA,CAAA,iBAAA,MAAA,GAAA,CAAA;AAGTiD,EAAAA,CAAAA,EAAAA,SAAAA,CAAAA;EACC,QAAA,kBAAoCC,OAAAA,CAAA,CAAA,GAAA,KAAA;AAGpC,IAAA,MAAMmB,WAAAA,EAAAA;AACN,IAAA,MAAA,gBAAA,uBAA4BD,GAAAA,EAAkB;AAC7C,IAAA,KAAA,MAAME,SAAAA,IAAWD,IAAAA,gBAAAA,EAAqBE;AACtCD,MAAAA,MAAAA,WAAcC,gBAAAA,CAAc,GAAA,CAAA,SAAA,CAAA,IAAA,KAAA,EAAA;AAC5BF,MAAAA,QAAAA,CAAAA,IAAAA,CAAAA,UAAqBE,IAAAA,CAAAA;AACtB,MAAA,gBAAA,CAAA,GAAA,CAAA,SAAA,CAAA,IAAA,EAAA,QAAA,CAAA;AAGA,IAAA;AACC,IAAA,KAAA,MAAMC,CAAAA,IAAAA,EAAAA,KAAc,CAAA,IAAA,gBAAA,CAAA,SAAA,EAAA;AAAI,MAAA,MAAA,WAAA,GAAQC;;;eAExB,IAAA,CAAA;QACPjkB,KAAAA,EAAM,SAAA;QACNC,IAAAA,EAAAA,mBAAAA;AACAiE,QAAAA,OAAAA,EAAAA,CAAAA,EAAAA,WAAAA,CAAAA,MAAAA,CAAAA,oBAAAA,EAAAA,WAAAA,CAAAA,MAAAA,GAAAA,CAAAA,GAAAA,GAAAA,GAAAA,EAAAA,CAAAA,EAAAA,EAAAA,WAAAA,CAAAA,IAAAA,CAAAA,IAAAA,CAAAA,CAAAA,CAAAA;AACAye,QAAAA,IAAAA;QACD,UAAA,EAAA;OACD,CAAA;AAEA,IAAA;AAAS1N,IAAAA,OAAAA;AAAS,MAAA;AACnB,KAAA;AACD,EAAA,CAAA,EAAA,UAAA;;ACxCA,IAAA,cAAA,GAAA,MAAA;AAAA,EAAA;;;;;AAuCSkB;AACA+N,EAAAA,MAAAA;AAER,EAAA,KAAA,GAAA,EAAA;EAEC,WAAA,CAAI/N,MAAAA,GAAO+L,EAAAA,EAAAA;AACV,IAAA,IAAA,MAAA,CAAM,WAAA,KAAU,MAAA,IAAA,MAAA,CAAA,cAAA,CAAA,EAAA;AACjB,MAAA,MAAA,IAAA,MAAA,iDAAA,CAAA;AACA,IAAA;AACC,IAAA,IAAA,MAAA,CAAM,cAAA,KAAU,MAAA,IAAA,MAAA,CAAA,iBAAA,CAAA,EAAA;AACjB,MAAA,MAAA,IAAA,MAAA,oDAAA,CAAA;AACA,IAAA;AACC,IAAA,IAAA,MAAA,CAAM,eAAA,KAAU,MAAA,IAAA,MAAA,CAAA,kBAAA,CAAA,EAAA;AACjB,MAAA,MAAA,IAAA,MAAA,qDAAA,CAAA;AAEA,IAAA;SAAmBiC,MAAAA,GAAAA;MAAyB,GAAGhO,uBAAAA;MAAO,GAAA;AACtD,KAAA;AACD,IAAA,IAAA,CAAA,sBAAA,EAAA;;;;;EAOC,sBAAA,GAAkBiO;AAClB,IAAA,IAAA,CAAKC,aAAaC,2BAAAA,CAAAA;AAClB,IAAA,IAAA,CAAKD,aAAaE,eAAAA,CAAAA;AAClB,IAAA,IAAA,CAAKF,aAAaG,iBAAAA,CAAAA;AAClB,IAAA,IAAA,CAAKH,aAAapB,oBAAAA,CAAAA;AACnB,IAAA,IAAA,CAAA,aAAA,sBAAA,CAAA;;;;;;AAQC,EAAA,YAAA,CAAW,IAAA,EAAA;AACX,IAAA,IAAIwB,IAAAA,GAAAA,CAAAA;AAEJ,IAAA,IAAA,KAAA,GAAOC,KAAOD,KAAAA,CAAO,MAAA;AACpB,IAAA,OAAA,OAAYvI,KAAAA,EAAKyI;AACjB,MAAA,MAAI,GAAA,GAAKT,IAAAA,CAAMU,KAAAA,CAAAA,CAAKrC,IAAAA,GAAWle,SAAKke,CAAAA,CAAAA;AACnCmC,MAAAA,IAAAA,KAAOE,KAAAA,CAAM,GAAA,CAAA,CAAA,QAAA,GAAA,KAAA,QAAA,EAAA;AACd,QAAA,IAAA,GAAO,GAAA,GAAA,CAAA;MACNH,CAAAA,MAAAA;AACD,QAAA,KAAA,GAAA,GAAA;AACD,MAAA;AAGA,IAAA;AACD,IAAA,IAAA,CAAA,KAAA,CAAA,MAAA,CAAA,IAAA,EAAA,CAAA,EAAA,IAAA,CAAA;;;;;AAOC,EAAA,MAAA,CAAK,OAAA,EAAKtO;AACT,IAAA,IAAA,CAAA,IAAA,CAAO,MAAA,CAAA,OAAA,EAAA;AACN0O,MAAAA,OAAAA;QACA5P,OAAAA,EAAAA,0BAAAA;AACAiO,QAAAA,QAAAA,EAAAA,EAAAA;AACA4B,QAAAA,WAAAA,EAAAA,EAAc;AACdC,QAAAA,YAAAA,EAAa,EAAA;AACd,QAAA,WAAA,EAAA;AACD,OAAA;AAGA,IAAA;AACA,IAAA,MAAM7B,WAAAA,EAAAA;AACN,IAAA,MAAM4B,cAAAA,EAA8B;AAGpC,IAAA,MAAA,eAAmB,EAAA;AAClB,IAAA,KAAA,MAAI,IAAA,IAAA,KAAA,KAAA,EAAA;AACH,MAAA,IAAA;AACC,QAAA,IAAA,IAAA,CAAMtB,OAAAA,CAASnf,OAAKoe,CAAAA,EAAAA;AAEpB,UAAA,MAAIe,MAAAA,GAAOvO,IAAAA,CAAAA,QAAAA,CAAU,OAAA,CAAA;AACpBA,UAAAA,IAAAA,OAASwM,QAAAA,EAAQ+B;AAClB,YAAA,QAAA,CAAA,IAAA,CAAA,GAAA,MAAA,CAAA,QAAA,CAAA;AACA,UAAA;AACCN,UAAAA,IAAAA,OAAAA,WAAAA,EAAoBM;AACrB,YAAA,WAAA,CAAA,IAAA,CAAA,GAAA,MAAA,CAAA,WAAA,CAAA;AACA,UAAA;AACCsB,UAAAA,IAAAA,OAAAA,YAAAA,EAAqBtB;AACtB,YAAA,YAAA,CAAA,IAAA,CAAA,GAAA,MAAA,CAAA,YAAA,CAAA;AACD,UAAA;AACD,QAAA;AACCwB,MAAAA,CAAAA,CAAAA,OAAOtiB,KAAAA,EAAM;AACZuiB,QAAAA,OAAAA,CAAAA,MAAQ5gB,sBAAAA,EAAK3D;AACbgC,UAAAA,MAAAA,EAAOA,IAAAA,CAAAA,EAAAA;AACR,UAAA,KAAA,EAAA,KAAA,YAAA,KAAA,GAAA,KAAA,CAAA,OAAA,GAAA,OAAA,KAAA;SACD,CAAA;AACD,MAAA;AAGA,IAAA;AACA,IAAA,MAAMwiB,kBAAAA,QAAAA,CAAqBhC,KAAAA,CACzBiC,CAAAA,EAAAA,IAAAA,CAAMvG,OAASA,WAAE2D,CAAAA;AAEnB,IAAA,MAAM6C,kBAAAA,GAAAA,WAAAA,CAAsBN,IAAAA,CAAazI,CAAAA,GAAM,CAAA,KAAG,CAAA,CAAKlG,QAAAA,GAAOiM,CAAAA,CAAAA,QAAe,CAAA,CAAA,KAAA,CAAA,CAAA,EAAA,IAAA,CAAA,OAAA,cAAA,CAAA;AAG7E,IAAA,MAAM2C,sBAAmB5O,YAAAA,CAAOmM,KAAAA,CAAAA,CAAAA,EAAAA,IAAAA,CAAqB,OAAK+C,eAAAA,CAAAA;AAG1D,IAAA,MAAMR,WAAAA,GAAU,KAAKS,MAAAA,CAAAA,kBAAAA,GAAgBje,KAAAA,mBAAAA,CAAAA,OAAAA,IAAAA,EAAAA;AAGrC,IAAA,MAAMke,OAAAA,GAAAA,IAAAA,CAAAA,eAAAA,CAA6BlD,OAAAA,CAAAA;AAEhClO,IAAAA,MAAAA,cAAAA,GAAmBvS,IAAAA,CAAAA,MAAAA,CAAQuS,qBAAAA,GAAAA;AAC3BqR,MAAAA,SAAAA,EAAAA,QAAene,OAAAA,CAAQzF,SAAAA;AACvBiX,MAAAA,aAAAA,EAAexR,QAAQzF,OAAAA,CAAQiX,aAAAA;AAC/BuK,MAAAA,aAAAA,EAAe/b,QAAQzF,OAAAA,CAAQwhB,aAAAA;AAChC,MAAA,aAAA,EACCqC,QAAAA,OAAAA,CAAAA;KAEH,GAAA,MAAA;AACCZ,IAAAA,OAAAA;AACA5P,MAAAA,OAAAA;MACAiO,QAAAA,EAAAA,eAAAA;MACA4B,WAAAA,EAAAA,kBAAAA;MACAC,YAAAA,EAAAA,mBAAAA;AACAnjB,MAAAA,WAAAA;MACD,OAAA,EAAA;AACD,KAAA;;;;;AAMC,EAAA,mBAAA,CAAe+E,OAAAA,EAAWzC;AACzB,IAAA,OAAA,OAAA,CAAMwhB,KAAAA,CAAAA,GAAAA,CAAAA,CAAAA,IAAAA,KAAAA;AACN,MAAA,MAAMC,2BAAyB/C,OAAAA,CAAUpG,OAAAA,CAAItY,4BAAAA,CAAS,GAAA,CAAA,IAAA,CAAA,IAAA,CAAA;AAEtD,MAAA,MAAA,cAAA,GAAO,OAAA,CAAA,SAAA,CAAA,GAAA,CAAA,IAAA,CAAA,IAAA,CAAA;AACN8N,MAAAA,OAAAA;;;;QAIA0T,kBAAAA,EAAAA,CAAAA;;;;;;;QAOA3L,cAAAA,EAAcxU,SAAAA;AACdogB,QAAAA,YAAAA,EAAAA,KAAAA,GAAAA,EAAAA;AACD,QAAA;AACD,OAAA;IACD,CAAA,CAAA;;;;;AAMC,EAAA,eAAA,CAAYhf,OAAAA,EAAM6Y;AACjB,IAAA,IAAA,OAAA,CAAO,KAAA,CAAA,MAAA,KAAA,CAAA,EAAA;AACR,MAAA,OAAA,4BAAA;AAGA,IAAA;AACA,IAAA,IAAIoG,OAAAA,GAAAA,CAAAA;AACJ,IAAA,IAAA,UAAA,GAAY1hB,EAAAA;AACX,IAAA,KAAA,MAAIoI,CAAAA,MAAQuZ,KAAS,CAAA,IAAA,QAAA,OAAA,CAAA,4BAAA,CAAA,SAAA,EAAA;AACpBA,MAAAA,IAAAA,QAAUvZ,OAAAA,EAAAA;AACVsZ,QAAAA,OAAAA,GAAAA,KAAAA;AACD,QAAA,UAAA,GAAA,IAAA;AACD,MAAA;AAEA,IAAA;AACC,IAAA,IAAA,UAAMhD,CAAAA,EAAAA;AACN,MAAA,MAAMkD,SAAAA,GAAAA,OAAAA,CACLlD,SAAAA,CAAY,GAAA,CAAA,UAAeA,CAAAA,IAAAA,CAAAA;AAE5B,MAAA,MAAA,cAAA,GAAUgD,YAAAA,GAAAA,GAAAA,MAAAA,GAAgCC,YAAAA,GAAAA,GAAAA,UAAAA,GAAAA,SAAAA,GAA0CC,GAAAA,GAAAA,KAAAA,GAAAA,QAAAA;AACrF,MAAA,OAAA,CAAA,EAAA,UAAA,CAAA,mBAAA,EAAA,OAAA,mCAAA,cAAA,CAAA,CAAA,CAAA;AAEA,IAAA;AACD,IAAA,OAAA,CAAA,UAAA,EAAA,OAAA,CAAA,KAAA,CAAA,MAAA,CAAA,KAAA,EAAA,QAAA,KAAA,CAAA,MAAA,GAAA,CAAA,GAAA,GAAA,GAAA,EAAA,CAAA,CAAA;;;;;AAMC,EAAA,cAAA,CAAO,IAAA,EAAA;AACN9T,IAAAA,OAAAA;MACA+T,IAAAA,EAAAA,IAAAA;MACAL,kBAAAA,EAAAA,CAAAA;MACAM,wBAAAA,EAAmB,CAAA;MACnBC,iBAAAA,EAAgB,CAAA;MAChBlM,cAAAA,EAAcxU,SAAAA;AACdogB,MAAAA,YAAAA,EAAAA,KAAgB,GAAA,EAAA;MACjB,cAAA,EAAA;AACD,KAAA;AACD,EAAA;;ICnNCO,eAAAA,GAAQ;EACRhC,MAAAA,EAAO,CAAA;EACPiC,KAAAA,EAAO,CAAA;EACPC,KAAAA,EAAAA,CAAAA;EACAC,SAAAA,EAAW,CAAA;EACXC,SAAAA,EAAS,CAAA;EACV,OAAA,EAAA;AAKO,CAAA;AACN,IAAA,iBAAA,GAAA;AACA,EAAA,QAAA;AACA,EAAA,OAAA;AACA,EAAA,OAAA;AACA,EAAA,WAAA;AACA,EAAA,WAAA;;;IAuBAC,eAAAA,GAAY;EACZC,UAAAA,EAAU,CAAA;EACVC,QAAAA,EAAAA,CAAAA;EACAC,UAAAA,EAAAA,CAAAA;EACAC,WAAAA,EAAAA,CAAAA;EACAC,cAAAA,EAAAA,CAAAA;EACAC,gBAAAA,EAAc,CAAA;EACdC,YAAAA,EAAAA,CAAAA;EACAC,cAAAA,EAAAA,CAAAA;EACAhD,eAAAA,EAAW,CAAA;EACXiD,SAAAA,EAAU,CAAA;EACX,QAAA,EAAA;AAqHO,CAAA;AACN,SAAKC,oBAAM,IAAA,EAAA;AACV,EAAA,IAAA,CAAA,IAAA,EAAO;AACR,IAAA,OAAA,CAAA;AAGA,EAAA;AACD,EAAA,OAAA,IAAA,CAAA,IAAA,CAAA,IAAA,CAAA,MAAA,GAAA,CAAA,CAAA;AAPgBC;AACVD,MAAAA,CAAAA,mBAAAA,EAAAA,qBAAAA,CAAAA;;ICjJLE,qBAAAA,GAAa;EACbC,WAAAA,EAAO,GAAA;AACNlB,EAAAA,KAAAA,EAAAA;AAAe,IAAA,MAAA,EAAA;MAAK1jB,GAAAA,EAAK,GAAA;MAAK+f,GAAAA,EAAAA,GAAAA;MAAY,QAAA,EAAA;AAC1C2B,KAAAA;AAAc,IAAA,KAAA,EAAA;MAAK1hB,GAAAA,EAAK,GAAA;MAAM+f,GAAAA,EAAAA,GAAAA;MAAY,QAAA,EAAA;AAC1C4D,KAAAA;AAAc,IAAA,KAAA,EAAA;MAAM3jB,GAAAA,EAAK,GAAA;MAAM+f,GAAAA,EAAAA,GAAAA;MAAY,QAAA,EAAA;AAC3C6D,KAAAA;AAAkB,IAAA,SAAA,EAAA;MAAG5jB,GAAAA,EAAK,CAAA;MAAM+f,GAAAA,EAAAA,IAAAA;MAAY,QAAA,EAAA;AAC5C8D,KAAAA;AAAkB,IAAA,SAAA,EAAA;MAAG7jB,GAAAA,EAAK,CAAA;MAAM+f,GAAAA,EAAAA,GAAAA;MAAY,QAAA,EAAA;AAC5C+D,KAAAA;AAAgB,IAAA,OAAA,EAAA;MAAG9jB,GAAAA,EAAK,CAAA;MAAM+f,GAAAA,EAAAA,GAAAA;MAAY,QAAA,EAAA;AAC3C;AACD;AAyBO;AACN,SAAKpM,qBAAQ,MAAA,EAAA;AACZ,EAAA,IAAA,CAAA,MAAA,EAAU9K;AACX,IAAA,MAAA,IAAA,MAAA,2BAAA,CAAA;AAEA,EAAA;AACC,EAAA,IAAA,CAAA,OAAUA,QAAAA,CAAM,MAAA,CAAA,WAAA,CAAA,IAAwB8K,MAAAA,CAAOgR,eAAW,CAAA,EAAA;AAC3D,IAAA,MAAA,IAAA,KAAA,CAAA,CAAA,qBAAA,EAAA,MAAA,CAAA,WAAA,CAAA,mBAAA,CAAA,CAAA;AAGA,EAAA;AACC,EAAA,KAAA,MAAKhR,QAAOiR,iBAAAA,EAAa;AACxB,IAAA,IAAA,CAAA,MAAA,CAAU/b,KAAAA,CAAM,IAAA,CAAA,EAAA;AACjB,MAAA,MAAA,IAAA,KAAA,CAAA,CAAA,4BAAA,EAAA,IAAA,CAAA,CAAA,CAAA;AACD,IAAA;AAGA,EAAA;AAEA,EAAA,MAAIgc,OAAAA,GAAUlR,MAAAA,CAAOgR,MAAAA,CAAAA,MAAAA,CAAa,KAAA,CAAA,CAAA,MAAA,CAAA,CAAA,GAAA,EAAA,IAAA,KAAA,GAAA,GAAA,IAAA,CAAA,KAAA,CAAA,CAAA;AACjC,EAAA,IAAA,OAAA,GAAU9b,OACT,WAAA,EAAA;AAGF,IAAA,MAAA,IAAA,KAAA,CAAA,CAAA,kCAAA,EAAA,OAAA,CAAA,iBAAA,EAAA,MAAA,CAAA,WAAA,CAAA,uCAAA,CAAA,CAAA;AAGA,EAAA;AACC,EAAA,KAAA,MAASnJ,CAAAA,MAAMolB,IAAK9kB,CAAAA,IAAK,OAAA,OAAA,CAAA,MAAA,CAAA,KAAA,CAAA,EAAA;AACxB,IAAA,IAAA,IAAA,CAAM,GAAA,GAAI6I,IAAAA,CAAM,GAAA,EAAA;AACjB,MAAA,MAAA,IAAA,KAAA,CAAA,CAAA,KAAA,EAAA,IAAA,CAAA,OAAA,EAAA,KAAA,GAAA,CAAA,SAAA,EAAA,IAAA,CAAA,GAAA,CAAA,CAAA,CAAA,CAAA;AACA,IAAA;AACC,IAAA,IAAA,IAAA,CAAM,MAAIA,CAAAA,EAAM;AACjB,MAAA,MAAA,IAAA,KAAA,CAAA,CAAA,KAAA,EAAA,IAAA,CAAA,gBAAA,EAAA,IAAA,CAAA,GAAA,CAAA,CAAA,CAAA,CAAA;AACA,IAAA;AACC,IAAA,IAAA,IAAA,CAAM,MAAIA,CAAAA,EAAM;AACjB,MAAA,MAAA,IAAA,KAAA,CAAA,CAAA,KAAA,EAAA,IAAA,CAAA,gBAAA,EAAA,IAAA,CAAA,GAAA,CAAA,CAAA,CAAA,CAAA;AACA,IAAA;AACC,IAAA,IAAA,CAAA,MAAA,CAAUA,QAAAA,CAAM,IAAA,CAAQzK,QAAAA,CAAAA,EAAAA;AACzB,MAAA,MAAA,IAAA,KAAA,CAAA,CAAA,KAAA,EAAA,IAAA,CAAA,oBAAA,EAAA,IAAA,CAAA,QAAA,CAAA,CAAA,CAAA,CAAA;AACD,IAAA;AACD,EAAA;AAzCgB2mB;AACVpR,MAAAA,CAAAA,oBAAAA,EAAAA,sBAAAA,CAAAA;AAgDCuM,OAAAA,CAAA,sBAA4BvM,sBAAoB,CAAA;AACtD,SAAQ4J,mBAAe5J,MAAAA,EAAY;AAGpC,EAAA,OAAA,MAAA,CAAA,QAAA,MAAA,CAAA,KAAA,EAAA,IAAA,CAAA,CAAA,CAAA,EAAA,CAAA,KAAA,CAAA,CAAA,CAAA,EAAA,QAAA,GAAA,CAAA,CAAA,CAAA,CAAA,CAAA,QAAA,CAAA,CAAA,IAAA,CAAA,CAAA,IAAA,CAAA,KAAA,IAAA,CAAA;AAJgBqR;AACPzH,MAAAA,CAAAA,kBAAAA,EAAAA,oBAAAA,CAAAA;;AChGR,SAAM0H,YAAAA,UAAAA,EAAAA;AAEN,EAAA,MAAA,MAAA,uBAAwBC,GAAAA,EAAY;AACnC,EAAA,KAAA,MAAMjL,aAAcD,UAAAA,EAAc8K;AAClC7K,IAAAA,MAAKgF,OAAKkG,MAAAA,CAAAA,GAAAA,CAAAA,SAAAA,CAAAA,IAAAA,KAAAA,EAAAA;AACVF,IAAAA,IAAAA,CAAAA,KAAOG,SAAID,CAAAA;AACZ,IAAA,MAAA,CAAA,GAAA,CAAA,SAAA,CAAA,IAAA,EAAA,IAAA,CAAA;AAEA,EAAA;AACD,EAAA,OAAA,MAAA;AAVgBE;AACTJ,MAAAA,CAAAA,WAAAA,EAAAA,aAAAA,CAAAA;AAiBA/E,OAAAA,CAAA,aAASoF,aAAkBJ,CAAAA;AACjC,SAAOA,kBAAkB,UAAA,EAAYtH;AACtC,EAAA,OAAA,UAAA,CAAA,OAAA,CAAA,GAAA,EAAA,MAAA,GAAA,GAAA,CAAA,CAAA,eAAA,CAAA,CAAA;AAFgB0H;AACRJ,MAAAA,CAAAA,iBAAAA,EAAAA,mBAAAA,CAAAA;AA2BDhF,OAAAA,CAAA,mBAASqF,mBAAoD5R,CAAAA;AACnE,SAAM6R,kBAAAA,CAAc,YAAA,MAAA,EAAA;AACpB,EAAA,MAAMC,aAA6C,EAAA;AACnD,EAAA,MAAIC,aAAcf,EAAAA;AAGlB,EAAA,IAAA,OAAMM,MAAAA,CAASI,WAAAA;AAGf,EAAA,MAAMT,MAAAA,GAAQI,YAAAA,UAAmBrR,CAAAA;AAGjC,EAAA,MAAA,KAAA,GAAWmR,mBAAe,MAAA,CAAA;AACzB,EAAA,KAAA,MAAMa,QAAAA,KAAAA,EAAiBV;AACvB,IAAA,MAAMW,cAAAA,GAAYN,MAAAA,CAAAA,GAAAA,CAAAA,IAAkBK,KAAAA,EAAAA;AACpC,IAAA,MAAME,SAAAA,GAAUlS,kBAAmBjU,cAAAA,CAAAA;AAGnC,IAAA,MAAMomB,OAAAA,GAAAA,MAAAA,CAAiBpmB,KAAAA,CAAImmB,IAAAA,CAAAA,CAAAA,GAAAA;AAC3BL,IAAAA,MAAAA,SAAAA,GAAWV,IAAAA,CAAQgB,GAAAA,CAAAA,OAAAA,EAAAA,WAAAA,IAAAA,CAAAA;AACnBJ,IAAAA,UAAAA,CAAQI,IAAAA,CAAAA,GAAAA,SAAAA;AAGR,IAAA,IAAA,IAAIA,SAAAA;AACHL,IAAAA,IAAAA,YAAWxG,OAAAA,EAAK;AACf6F,MAAAA,UAAAA,CAAAA,IAAAA,CAAAA;AACAiB,QAAAA,IAAAA;QACAH,SAAAA,EAAAA,OAAAA;AACD,QAAA;OACD,CAAA;AACD,IAAA;AAEA,EAAA;AAASJ,EAAAA,OAAAA;AAAYE,IAAAA,UAAAA;AAAMD,IAAAA,IAAAA;AAAW,IAAA;AACvC,GAAA;AAjCgBF;AACTC,MAAAA,CAAAA,kBAAAA,EAAAA,oBAAAA,CAAAA;AAkHAtF,OAAAA,CAAA,oBAAS8F,oBAEfC,CAAAA;AAGA,SAAMC,kBAAAA,CAAgC,MAAA,EAAA,eAAA,EAAA,MAAA,EAAA;AACtC,EAAA,MAAMC,WAA8C,EAAA;AAGpD,EAAA,MAAMC,WAAS,EAAA;AACf,EAAA,MAAA,QAAWtB,EAAAA;AACVsB,EAAAA,KAAAA,MAAMtB,IAAAA,IAAQ,MAAA,CAAA,IAAA,CAAA,MAAA,CAAA,KAAA,CAAA,EAAA;AACf,IAAA,KAAA,CAAA,IAAA,CAAA,GAAA,CAAA;AAEA,EAAA;AAGA,EAAA,IAAA,SAAA,GAAgBmB,CAAAA;AACfG,EAAAA,KAAAA,MAAQtB,KAAI,eAAA,EAAOuB;AACnBC,IAAAA,KAAAA,CAAAA,CAAAA,CAAAA,IAAAA,CAAAA,IAAeD,CAAAA,CAAAA,aAAAA;AAChB,IAAA,SAAA,IAAA,CAAA,CAAA,aAAA;AAGA,EAAA;AACC,EAAA,KAAA,MAAMvB,aAAOK,MAAAA,EAAUL;AACvB,IAAA,MAAMyB,OAAAA,SAAAA,CAASpB,IAAAA;AACf,IAAA,MAAMqB,SAAAA,SAAAA,CAAiB5B,aAAAA;AAGvB,IAAA,MAAIwB,OAAAA,GAAMtB,MAAAA,CAAQyB,KAAAA,CAASC,IAAAA,CAAAA,CAAAA,GAAAA;AAC1BL,IAAAA,IAAAA,KAAAA,CAAAA,IAASlH,CAAAA,GAAK,MAAA,GAAA,OAAA,EAAA;AACbkG,MAAAA,QAAAA,CAAAA,IAAAA,CAAAA;AACA5hB,QAAAA,SAAAA;QACD,MAAA,EAAA;OACA,CAAA;AACD,MAAA;AAGA,IAAA;AACC4iB,IAAAA,IAAAA,SAAAA,GAAc,MAAA,GAAA,MAAA,CAAA,WAAA,EAAA;AACbhB,MAAAA,QAAAA,CAAAA,IAAAA,CAAAA;AACA5hB,QAAAA,SAAAA;QACD,MAAA,EAAA;OACA,CAAA;AACD,MAAA;AAGA2iB,IAAAA;AACAE,IAAAA,QAAAA,CAAMtB,KAAAA,SAASyB,CAAAA;AACfD,IAAAA,KAAAA,CAAAA,IAAAA,CAAAA,IAAaC,MAAAA;AACd,IAAA,SAAA,IAAA,MAAA;AAEA,EAAA;AACCL,EAAAA,OAAAA;AACAC,IAAAA,QAAAA;AACAC,IAAAA,QAAAA;AACAE,IAAAA,KAAAA;AACD,IAAA;AACD,GAAA;AA1DgBN;AAKTE,MAAAA,CAAAA,kBAAAA,EAAAA,oBAAAA,CAAAA;AC/JAhG,OAAAA,CAAMuG,oBAAmB,oBAAA,CAAA;AAKzB,IAAMC,gBAAAA,GAAmB,OAAA;AAiCzB,IAAA,YAAA,GAASC,IAAAA,EAAAA,GAAgBC,GAAAA;AAE/B,SAAMC,gBAAa9d,MAAAA,EAAKC;AACxB,EAAA,MAAA,UAAA,GAAkB,KAAA,SAAA,CAAU8d,MAAAA,EAAOD,OAAYE,IAAAA,CAAO,MAAA,CAAA,CAAA,IAAA,EAAalN,CAAAA;AACpE,EAAA,OAAA,UAAA,CAAA,QAAA,CAAA,CAAA,MAAA,CAAA,UAAA,CAAA,CAAA,MAAA,CAAA,WAAA,CAAA,CAAA,KAAA,CAAA,CAAA,EAAA,EAAA,CAAA;AAJgB8M;AAETE,MAAAA,CAAAA,eAAAA,EAAAA,iBAAAA,CAAAA;AAWA3G,OAAAA,CAAA,iBAAS8G,iBAAuB9B,CAAAA;AAEtC,SAAM+B,uBAAS,UAAA,EAAA;AAAI/B,EAAAA,MAAAA,MAAAA,GAAAA;AAAYvC,IAAAA,GAAAA;IAG/B,IAAA,CAAMnJ,CAAAA,GAAAA,CAAAA,KAAOyN,CAAAA,CAAAA,GAAOxJ,aAAAA,CAAgBvf,CAAAA,CAAE,EAAA,CAAA,CAAA;AAEtC,EAAA,MAAA,OAAOgpB,MAAAA,CAAW,GAAA,CAAA,CAAA,CAAA,KAAUJ,GAAAA,CAAAA,CAAOtN,EAAAA,CAAAA,CAAAA,EAAK2N,CAAAA,CAAAA,IAAK,CAAA,CAAA,EAAMJ,CAAAA,CAAAA,IAAO,CAAA,CAAA,EAAA,CAAA,CAAA,aAAmB,CAAA,CAAA,CAAA;AAC9E,EAAA,OAAA,UAAA,CAAA,QAAA,CAAA,CAAA,MAAA,CAAA,KAAA,IAAA,CAAA,GAAA,CAAA,CAAA,CAAA,MAAA,CAAA,WAAA,CAAA,CAAA,KAAA,CAAA,GAAA,EAAA,CAAA;AARgBC;AAETC,MAAAA,CAAAA,sBAAAA,EAAAA,wBAAAA,CAAAA;AAcA/G,OAAAA,CAAA,wBAASkH,wBAAyD,CAAA;AAExE,SAAM5N,yBAAO,WAAA,EAAA;QACZ6N,IAAAA,GAAAA;IACAC,WAAAA,EAAaC,WAAAA,CAAYD,WAAAA,CAAY7J,GAAAA,CAAI,CAAC+J,CAAAA,KAAMze,IAAAA,CAAKC,SAAAA,CAAUwe,CAAAA,CAAEnK,KAAK,CAAA,CAAA,CAAGsF,IAAAA,EAAAA;IACzE8E,WAAAA,EAAQF,WAAAA,CAAYE,WAAAA,CAAYD,GAAAA,CAAMze,CAAAA,CAAAA,KAAKC,IAAAA,CAAUwe,SAAAA,CAAU7E,CAAAA,CAAAA,KAAI,CAAA,CAAA,CAAA,IAAA,EAAA;IACnE+E,MAAAA,EAAAA,WAAAA,CAAkBH,MAAAA,CAAAA,GAAAA,CAAYG,CAAAA,CAAAA,KAAAA,IAAAA,CAAAA,SAAAA,CAAsBC,CAAAA,CAAAA,KAAM,CAAGA,CAAAA,CAAE7C,IAAAA,EAAI;AACpE,IAAA,gBAAA,EAAA,WAAA,CAAA,gBAAA,CAAA,GAAA,CAAA,CAAA,CAAA,KAAA,CAAA,EAAA,CAAA,CAAA,IAAA,CAAA,CAAA,EAAA,CAAA,CAAA,SAAA,CAAA,CAAA,EAAA,IAAA;AAEA,GAAA;AACD,EAAA,OAAA,UAAA,CAAA,QAAA,CAAA,CAAA,MAAA,CAAA,KAAA,SAAA,CAAA,IAAA,CAAA,CAAA,CAAA,MAAA,CAAA,WAAA,CAAA,CAAA,KAAA,CAAA,GAAA,EAAA,CAAA;AAVgBsC;AAET5N,MAAAA,CAAAA,wBAAAA,EAAAA,0BAAAA,CAAAA;AAgBA0G,OAAAA,CAAA,0BAAS0H,0BAAyD,CAAA;AACxE,SAAMf,0BAAkB7d,MAAAA,EAAU2K;AAClC,EAAA,MAAA,UAAA,GAAkB,KAAA,SAAA,CAAUmT,MAAAA,EAAOD,OAAYE,IAAAA,CAAO,MAAA,CAAA,CAAA,IAAA,EAAalN,CAAAA;AACpE,EAAA,OAAA,UAAA,CAAA,QAAA,CAAA,CAAA,MAAA,CAAA,UAAA,CAAA,CAAA,MAAA,CAAA,WAAA,CAAA,CAAA,KAAA,CAAA,CAAA,EAAA,EAAA,CAAA;AAHgB+N;AACTf,MAAAA,CAAAA,yBAAAA,EAAAA,2BAAAA,CAAAA;AAuBA3G,OAAAA,CAAM2H,2BAAAA,2BAAAA,CAAAA;AA1Jb,IAAA,cAAA,GAAA,MAAA;AAAA,EAAA;;;;;AA2JSC;AACAC,EAAAA,KAAAA,uBAAAA,GAAAA,EAAAA;AAER,EAAA,KAAA;AACC,EAAA,WAAA,CAAKA,QAAQA,YAAAA,EAAAA;AACd,IAAA,IAAA,CAAA,KAAA,GAAA,KAAA;;;;;;;;AASC,EAAA,GAAA,CAAA,GAAA,EAAMC;AACN,IAAA,MAAKA,KAAAA,GAAO,IAAA,CAAA,KAAA,CAAA,GAAA,CAAA,GAAA,CAAA;AACX,IAAA,IAAA,CAAA,KAAA,EAAO/E;AACR,MAAA,OAAA,MAAA;AAGA,IAAA;AACC,IAAA,IAAA,IAAA,CAAK6E,GAAAA,EAAMG,GAAAA,KAAAA,CAAOC,SAAAA,EAAAA;AAClB,MAAA,IAAA,CAAA,KAAA,CAAOjF,OAAAA,GAAAA,CAAAA;AACR,MAAA,OAAA,MAAA;AAEA,IAAA;AACD,IAAA,OAAA,KAAA,CAAA,KAAA;;;;;;;;AAQAmC,EAAAA,GAAAA,CACC,KAAMpiB,KAAAA,EAAMD;AACZ,IAAA,MAAK+kB,GAAAA,GAAM1C,KAAI8C,GAAAA,EAAK;AACnBre,IAAAA,IAAAA,CAAAA,KAAAA,CAAAA,IAAAA,GAAAA,EAAAA;AACAqe,MAAAA,KAAAA;AACAzpB,MAAAA,GAAAA;MACAO,SAAAA,EAAWgE,GAAAA;AACZ,MAAA,SAAA,EAAA,MAAA,IAAA,CAAA;KACD,CAAA;;;;;;;AAUC,EAAA,UAAA,CAAK8kB,QAAAA,EAAW;AACjB,IAAA,IAAA,CAAA,MAAA,KAAA,EAAA;;;;;EAMC,KAAA,GAAKA;AACN,IAAA,IAAA,CAAA,MAAA,KAAA,EAAA;;;;;EAMC,QAAA,GAAO;AACNhc,IAAAA,OAAAA;AACAqc,MAAAA,IAAAA,EAAAA,KAAS,KAAA,CAAA,IAAA;MACV,OAAA,EAAA;AACD,KAAA;;;;;AAMC,EAAA,GAAA,CAAA,GAAA,EAAMH;AACN,IAAA,MAAKA,KAAAA,GAAO,IAAA,CAAA,KAAA,CAAA,GAAA,CAAA,GAAA,CAAA;AACX,IAAA,IAAA,CAAA,KAAA,EAAO;AACR,MAAA,OAAA,KAAA;AACA,IAAA;AACC,IAAA,IAAA,IAAA,CAAKF,GAAAA,EAAMG,GAAAA,KAAAA,CAAOC,SAAAA,EAAAA;AAClB,MAAA,IAAA,CAAA,KAAA,CAAO,OAAA,GAAA,CAAA;AACR,MAAA,OAAA,KAAA;AACA,IAAA;AACD,IAAA,OAAA,IAAA;;;;;EAMC,KAAA,GAAMllB;AACN,IAAA,MAAIolB,GAAAA,GAAAA,KAAS,GAAA,EAAA;AAEb,IAAA,IAAA,MAAA,GAAYF,CAAAA;AACX,IAAA,KAAA,MAAIllB,CAAMglB,GAAAA,EAAAA,KAAMhpB,KAAAA,IAAAA,CAAW,KAAA,CAAA,SAAA,EAAA;AAC1B,MAAA,IAAA,GAAA,GAAK8oB,MAAMG,SAAAA,EAAOC;AAClBE,QAAAA,IAAAA,CAAAA,KAAAA,CAAAA,OAAAA,GAAAA,CAAAA;AACD,QAAA,MAAA,EAAA;AACD,MAAA;AAEA,IAAA;AACD,IAAA,OAAA,MAAA;AACD,EAAA;AAWO,CAAA;AAWN,SAAO,mBAAA,CAAA,UAAA,EAAA,WAAA,EAAA,YAAA,EAAA,OAAA,EAAA;AACNC,EAAAA,OAAAA;AACAC,IAAAA,oBAAAA,EAAsBA,OAAAA,CAAAA,oBAAAA;AACtBC,IAAAA,YAAAA,EAAW1jB,OAAAA,CAAQ0jB,YAAAA;AACnBC,IAAAA,SAAAA,EAAAA,OAAAA,CAAiBxB,SAAAA;AACjByB,IAAAA,eAAAA,EAAa5jB,uBAAQ4jB,UAAAA,CAAAA;AACrBC,IAAAA,WAAAA,EAAAA,OAAAA,CAAoBd,WAAAA;AACpBe,IAAAA,kBAAAA,EAAmBvB,0BAAyBG,YAAAA,CAAAA;AAC5CqB,IAAAA,iBAAAA,EAAiBnC,yBAAAA,WAAAA,CAAAA;IAClB,eAAA,EAAA;AACD,GAAA;AArBgBoC;AAWR,MAAA,CAAA,mBAAA,EAAA,qBAAA,CAAA;;ACxKPxB,IAAAA,iBAAAA,GAAa;AACbC,EAAAA,WAAAA,EAAa,EAAA;AACbG,EAAAA,WAAAA,EAAQ,EAAA;AACRC,EAAAA,MAAAA,EAAAA,EAAAA;AACD,EAAA,gBAAA,EAAA;AAUA,CAAA;AAEC,SAAMoB,SAAAA,CAAAA,SAAetjB,IAAAA,EACnB0O;AAIF,EAAA,MAAMvU,YAAAA,GAAYopB,OAAAA,CAAWD,OAAAA,CAAAA,mBAAAA,EAAiB,MAAA,CAAA,CAAA,OAAA,CAAA,KAAA,EAAA,IAAA,CAAA,CAAA,OAAA,CAAA,KAAA,EAAA,GAAA,CAAA;AAC9C,EAAA,MAAA,QAAa7U,IAAKwQ,MAAAA,CAAAA,CAAAA,CAAAA,EAAAA,YAAAA,KAAAA,GAAAA,CAAAA;AACnB,EAAA,OAAA,KAAA,CAAA,KAAA,IAAA,CAAA;AATSuE;AAEFF,MAAAA,CAAAA,SAAAA,EAAAA,WAAAA,CAAAA;AA2BA5I,OAAAA,CAAA,WACN+I,WACAC,CAAAA;AAGA,SAAA,OAAA,CAAQA,QAAAA,EAAQ7nB,OAAAA,EAAAA,OAAAA,EAAAA;AACV,EAAA,QAAA,OAAA,CAAA,IAAA;IACJ,KAAA,IAAA;AAED,MAAA,OAAK,QAAA,CAAA,OAAA,OAAA,CAAA,EAAA;IACJ,KAAA,MAAA;AAED,MAAA,OAAK,QAAA,CAAA,SAAA,OAAA,CAAA,IAAA;IACJ,KAAA,MAAA;AAED,MAAA,OAAK,QAAA,CAAW,SAAA,OAAA,CAAA,IAAA;AAGf,IAAA,KAAA,SAAA,EAAc;AACb,MAAA,IAAA,CAAA,OAAA,EAAO;AACR,QAAA,OAAA,KAAA;AACA,MAAA;AACA,MAAA,MAAKmO,KAAAA,GAAM,QAAA,QAAA,CAAA;AACV,MAAA,IAAA,CAAA,KAAA,EAAO;AACR,QAAA,OAAA,KAAA;AACA,MAAA;AACD,MAAA,OAAA,SAAA,CAAA,OAAA,CAAA,OAAA,EAAA,KAAA,CAAA;AACD,IAAA;AACD;AA5BgB2Z;AAKf,MAAA,CAAA,OAAA,EAAA,SAAA,CAAA;AAiCMjJ,OAAAA,CAAA,SAASkJ,SAAAA,CAAAA;AAKf,SAAO7B,sBAAAA,CAAkBC,QAAAA,EAAcyB,WAAAA,EAAY5L,OAAAA,EAAOgM;AAC3D,EAAA,OAAA,WAAA,CAAA,KAAA,CAAA,CAAA,KAAA,QAAA,QAAA,EAAA,CAAA,CAAA,KAAA,EAAA,OAAA,CAAA,CAAA;AANgBD;AAKR7B,MAAAA,CAAAA,sBAAAA,EAAAA,wBAAAA,CAAAA;AAWDrH,OAAAA,CAAA,wBAENqH,wBAC6D,CAAA;AAE7D,SAAO6B,UAAAA,CAAAA,QAAAA,EAAAA,WAAAA,EAAiC7B,OAAAA,EAAAA;AACzC,EAAA,OAAA,sBAAA,CAAA,QAAA,EAAA,WAAA,CAAA,WAAA,EAAA,OAAA,CAAA;AANgB+B;AAKRF,MAAAA,CAAAA,UAAAA,EAAAA,YAAAA,CAAAA;AAWDlJ,OAAAA,CAAA,YACN+I,YACA1B,CAAAA;AAGA,SAAO6B,QAAAA,CAAAA,QAAAA,EAAAA,WAAAA,EAAuBH,OAAAA,EAAU1B;AACzC,EAAA,OAAA,sBAAA,CAAA,QAAA,EAAA,WAAA,CAAA,MAAA,EAAA,OAAA,CAAA;AANgBgC;AAKRH,MAAAA,CAAAA,QAAAA,EAAAA,UAAAA,CAAAA;AAWDlJ,OAAAA,CAAA,UAASsJ,UACfP,CAAAA;AAIA,SAAOG,aAAAA,CAAAA,QAAAA,EAAuBH,WAAAA,EAAU1B,OAAAA,EAAYF;AACrD,EAAA,OAAA,sBAAA,CAAA,QAAA,EAAA,WAAA,CAAA,WAAA,EAAA,OAAA,CAAA;AANgBmC;AAKRJ,MAAAA,CAAAA,aAAAA,EAAAA,eAAAA,CAAAA;;AC/LD,IAAA,mBAAA,GAASK,IAAAA;AACf,SAAKC,kBAAgB1f,KAAAA,EAAQ;AAC5B,EAAA,IAAA,CAAA,MAAA,CAAO,QAAA,CAAA,KAAA,CAAA,EAAA;AACR,IAAA,OAAA,CAAA;AAEA,EAAA;AAEA,EAAA,MAAA,OAAA,GAAY2f,KAAMC,GAAAA,CAAAA,CAAAA,EAAUC,KAAAA,GAAAA,CAAAA,CAAAA,EAAAA,KAAAA,CAAAA,CAAAA;AAC7B,EAAA,OAAA,IAAA,CAAA,KAAA,CAAA,OAAA,GAAA,mBAAA,CAAA,GAAA,mBAAA;AARgBJ;AACVC,MAAAA,CAAAA,iBAAAA,EAAAA,mBAAAA,CAAAA;AAwFCxJ,OAAAA,CAAA,mBAA8D,mBAAA,CAAA;AAEpE,SAAM4J,UAAAA,CAAAA,GAAAA,CAAAA,EAAgBC;AACtB,EAAA,MAAMC,aAAAA,GAAgBD,eAAAA,CAAgB1N,CAAAA,CAAEyI,IAAI,CAAA;AAC5C,EAAA,MAAIgF,aAAAA,GAAkBE,eAAAA,CAAe,CAAA,CAAA,IAAA,CAAA;AACpC,EAAA,IAAA,kBAAOF,aAAAA,EAAgBE;AACxB,IAAA,OAAA,aAAA,GAAA,aAAA;AAGA,EAAA;AACA,EAAA,MAAMC,aAAAA,GAAgBC,eAAAA,CAAgB7N,CAAAA,CAAE8N,IAAI,CAAA,IAAK,EAAA;AACjD,EAAA,MAAIC,aAAAA,GAAkBH,eAAAA,CAAe,CAAA,CAAA,IAAA,CAAA,IAAA,EAAA;AACpC,EAAA,IAAA,kBAAOG,aAAAA,EAAgBH;AACxB,IAAA,OAAA,aAAA,GAAA,aAAA;AAGA,EAAA;AACD,EAAA,OAAA,CAAA,CAAA,EAAA,CAAA,aAAA,CAAA,CAAA,CAAA,EAAA,CAAA;AAjBgBI;AAETP,MAAAA,CAAAA,UAAAA,EAAAA,YAAAA,CAAAA;;;;EC5HG,OAAA,EAAA,GAAA;;EAEE,SAAA,EAAA,IAAA;;EAEE,WAAA,EAAA,GAAA;;EAGd,aAAA,EAAA;AAKA,CAAA;AAwBO,IAAA,mBAAA,GAAsB3E,CAAAA;AAE5B,SAAMmF,aAAAA,SAAAA,EAAoBnF;AAE1B,EAAA,MAAMnb,iBAAAA,GACLugB,UAAgBC,aAAAA,GAAUF,mBAAAA;AAM3B,EAAA,MAAA,KAAA,GAAOb,eAAAA,CAAkBzf,OAAAA,GAAAA,iBAAAA,GAAAA,gBAAAA,SAAAA,GAAAA,SAAAA,CAAAA,cAAAA,GAAAA,eAAAA,CAAAA,WAAAA,GAAAA,SAAAA,CAAAA,gBAAAA,GAAAA,eAAAA,CAAAA,gBAAAA,SAAAA,CAAAA,aAAAA;AAC1B,EAAA,OAAA,kBAAA,KAAA,CAAA;AAZgBygB;AAETH,MAAAA,CAAAA,YAAAA,EAAAA,cAAAA,CAAAA;AAsCApK,OAAAA,CAAA,cAASwK,cAA4C,CAAA;AAE3D,SAAMC,aAASzF,UAAAA,EAAgBC;AAC9BA,EAAAA,MAAAA,MAAAA,GAAAA,UAAAA,CAAAA,GAAAA,CAAAA,CAAAA,SAAAA,MAAAA;AACAnb,IAAAA,SAAAA;AACD,IAAA,KAAA,EAAA,aAAA,SAAA;AAGA2gB,GAAAA,CAAAA,CAAAA;AACC,EAAA,MAAA,CAAIvO,IAAAA,CAAEpS,CAAAA,CAAAA,EAAAA,CAAAA,KAAYA;AACjB,IAAA,IAAA,CAAA,CAAA,KAAA,KAASA,CAAAA,CAAAA,KAAAA,EAAUA;AACpB,MAAA,OAAA,CAAA,CAAA,QAAA,CAAA,CAAA,KAAA;AACA,IAAA;AACD,IAAA,OAAA,UAAA,CAAA,CAAA,CAAA,SAAA,EAAA,CAAA,CAAA,SAAA,CAAA;EAEA,CAAA,CAAA;AACD,EAAA,OAAA,MAAA;AAhBgB0gB;AAETC,MAAAA,CAAAA,YAAAA,EAAAA,cAAAA,CAAAA;AAiGAzK,OAAAA,CAAA,cAAS0K,cAAAA,CAAAA;AACf,SAAMhN,sBAAAA,GACW4M;AAKjB,EAAA,MAAI9Q,MAAKoE,eAAAA,CAAiB,OAAA,GAAO,gBAAA,SAAA,GAAA,eAAA,CAAA,cAAA,eAAA,CAAA,aAAA;AAChC,EAAA,IAAA,IAAA,CAAM,GAAA,CAAIjV,GAAAA,GAAM,CAAA,IAAA,IAAA,EAAA;AACjB,IAAA,MAAA,IAAA,KAAA,CAAA,CAAA,qCAAA,EAAA,GAAA,CAAA,CAAA,CAAA;AACD,EAAA;AAVgB+hB;AACThN,MAAAA,CAAAA,sBAAAA,EAAAA,wBAAAA,CAAAA;AAYPgN,OAAAA,CAAAA,wBAAAA,wBAAAA,CAAAA;;AC9HC,SAAMhG,iBAAeiG,QAAAA,EAAYjG,UAAAA,EAAK,SAAA,EAAA,MAAA,EAAA,YAAA,gBAAA,EAAA;AAGtC,EAAA,MAAMkG,KAAAA,GAAAA,MAAAA,CAAAA,IAAAA,CAAgBlG,MAAAA,CAAWE,KAAAA,CAAAA;AAChC,EAAA,MAAA,aAAA,GAAMiG,KAAAA,CAAe7E,GAAAA,CAASnI,CAAAA,IAAAA,KAAQL;AACtC,IAAA,MAAMsN,eAAarX,QAAAA,CAAOiR,MAAAA,CAAME,CAAAA,CAAAA,KAAAA,CAAAA,CAAAA,SAAAA,IAAAA,CAAAA;AAEhC,IAAA,MAAA,UAAA,GAAO,MAAA,CAAA,KAAA,CAAA,IAAA,CAAA;AACNA,IAAAA,OAAAA;AACAmG,MAAAA,IAAAA;AACAC,MAAAA,aAAAA,EAAYC,YAAAA,CAAUrG,MAAAA;MACtBsG,UAAAA,EAAWJ,SAAAA,CAAWhrB,IAAAA,CAAAA,IAAAA,CAAAA;AACtBqrB,MAAAA,SAAAA,EAAAA,UAAAA,CAAcN,GAAAA;AACb7sB,MAAAA,YAAAA,EAAMA,aAAAA,KAAAA,CAAAA,CAAAA,EAAAA,CAAAA,CAAAA,CAAAA,GAAAA,CAAAA,CAAAA,CAAAA,MAAAA;AACNisB,QAAAA,EAAAA,EAAAA,CAAAA,CAAMzM,EAAAA;AACN1T,QAAAA,IAAAA,EAAAA,CAAAA,CAAOygB,IAAAA;AACR,QAAA,KAAA,EAAA,aAAA,CAAA;OACD,CAAA;AACD,KAAA;EAGA,CAAA,CAAA;AACA,EAAA,MAAMa,SAAAA,GAAAA,MAAAA,CAAkBpF,MAAAA,CAAAA,SAASlJ,CAAAA,CAASuO,MAAAA,CAAAA,CAAAA,CAAAA,EAAWvO,CAAAA,KAAAA,CAAAA,GAAAA,CAAAA,EAAAA,CAAAA,CAAAA;AAGrD,EAAA,MAAMwO,eAAAA,GAAe,QAAA,CAAA,MAAA,GAAA,UAAA,CAAA,MAAA;AAAC,EAAA,MAAA,YAAA,GAAYtF;AAA6B,IAAA,CAAA,SAAA,EAASI,SAAAA,MAAa3S,CAAAA,UAAAA,CAAAA;;;AAGpF6X,EAAAA,IAAAA,UAAAA,CAAavM,SAASwG,CAAAA,EAAAA;AACvB,IAAA,YAAA,CAAA,IAAA,CAAA,CAAA,CAAA,EAAA,UAAA,CAAA,MAAA,CAAA,oBAAA,CAAA,CAAA;AAEA,EAAA;AAGA,EAAA,MAAMgG,OAAAA,GAAAA,YAAAA,CAAgBF,IAAAA,CAAW1R,GAAAA,CAAAA;AAChCoP,EAAAA,MAAAA,aAAAA,GAAYA,WAAAA,KAAAA,CAAAA,CAAAA,EAAAA,CAAAA,CAAAA,CAAAA,GAAAA,CAAAA,CAAAA,CAAAA,MAAAA;AACZ1lB,IAAAA,QAAAA,EAAUA,CAAAA,CAAAA,QAAAA;AACVmoB,IAAAA,MAAAA,EAAQ/D,CAAAA,CAAE+D,MAAAA;AACX,IAAA,MAAA,EAAA,CAAA,CAAA;AAEA,GAAA,CAAA,CAAA;AACCrJ,EAAAA,OAAAA;AACAyI,IAAAA,OAAAA;AACAW,IAAAA,aAAAA;AACAlE,IAAAA,aAAAA;IACCoE,WAAAA,EAAAA;AACAC,MAAAA,WAAAA,EAAAA,kBAAkBC,MAAAA,IAAkBxE,CAAAA;AACpCyE,MAAAA,gBAAAA,EACCD,kBAAkBE,WAAAA,IAAYR,CAAAA;MAChC,aAAA,EAAA,gBAAA,EAAA,YAAA,UAAA,CAAA,MAAA,CAAA,CAAA,CAAA,KAAA,CAAA,CAAA,MAAA,KAAA,oBAAA,CAAA,CAAA;AACAS,KAAAA;AACCC,IAAAA,WAAAA,EAAAA;MACAhB,cAAAA,EAAe/E,eAAAA;AACfnO,MAAAA,aAAAA,EAAAA,QAAAA,CAAkBuT,MAAAA;MAClBY,gBAAAA,EAAU,eAAA,GAAA,IAAA,IAAA,CAAA,KAAA,CAAA,SAAA,MAAA,GAAA,eAAA,GAAA,GAAA,CAAA,GAAA,GAAA,GAAA,CAAA;MACX,QAAA,EAAA;AACD;AACD,GAAA;AArEgBC;AAYTvH,MAAAA,CAAAA,gBAAAA,EAAAA,kBAAAA,CAAAA;AAiMA1E,OAAAA,CAAA,kBAAsBkM,kBAA4C,CAAA;AACxE,SAAO,YAAA,CAAA,KAAA,QAAA,EAAA;AACHA,EAAAA,OAAAA;IACHJ,GAAAA,GAAAA;IACC,WAAA,EAAOA;AACPE,MAAAA,GAAAA,GAAAA,CAAAA,WAAAA;AACD,MAAA;AACD;AACD,GAAA;AARgBG;AACR,MAAA,CAAA,YAAA,EAAA,cAAA,CAAA;ACnODnM,OAAAA,CAAA,cAASoM,cAAAA,CAAAA;AAEf,SAAOpF,uBAAAA,GACLJ;AAIH,EAAA,OAAA,UAAA,CAAA,QAAA,CAAA,CAAA,MAAA,CAAAyF,YAAA,CAAA,CAAA,MAAA,CAAA,IAAA,CAAA,GAAA,EAAA,CAAA,UAAA,CAAA,CAAA,OAAA,IAAA,CAAA,MAAA,GAAA,QAAA,EAAA,CAAA,CAAA,MAAA,CAAA,WAAA,CAAA;AAPgBD;AAERpF,MAAAA,CAAAA,uBAAAA,EAAAA,yBAAAA,CAAAA;AA+EDhH,OAAAA,CAAA,yBAAgD,yBAAA,CAAA;AAEtD,SAAM2G,WAAAA,GAAAA,EAAa9d;AACnB,EAAA,MAAA,UAAA,GAAkB,KAAA,SAAA,CAAU+d,GAAAA,EAAOD,OAAAA,IAAAA,CAAYE,GAAO,CAAA,CAAA,IAAA,EAAA,CAAA;AACvD,EAAA,OAAA,UAAA,CAAA,QAAA,CAAA,CAAA,MAAA,CAAA,UAAA,CAAA,CAAA,MAAA,CAAA,WAAA,CAAA,CAAA,KAAA,CAAA,CAAA,EAAA,EAAA,CAAA;AAJgByF;AAET3F,MAAAA,CAAAA,UAAAA,EAAAA,YAAAA,CAAAA;;ICzGN9C,iBAAAA,GAAY;EACZC,UAAAA,EAAU,OAAA;EACVC,QAAAA,EAAAA,OAAAA;EACAC,UAAAA,EAAAA,iBAAAA;EACAC,WAAAA,EAAAA,iBAAAA;EACAC,cAAAA,EAAAA,iBAAAA;EACAC,gBAAAA,EAAc,kBAAA;EACdC,YAAAA,EAAAA,iBAAAA;EACAC,cAAAA,EAAAA,iBAAAA;EACAhD,eAAAA,EAAW,cAAA;EACXiD,SAAAA,EAAU,cAAA;EACX,QAAA,EAAA;AAKO,CAAA;AAWA,IAAA,eAAA,GAASiI,EAAAA;AAKf,SAAMtH,cAAAA,CAAYD,GAAAA,EAAAA,UAAAA,EAAiBsC,WAAAA,GAAekF,mBAAAA,EAAM;AACxD,EAAA,MAAKvH,SAAAA,GAAW,WAAA,IAAA,CAAA,CAAA,MAAA,CAAA,CAAA,EAAA,KAAA,IAAA,EAAA,CAAA;AACf,EAAA,IAAA,CAAA,SAAA,EAAUtc;AACX,IAAA,MAAA,IAAA,KAAA,CAAA,CAAA,qBAAA,EAAA,GAAA,CAAA,EAAA,CAAA,CAAA,CAAA;AAEA,EAAA;AACA,EAAA,MAAM8jB,OAAAA,GAAAA,UAAkBC,UAAAA,EAAYliB;AAEpC,EAAA,MAAA,eAAA,GAAO,YAAA,OAAA,CAAA;AACNxM,EAAAA,OAAIwuB;AACJvC,IAAAA,EAAAA,EAAAA,GAAAA,CAAMuC,EAAAA;AACN5H,IAAAA,IAAAA,EAAM4H,GAAAA,CAAI5H,IAAAA;AACVpa,IAAAA,IAAAA,EAAAA,GAAAA,CAAAA,IAAAA;AACAiiB,IAAAA,OAAAA;AACAE,IAAAA,eAAAA;IACD,MAAA,EAAA;AACD,GAAA;AArBgBJ;AAKTtH,MAAAA,CAAAA,cAAAA,EAAAA,gBAAAA,CAAAA;AA0BAjF,OAAAA,CAAA,gBAAS4M,gBAEf5H,CAAAA;AAGA,SAAO6H,eAAAA,CAAUL,IAAAA,EAAQD,UAAAA,EAAeC,WAAAA,GAAKxH,mBAAAA,EAAY0H;AAC1D,EAAA,OAAA,IAAA,CAAA,IAAA,CAAA,GAAA,KAAA,eAAA,GAAA,EAAA,UAAA,EAAA,WAAA,CAAA,CAAA;AANgBE;AAKRC,MAAAA,CAAAA,eAAAA,EAAAA,iBAAAA,CAAAA;AASD7M,OAAAA,CAAA,iBAAwB8M,iBAA4B,CAAA;AAC1D,SAAOA,eAASC,QAAAA,EAAatF;AAC9B,EAAA,OAAA,QAAA,CAAA,OAAA,CAAA,GAAA,EAAA,MAAA,GAAA,GAAA,CAAA,CAAA,iBAAA,CAAA,CAAA;AAFgBuF;AACRF,MAAAA,CAAAA,cAAAA,EAAAA,gBAAAA,CAAAA;AAgBD9M,OAAAA,CAAA,gBACN8M,gBACAG,CAAAA;AAGA,SAAMC,WAAAA,CAAUF,QAAAA,EAAAA,YAAAA,EAAeF,WAAAA,GAAAA,mBAAAA,EAAAA;AAE/B,EAAA,MAAII,OAAAA,GAAWD,eAAc,QAAA,CAAA;AAC5B,EAAA,IAAA,WAAOH,YAAAA,EAAAA;AACR,IAAA,OAAA,QAAA;AAGA,EAAA;AAAoBA,EAAAA,MAAAA,OAAAA,GAAAA;AAAUrK,IAAAA,GAAAA;IAC7B,IAAA,CAAA,CAAM0K,GAAAA,CAAAA,KAAAA;AACN,IAAA,MAAMC,MAAAA,GAASC,iBAAAA,CAAkBlR,CAAAA,CAAE8N,IAAI,CAAA;AAGvC,IAAA,MAAIkD,MAAAA,GAAW,iBAAA,CAAWC,CAAAA,CAAAA,IAAW,CAAA;AACpC,IAAA,IAAA,MAAA,KAAO,OAAA,IAAA,MAAA,KAAA,OAAA,EAAA;AACR,MAAA,OAAA,CAAA;AACA,IAAA;AACC,IAAA,IAAA,MAAA,KAAO,OAAA,IAAA,MAAA,KAAA,OAAA,EAAA;AACR,MAAA,OAAA,EAAA;AAGA,IAAA;AACD,IAAA,OAAA,gBAAA,CAAA,CAAA,IAAA,CAAA,GAAA,eAAA,CAAA,EAAA,IAAA,CAAA;EAEA,CAAA,CAAA;AACA,EAAA,MAAME,SAAAA,EAAAA;AACN,EAAA,MAAIX,WAAS,OAAA,GAAA,YAAA;AAEb,EAAA,IAAA,MAAA,GAAW5D,CAAAA;AAEV,EAAA,KAAA,MAAI4D,YAAUW,OAAAA,EAAYD;AACzBvM,IAAAA,IAAAA,UAAYiI,QAAAA,IAAAA,iBAAAA,CAAAA,QAAAA,CAAAA,IAAAA,MAAAA,OAAAA,EAAAA;AACZ,MAAA,MAAA,CAAA,KAAA,QAAA,CAAA;AACD,MAAA;AAGA,IAAA;AACA,IAAA,MAAMwE,iBAAiBztB,QAAAA,GAAIipB,MAAAA;AAG3B,IAAA,MAAIA,YAAS0D,IAAAA,CAAAA,GAAAA,CAAAA,QAAAA,CAAmBc,eAAAA,GAAW,gBAAA,eAAA,CAAA;AAC1CzM,IAAAA,IAAAA,QAAAA,CAAO/B,mBAAKgK,SAAAA,EAAAA;AACZ,MAAA,MAAA,CAAA,KAAA,QAAA,CAAA;AACD,MAAA;AAGA,IAAA;AACA,IAAA,MAAMyE,cAAAA,GAAiBf,mBAAAA,CAAkBgB,QAAAA,EAAAA,SAAAA,EAAehB,WAAAA,CAAAA;AACxDE,IAAAA,MAAAA,KAAAA,GAAUa,QAAAA,CAAAA,eAAAA,GAAAA,cAAAA,CAAAA,eAAAA;AACV1M,IAAAA,MAAAA,IAAO/B,KAAAA;AACR,IAAA,MAAA,CAAA,KAAA,cAAA,CAAA;AAEA,EAAA;AACD,EAAA,OAAA,MAAA;AAzDgB2O;AAKTR,MAAAA,CAAAA,WAAAA,EAAAA,aAAAA,CAAAA;AA8DAlN,OAAAA,CAAA,aAAS2N,aACf5E,CAAAA;AAIA,SAAM6E,mBAAAA,CAAWP,QAAAA,EAAkBtE,YAAAA,EAAa,WAAA,GAAA,mBAAA,EAAA;AAEhD,EAAA,MAAA,QAAA,GAAQ6E,iBAAAA,CAAAA,QAAAA,CAAAA,IAAAA,CAAAA;UACF,QAAA;IACJ,KAAA,iBAAA;AACD,MAAA,OAAK,cAAA,CAAA,QAAA,EAAA,YAAA,EAAA,WAAA,CAAA;IACJ,KAAA,iBAAA;AACD,MAAA,OAAK,cAAA,CAAA,QAAA,EAAA,YAAA,EAAA,WAAA,CAAA;IACJ,KAAA,kBAAA;AACD,MAAA,OAAK,eAAA,CAAA,QAAA,EAAA,YAAA,EAAA,WAAA,CAAA;IACJ,KAAA,cAAA;AACD,MAAA,OAAA,WAAA,CAAA,QAAA,EAAA,YAAA,EAAA,WAAA,CAAA;AACC,IAAA;AACF,MAAA,OAAA,QAAA;AACD;AAnBgBD;AAKTC,MAAAA,CAAAA,mBAAAA,EAAAA,qBAAAA,CAAAA;AA0BA5N,OAAAA,CAAA,qBACN+I,qBAEA2D,CAAAA;AAEA,SAAMmB,cAAAA,CAAQ9E,QAAAA,EAAiB+E,YAAAA,EAAM,WAAA,GAAA,mBAAA,EAAA;AACrC,EAAA,MAAIC,KAAAA,GAAAA,QAAAA,CAAa,OAAA,CAAA,KAAA,CAAA,IAAA,CAAA;AAGjB,EAAA,IAAA,UAAA,GAAOA,CAAAA;AACN,EAAA,OAAA,UAAA,GAAkBF,KAAAA,CAAMlU,MAAAA,GAAMoU,CAAAA,EAAAA;AAC9B,IAAA,MAAM1H,YAASqG,KAAAA,CAAAA,KAAAA,CAAYsB,UAAAA,CAAAA,CAAAA,KAAAA,IAAAA,CAAAA;AAE3B,IAAA,MAAI3H,MAAAA,GAAU4G,YAAAA,SAAc,CAAA;AAC3B,IAAA,IAAA,UAAA,YAAA,EAAA;AACD,MAAA;AAEAc,IAAAA;AACD,IAAA,UAAA,EAAA;AAEA,EAAA;AACA,EAAA,MAAMtB,UAAAA,GAAAA,CAAAA,UAAAA,GAAkBC,CAAAA,GAAYuB,mBAAAA,GAAAA,EAAAA,IAAAA,MAAAA,KAAAA,CAAAA,UAAAA,CAAAA,CAAAA,IAAAA,CAAAA,IAAAA,CAAAA;AAEpC,EAAA,MAAA,eAAA,GAAO,YAAA,UAAA,CAAA;AACHlF,EAAAA,OAAAA;IACHve,GAAAA,QAAAA;IACAiiB,OAAAA,EAAAA,UAAAA;AACAE,IAAAA,eAAAA;IACAuB,MAAAA,EAAAA,IAAAA;AACAC,IAAAA,kBAAAA,EAAgB,QAAA,CAAA,eAAA;IACjB,cAAA,EAAA;AACD,GAAA;AA/BgBC;AAKTP,MAAAA,CAAAA,cAAAA,EAAAA,gBAAAA,CAAAA;AAqCA7N,OAAAA,CAAA,gBAASqO,gBAEfpB,CAAAA;AAGA,SAAMY,cAAAA,CAAQ9E,QAAAA,EAAiB+E,YAAAA,EAAM,WAAA,GAAA,mBAAA,EAAA;AACrC,EAAA,MAAMQ,KAAAA,GAAAA,QAAAA,CAAuB,OAAA,CAAA,KAAA,CAAA,IAAA,CAAA;AAC7B,EAAA,MAAIC,aAAS,EAAA;AACb,EAAA,IAAIC,MAAAA,GAAAA,KAAAA;AAEJ,EAAA,IAAA,UAAA,GAAWptB,CAAAA;AACV,EAAA,KAAA,MAAMqtB,QAAUrtB,KAAAA,EAAKxB;AAGrB,IAAA,MAAM8uB,OAAAA,GAAAA,KAActtB,IAAAA,EAAK+b;AACzB,IAAA,MAAMwR,cAAAA,IAAAA,CAAevtB,KAAAA,CAAK+b,IAAM,CAAA,IAAA,EAAA,EAAS,MAAA;AAEzC,IAAA,MAAKoR,eAAQ,IAAA,CAAA,KAAA,CAAA,IAAA,CAAA,IAAA,EAAA,EAAA,MAAA;AAEZ,IAAA,IAAA,CAAA,MAAA,EACCE;AAKAH,MAAAA,IAAAA,OAAAA,CAAAA,KAAAA,CAAgBltB,wCAAAA,CAAAA,IAAAA,QAAAA,KAAAA,CAAAA,gDAAAA,CAAAA,IAAAA,OAAAA,CAAAA,MAAAA,yBAAAA,CAAAA,IAAAA,OAAAA,CAAAA,KAAAA,CAAAA,gDAAAA,CAAAA,EAAAA;AAChB,QAAA,UAAA,CAAIstB,KAAAA,IAAaC,CAAAA;AAChBJ,QAAAA,IAAAA,aAAS,WAAA,EAAA;AACTC,UAAAA,MAAAA,GAAAA,IAAAA;AACAF,UAAAA,UAAAA,GAAWvP,UAAAA,GAAK,WAAA;AACjB,UAAA,UAAA,CAAA,KAAA,uBAAA,CAAA;AACD,QAAA;AAEC,MAAA,CAAA,MAAA,IAAI0P,CAAAA,OAAAA,CAAY,UAAA,CAAOA,IAAQG,KAAAA,CAAAA,OAAAA,CAAW,UAAA,CAAcH,IAAAA,CAAAA,IAAQG,CAAAA,OAAAA,CAAW,UAAA,CAAY,GAAA,CAAA,EAAA;AACtFN,QAAAA,IAAAA,OAAAA,KAAWvP,EAAAA,IAAK3d,CAAAA,OAAAA,CAAAA,UAAAA,CAAAA,QAAAA,CAAAA,IAAAA,CAAAA,OAAAA,CAAAA,UAAAA,CAAAA,SAAAA,CAAAA,EAAAA;AACjB,UAAA,UAAA,CAAA,KAAA,IAAA,CAAA;AACD,QAAA;AACD,MAAA;IAECotB,CAAAA,MAAAA;AACA,MAAA,UAAA,IAAIA,UAAAA,GAAiB,WAAA;AACpBD,MAAAA,IAAAA,cAAS,CAAA,EAAA;AACTC,QAAAA,MAAAA,GAAAA,KAAAA;AACAF,QAAAA,UAAAA,GAAWvP,CAAAA;AACZ,QAAA,UAAA,CAAA,KAAA,IAAA,CAAA;AACD,MAAA;AAGA,IAAA;AACA,IAAA,MAAI2N,OAAAA,GAAYQ,UAAAA,CAAAA,IAAAA,CAAYD,IAAAA,CAAAA;AAC3B,IAAA,IAAA,WAAA,CAAA,OAAA,CAAA,IAAA,YAAA,EAAA;AACD,MAAA;AACD,IAAA;AAEA,EAAA;AACA,EAAA,MAAMR,UAAAA,GAAAA,UAAAA,CAAkBC,IAAAA,CAAAA,IAAYuB,CAAAA;AAEpC,EAAA,MAAA,eAAA,GAAO,YAAA,UAAA,CAAA;AACHlF,EAAAA,OAAAA;IACHve,GAAAA,QAAAA;IACAiiB,OAAAA,EAAAA,UAAAA;AACAE,IAAAA,eAAAA;IACAuB,MAAAA,EAAAA,IAAAA;AACAC,IAAAA,kBAAAA,EAAgB,QAAA,CAAA,eAAA;IACjB,cAAA,EAAA;AACD,GAAA;AAjEgBE;AAKTR,MAAAA,CAAAA,cAAAA,EAAAA,gBAAAA,CAAAA;AAuEA7N,OAAAA,CAAA,gBAAS6O,gBAEf5B,CAAAA;AAGA,SAAMY,eAAAA,CAAiBrjB,QAAAA,EAAQsjB,YAAAA,EAAM,WAAA,GAAA,mBAAA,EAAA;AAGrC,EAAA,MAAM3L,KAAAA,GAAAA,QAAAA,CAAoB,OAAA,CAAA,KAAA,CAAA,IAAA,CAAA;AAC1B,EAAA,MAAI2M,UAAY,EAAA;AAEhB,EAAA,IAAA,SAAA,GAAW1tB,CAAAA;AACV,EAAA,KAAA,MAAMqtB,QAAUrtB,KAAAA,EAAKxB;AAGrB,IAAA,MACC6uB,OAAAA,GAAQG,KAAAA,IAAAA,EAAW;AAMnBzM,IAAAA,IAAAA,QAAQpD,UAAAA,CAAK3d,GAAAA,KAAAA,OAAAA,CAAAA,UAAAA,CAAAA,IAAAA,CAAAA,IAAAA,OAAAA,CAAAA,WAAAA,IAAAA,CAAAA,IAAAA,QAAAA,UAAAA,CAAAA,IAAAA,KAAAA,OAAAA,CAAAA,KAAAA,CAAAA,QAAAA,CAAAA,EAAAA;AACb0tB,MAAAA,OAAAA,CAAAA,KAAAA,IAAAA,CAAAA;AACD,MAAA,SAAA,EAAA;AAGA,IAAA;AACA,IAAA,MAAIpC,OAAAA,GAAYQ,OAAAA,CAAAA,IAAAA,CAAYD,IAAAA,CAAAA;AAE3B,IAAA,IAAA,WAAA,CAAA,OAAA,CAAA,IAAA,YAAA,GAAA,EAAA,EAAA;AACD,MAAA;AACD,IAAA;AAEA,EAAA;AAEA,EAAA,MAAM8B,aAAAA,KAAAA,CAAcD,MAAAA,CAAYE,CAAAA,CAAAA,KAAAA,EAAAA,IAAAA,EAAa,CAAA,UAAA,CAAA,IAAA,KAAA,CAAA,CAAA,IAAA,GAAA,UAAA,CAAA,IAAA,CAAA,CAAA,CAAA,MAAA;AAAaA,EAAAA,MAAAA,WAAAA,GAAAA,YAAaF,UAAAA,GAAAA;AAEjEb,QAAAA,EAAAA,UAAAA,GAAa9L,SAAQ8E,CAAAA,uBAAAA,CAAAA,GAAa8H,EAAAA;AACxC,EAAA,MAAMtC,UAAAA,GAAAA,OAAAA,CAAkBC,IAAAA,CAAAA,IAAYuB,CAAAA,GAAAA,WAAAA;AAEpC,EAAA,MAAA,eAAA,GAAO,YAAA,UAAA,CAAA;AACHlF,EAAAA,OAAAA;IACHve,GAAAA,QAAAA;IACAiiB,OAAAA,EAAAA,UAAAA;AACAE,IAAAA,eAAAA;IACAuB,MAAAA,EAAAA,IAAAA;AACAC,IAAAA,kBAAAA,EAAgB,QAAA,CAAA,eAAA;IACjB,cAAA,EAAA;AACD,GAAA;AAjDgBU;AAKThB,MAAAA,CAAAA,eAAAA,EAAAA,iBAAAA,CAAAA;AAuDA7N,OAAAA,CAAA,iBACN+I,iBACAkE,CAAAA;AAGA,SAAMY,WAAAA,CAAQ9E,QAAAA,EAASve,YAAAA,EAAc,WAAA,GAAA,mBAAA,EAAA;AAGrC,EAAA,MAAMyR,KAAAA,GAAAA,QAAAA,CAAsB,OAAA,CAAA,KAAA,CAAA,IAAA,CAAA;AAC5B,EAAA,MAAIgT,UAAAA,EAAAA;AAEJ,EAAA,IAAA,eAAmBpB,EAAAA;AAClB,EAAA,KAAA,MAASjuB,QAAI,KAAA,EAAO;AACnBqc,IAAAA,IAAAA,KAAAA,IAAAA,EAAQ8C,KAAKkQ,EAAAA,IAAAA,YAAAA,CAAAA,SAAAA,CAAAA,EAAAA;AACbA,MAAAA,OAAAA,CAAAA,KAAAA,YAAe,CAAA;AAChB,MAAA,YAAA,GAAO,EAAA;IACNA,CAAAA,MAAAA;AACD,MAAA,YAAA,CAAA,KAAA,IAAA,CAAA;AACD,IAAA;AACA,EAAA;AACChT,EAAAA,IAAAA,YAAAA,CAAagT,SAAAA,CAAAA,EAAAA;AACd,IAAA,OAAA,CAAA,KAAA,YAAA,CAAA;AAGA,EAAA;AACA,EAAA,MAAIxK,OAAAA,EAAAA;AAEJ,EAAA,IAAA,WAAA,GAAaxI,CAAAA;AACZ,EAAA,KAAA,IAAM6L,IAAAA,OAAAA,CAAQ7L,MAAAA,GAAQiT,CAAAA,EAAAA,CAAAA,IAAAA,GAAAA,CAAAA,EAAAA,EAAAA;AACtB,IAAA,MAAMC,KAAAA,GAAAA,QAAerH,CAAAA,CAAAA;AACrB,IAAA,MAAMsH,YAAAA,GAAc1C,KAAAA,CAAAA,IAAAA,CAAYyC,IAAAA,CAAAA;AAEhC,IAAA,MAAI1K,WAAAA,GAAc2K,YAAAA,YAAenC,CAAAA;AAEhCoC,IAAAA,IAAAA,WAAAA,GAAavH,WAAAA,IAAAA,YAAAA,GAAAA,EAAAA,EAAAA;AACbrD,MAAAA,IAAAA,CAAAA,QAAAA,KAAe2K,CAAAA;AAChB,MAAA,WAAA,IAAgBtS,WAAAA;IAEfuS,CAAAA,MAAAA,IAAKC,IAAAA,CAAQxH,WAAAA,CAAAA,EAAAA;AACb,MAAA,IAAA,CAAA,QAAA,KAAA,CAAA;AACD,MAAA;IACC,CAAA,MAAA;AACD,MAAA;AACD,IAAA;AAEA,EAAA;AACA,EAAA,MAAMyH,YAAAA,GAAcC,OAAAA,CAAAA,MAAAA,GAAe,IAAA,CAAI,MAAA;;;AAEvC,CAAA,GAAA,EAAA;AACA,EAAA,MAAM/C,UAAAA,GAAAA,WAAAA,GAAkBC,IAAAA,CAAYuB,GAAAA,CAAAA,CAAAA,CAAAA,KAAAA,CAAAA,CAAAA,IAAAA,CAAAA,IAAAA,CAAAA,CAAAA,CAAAA,IAAAA,CAAAA,MAAAA,CAAAA;AAEpC,EAAA,MAAA,eAAA,GAAO,YAAA,UAAA,CAAA;AACHlF,EAAAA,OAAAA;IACHve,GAAAA,QAAAA;IACAiiB,OAAAA,EAAAA,UAAAA;AACAE,IAAAA,eAAAA;IACAuB,MAAAA,EAAAA,IAAAA;AACAC,IAAAA,kBAAAA,EAAgB,QAAA,CAAA,eAAA;IACjB,cAAA,EAAA;AACD,GAAA;AA3DgBsB;AAKT5B,MAAAA,CAAAA,WAAAA,EAAAA,aAAAA,CAAAA;;AC1TN,SAAMjrB,aAAAA,GAAiBE;AACvB,EAAA,MAAM2W,SAAAA,GAASD,IAAAA,CAAKC,GAAAA,EAAAA,CAASC,SAAS,EAAA,CAAA;AACtC,EAAA,MAAA,MAAA,GAAc9W,KAAAA,MAAAA,EAAa6W,CAAAA,SAAAA,EAAAA,CAAAA,CAAAA,KAAAA,CAAAA,CAAAA,EAAAA,EAAAA,CAAAA;AAC5B,EAAA,OAAA,CAAA,IAAA,EAAA,SAAA,CAAA,CAAA,EAAA,MAAA,CAAA,CAAA;AAJgBiW;AACT9sB,MAAAA,CAAAA,aAAAA,EAAAA,eAAAA,CAAAA;AAWAod,OAAAA,CAAA,eAAS2P,eAuBf,CAAA;AACA,SAAM,gBAAUhqB,MAAAA,EAAS0hB;AAEzB,EAAA,MAAA,EAAO,QAAA,OAAA,EAAA,WAAA,EAAA,YAAA,YAAA,EAAA,QAAA,EAAA,WAAA,GAAA,MAAA;AACNrpB,EAAAA,OAAI0xB;AACJ9sB,IAAAA,EAAAA,EAAAA,aAAAA,EAAgBE;AAChB4lB,IAAAA,SAAAA,EAAAA,KAAAA,GAAAA,EAAiBnC;IAEjB4B,eAAAA,EAAAA,gBAAAA;AACAC,IAAAA,oBAAAA,EAAsBplB,OAAAA,CAAAA,oBAAAA;AACtBqlB,IAAAA,YAAAA,EAAW1iB,OAAAA,CAAQ0iB,KAAAA;AAEnB0D,IAAAA,SAAAA,EAAAA,QAAgB/G,SAAAA,IAAWlI,MAAAA;AAC3BwL,IAAAA,cAAAA,EAAAA,UAAAA,CAAiBxB,MAAAA;AACjB2B,IAAAA,eAAAA,EAAAA,uBAA8BpB,UAAAA,CAAAA;AAC9BmB,IAAAA,iBAAAA,EAAAA,WAAoB8D,WAAWsD,CAAAA;AAE/BC,IAAAA,kBAAAA,EAAmB/O,WAAOkF,YAAAA,CAAAA;AAC1B8J,IAAAA,iBAAAA,EAAkBhP,MAAAA,CAAOwE,QAAAA;AACzByK,IAAAA,gBAAAA,EAAiBjP,MAAAA,CAAOkP,UAAAA;AAExBC,IAAAA,eAAAA,EAAAA,MAAAA,CAAAA,YAAAA;AAEAC,IAAAA,QAAAA;AACAlE,IAAAA,QAAAA,EAAUlL,MAAAA,CAAOkL,QAAAA;AAEjBmE,IAAAA,QAAAA,EAAAA,MAAAA,CAAiBrtB,QAAAA;IAClB,UAAA,EAAA,IAAA,CAAA,KAAA,GAAA;AACD,GAAA;AAnDgB6sB;AAwBT,MAAA,CAAA,eAAA,EAAA,iBAAA,CAAA;;ACvCN,SAAO,MAAA,SAAA,EAAA;AACN3xB,EAAAA,OAAIinB;AACJgF,IAAAA,EAAAA,EAAAA,SAAAA,CAAMhF,EAAAA;AACNL,IAAAA,IAAAA,EAAMK,SAAAA,CAAUL,IAAAA;AAChBuB,IAAAA,IAAAA,EAAAA,SAAAA,CAAelB,IAAAA;AAChB,IAAA,aAAA,EAAA,SAAA,CAAA;AACD,GAAA;AAPgBmL;AACR,MAAA,CAAA,KAAA,EAAA,OAAA,CAAA;AA4BDpQ,OAAAA,CAAA,OAASqQ,OAAAA,CAAAA;AAQf,SAAMC,eAAAA,CAAAA,UAAAA,EAAAA,MAAAA,EAAkBC,WAAAA,EAAAA,SAAAA,OAAAA,EAAAA;AACxB,EAAA,MAAMvK,WAAAA,uBAAgC,GAAA,EAAA;AACtC,EAAA,MAAMqF,WAAAA,EAAAA;AAKN,EAAA,MAAMmF,aAAAA,EAAAA;AACL,EAAA,MAAA,YAAA,GAAkBpH,UAAAA,CAAW9B,MAAAA,CAAGD,CAAAA,CAAAA,KAAAA;AAChC,IAAA,MAAIoJ,SAAAA,GAAW,UAAA,CAAA,CAAA,EAAA,WAAA,EAAA,OAAA,CAAA;AACdpF,IAAAA,IAAAA,SAAAA,EAAWtM;AACVgK,MAAAA,UAAAA,CAAAA,IAAAA,CAAUqH;AACV/sB,QAAAA,QAAAA,EAAQ,MAAA,CAAA,CAAA;QACRmoB,MAAAA,EAAQiF,oBAAAA;AACT,QAAA,MAAA,EAAA,SAAA,CAAA;OACA,CAAA;AACD,MAAA,OAAA,KAAA;AACA,IAAA;AACD,IAAA,OAAA,IAAA;EAKA,CAAA,CAAA;AACC,EAAA,KAAA,MAAMC,aAAgBrH,YAAAA,EAASpE;AAC/B,IAAA,MAAIyL,aAAAA,GAAkBJ,QAAAA,CAAAA,SAAAA,EAAgBrL,WAAAA,EAAe,OAAA,CAAA;AACpDqL,IAAAA,IAAAA,iBAAgBrL,CAAAA,WAAAA,CAAY,GAAA,CAAA,SAAA,CAAA,EAAA,CAAA,EAAA;AAC5Be,MAAAA,WAAAA,CAASjH,GAAAA,CAAKkG,UAAAA,EAAAA,CAAAA;AACf,MAAA,QAAA,CAAA,KAAA,SAAA,CAAA;AACD,IAAA;AAKA,EAAA;AACC,EAAA,KAAA,MAAIqL,aAAgBrL,YAAAA,EAAe;AAClC,IAAA,IAAA,WAAA,CAAA,GAAA,CAAA,SAAA,CAAA,EAAA,CAAA,EAAA;AACD,MAAA;AAEA,IAAA;AACA,IAAA,MAAI0L,qBAAAA,GAAuB,aAAA,CAAA,SAAA,EAAA,WAAA,EAAA,OAAA,CAAA;AAC1BL,IAAAA,IAAAA,qBAAAA,EAAgBrL;AAChBe,MAAAA,WAAAA,CAASjH,GAAAA,CAAKkG,UAAAA,EAAAA,CAAAA;AACf,MAAA,QAAA,CAAA,KAAA,SAAA,CAAA;AACD,IAAA;AAKA,EAAA;AAKA,EAAA,MAAM2L,QAAAA,GAAAA,YAAAA,CAAoBvL,MAAAA,CAAAA,CAAAA,CAAAA,KAAAA,CAAmBwL,WAAAA,CAAUpd,GAAAA,CAAAA,CAAAA,CAAAA,EAAAA,CAAAA,CAAAA;AAGvD,EAAA,MAAMgX,iBAAAA,GAASD,kBAAAA,CAAaqG,QAAAA,EAAAA,MAAAA,CAAAA;AAK5B,EAAA,MAAMC,MAAAA,GAAAA,aAAehL,QAAAA,CAAAA;AAOrB,EAAA,MAAA,YAAA,GAAgBgL,kBAAAA,CAAuB,MAAA,CAAA,GAAA,CAAA,CAAA,MAAA,CAAA,CAAA,SAAA,CAAA,EAAA,QAAA,EAAA,MAAA,CAAA;AACtC,EAAA,KAAA,MAAKR,CAAAA,IAAAA,aAAoB,QAAA,EAAG;AAC3BA,IAAAA,IAAAA,CAAAA,WAAAA,CAAYS,GAAAA,CAAM/yB,CAAAA,CAAE,EAAA,CAAA,EAAA;AACpBgoB,MAAAA,WAAAA,CAASjH,GAAAA,CAAKvB,EAAAA,EAAAA,CAAAA;AACf,MAAA,QAAA,CAAA,KAAA,CAAA,CAAA;AACD,IAAA;AAGA,EAAA;AACC6N,EAAAA,KAAAA,MAAAA,CAAAA,IAAWtM,aAAK,QAAA,EAAA;eACfgK,IAAAA,CAAUqH;MACV/sB,QAAAA,EAAUA,KAAAA,CAAAA,EAAAA,SAAAA,CAAAA;AACVmoB,MAAAA,MAAAA,EAAQ/D,CAAAA,CAAEpkB,MAAAA;AACX,MAAA,MAAA,EAAA,EAAA,MAAA,KAAA,kBAAA,GAAA,GAAA,CAAA,CAAA,SAAA,CAAA,IAAA,CAAA,YAAA,CAAA,GAAA;KACD,CAAA;AAKA,EAAA;AAKA,EAAA,MAAA,QAAA,GAAO,wBAAA,CAAA,UAAA,EAAA,MAAA,EAAA,aAAA,OAAA,CAAA;AACN2iB,EAAAA,OAAAA;IACAV,QAAAA,EAAAA,QAAAA,CAAYwL,IAAAA,KAAa5K,CAAAA;AACzBmF,IAAAA,UAAAA,EAAAA,YAAAA,CAAAA,KAAAA;AACA6E,IAAAA,UAAAA;AACAlE,IAAAA,QAAAA;IACA4E,QAAAA,EAAAA,KAAAA;AACA9D,IAAAA,iBAAAA;AACD,IAAA,QAAA,EAAA;AACD,GAAA;AA9GgBuD;AAQTC,MAAAA,CAAAA,eAAAA,EAAAA,iBAAAA,CAAAA;AAkHPtQ,OAAAA,CAAA,iBAASgR,iBACRhM,CAAAA;AAMA,SAAMiM,wBAAAA,CAAa,UAAA,EAAA,MAAA,EAAA,WAAA,EAAA,OAAA,EAAA;QAClBtsB,UAAAA,GAAQwjB;IACRxjB,OAAAA,CAAQyjB,oBAAAA;IACRzjB,OAAAA,CAAQ0jB,YAAAA;IACR1jB,OAAAA,CAAQ4jB,SAAAA;IACR9U,OAAAA,CAAOgR,WAAAA;AACPO,IAAAA,MAAAA,CAAAA,YAAkBtL,QAAAA,EAAQ;;;;;IAK1B2N,WAAAA,CAAYD,WAAAA,CAAYtK,OAAOpD,QAAAA,EAAAA;IAC/B2N,WAAAA,CAAYE,WAAAA,CAAOzK,OAAOpD,QAAAA,EAAAA;;;AAK3B,EAAA,IAAA,IAAA,GAAMwX,CAAAA;AACN,EAAA,MAAA,GAAA,GAAShC,UAAAA,CAAWgC,IAAAA,CAAIpU,GAAAA,CAAAA;AACvB,EAAA,KAAA,IAAMqU,CAAAA,GAAAA,CAAAA,EAAOD,CAAAA,GAAIE,GAAAA,CAAAA,QAAWlC,CAAAA,EAAAA,EAAAA;AAC5Bld,IAAAA,MAAAA,IAAAA,GAASA,GAAAA,CAAQ,UAAA,CAAYmf,CAAAA,CAAAA;AAC9B,IAAA,IAAA,GAAA,CAAA,IAAA,IAAA,CAAA,IAAA,IAAA,GAAA,IAAA,GAAA,CAAA;AAEA,EAAA;AACD,EAAA,OAAA,OAAA,IAAA,CAAA,GAAA,CAAA,IAAA,CAAA,CAAA,QAAA,CAAA,EAAA,CAAA,CAAA,CAAA;AA/BSH;AAOFC,MAAAA,CAAAA,wBAAAA,EAAAA,0BAAAA,CAAAA;;AC9OP,IAAA,QAAA,GAAA,MAAA;AAAA,EAAA;;;;;AA4GSxd;AACAmU,EAAAA,MAAAA;AACAW,EAAAA,KAAAA;EAER,WAAA,GAAYtgB,EAAAA;EACX,WAAA,CAAKwL,OAAAA,GAAc4d,EAAAA,EAAAA;AAGnBxM,IAAAA,IAAAA,CAAAA,MAAAA,GAAAA,IAAAA,CAAAA,aAAAA,CAAiC+K,OAAAA,CAAAA;AAGjC,IAAA,oBAAA,CAAiBjI,IAAAA,CAAAA,OAAe,YAAY2J,CAAAA;AAC7C,IAAA,IAAA,CAAA,KAAA,GAAA,IAAA,cAAA,CAAA,IAAA,CAAA,OAAA,UAAA,CAAA;;;;;;;;;EAaC,MAAA,OAAA,CAAMC,OAAAA,EAAY1uB,WAAAA,GAAQ,iBAAA,EAAA;AAK1B,IAAA,MAAMmiB,SAAAA,GAAAA,KAAa,GAAA,EAAM;AAKzB,IAAA,MAAMrgB,UAAAA,GAAU,MAAA,IAAA,CAAA,gBAAA,CAAA,OAAA,CAAA;AACfwjB,IAAAA,MAAAA,OAAAA,GAAAA;AACAC,MAAAA,oBAAAA,EAAsBplB,OAAAA,CAAAA,oBAAAA;AACtBqlB,MAAAA,YAAAA,EAAW1iB,OAAAA,CAAQ0iB,KAAAA;AACnBE,MAAAA,SAAAA,EAAAA,QAAkBA,SAAAA,IAAAA,MAAAA;AACnB,MAAA,WAAA,EAAA,IAAA,CAAA;AAKA,KAAA;AAMA,IAAA,MAAM2H,iBAAWzJ,mBAAAA,CAAgB+K,UAAAA,EAAAA,aAAAA,IAAAA,CAAAA,MAAAA,CAAAA,cAAAA,OAAAA,CAAAA;AAEjC,IAAA,MAAMC,QAAAA,GAAS,gBAAevB,cAAAA,CAAAA;AAC9B,IAAA,MAAIuB,MAAAA,GAAQ,IAAA,CAAA,KAAA,CAAA,GAAA,CAAA,QAAA,CAAA;AACX,IAAA,IAAA,MAAA,EAAO;AACHA,MAAAA,OAAAA;QACHzF,GAAAA,MAAAA;QACA0F,QAAAA,EAAAA,IAAAA;QACD,WAAA,EAAA,YAAA,CAAA,MAAA,CAAA,WAAA,EAAA,IAAA;AACD,OAAA;AAKA,IAAA;AAKA,IAAA,MAAM5E,YAAWF,eAAAA,CAAgB+E,UAAAA,EAAU3L,KAAAA,MAAAA,CAAUhB,YAAAA,EAAiBvR,aAAOme,OAAY,CAAA;AAKzF,IAAA,MAAIC,WAAAA,eAAAA,CAA6B/E,SAAAA,CAAAA,UAAAA,UAAAA,EAAAA,IAAAA,CAAAA,OAAAA,YAAAA,CAAAA;AAKjC,IAAA,IAAIgF,WAAAA,GAAAA,eAAgBhF,QAAAA,CAAAA;AACpB,IAAA,IAAI+E,aAAAA,GAAc,QAAA;AACjBC,IAAAA,IAAAA,WAAAA,GAAgBpE,IAAAA,CAAAA,MAAAA,CAAYZ,YAAAA,CAAU,WAAA,EAAY8C;AAClDiC,MAAAA,aAAAA,GAAc7E,WAAAA,CAAAA,UAAe8E,IAAAA,CAAAA,MAAAA,CAAAA,aAAAA,WAAAA,EAAAA,IAAAA,CAAAA,OAAAA,YAAAA,CAAAA;AAC9B,MAAA,WAAA,GAAA,eAAA,aAAA,CAAA;AAKA,IAAA;AAEA,IAAA,MAAMJ,kBAAAA,GAAczF,UAAAA,CACnB8F,MAAAA,CAAAA,CAAAA,MAAAA,SAAAA,CACAJ,QAAAA,CAAUtG,IAAAA,CAAAA,CAAAA,CAAAA,KACVsG,CAAAA,CAAAA,EAAAA,KAAUrM,CAAAA,CAAAA,EAAAA,CAAAA,CAAAA;AAITiC,IAAAA,MAAAA,WAAAA,GAAQF,gBAAAA,CAAmBvK,kBAAAA,EAAAA,SAAAA,CAAAA,UAAAA,EAAAA,SAAAA,CAAAA,UAAAA,EAAAA,IAAAA,CAAAA,MAAAA,CAAAA,YAAAA,EAAAA,SAAAA,CAAAA,iBAAAA,CAAAA,UAAAA,EAAAA;AAC3BqK,MAAAA,MAAAA,EAAAA,YAAaE,MAAAA,CAAYF,MAAAA;AACzB0E,MAAAA,WAAAA,EAAUxE,YAAYD,WAAAA,CAAYtK,MAAAA;AACnC,MAAA,QAAA,EAAA,YAAA,WAAA,CAAA;KAMD,CAAA;AACCkJ,IAAAA,MAAAA,MAAAA,GAAU2L;AACVrM,MAAAA,QAAAA,EAAAA,SAAAA,CAAYqM,QAAAA;AACZD,MAAAA,UAAAA,EAAAA,SAAAA,CAAAA,UAAAA;AACAxB,MAAAA,WAAAA;AACAlE,MAAAA,QAAAA;MACAgE,QAAAA,EAAAA,KAAAA;MACAlD,YAAAA,EAAUgF,WAAAA;MACX,QAAA,EAAA;AAKA,KAAA;AACC,IAAA,IAAA,IAAA,CAAM7B,OAAAA,gBAAAA,EAAwBjL;AAC7B+D,MAAAA,MAAAA,QAAAA,GAAUqH,YAAAA,CAAkB,UAAA,CAAA,CAAA,GAAA,CAAA,CAAA,EAAA,MAAA;QAC5BtmB,QAAAA,EAAUA,KAAAA,CAAAA,GAAAA,SAAAA,CAAAA;AACVkc,QAAAA,KAAAA,EAAAA,EAAAA,CAAU2L,KAAAA;QACVK,QAAAA,EAAAA,SAAAA,CAAiBL,SAAUtG,IAAAA,CAAAA,CAAAA,MAAW4G,CAAAA,CAAK,EAAA,KAAOxK,EAAAA,CAAEsB,SAAAA,CAAS/qB,EAAAA,CAAAA;QAC9D,eAAA,EAAA,SAAA,CAAA,UAAA,CAAA,IAAA,CAAA,CAAA,CAAA,KAAA,CAAA,CAAA,QAAA,CAAA,EAAA,KAAA,EAAA,CAAA,SAAA,CAAA,EAAA,CAAA,EAAA;AAEA8iB,OAAAA,CAAAA,CAAAA;AACCA,MAAAA,MAAAA,CAAAA,WAAAA,GAAQ,eAAA,CAAA;QACPkF,MAAAA,EAAAA;AACAV,UAAAA,QAAAA,EAAAA,MAAAA,CAAYxE,QAAAA;AACZoP,UAAAA,UAAAA,EAAUpP,MAAAA,CAAOoP,UAAAA;AACjBlE,UAAAA,QAAAA,EAAUlL,MAAAA,CAAOkL,QAAAA;AACjBgE,UAAAA,QAAAA,EAAAA,MAAAA,CAAclP,QAAAA;AACf,UAAA,YAAA,EAAA,MAAA,CAAA;AACAnb,SAAAA;AACA0hB,QAAAA,OAAAA;AACArC,QAAAA,WAAAA;AACA4K,QAAAA,UAAAA;AACAK,QAAAA,YAAAA,EAAAA,KAAAA,MAAAA,CAAAA,YAAAA;AACAsB,QAAAA,QAAAA;AACD,QAAA;OACD,CAAA;AAKA,IAAA;AAEA,IAAA,IAAA,CAAA,KAAA,CAAOzQ,GAAAA,CAAAA,QAAAA,EAAAA,MAAAA,CAAAA;AACR,IAAA,OAAA,MAAA;;;;;AAWC,EAAA,MAAA,qBAAA,CAAmC,UAAA,EAAA,OAAA,EAAA,WAAA,GAAA,iBAAA,EAAA;AAClCoR,IAAAA,MAAAA,UAAAA,GAAAA;AACD,MAAA,kBAAA,kBAAAlS,OAAAA,CAAA,YAAA,UAAA,EAAA,oBAAA;AAEA,KAAA;AACA,IAAA,MAAKvM,eAAAA,GAAiB,KAAA,MAAA,CAAA,OAAA;AAAC0e,IAAAA,IAAAA,CAAAA,OAAAA,OAAAA,GAAAA;;;AAGtB,IAAA,IAAA;AACD,MAAA,OAAA,MAAA,IAAA,CAAA,OAAA,CAAA,OAAA,EAAA,WAAA,CAAA;IACC,CAAA,SAAA;AACD,MAAA,IAAA,CAAA,OAAA,OAAA,GAAA,eAAA;AACD,IAAA;;;;;EAMC,SAAA,GAAO;AACR,IAAA,OAAA,KAAA,MAAA,CAAA,YAAA;;;;;AAMC,EAAA,cAAA,CAAK5J,MAAAA,EAAc1B;AACnB,IAAA,IAAA,CAAKe,WAAAA,GAAW,MAAA;AACjB,IAAA,IAAA,CAAA,MAAA,KAAA,EAAA;;;;;EAMC,UAAA,GAAWwK;AACZ,IAAA,IAAA,CAAA,MAAA,KAAA,EAAA;;;;;EAMC,aAAA,GAAYxK;AACb,IAAA,OAAA,IAAA,CAAA,MAAA,QAAA,EAAA;;;;;EAMC,kBAAA,GAAmByK;AACpB,IAAA,OAAA,KAAA,MAAA,CAAA,eAAA;;;;;AAMC,EAAA,MAAA,iBAAMC,OAAAA,EAAqC;AAE3C,IAAA,MAAA,gBAAqB,EAAA;AACpB,IAAA,KAAA,MAAMtN,MAAAA,IAAa,IAAA,CAAA,MAAA,CAAMvf,OAAAA,EAAOysB;AAChCI,MAAAA,MAAAA,aAAkB,MAAItN,MAAAA,CAAAA,mBAAAA,OAAAA,EAAAA,IAAAA,CAAAA,OAAAA,eAAAA,CAAAA;AACvB,MAAA,aAAA,CAAA,IAAA,CAAA,GAAA,UAAA,CAAA;AAEA,IAAA;AACD,IAAA,OAAA,aAAA;;;;;AAMC,EAAA,aAAA,CAAO,OAAA,EAAA;AACN4K,IAAAA,OAAAA;AACA2C,MAAAA,YAAAA,EAAStqB,QAAQsqB,YAAAA,IAAW,qBAAA;MAC5BjB,OAAAA,EAAAA,OAAAA,CAAYrpB,WAAQqpB,EAAAA;AACpBM,MAAAA,UAAAA,EAAAA,QAAc3pB,UAAAA,IAAQ2pB,YAAAA;AACtBS,MAAAA,YAAAA,EAAAA,QAAiBpqB,YAAAA,IAAQoqB,mBAAAA;MACzBG,eAAAA,EAAAA,OAAAA,CAAkBvqB,mBAAQuqB,uBAAAA,EAAoB;AAC/C,MAAA,gBAAA,EAAA,QAAA,gBAAA,IAAA;AACD,KAAA;AACD,EAAA;AAKO;AACN,SAAO,eAAavqB,OAAAA,EAAAA;AACrB,EAAA,OAAA,IAAA,SAAA,OAAA,CAAA;AAFgBwqB;AACR,MAAA,CAAA,cAAA,EAAA,gBAAA,CAAA;;IC7UPC,gBAAAA,GAAQ;EACRnR,MAAAA,EAAO,IAAA;EACPoR,KAAAA,EAAAA,IAAAA;EACA,QAAA,EAAA,IAAA;EACAC,iBAAAA,EAAO,GAAA;EACP,KAAA,EAAA,GAAA;EACA,eAAA,EAAA,IAAA;EACAC,gBAAAA,EAAc,IAAA;EACdC,YAAAA,EAAc,GAAA;EACd,YAAA,EAAA,GAAA;EACD,iBAAA,EAAA;AAKA,CAAA;IACC5gB,kBAAAA,GAAU;EACV6gB,QAAAA,EAAM,IAAA;EACNC,IAAAA,EAAAA,GAAAA;EACAC,MAAAA,EAAK,IAAA;EACL/pB,GAAAA,EAAAA,IAAAA;EACD,IAAA,EAAA;AAKA,CAAA;IACCgqB,aAAAA,GAAO;EACPC,KAAAA,EAAAA,GAAAA;EACAC,UAAAA,EAAAA,GAAAA;EACAC,cAAAA,EAAgB,GAAA;EAChBC,cAAAA,EAAM,GAAA;EACP,IAAA,EAAA;AAUA,CAAA;IACCC,yBAAAA,GAAW;EACXC,SAAAA,EAAAA,GAAAA;EACD,WAAA,EAAA;AAKO,CAAA;AAtEP,IAAA,oBAAA,GAAA,MAAA;AAAA,EAAA;;;;;;;;;AA2EE,EAAA,SAAA,CAAIC,iBAAc,QAAA,EAAA;AAClB,IAAA,IAAIC,WAAAA,GAAAA,CAAAA;AACJ,IAAA,IAAA,aAAA,GAA2C,CAAA;AAG3C,IAAA,MAAA,YAAW5S,EAAAA;AACV,IAAA,KAAA,MAAM6S,UAASC,eAAAA,EAAiB9S;AAChC2S,MAAAA,MAAAA,MAAAA,GAAeE,gBAAAA,CAAAA,MAAAA,CAAAA,QAAAA,CAAAA,IAAAA,IAAAA;AAGf,MAAA,WAAA,IAAc7S,MAAAA;AACd4S,MAAAA,MAAAA,KAAAA,GAAAA,MAAAA,CAAiBC,OAAAA,GAAS7pB,MAAAA,CAAAA,QAAAA,GAAAA,CAAAA;AAC1B+pB,MAAAA,aAAAA,IAAiBC,MAAAA,GAAQ,KAAA;AAC1B,MAAA,SAAA,CAAA,MAAA,CAAA,QAAA,CAAA,GAAA,KAAA;AAGA,IAAA;AAGA,IAAA,IAAA,UAAA,GAAWhT,WAAAA,GAAUiT,CAAAA,GAAAA,aAAAA,GAAiB,WAAA,GAAA,CAAA;AACrC,IAAA,KAAA,MAAA,UAAWC,eAAAA,EAAwB;AAClC,MAAA,KAAA,MAAMC,KAAAA,IAAUC,OAAAA,MAAAA,EAAAA;AAChBjkB,QAAAA,MAAAA,OAAAA,GAAauJ,kBAAAA,CAAYvJ,KAAAA,CAAagkB,QAAAA,CAAAA,IAAAA,CAAAA;AACvC,QAAA,UAAA,GAAA,IAAA,CAAA,GAAA,CAAA,CAAA,EAAA,UAAA,GAAA,OAAA,CAAA;AACD,MAAA;AAGA,IAAA;AACAhkB,IAAAA,MAAAA,qBAAAA,GAAsBA,IAAAA,CAAYkkB,sBAAAA,CAAAA,QAAAA,CAAAA;AAGlClkB,IAAAA,UAAAA,GAAauJ,IAAAA,CAAKiQ,GAAAA,CAAAA,UAAAA,EAAMxZ,qBAAoB,CAAA;AAE5C,IAAA,UAAA,GAAO,IAAA,CAAA,KAAA,CAAA,UAAA,GAAA,GAAA,CAAA,GAAA,GAAA;AACNA,IAAAA,OAAAA;AACA4jB,MAAAA,UAAAA;AACAnC,MAAAA,SAAAA;AACAyC,MAAAA,WAAAA,EAAAA,IAAAA,CAAAA,mBAAAA,CAAAA,UAAAA,EAAAA,QAAAA,EAAAA,eAAAA,CAAAA;AACD,MAAA;AACD,KAAA;;;;;AAOC,EAAA,iBAAA,CAAIC,kBAAmB,iBAAA,EAAA;AACtB,IAAA,IAAA,iBAAA,EAAO;AACR,MAAA,OAAA,wBAAA;AAEA,IAAA;AAEA,IAAA,MAAInkB,EAAAA,YAAcokB,GAAAA,gBAAAA;AACjB,IAAA,IAAA,UAAA,IAAO,0BAAA,SAAA,EAAA;AACR,MAAA,OAAA,sBAAA;AAEA,IAAA;AACC,IAAA,IAAA,UAAA,IAAO,0BAAA,WAAA,EAAA;AACR,MAAA,OAAA,oBAAA;AAEA,IAAA;AACD,IAAA,OAAA,wBAAA;;;;;AAOC,EAAA,sBAAA,CAAoBC,QAAAA,EAAAA;AAGpB,IAAA,IAAI,gBAAUC,aAAAA,CAAW,IAAA;AACxBC,IAAAA,IAAAA,CAAAA,SAAAA,SAAAA,EAAqBh1B;AACtB,MAAA,aAAA,GAAA,IAAA,CAAA,GAAA,CAAA,aAAA,EAAA,aAAA,CAAA,KAAA,CAAA;AAGA,IAAA;AACCg1B,IAAAA,IAAAA,CAAAA,SAAAA,eAAAA,EAAyBA;AAC1B,MAAA,aAAA,GAAA,IAAA,CAAA,GAAA,CAAA,aAAA,EAAA,aAAA,CAAA,UAAA,CAAA;AAGA,IAAA;AACCA,IAAAA,IAAAA,CAAAA,SAAAA,mBAAAA,EAAyBA;AAC1B,MAAA,aAAA,GAAA,IAAA,CAAA,GAAA,CAAA,aAAA,EAAA,aAAA,CAAA,cAAA,CAAA;AAGA,IAAA;AACCA,IAAAA,IAAAA,CAAAA,SAAAA,mBAAAA,EAAyBA;AAC1B,MAAA,aAAA,GAAA,IAAA,CAAA,GAAA,CAAA,aAAA,EAAA,aAAA,CAAA,cAAA,CAAA;AAGAA,IAAAA;AAEA,IAAA,aAAA,GAAOA,IAAAA,CAAAA,GAAAA,CAAAA,aAAAA,EAAAA,QAAAA,CAAAA,aAAAA,CAAAA;AACR,IAAA,OAAA,aAAA;;;;;EAMC,mBAAA,CAAwB,UAAA,EAAA,UAAA,OAAA,EAAA;AAGxB,IAAA,MAAIvkB,QAAAA,EAAAA;AACHwkB,IAAAA,IAAAA,aAAW,GAAA,EAAA;AACZ,MAAA,KAAA,CAAA,KAAWxkB,CAAAA,gBAAAA,EAAkB,IAAA,CAAA,MAAA,UAAA,GAAA,GAAA,CAAA,CAAA,2BAAA,CAAA,CAAA;AAC5BwkB,IAAAA,CAAAA,MAAAA,IAAM1V,aAAK,GAAA,EAAA;AACZ,MAAA,KAAA,CAAO,KAAA,CAAA,qBAAA,EAAA,IAAA,CAAA,MAAA,UAAA,GAAA,GAAA,CAAA,CAAA,uBAAA,CAAA,CAAA;IACN0V,CAAAA,MAAAA;AACD,MAAA,KAAA,CAAA,KAAA,CAAA,iBAAA,EAAA,IAAA,CAAA,MAAA,UAAA,GAAA,GAAA,CAAA,CAAA,yBAAA,CAAA,CAAA;AAGA,IAAA;AACA,IAAA,MAAKC,OAAAA,EAASH;AACbI,IAAAA,IAAAA,CAAAA,SAAU,SAAA,EAAA;AACX,MAAA,IAAA,CAAA,KAAA,oBAAA,CAAA;AACA,IAAA;AACCA,IAAAA,IAAAA,CAAAA,SAAU,eAAA,EAAA;AACX,MAAA,IAAA,CAAA,KAAA,uBAAA,CAAA;AACA,IAAA;AACCA,IAAAA,IAAAA,CAAAA,SAAU,mBAAA,EAAA;AACX,MAAA,IAAA,CAAA,KAAA,0BAAA,CAAA;AACA,IAAA;AACCA,IAAAA,IAAAA,CAAAA,SAAU,mBAAA,EAAA;AACX,MAAA,IAAA,CAAA,KAAA,4BAAA,CAAA;AAEA,IAAA;AACCF,IAAAA,IAAAA,IAAAA,CAAM1V,SAAK,CAAA,EAAA;AACZ,MAAA,KAAA,CAAA,KAAA,CAAA,eAAA,EAAA,IAAA,CAAA,IAAA,CAAA,IAAA,CAAA,CAAA,CAAA,CAAA,CAAA;AAGA,IAAA;AACA,IAAA,MAAM6V,WAAAA,GAAAA,OAAAA,CAAiB9d,MAAAA,CAAQ+d,CAAAA,GAAAA,EAASpN,MAAMA,GAAAA,GAAE5lB,CAAAA,CAAM,MAAA,CAAEgc,MAAAA,EAAcqR,CAAAA,CAAAA;AACtE,IAAA,MAAM4F,cAAAA,GAAahe,OAAAA,CAAQ+d,OAAAA,CAASpN,CAAAA,MAAQ5lB,CAAAA,CAAAA,MAAQgc,CAAAA,CAAAA,MAAAA,CAAQqR,CAAAA,CAAAA,KAAQhuB,CAAAA,CAAAA,QAAAA,KAAa,UAAQ4b,CAAAA,CAAAA,MAAAA;AAEzF,IAAA,MAAI8X,UAAAA,GAAAA,OAAAA,CAAsBE,OAAAA,CAAAA,CAAAA,MAAgB,CAAA,CAAA,MAAA,CAAA,CAAA,MAAA,CAAA,CAAA,CAAA,KAAA,CAAA,CAAA,QAAA,KAAA,MAAA,CAAA,CAAA,MAAA;AACzCL,IAAAA,IAAAA,cAAAA,GAAW,CAAA,IAAWG,UAAAA,GAAAA,CAAAA,EAAAA;AACvB,MAAA,KAAA,CAAA,KAAWG,CAAAA,QAAAA,EAAAA,cAAiB,cAAA,UAAA,CAAA,OAAA,EAAA,WAAA,CAAA,OAAA,CAAA,CAAA;AAC3BN,IAAAA,CAAAA,MAAAA,IAAM1V,cAAcgW,CAAAA,EAAAA;AACrB,MAAA,KAAA,CAAO,IAAA,CAAA,CAAA,MAAA,EAAA,WAAA,CAAA,wBAAA,CAAA,CAAA;IACNN,CAAAA,MAAAA;AACD,MAAA,KAAA,CAAA,KAAA,qBAAA,CAAA;AAEA,IAAA;AACD,IAAA,OAAA,KAAA,CAAA,KAAA,GAAA,CAAA;;;;;AAMC,EAAA,OAAA,kBAAoB,OAAA,EAAQ3d;AAC5B,IAAA,MAAMke,WAAAA,GAAcle,IAAAA,GAAAA,CAAQgG,OAAAA,CAAAA,IAAS,CAAIhG,CAAAA,KAAAA,CAAAA,CAAQiW,QAAQrP,CAAAA,CAAAA;AAEzD,IAAA,MAAA,WAAA,GAAO,OAAA,CAAA,MAAA,GAAA,CAAA,GAAA,QAAA,MAAA,CAAA,CAAA,GAAA,EAAA,CAAA,KAAA,MAAA,CAAA,CAAA,QAAA,EAAA,CAAA,CAAA,GAAA,QAAA,MAAA,GAAA,CAAA;AACN6W,IAAAA,OAAAA;AACAU,MAAAA,SAAAA,EAAAA,WAAAA,CACCC,GAAAA,CAAAA,QAAgB,CAAA,IAAA,OAAA,CAAepe,IAAAA,CAAAA,CAAAA,CAAAA,KAAQmb,CAAAA,CAAMxK,QAAAA,KAAQqM,QAAa,CAAA,EAAA,OAAA,KAAa/zB,IAAAA;AAChFo1B,MAAAA,eAAAA,EAAAA,WAAAA,CACCD,GAAAA,CAAYE,UAAI,CAAA,IAAA,OAAA,CAAmBte,IAAAA,CAAAA,CAAAA,CAAAA,KAAQmb,CAAAA,CAAMxK,QAAAA,KAAQqM,UAAa,CAAA,EAAA,OAAA,KAAiB/zB,IAAAA;AACxFs1B,MAAAA,mBAAAA,EACCH,WAAAA,CAAYE,GAAAA,CAAI,cAAA,CAAA,IAAmBte,OAAAA,CAAQmb,IAAAA,CAAK,CAACxK,CAAAA,KAAMA,CAAAA,CAAEqM,QAAAA,KAAa,cAAA,CAAA,EAAiB/zB,OAAAA,KAAY,IAAA;AACpGu1B,MAAAA,mBAAAA,EAAeN,WAAAA,CAAAA,GAAAA,CAAAA,cAAAA,CAAAA,IAAAA,OAAAA,CAAAA,IAAAA,CAAAA,CAAAA,CAAAA,KAAAA,CAAAA,CAAAA,QAAAA,KAAAA,cAAAA,CAAAA,EAAAA,OAAAA,KAAAA,IAAAA;MAChB,aAAA,EAAA;AACD,KAAA;AACD,EAAA;AChOO;AACN,SAAQO,UAAAA,QAAAA,EAAWC;AAClB,EAAA,IAAA,CAAA,EAAA,CAAA,UAAA,CAAO,QAAA,CAAA,EAAA;AACR,IAAA,OAAA,EAAA;AACA,EAAA;AACC,EAAA,IAAA;AAKD,IAAA,OAAY,EAAA,CAAA,YAAA,CAAA,UAAA,OAAA,CAAA,CAAA,MAAA,OAAA,CAAA,CAAA,OAAA,CAAA,IAAA,KAAA,KAAA,IAAA,EAAA,EAAA,GAAA,CAAA,CAAA,SAAA,IAAA,CAAA,KAAA,CAAA,IAAA,CAAA,CAAA;AACXvsB,EAAAA,CAAAA,CAAAA,OAAAA,CAAAA,EAAQjJ;AACR,IAAA,OAAA,CAAO,KAAA,CAAA,CAAA,2BAAA,EAAA,QAAA,CAAA,CAAA,CAAA,EAAA,CAAA,CAAA;AACR,IAAA,OAAA,EAAA;AACD,EAAA;AAdgBy1B;AACPF,MAAAA,CAAAA,SAAAA,EAAAA,WAAAA,CAAAA;AAkBFvV,OAAAA,CAAA,WAAS0V,WAAeF,CAAAA;AAC9B,SAAMG,WAAAA,CAAWC,UAAQJ,IAAAA,EAAAA;AACzB,EAAA,MAAQD,GAAAA,GAAAA,cAAiB,QAAA,CAAA;AACxBM,EAAAA,IAAGC,CAAAA,EAAAA,CAAAA,UAAAA,CAAUH,GAAK,CAAA,EAAA;AAAEI,IAAAA,EAAAA,CAAAA,SAAAA,CAAW,GAAA,EAAA;MAAK,SAAA,EAAA;KACrC,CAAA;AACGC,EAAAA;AAAoD,EAAA,kBAAA,QAAA,EAAA,CAAA,EAAA,IAAA,CAAA,SAAA,CAAA,IAAA,CAAA;AACxD,CAAA,CAAA;AANgBN;AACTC,MAAAA,CAAAA,WAAAA,EAAAA,aAAAA,CAAAA;AAUP3V,OAAAA,CAAA,aAAsBiW,aAAoBT,CAAAA;AACzC,eAAiBI,gBAAAA,CAAQJ,UAAAA,IAAAA,EAAAA;AACzB,EAAA,MAAQD,GAAAA,GAAAA,cAAiB,QAAA,CAAA;AACxBM,EAAAA,IAAGC,CAAAA,EAAAA,CAAAA,UAAAA,CAAUH,GAAK,CAAA,EAAA;AAAEI,IAAAA,EAAAA,CAAAA,SAAAA,CAAW,GAAA,EAAA;MAAK,SAAA,EAAA;KACrC,CAAA;AACA,EAAA;AACC,EAAA,IAAA;AACA,IAAA,MAAMG,WAAUV,EAAAA,CAAAA,UAAAA,CAAapU,QAAAA,IAAgBtY,EAAAA,CAAAA,YAAAA,CAAUwQ,QAAAA,EAAAA,OAAAA,CAAAA,GAAAA,EAAAA;AAAS,IAAA,MAAA,UAAA,QAAA,EAAA,CAAA,EAAA,WAAA,IAAA,CAAA,SAAA,CAAA,IAAA,CAAA;;EAGhEuc,CAAAA,CAAAA,MAAGG;AAAoD,IAAA,kBAAA,QAAA,EAAA,CAAA,EAAA,IAAA,CAAA,SAAA,CAAA,IAAA,CAAA;AACxD,CAAA,CAAA;AACD,EAAA;AAZsBC;AACJL,MAAAA,CAAAA,gBAAAA,EAAAA,kBAAAA,CAAAA;AAgBlB5V,OAAAA,CAAA,kBAAsBmW,kBAAgCC,CAAAA;AACrD,eAAiBR,UAAAA,CAAAA,UAAQJ,OAAAA,EAAAA;AACzB,EAAA,MAAQD,GAAAA,GAAAA,cAAiB,QAAA,CAAA;AACxBM,EAAAA,IAAGC,CAAAA,EAAAA,CAAAA,UAAAA,CAAUH,GAAK,CAAA,EAAA;AAAEI,IAAAA,EAAAA,CAAAA,SAAAA,CAAW,GAAA,EAAA;MAAK,SAAA,EAAA;KACrC,CAAA;AACA,EAAA;;;AAEC,EAAA,IAAA;AACD,IAAA,MAAQ,SAAA,CAAA,UAAA,OAAA,CAAA;EAEPF,CAAAA,CAAAA,MAAGQ;AACJ,IAAA,EAAA,CAAA,aAAA,CAAA,UAAA,OAAA,CAAA;AACD,EAAA;AAZsBF;AACJP,MAAAA,CAAAA,UAAAA,EAAAA,YAAAA,CAAAA;AA8DX5V,OAAAA,CAAA,YAASsW,YAAoB,CAAA;AACnC,SAAOC,WAAAA,CAAAA,SAAoBhuB,IAAAA,EAAAA;AAC5B,EAAA,OAAA,WAAA,MAAA,CAAA;AAFgB+tB;AACRC,MAAAA,CAAAA,WAAAA,EAAAA,YAAAA,CAAAA;;AC9HR,IAAA,aAAA,GAAA,MAAA;AAAA,EAAA;;;;;AAwBS9iB;AACA+iB,EAAAA,MAAAA;AACAC,EAAAA,WAAAA;EAER,WAAA,GAAYhjB,KAAAA;AACX,EAAA,WAAA,CAAKA,QAASA,WAAAA,EAAAA;AACd,IAAA,IAAA,CAAK+iB,MAAAA,GAAAA,MAAAA;AACN,IAAA,IAAA,CAAA,WAAA,GAAA,WAAA;;;;;;AAOC,EAAA,MAAI,UAAA,GAAKC;AACR,IAAA,IAAA,KAAA,WAAA,EAAA;AACD,MAAA;AAIA,IAAA;AACD,IAAA,IAAA,CAAA,WAAA,GAAA,IAAA;;;;;;AAOC,EAAA,MAAA,WAAcxyB,MAAAA,EAAQ;AAGtB,IAAA,MAAMyyB,EAAAA,MAAAA,KAAAA,GAAAA,IAAoBC,QAAAA,GAAS7Z,IAAAA,GAAS,MAAA;AAG5C,IAAA,MAAM8Z,oBAAoBJ,QAAAA,CAAAA,MAAAA,GAAYK,IAAAA,QAAAA,GAAgB,IAAA,CAAA,gBAAA,IAAA,CAAA;AACtD,IAAA,MAAMxP,YAAAA,GAAc,IAAA,CAAKmP,WAAAA,CAAYM,gBAAAA,EAAe;AACpD,IAAA,MAAMxmB,WAAAA,GAAW,IAAA,CAAKkmB,WAAAA,CAAYO,eAAAA,EAAY;AAG9C,IAAA,MAAMC,SAAAA,GAAAA,IAAAA,CAAAA,WAAAA,CAAuBC,YAAAA,EAAAA;AAAwBL,IAAAA,MAAAA,eAAAA,GAAAA,KAAAA,sBAAAA,CAAAA;AAActmB,MAAAA,YAAAA;AAAU2W,MAAAA;MAG7E,IAAA,CAAMiQ,MAAAA,GAAAA,iBAAiBC,CAAAA;AAGvB,IAAA,MAAMjW,SAAAA,GAAAA,IAAAA,CAAAA,gBAAAA,CAAwBkW,WAAoBV,CAAAA;AAGlD,IAAA,MAAMW,gBAAAA,GAAAA,IAAAA,CAAoB,mBAAA,CAAKC,iBAAAA,EAAqBZ,KAAAA,CAAAA;AAEpD,IAAA,MAAA,iBAAA,GAAO,IAAA,CAAA,oBAAA,CAAA,iBAAA,CAAA;AACNa,IAAAA,OAAAA;AACAP,MAAAA,IAAAA;AACAE,MAAAA,eAAAA;AACA5mB,MAAAA,SAAAA;MACA4Q,QAAAA,EAAAA,SAAAA;AACAmW,MAAAA,gBAAAA;AACAG,MAAAA,iBAAAA;AACD,MAAA,IAAA,EAAA,IAAA,CAAA,YAAA,CAAA,gBAAA,CAAA,MAAA,EAAA,kBAAA,MAAA;AACD,KAAA;;;;;AAMC,EAAA,eAAA,CAAMC,IAAAA,EAAAA;AACL,IAAA,MAAA,SAAA,uBAAA,GAAA,CAAA;AACA,MAAA,KAAA;AACA,MAAA,GAAA;AACA,MAAA,IAAA;AACA,MAAA,IAAA;AACA,MAAA,KAAA;AACA,MAAA,KAAA;AACA,MAAA,MAAA;AACA,MAAA,IAAA;AACA,MAAA,MAAA;AACA,MAAA,OAAA;AACA,MAAA,MAAA;AACA,MAAA,KAAA;AACA,MAAA,KAAA;AACA,MAAA,IAAA;AACA,MAAA,MAAA;AACA,MAAA,KAAA;AACA,MAAA,MAAA;AACA,MAAA,OAAA;AACA,MAAA,OAAA;AACA,MAAA,QAAA;AACA,MAAA,KAAA;AACA,MAAA,OAAA;AACA,MAAA,MAAA;AACA,MAAA,OAAA;AACA,MAAA,KAAA;AACA,MAAA,MAAA;AACA,MAAA,IAAA;AACA,MAAA,IAAA;AACA,MAAA,IAAA;AACA,MAAA,KAAA;AACA,MAAA,IAAA;AACA,MAAA,MAAA;AACA,MAAA,IAAA;AACA,MAAA,IAAA;AACA,MAAA,MAAA;AACA,MAAA,IAAA;AACA,MAAA,MAAA;AACA,MAAA,SAAA;AACA,MAAA,QAAA;AACA,MAAA,QAAA;AACA,MAAA,OAAA;AACA,MAAA,OAAA;AACA,MAAA,OAAA;AACA,MAAA,SAAA;AACA,MAAA,OAAA;AACA,MAAA,OAAA;AACA,MAAA,SAAA;AACA,MAAA,MAAA;AACA,MAAA,MAAA;AACA,MAAA,MAAA;AACA,MAAA,OAAA;AACA,MAAA,MAAA;AACA,MAAA,OAAA;AACA,MAAA,KAAA;AACA,MAAA,KAAA;AACA,MAAA,KAAA;AACA,MAAA,MAAA;AACA,MAAA,KAAA;AACA,MAAA,MAAA;AACA,MAAA,MAAA;AACA,MAAA,OAAA;AACA,MAAA,MAAA;AACA,MAAA,MAAA;AACA,MAAA,IAAA;AACA,MAAA,KAAA;AACA,MAAA,KAAA;AACA,MAAA,MAAA;AACA,MAAA,KAAA;AACA,MAAA,MAAA;AACA,MAAA,IAAA;AACA,MAAA,MAAA;AACA,MAAA,KAAA;AACA,MAAA,MAAA;AACA,MAAA,MAAA;AACA,MAAA,KAAA;AACA,MAAA,KAAA;AACA,MAAA,IAAA;AACA,MAAA,IAAA;AACA,MAAA,SAAA;AACA,MAAA,OAAA;AACA,MAAA,OAAA;AACA,MAAA,MA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","file":"chunk-MTQ6ESQR.js","sourcesContent":["/**\n * Authentication Error Types\n *\n * Standardized error codes and schemas for authentication flows.\n * Maps Better Auth errors to our application-specific error codes.\n */\nimport { z } from \"zod\";\n/**\n * Standard authentication error codes\n *\n * These codes provide a consistent error interface across\n * all authentication operations, regardless of the underlying\n * authentication provider (Better Auth, OAuth, etc.)\n */\nexport const AuthErrorCodeSchema = z.enum([\n    \"INVALID_CREDENTIALS\",\n    \"USER_NOT_FOUND\",\n    \"EMAIL_NOT_VERIFIED\",\n    \"SESSION_EXPIRED\",\n    \"UNAUTHORIZED\",\n    \"RATE_LIMITED\",\n    \"INVALID_TOKEN\",\n    \"USER_ALREADY_EXISTS\",\n    \"WEAK_PASSWORD\",\n    \"INVALID_EMAIL\",\n    \"OAUTH_ERROR\",\n    \"NETWORK_ERROR\",\n    \"UNKNOWN_ERROR\",\n]);\n/**\n * Authentication error schema\n *\n * Provides structured error information for frontend display\n * and logging purposes.\n *\n * @example\n * ```typescript\n * const result = await signIn(email, password);\n * if (result.error) {\n *   console.error(`Auth failed: ${result.error.message}`);\n *   if (result.error.code === 'INVALID_CREDENTIALS') {\n *     showToast('Invalid email or password');\n *   }\n * }\n * ```\n */\nexport const AuthErrorSchema = z.object({\n    code: AuthErrorCodeSchema,\n    message: z.string(),\n    details: z.record(z.string(), z.unknown()).optional(),\n});\n/**\n * Map Better Auth error messages to our error codes\n *\n * Better Auth returns string error messages. This map translates\n * them to our standardized error codes for consistent handling.\n */\nexport const BETTER_AUTH_ERROR_MAP = {\n    // Sign in errors\n    INVALID_PASSWORD: \"INVALID_CREDENTIALS\",\n    USER_NOT_FOUND: \"USER_NOT_FOUND\",\n    INVALID_EMAIL: \"INVALID_EMAIL\",\n    // Sign up errors\n    USER_ALREADY_EXISTS: \"USER_ALREADY_EXISTS\",\n    EMAIL_ALREADY_IN_USE: \"USER_ALREADY_EXISTS\",\n    WEAK_PASSWORD: \"WEAK_PASSWORD\",\n    // Session errors\n    SESSION_EXPIRED: \"SESSION_EXPIRED\",\n    SESSION_NOT_FOUND: \"SESSION_EXPIRED\",\n    INVALID_SESSION: \"SESSION_EXPIRED\",\n    // Verification errors\n    EMAIL_NOT_VERIFIED: \"EMAIL_NOT_VERIFIED\",\n    // Token errors\n    INVALID_TOKEN: \"INVALID_TOKEN\",\n    TOKEN_EXPIRED: \"INVALID_TOKEN\",\n    // Rate limiting\n    RATE_LIMIT_EXCEEDED: \"RATE_LIMITED\",\n    TOO_MANY_REQUESTS: \"RATE_LIMITED\",\n    // OAuth errors\n    OAUTH_ERROR: \"OAUTH_ERROR\",\n    OAUTH_CALLBACK_ERROR: \"OAUTH_ERROR\",\n    PROVIDER_ERROR: \"OAUTH_ERROR\",\n};\n/**\n * Helper function to map Better Auth errors to our error codes\n *\n * @param betterAuthError - Error message or code from Better Auth\n * @returns Mapped error code or UNKNOWN_ERROR\n *\n * @example\n * ```typescript\n * const errorCode = mapBetterAuthError('INVALID_PASSWORD');\n * // Returns: 'INVALID_CREDENTIALS'\n * ```\n */\nexport function mapBetterAuthError(betterAuthError) {\n    return BETTER_AUTH_ERROR_MAP[betterAuthError] || \"UNKNOWN_ERROR\";\n}\n/**\n * Create a standardized auth error\n *\n * @param code - Error code\n * @param message - User-friendly error message\n * @param details - Optional additional error details\n * @returns AuthError object\n *\n * @example\n * ```typescript\n * throw createAuthError(\n *   'INVALID_CREDENTIALS',\n *   'The email or password you entered is incorrect',\n *   { attempts: 3 }\n * );\n * ```\n */\nexport function createAuthError(code, message, details) {\n    return {\n        code,\n        message,\n        ...(details && { details }),\n    };\n}\n/**\n * User-friendly error messages for each error code\n *\n * These messages are safe to display to end users and provide\n * actionable guidance.\n */\nexport const AUTH_ERROR_MESSAGES = {\n    INVALID_CREDENTIALS: \"The email or password you entered is incorrect\",\n    USER_NOT_FOUND: \"No account found with this email address\",\n    EMAIL_NOT_VERIFIED: \"Please verify your email address before signing in\",\n    SESSION_EXPIRED: \"Your session has expired. Please sign in again\",\n    UNAUTHORIZED: \"You do not have permission to perform this action\",\n    RATE_LIMITED: \"Too many attempts. Please try again later\",\n    INVALID_TOKEN: \"Invalid or expired verification token\",\n    USER_ALREADY_EXISTS: \"An account with this email already exists\",\n    WEAK_PASSWORD: \"Password does not meet security requirements\",\n    INVALID_EMAIL: \"Please enter a valid email address\",\n    OAUTH_ERROR: \"Authentication with this provider failed. Please try again\",\n    NETWORK_ERROR: \"Network error. Please check your connection and try again\",\n    UNKNOWN_ERROR: \"An unexpected error occurred. Please try again\",\n};\n/**\n * Get user-friendly message for an error code\n *\n * @param code - Error code\n * @returns User-friendly error message\n */\nexport function getErrorMessage(code) {\n    return AUTH_ERROR_MESSAGES[code];\n}\n","/**\n * Authentication Session Types\n *\n * Core types and schemas for user authentication and session management.\n * These contracts are shared between frontend and backend to ensure type safety.\n */\nimport { z } from \"zod\";\n/**\n * User role type - matches database schema and Better Auth admin plugin\n */\nexport const UserRoleSchema = z.enum([\"admin\", \"user\", \"viewer\"]).nullable();\n/**\n * Core user schema - minimal fields needed for authentication\n *\n * This represents the authenticated user object as returned by Better Auth\n * and used throughout the application.\n */\nexport const AuthUserSchema = z.object({\n    id: z.string(),\n    email: z.string().email(),\n    name: z.string().nullable(),\n    image: z.string().url().nullable().optional(),\n    emailVerified: z.boolean(),\n    createdAt: z.coerce.date(),\n    updatedAt: z.coerce.date(),\n    // Role field from database - nullable as not all users have a role assigned\n    role: UserRoleSchema.optional(),\n});\n/**\n * Session schema - represents an active authentication session\n *\n * Sessions are stored in the database and include metadata about\n * the device and location for security purposes.\n */\nexport const SessionSchema = z.object({\n    id: z.string(),\n    userId: z.string(),\n    expiresAt: z.coerce.date(),\n    createdAt: z.coerce.date(),\n    updatedAt: z.coerce.date(),\n    // Better Auth session metadata\n    userAgent: z.string().nullable().optional(),\n    ipAddress: z.string().nullable().optional(),\n});\n/**\n * Combined session + user for convenience\n *\n * This is the most common data structure used in the frontend,\n * representing a fully authenticated state with both session and user data.\n *\n * @example\n * ```typescript\n * const session = await getSession();\n * if (session) {\n *   console.log(session.user.email); // Access user data\n *   console.log(session.session.expiresAt); // Access session data\n * }\n * ```\n */\nexport const SessionWithUserSchema = z.object({\n    session: SessionSchema,\n    user: AuthUserSchema,\n});\n/**\n * Authentication state for UI components\n *\n * Discriminated union representing the three possible auth states:\n * - authenticated: User is logged in with valid session\n * - unauthenticated: No valid session exists\n * - loading: Session check in progress\n *\n * @example\n * ```typescript\n * function MyComponent() {\n *   const { state } = useAuth();\n *\n *   if (state.status === 'loading') {\n *     return <Spinner />;\n *   }\n *\n *   if (state.status === 'unauthenticated') {\n *     return <LoginPrompt />;\n *   }\n *\n *   // TypeScript knows state.user exists here\n *   return <div>Welcome, {state.user.name}</div>;\n * }\n * ```\n */\nexport const AuthStateSchema = z.discriminatedUnion(\"status\", [\n    z.object({\n        status: z.literal(\"authenticated\"),\n        user: AuthUserSchema,\n        session: SessionSchema,\n    }),\n    z.object({\n        status: z.literal(\"unauthenticated\"),\n    }),\n    z.object({\n        status: z.literal(\"loading\"),\n    }),\n]);\n/**\n * Type guards for auth state\n */\nexport function isAuthenticated(state) {\n    return state.status === \"authenticated\";\n}\nexport function isUnauthenticated(state) {\n    return state.status === \"unauthenticated\";\n}\nexport function isLoading(state) {\n    return state.status === \"loading\";\n}\n","// ESM imports fixed for Node.js v22+\n/**\n * Authentication API Contracts\n *\n * Request and response schemas for all authentication endpoints.\n * These schemas ensure type safety and runtime validation across\n * the frontend/backend boundary.\n */\nimport { z } from \"zod\";\nimport { AuthErrorSchema } from \"./errors.js\";\nimport { AuthUserSchema, SessionWithUserSchema } from \"./session.js\";\n/**\n * Password validation schema\n *\n * Enforces security requirements:\n * - Minimum 8 characters\n * - At least one uppercase letter\n * - At least one lowercase letter\n * - At least one number\n */\nexport const PasswordSchema = z\n    .string()\n    .min(8, \"Password must be at least 8 characters\")\n    .regex(/[A-Z]/, \"Password must contain at least one uppercase letter\")\n    .regex(/[a-z]/, \"Password must contain at least one lowercase letter\")\n    .regex(/[0-9]/, \"Password must contain at least one number\");\n/**\n * Email validation schema\n *\n * Validates email format and normalizes to lowercase\n */\nexport const EmailSchema = z.string().email(\"Invalid email address\").toLowerCase().trim();\n/**\n * Sign up request schema\n *\n * @example\n * ```typescript\n * const signupData: SignUpRequest = {\n *   email: 'user@example.com',\n *   password: 'SecurePass123',\n *   name: 'John Doe'\n * };\n * ```\n */\nexport const SignUpRequestSchema = z.object({\n    email: EmailSchema,\n    password: PasswordSchema,\n    name: z.string().min(1, \"Name is required\").max(100, \"Name is too long\").trim(),\n});\n/**\n * Sign up response schema\n *\n * Uses discriminated union for type-safe success/error handling\n *\n * @example\n * ```typescript\n * const response = await signUp(data);\n * if (response.success) {\n *   console.log('User created:', response.user.email);\n * } else {\n *   console.error('Signup failed:', response.error.message);\n * }\n * ```\n */\nexport const SignUpResponseSchema = z.discriminatedUnion(\"success\", [\n    z.object({\n        success: z.literal(true),\n        user: AuthUserSchema,\n    }),\n    z.object({\n        success: z.literal(false),\n        error: AuthErrorSchema,\n    }),\n]);\n/**\n * Sign in request schema\n *\n * Includes optional `rememberMe` field to control session duration:\n * - true (default): 7-day session\n * - false: 24-hour session\n *\n * @example\n * ```typescript\n * const signinData: SignInRequest = {\n *   email: 'user@example.com',\n *   password: 'SecurePass123',\n *   rememberMe: true  // Optional, defaults to false\n * };\n * ```\n */\nexport const SignInRequestSchema = z.object({\n    email: EmailSchema,\n    password: z.string().min(1, \"Password is required\"),\n    rememberMe: z.boolean().optional().default(false),\n});\n/**\n * Sign in response schema\n *\n * Returns user and session information on success\n *\n * @example\n * ```typescript\n * const response = await signIn(data);\n * if (response.success) {\n *   console.log('Logged in:', response.user.email);\n *   console.log('Session expires:', response.session.expiresAt);\n * } else {\n *   console.error('Login failed:', response.error.message);\n * }\n * ```\n */\nexport const SignInResponseSchema = z.discriminatedUnion(\"success\", [\n    z.object({\n        success: z.literal(true),\n        user: AuthUserSchema,\n        session: z.object({\n            id: z.string(),\n            expiresAt: z.coerce.date(),\n        }),\n    }),\n    z.object({\n        success: z.literal(false),\n        error: AuthErrorSchema,\n    }),\n]);\n/**\n * Get session response schema\n *\n * Returns session with user data if authenticated, null otherwise\n *\n * @example\n * ```typescript\n * const session = await getSession();\n * if (session) {\n *   console.log('Authenticated as:', session.user.email);\n * } else {\n *   console.log('Not authenticated');\n * }\n * ```\n */\nexport const GetSessionResponseSchema = z.union([SessionWithUserSchema, z.null()]);\n/**\n * Sign out response schema\n *\n * Simple success/error response for logout operations\n */\nexport const SignOutResponseSchema = z.discriminatedUnion(\"success\", [\n    z.object({\n        success: z.literal(true),\n    }),\n    z.object({\n        success: z.literal(false),\n        error: AuthErrorSchema,\n    }),\n]);\n/**\n * Update user profile request schema\n *\n * All fields are optional - only provided fields will be updated\n *\n * @example\n * ```typescript\n * const updates: UpdateProfileRequest = {\n *   name: 'Jane Doe',\n *   // image not provided, won't be updated\n * };\n * ```\n */\nexport const UpdateProfileRequestSchema = z.object({\n    name: z.string().min(1).max(100).trim().optional(),\n    image: z.string().url().optional(),\n});\n/**\n * Update user profile response schema\n */\nexport const UpdateProfileResponseSchema = z.discriminatedUnion(\"success\", [\n    z.object({\n        success: z.literal(true),\n        user: AuthUserSchema,\n    }),\n    z.object({\n        success: z.literal(false),\n        error: AuthErrorSchema,\n    }),\n]);\n/**\n * Change password request schema\n *\n * Requires current password for security\n */\nexport const ChangePasswordRequestSchema = z.object({\n    currentPassword: z.string().min(1, \"Current password is required\"),\n    newPassword: PasswordSchema,\n});\n/**\n * Change password response schema\n */\nexport const ChangePasswordResponseSchema = z.discriminatedUnion(\"success\", [\n    z.object({\n        success: z.literal(true),\n    }),\n    z.object({\n        success: z.literal(false),\n        error: AuthErrorSchema,\n    }),\n]);\n/**\n * OAuth sign-in request schema\n *\n * Supports GitHub, Google, and other OAuth providers\n */\nexport const OAuthSignInRequestSchema = z.object({\n    provider: z.enum([\"github\", \"google\"]),\n    callbackURL: z.string().url().optional(),\n});\n","/**\n * @snapback/contracts - EventBus Emitter Implementation\n *\n * This file contains the EventBus implementation using EventEmitter2.\n * Consolidated from @snapback/events package.\n */\nimport { randomUUID } from \"node:crypto\";\nimport EventEmitter2 from \"eventemitter2\";\n// Define the event types\nexport var SnapBackEvent;\n(function (SnapBackEvent) {\n    SnapBackEvent[\"SNAPSHOT_CREATED\"] = \"snapshot:created\";\n    SnapBackEvent[\"SNAPSHOT_DELETED\"] = \"snapshot:deleted\";\n    SnapBackEvent[\"SNAPSHOT_RESTORED\"] = \"snapshot:restored\";\n    SnapBackEvent[\"RESTORE_STARTED\"] = \"snapshot:restore_started\";\n    SnapBackEvent[\"PROTECTION_CHANGED\"] = \"protection:changed\";\n    SnapBackEvent[\"FILE_PROTECTED\"] = \"file:protected\";\n    SnapBackEvent[\"FILE_UNPROTECTED\"] = \"file:unprotected\";\n    SnapBackEvent[\"ANALYSIS_REQUESTED\"] = \"analysis:requested\";\n    SnapBackEvent[\"ANALYSIS_COMPLETED\"] = \"analysis:completed\";\n})(SnapBackEvent || (SnapBackEvent = {}));\n// QoS levels for event delivery guarantees\nexport var QoSLevel;\n(function (QoSLevel) {\n    QoSLevel[QoSLevel[\"BEST_EFFORT\"] = 0] = \"BEST_EFFORT\";\n    QoSLevel[QoSLevel[\"AT_LEAST_ONCE\"] = 1] = \"AT_LEAST_ONCE\";\n    QoSLevel[QoSLevel[\"EXACTLY_ONCE\"] = 2] = \"EXACTLY_ONCE\";\n})(QoSLevel || (QoSLevel = {}));\n// Check if running in MCP quiet mode (suppress all non-error output for MCP stdio)\nconst MCP_QUIET = process.env.MCP_QUIET === \"1\" || process.env.MCP_QUIET === \"true\";\n// Simple logger implementation - uses stderr to avoid polluting stdout (important for MCP stdio transport)\n// When MCP_QUIET=1, only errors are logged to avoid corrupting MCP protocol\nconst logger = {\n    info: MCP_QUIET ? () => { } : console.error,\n    warn: MCP_QUIET ? () => { } : console.error,\n    error: console.error,\n    debug: MCP_QUIET ? () => { } : console.error,\n};\n// Simple in-memory storage for events (replaces the persistence manager)\nclass InMemoryEventStorage {\n    events = new Map();\n    async storeEvent(event) {\n        this.events.set(event.id, event);\n    }\n    async getEvent(eventId) {\n        return this.events.get(eventId) || null;\n    }\n    async listEvents(filters) {\n        let events = Array.from(this.events.values());\n        // Apply filters\n        if (filters?.type) {\n            events = events.filter((event) => event.type === filters.type);\n        }\n        if (filters?.qosLevel !== undefined) {\n            events = events.filter((event) => event.qosLevel === filters.qosLevel);\n        }\n        if (filters?.status) {\n            events = events.filter((event) => event.status === filters.status);\n        }\n        // Apply limit and offset\n        if (filters?.offset) {\n            events = events.slice(filters.offset);\n        }\n        if (filters?.limit) {\n            events = events.slice(0, filters.limit);\n        }\n        return events;\n    }\n    async updateEventStatus(eventId, status) {\n        const event = this.events.get(eventId);\n        if (event) {\n            event.status = status;\n            this.events.set(eventId, event);\n        }\n    }\n    close() {\n        this.events.clear();\n    }\n}\nexport class SnapBackEventBusEventEmitter2 {\n    emitter;\n    storage;\n    requestHandlers = new Map();\n    pendingRequests = new Map();\n    constructor() {\n        // Initialize with wildcard support to match the old EventBus functionality\n        this.emitter = new EventEmitter2({\n            wildcard: true,\n            delimiter: \":\",\n            newListener: false,\n            removeListener: false,\n        });\n        // Initialize in-memory storage\n        this.storage = new InMemoryEventStorage();\n    }\n    async initialize() {\n        // No initialization needed for EventEmitter2\n        logger.info(\"EventEmitter2 EventBus initialized\");\n    }\n    // EventEmitter2 methods\n    on(event, listener) {\n        this.emitter.on(event, listener);\n        return this;\n    }\n    once(event, listener) {\n        this.emitter.once(event, listener);\n        return this;\n    }\n    off(event, listener) {\n        this.emitter.off(event, listener);\n        return this;\n    }\n    emit(event, ...values) {\n        return this.emitter.emit(event, ...values);\n    }\n    // Request/response pattern\n    onRequest(event, handler) {\n        this.requestHandlers.set(event, handler);\n    }\n    async request(event, data, timeoutMs = 5000) {\n        return new Promise((resolve, reject) => {\n            const id = `${Date.now()}-${Math.random()}`;\n            const timeout = setTimeout(() => {\n                this.pendingRequests.delete(id);\n                reject(new Error(`Request timeout: ${event}`));\n            }, timeoutMs);\n            this.pendingRequests.set(id, { resolve: resolve, reject, timeout });\n            // In a real implementation, we would need to handle the request/response\n            // For now, we'll just resolve with a mock response\n            const handler = this.requestHandlers.get(event);\n            if (handler) {\n                handler(data).then((result) => {\n                    clearTimeout(timeout);\n                    this.pendingRequests.delete(id);\n                    resolve(result);\n                }, (error) => {\n                    clearTimeout(timeout);\n                    this.pendingRequests.delete(id);\n                    reject(error instanceof Error ? error : new Error(String(error)));\n                });\n            }\n            else {\n                clearTimeout(timeout);\n                this.pendingRequests.delete(id);\n                reject(new Error(`No handler for request: ${event}`));\n            }\n        });\n    }\n    /**\n     * Publish an event with QoS guarantees\n     * @param eventType The type of event to publish\n     * @param payload The event payload\n     * @param qosLevel The QoS level for this event\n     * @param correlationId Optional correlation ID for related events\n     */\n    async publishQoS(eventType, payload, qosLevel = QoSLevel.BEST_EFFORT, correlationId) {\n        const eventId = randomUUID();\n        const timestamp = Date.now();\n        // Create enhanced event with QoS support\n        const event = {\n            id: eventId,\n            type: eventType,\n            payload,\n            timestamp,\n            qosLevel,\n            correlationId,\n            retries: 0,\n            status: \"pending\",\n        };\n        // Store event if QoS level requires it\n        if (qosLevel > QoSLevel.BEST_EFFORT) {\n            try {\n                await this.storage.storeEvent(event);\n            }\n            catch (error) {\n                logger.error(\"Failed to store event\", error);\n            }\n        }\n        // Emit the event\n        this.emitter.emit(eventType, payload);\n        // For AT_LEAST_ONCE and EXACTLY_ONCE, update status to processed\n        if (qosLevel >= QoSLevel.AT_LEAST_ONCE) {\n            try {\n                await this.storage.updateEventStatus(eventId, \"processed\");\n            }\n            catch (error) {\n                logger.error(\"Failed to update event status\", error);\n            }\n            // Return event ID for tracking\n            return eventId;\n        }\n    }\n    publish(eventType, payload) {\n        // Emit the event\n        this.emitter.emit(eventType, payload);\n    }\n    close() {\n        // Cancel all pending requests\n        for (const [_id, pending] of this.pendingRequests) {\n            clearTimeout(pending.timeout);\n            pending.reject(new Error(\"EventBus closed\"));\n        }\n        this.pendingRequests.clear();\n        // Close storage\n        this.storage.close();\n        // Remove all listeners\n        this.emitter.removeAllListeners();\n    }\n    /**\n     * Replay events within a time range\n     */\n    async replayEvents(startTime, endTime, eventType) {\n        try {\n            const events = await this.storage.listEvents({\n                type: eventType,\n            });\n            // Filter events by time range\n            const filteredEvents = events.filter((event) => event.timestamp >= startTime && event.timestamp <= endTime);\n            // Replay events in order\n            for (const event of filteredEvents) {\n                this.emitter.emit(event.type, event.payload);\n            }\n        }\n        catch (error) {\n            logger.error(\"Failed to replay events\", error);\n            throw error;\n        }\n    }\n    /**\n     * Get event by ID\n     */\n    async getEvent(eventId) {\n        return this.storage.getEvent(eventId);\n    }\n    /**\n     * List events with filters\n     */\n    async listEvents(filters) {\n        return this.storage.listEvents(filters);\n    }\n}\n// Alias for backward compatibility\nexport { SnapBackEventBusEventEmitter2 as SnapBackEventBus };\n","/**\n * Analysis Types\n *\n * Common type definitions for code analysis across SnapBack packages.\n * Used by @snapback/core, @snapback/intelligence, and other analysis tools.\n *\n * @module types/analysis\n */\nimport { z } from \"zod\";\n/**\n * Issue severity levels (comprehensive) - Zod schema\n * - critical: Security vulnerabilities, data loss risks\n * - high: Significant bugs, performance issues\n * - medium: Code quality issues, potential bugs\n * - low: Minor issues, style violations\n * - info: Informational messages, suggestions\n */\nexport const SeveritySchema = z.enum([\"critical\", \"high\", \"medium\", \"low\", \"info\"]);\n/**\n * Risk/Urgency severity (4-level, action-oriented) - Zod schema\n * Used for risk scores, urgency levels, and event severity where \"info\" doesn't apply.\n * Order: critical > high > medium > low\n */\nexport const RiskSeveritySchema = z.enum([\"critical\", \"high\", \"medium\", \"low\"]);\n/**\n * Simplified severity for validation contexts - Zod schema\n * Maps to Severity: critical->critical, warning->medium, info->info\n */\nexport const ValidationSeveritySchema = z.enum([\"critical\", \"warning\", \"info\"]);\n/**\n * Convert ValidationSeverity to Severity\n */\nexport function toSeverity(validationSeverity) {\n    switch (validationSeverity) {\n        case \"critical\":\n            return \"critical\";\n        case \"warning\":\n            return \"medium\";\n        case \"info\":\n            return \"info\";\n    }\n}\n/**\n * Convert Severity to ValidationSeverity\n */\nexport function toValidationSeverity(severity) {\n    switch (severity) {\n        case \"critical\":\n        case \"high\":\n            return \"critical\";\n        case \"medium\":\n        case \"low\":\n            return \"warning\";\n        case \"info\":\n            return \"info\";\n    }\n}\n/**\n * Base issue schema for all analysis/validation contexts\n */\nexport const BaseIssueSchema = z.object({\n    /** Severity level */\n    severity: z.union([SeveritySchema, ValidationSeveritySchema]),\n    /** Issue type code (e.g., UNSAFE_EVAL, PATH_TRAVERSAL) */\n    type: z.string(),\n    /** Human-readable message */\n    message: z.string(),\n    /** Line number (1-indexed) */\n    line: z.number().optional(),\n    /** Suggested fix */\n    fix: z.string().optional(),\n});\n/**\n * Issue detected during validation (simple form) - Zod schema\n * Used by intelligence package validation layers\n */\nexport const ValidationIssueSchema = BaseIssueSchema.extend({\n    severity: ValidationSeveritySchema,\n});\n/**\n * Issue detected during analysis (detailed form) - Zod schema\n * Used by core package analyzers\n */\nexport const AnalysisIssueSchema = BaseIssueSchema.extend({\n    /** Unique identifier for deduplication: analyzer/type/file/line */\n    id: z.string(),\n    /** Severity level */\n    severity: SeveritySchema,\n    /** File path where issue was found */\n    file: z.string().optional(),\n    /** Column number (1-indexed) */\n    column: z.number().optional(),\n    /** Code snippet showing the issue */\n    snippet: z.string().optional(),\n    /** Rule ID if from a lint tool */\n    rule: z.string().optional(),\n});\n/**\n * Basic validation result - Zod schema\n */\nexport const ValidationResultSchema = z.object({\n    /** Whether validation passed */\n    passed: z.boolean(),\n    /** Issues found */\n    issues: z.array(BaseIssueSchema),\n    /** Duration in milliseconds */\n    duration: z.number().optional(),\n});\n/**\n * Circuit breaker state enum - Zod schema\n */\nexport const CircuitBreakerStateEnumSchema = z.enum([\"closed\", \"open\", \"half-open\"]);\n/**\n * Circuit breaker state - Zod schema\n * Used for resilience patterns across packages\n */\nexport const CircuitBreakerStateSchema = z.object({\n    /** Current state */\n    state: CircuitBreakerStateEnumSchema,\n    /** Failure count */\n    failures: z.number(),\n    /** Failure threshold */\n    threshold: z.number(),\n    /** Last failure timestamp */\n    lastFailure: z.number().optional(),\n    /** Cooldown period in ms */\n    cooldownMs: z.number(),\n});\n","// Extend Zod with OpenAPI functionality\nimport { extendZodWithOpenApi } from \"@asteasolutions/zod-to-openapi\";\nimport { z } from \"zod\";\nimport { RiskSeveritySchema } from \"../types/analysis.js\";\nextendZodWithOpenApi(z);\n// Event version constant\nexport const EVENT_VERSION = \"1.0.0\";\n// Base event schema with version\nexport const BaseEventSchema = z.object({\n    event_version: z.string().default(EVENT_VERSION).openapi({ example: \"1.0.0\" }),\n    timestamp: z\n        .number()\n        .default(() => Date.now())\n        .openapi({ example: 1620000000000 }),\n});\n// 1. save_attempt event\nexport const SaveAttemptSchema = BaseEventSchema.extend({\n    event: z.literal(\"save_attempt\"),\n    properties: z.object({\n        protection: z.enum([\"watch\", \"warn\", \"block\"]).openapi({ description: \"Protection level applied to the file\" }),\n        severity: z\n            .enum([\"low\", \"medium\", \"high\", \"critical\"])\n            .openapi({ description: \"Severity of the risk detected\" }),\n        file_kind: z.string().openapi({ description: \"Type of file being protected\", example: \"typescript\" }),\n        reason: z.string().openapi({\n            description: \"Reason for the save attempt\",\n            example: \"User tried to save a file with a secret\",\n        }),\n        ai_present: z.boolean().openapi({ description: \"Whether AI was involved in the decision\" }),\n        ai_burst: z.boolean().openapi({ description: \"Whether this was part of an AI burst operation\" }),\n        outcome: z.enum([\"saved\", \"canceled\", \"blocked\"]).openapi({ description: \"Outcome of the save attempt\" }),\n    }),\n}).openapi(\"SaveAttemptEvent\");\n// 2. snapshot_created event\nexport const SnapshotCreatedSchema = BaseEventSchema.extend({\n    event: z.literal(\"snapshot_created\"),\n    properties: z.object({\n        session_id: z.string().openapi({ description: \"Unique identifier for the session\", example: \"sess_12345\" }),\n        snapshot_id: z.string().openapi({ description: \"Unique identifier for the snapshot\", example: \"snap_67890\" }),\n        bytes_original: z.number().openapi({ description: \"Original size of the file in bytes\", example: 1024 }),\n        bytes_stored: z.number().openapi({ description: \"Size of the stored snapshot in bytes\", example: 512 }),\n        dedup_hit: z.boolean().openapi({ description: \"Whether deduplication was applied\" }),\n        latency_ms: z\n            .number()\n            .openapi({ description: \"Time taken to create the snapshot in milliseconds\", example: 45 }),\n    }),\n}).openapi(\"SnapshotCreatedEvent\");\n// 3. session_finalized event\nexport const SessionFinalizedSchema = BaseEventSchema.extend({\n    event: z.literal(\"session_finalized\"),\n    properties: z.object({\n        session_id: z.string().openapi({ description: \"Unique identifier for the session\", example: \"sess_12345\" }),\n        files: z\n            .array(z.string())\n            .openapi({ description: \"List of files in the session\", example: [\"src/index.ts\", \"package.json\"] }),\n        triggers: z.array(z.string()).openapi({\n            description: \"List of triggers that activated during the session\",\n            example: [\"save_attempt\", \"risk_detected\"],\n        }),\n        duration_ms: z.number().openapi({ description: \"Duration of the session in milliseconds\", example: 120000 }),\n        ai_present: z.boolean().openapi({ description: \"Whether AI was involved in the session\" }),\n        ai_burst: z.boolean().openapi({ description: \"Whether this was part of an AI burst operation\" }),\n        highest_severity: z\n            .enum([\"info\", \"low\", \"medium\", \"high\", \"critical\"])\n            .openapi({ description: \"Highest severity of issues in the session\" }),\n        // AI detection v1 fields\n        ai_assist_level: z\n            .enum([\"none\", \"light\", \"medium\", \"heavy\", \"unknown\"])\n            .optional()\n            .openapi({ description: \"AI assistance level inferred from change patterns\", example: \"medium\" }),\n        ai_confidence_score: z\n            .number()\n            .min(0)\n            .max(10)\n            .optional()\n            .openapi({ description: \"Confidence score for AI detection (0-10)\", example: 7.5 }),\n        ai_provider: z\n            .enum([\"cursor\", \"claude\", \"unknown\", \"none\"])\n            .optional()\n            .openapi({ description: \"Detected AI tool/provider\", example: \"cursor\" }),\n        ai_large_insert_count: z\n            .number()\n            .int()\n            .min(0)\n            .optional()\n            .openapi({ description: \"Count of large insertions detected\", example: 5 }),\n        ai_total_chars: z\n            .number()\n            .int()\n            .min(0)\n            .optional()\n            .openapi({ description: \"Total characters in large insertions\", example: 2000 }),\n        context: z\n            .record(z.string(), z.any())\n            .optional()\n            .openapi({ description: \"Additional context for the session\" }),\n    }),\n}).openapi(\"SessionFinalizedEvent\");\n// 4. issue_created event\nexport const IssueCreatedSchema = BaseEventSchema.extend({\n    event: z.literal(\"issue_created\"),\n    properties: z.object({\n        issue_id: z.string().openapi({ description: \"Unique identifier for the issue\", example: \"issue_12345\" }),\n        session_id: z.string().openapi({ description: \"Unique identifier for the session\", example: \"sess_12345\" }),\n        file_kind: z\n            .string()\n            .openapi({ description: \"Type of file where the issue was detected\", example: \"typescript\" }),\n        type: z.enum([\"secret\", \"mock\", \"phantom\"]).openapi({ description: \"Type of issue detected\" }),\n        severity: RiskSeveritySchema.openapi({ description: \"Severity of the issue\" }),\n        recommendation: z.string().openapi({\n            description: \"Recommendation for resolving the issue\",\n            example: \"Remove the secret from the file\",\n        }),\n        context: z.record(z.string(), z.any()).optional().openapi({ description: \"Additional context for the issue\" }),\n    }),\n}).openapi(\"IssueCreatedEvent\");\n// 5. issue_resolved event\nexport const IssueResolvedSchema = BaseEventSchema.extend({\n    event: z.literal(\"issue_resolved\"),\n    properties: z.object({\n        issue_id: z.string().openapi({ description: \"Unique identifier for the issue\", example: \"issue_12345\" }),\n        resolution: z.enum([\"fixed\", \"ignored\", \"allowlisted\"]).openapi({ description: \"How the issue was resolved\" }),\n    }),\n}).openapi(\"IssueResolvedEvent\");\n// 6. session_restored event\nexport const SessionRestoredSchema = BaseEventSchema.extend({\n    event: z.literal(\"session_restored\"),\n    properties: z.object({\n        session_id: z.string().openapi({ description: \"Unique identifier for the session\", example: \"sess_12345\" }),\n        files_restored: z\n            .array(z.string())\n            .openapi({ description: \"List of files that were restored\", example: [\"src/index.ts\", \"package.json\"] }),\n        time_to_restore_ms: z\n            .number()\n            .openapi({ description: \"Time taken to restore the session in milliseconds\", example: 2500 }),\n        reason: z\n            .string()\n            .openapi({ description: \"Reason for the session restoration\", example: \"User requested rollback\" }),\n    }),\n}).openapi(\"SessionRestoredEvent\");\n// 7. policy_changed event\nexport const PolicyChangedSchema = BaseEventSchema.extend({\n    event: z.literal(\"policy_changed\"),\n    properties: z.object({\n        pattern: z.string().openapi({ description: \"File pattern that the policy applies to\", example: \"*.env\" }),\n        from: z\n            .enum([\"watch\", \"warn\", \"block\", \"unprotected\", \"unauthenticated\", \"unaware\"])\n            .openapi({ description: \"Previous protection level\" }),\n        to: z\n            .enum([\"watch\", \"warn\", \"block\", \"unprotected\", \"authenticated\", \"aware\"])\n            .openapi({ description: \"New protection level\" }),\n        source: z.string().openapi({ description: \"Source of the policy change\", example: \"cli\" }),\n        context: z\n            .record(z.string(), z.any())\n            .optional()\n            .openapi({ description: \"Additional context for the policy change\" }),\n    }),\n}).openapi(\"PolicyChangedEvent\");\n// ============================================================================\n// DIAGNOSTIC TELEMETRY EVENTS (Auth Flow & Welcome Panel Instrumentation)\n// ============================================================================\n// 8. auth.provider.selected event - Track OAuth vs Device flow choice\nexport const AuthProviderSelectedSchema = BaseEventSchema.extend({\n    event: z.literal(\"auth.provider.selected\"),\n    properties: z.object({\n        provider: z.enum([\"oauth\", \"device_flow\"]).openapi({ description: \"Authentication provider selected\" }),\n        trigger: z\n            .enum([\"user_selected\", \"fallback\", \"auto\"])\n            .openapi({ description: \"How the provider was selected\" }),\n    }),\n}).openapi(\"AuthProviderSelectedEvent\");\n// 9. auth.browser.opened event - Track browser launch success\nexport const AuthBrowserOpenedSchema = BaseEventSchema.extend({\n    event: z.literal(\"auth.browser.opened\"),\n    properties: z.object({\n        method: z\n            .enum([\"external_command\", \"clipboard\", \"error\"])\n            .openapi({ description: \"Method used to open browser\" }),\n        success: z.boolean().openapi({ description: \"Whether browser was successfully opened\" }),\n        error: z.string().optional().openapi({ description: \"Error message if browser opening failed\" }),\n    }),\n}).openapi(\"AuthBrowserOpenedEvent\");\n// 10. auth.code.entry event - Track device code entry in browser\nexport const AuthCodeEntrySchema = BaseEventSchema.extend({\n    event: z.literal(\"auth.code.entry\"),\n    properties: z.object({\n        code_format: z\n            .enum([\"valid\", \"invalid_chars\", \"wrong_length\"])\n            .openapi({ description: \"Validity of the entered code format\" }),\n        time_to_enter_ms: z.number().openapi({ description: \"Time taken to enter the code in milliseconds\" }),\n        attempts: z.number().int().min(1).openapi({ description: \"Number of attempts to enter the code correctly\" }),\n        code_length: z.number().int().optional().openapi({ description: \"Length of the entered code\" }),\n    }),\n}).openapi(\"AuthCodeEntryEvent\");\n// 11. auth.approval.received event - Track successful device code approval\nexport const AuthApprovalReceivedSchema = BaseEventSchema.extend({\n    event: z.literal(\"auth.approval.received\"),\n    properties: z.object({\n        polling_attempts: z\n            .number()\n            .int()\n            .min(1)\n            .openapi({ description: \"Number of polling attempts before approval\" }),\n        total_wait_ms: z.number().openapi({ description: \"Total time waited for approval in milliseconds\" }),\n        device_code_expired: z.boolean().openapi({ description: \"Whether the device code had expired\" }),\n    }),\n}).openapi(\"AuthApprovalReceivedEvent\");\n// 12. welcome.feature.viewed event - Track feature discovery in welcome panel\nexport const WelcomeFeatureViewedSchema = BaseEventSchema.extend({\n    event: z.literal(\"welcome.feature.viewed\"),\n    properties: z.object({\n        feature: z.string().openapi({ description: \"Feature name shown in welcome panel\", example: \"ai_detection\" }),\n        position: z.number().int().min(0).openapi({ description: \"Position in feature carousel\", example: 0 }),\n        trigger: z\n            .enum([\"onboarding\", \"nudge\", \"manual\"])\n            .openapi({ description: \"How the welcome panel was triggered\" }),\n    }),\n}).openapi(\"WelcomeFeatureViewedEvent\");\n// 13. welcome.action.triggered event - Track feature adoption from welcome panel\nexport const WelcomeActionTriggeredSchema = BaseEventSchema.extend({\n    event: z.literal(\"welcome.action.triggered\"),\n    properties: z.object({\n        action: z.string().openapi({ description: \"Action triggered by user\", example: \"try_now\" }),\n        feature: z.string().openapi({ description: \"Feature associated with the action\", example: \"ai_detection\" }),\n        time_viewed_ms: z\n            .number()\n            .openapi({ description: \"How long the feature was viewed before action\", example: 2500 }),\n    }),\n}).openapi(\"WelcomeActionTriggeredEvent\");\n// Zod schema for validating any core event (including diagnostic events)\nexport const CoreEventSchema = z.discriminatedUnion(\"event\", [\n    SaveAttemptSchema,\n    SnapshotCreatedSchema,\n    SessionFinalizedSchema,\n    IssueCreatedSchema,\n    IssueResolvedSchema,\n    SessionRestoredSchema,\n    PolicyChangedSchema,\n    AuthProviderSelectedSchema,\n    AuthBrowserOpenedSchema,\n    AuthCodeEntrySchema,\n    AuthApprovalReceivedSchema,\n    WelcomeFeatureViewedSchema,\n    WelcomeActionTriggeredSchema,\n]);\n// Event name enum for compile-time checking (including diagnostic events)\nexport const CORE_TELEMETRY_EVENTS = {\n    // Core events (7)\n    SAVE_ATTEMPT: \"save_attempt\",\n    SNAPSHOT_CREATED: \"snapshot_created\",\n    SESSION_FINALIZED: \"session_finalized\",\n    ISSUE_CREATED: \"issue_created\",\n    ISSUE_RESOLVED: \"issue_resolved\",\n    SESSION_RESTORED: \"session_restored\",\n    POLICY_CHANGED: \"policy_changed\",\n    // Diagnostic events (6)\n    AUTH_PROVIDER_SELECTED: \"auth.provider.selected\",\n    AUTH_BROWSER_OPENED: \"auth.browser.opened\",\n    AUTH_CODE_ENTRY: \"auth.code.entry\",\n    AUTH_APPROVAL_RECEIVED: \"auth.approval.received\",\n    WELCOME_FEATURE_VIEWED: \"welcome.feature.viewed\",\n    WELCOME_ACTION_TRIGGERED: \"welcome.action.triggered\",\n};\n// Helper function to validate core telemetry events\nexport function validateCoreTelemetryEvent(event) {\n    const result = CoreEventSchema.safeParse(event);\n    return result.success;\n}\n// Helper function to get validation errors\nexport function getCoreEventValidationError(event) {\n    const result = CoreEventSchema.safeParse(event);\n    if (result.success) {\n        return null;\n    }\n    return result.error.message;\n}\n","// ESM imports fixed for Node.js v22+\n/**\n * Accountability Effect Event Schema\n *\n * Tracks user perception vs reality of SnapBack's value in a session.\n * Used for session feedback implementation to measure accountability.\n *\n * Privacy guarantees (per ARCHITECTURE.md):\n * -  No file paths\n * -  No path hashes\n * -  No workspace identifiers\n * -  Counts only (files_modified, lines_added, etc.)\n * -  Durations (session_duration_ms)\n * -  Enums (perceived_help, tier)\n *\n * @module events/accountability\n */\nimport { extendZodWithOpenApi } from \"@asteasolutions/zod-to-openapi\";\nimport { z } from \"zod\";\nimport { BaseEventSchema } from \"./core.js\";\nextendZodWithOpenApi(z);\n// ============================================================================\n// Accountability Effect Event\n// ============================================================================\n/**\n * Schema for tracking user's perception of how much SnapBack helped\n */\nexport const PerceivedHelpSchema = z\n    .enum([\"significantly\", \"somewhat\", \"not_really\", \"blocked\"])\n    .openapi({ description: \"User's perception of how much SnapBack helped\" });\n/**\n * Type guard for PerceivedHelp values\n */\nexport function isPerceivedHelp(value) {\n    return PerceivedHelpSchema.safeParse(value).success;\n}\n/**\n * Schema for actual changes made during the session (counts only, no paths)\n */\nconst ActualChangesSchema = z\n    .object({\n    files_modified: z\n        .number()\n        .int()\n        .min(0)\n        .openapi({ description: \"Number of files modified during session\", example: 5 }),\n    lines_added: z.number().int().min(0).openapi({ description: \"Total lines added\", example: 150 }),\n    lines_removed: z.number().int().min(0).openapi({ description: \"Total lines removed\", example: 30 }),\n    snapshots_used: z\n        .number()\n        .int()\n        .min(0)\n        .openapi({ description: \"Number of snapshots created or restored\", example: 2 }),\n})\n    .openapi(\"ActualChanges\");\n/**\n * Schema for issues prevented by SnapBack during the session\n */\nconst PreventedIssuesSchema = z\n    .object({\n    rollbacks_avoided: z\n        .number()\n        .int()\n        .min(0)\n        .openapi({ description: \"Rollbacks avoided due to snapshots\", example: 1 }),\n    pattern_violations_caught: z\n        .number()\n        .int()\n        .min(0)\n        .openapi({ description: \"Pattern violations caught before commit\", example: 3 }),\n    skipped_tests_flagged: z\n        .number()\n        .int()\n        .min(0)\n        .openapi({ description: \"Skipped tests flagged for attention\", example: 2 }),\n})\n    .openapi(\"PreventedIssues\");\n/**\n * Schema for user tier\n */\nconst TierSchema = z.enum([\"free\", \"solo\", \"team\", \"enterprise\"]).openapi({ description: \"User's subscription tier\" });\n/**\n * Accountability Effect Event Schema\n *\n * Tracks the perception vs reality of SnapBack's value in a session.\n * Follows BaseEventSchema pattern from core.ts for consistency.\n */\nexport const AccountabilityEffectSchema = BaseEventSchema.extend({\n    event: z.literal(\"session:feedback_submitted\"),\n    properties: z.object({\n        // Session identification\n        session_id: z.string().openapi({ description: \"Unique session identifier\", example: \"sess_12345\" }),\n        session_duration_ms: z\n            .number()\n            .int()\n            .min(0)\n            .openapi({ description: \"Session duration in milliseconds\", example: 3600000 }),\n        // User perception\n        perceived_help: PerceivedHelpSchema,\n        // Reality metrics (counts only, no PII)\n        actual_changes: ActualChangesSchema,\n        prevented_issues: PreventedIssuesSchema,\n        // Tier for consent checking\n        tier: TierSchema,\n    }),\n}).openapi(\"AccountabilityEffectEvent\");\n// ============================================================================\n// Validation Helpers\n// ============================================================================\n/**\n * Validate an accountability effect event\n */\nexport function validateAccountabilityEvent(event) {\n    const result = AccountabilityEffectSchema.safeParse(event);\n    return result.success;\n}\n/**\n * Get validation error for an accountability event\n */\nexport function getAccountabilityEventValidationError(event) {\n    const result = AccountabilityEffectSchema.safeParse(event);\n    if (result.success) {\n        return null;\n    }\n    return result.error.message;\n}\n// ============================================================================\n// Event Constants\n// ============================================================================\n/**\n * Accountability event name constants\n * Uses PostHog category:object_action naming convention\n */\nexport const ACCOUNTABILITY_EVENTS = {\n    SESSION_FEEDBACK_SUBMITTED: \"session:feedback_submitted\",\n};\n","/**\n * Minimal logging interface for public packages\n *\n * This interface allows public packages (@snapback/sdk, @snapback/core, @snapback/mcp-server)\n * to log without depending on the private @snapback/infrastructure package.\n *\n * Browser-safe: No dynamic requires, no node:fs dependencies\n * Server packages can enhance this with infrastructure logger via DI using registerLoggerFactory()\n *\n * Private packages can use the full @snapback/infrastructure implementation,\n * which provides advanced features like structured logging, log levels, etc.\n */\n// Global logger factory registry for server-side enhancement\nlet _loggerFactory = null;\n/**\n * Register an enhanced logger factory (called by server packages)\n * This allows @snapback/infrastructure to enhance logging without\n * being a compile-time dependency.\n *\n * @example\n * ```typescript\n * // In @snapback/infrastructure/src/index.ts\n * import { registerLoggerFactory } from '@snapback/contracts'\n * registerLoggerFactory((options) => createPinoLogger(options))\n * ```\n */\nexport function registerLoggerFactory(factory) {\n    _loggerFactory = factory;\n}\n/**\n * Get the registered logger factory, if any\n * @internal\n */\nfunction getLoggerFactory() {\n    return _loggerFactory;\n}\n/**\n * Log levels\n */\nexport var LogLevel;\n(function (LogLevel) {\n    LogLevel[LogLevel[\"DEBUG\"] = 0] = \"DEBUG\";\n    LogLevel[LogLevel[\"INFO\"] = 1] = \"INFO\";\n    LogLevel[LogLevel[\"WARN\"] = 2] = \"WARN\";\n    LogLevel[LogLevel[\"ERROR\"] = 3] = \"ERROR\";\n    LogLevel[LogLevel[\"SILENT\"] = 4] = \"SILENT\";\n})(LogLevel || (LogLevel = {}));\n/**\n * Enhanced logger that uses registered factory when available,\n * otherwise falls back to minimal console-based implementation\n *\n * @example\n * ```typescript\n * import { createLogger } from '@snapback/contracts'\n *\n * const logger = createLogger({ name: 'sdk' })\n * logger.info('SDK initialized')\n * logger.error('Failed to create snapshot', { error: err })\n * ```\n */\nexport function createLogger(options) {\n    // If a logger factory has been registered (by @snapback/infrastructure), use it\n    const factory = getLoggerFactory();\n    if (factory) {\n        return factory(options);\n    }\n    // Fallback to minimal console implementation\n    const { name, level = LogLevel.INFO, timestamps = false } = options;\n    const formatMessage = (levelStr, message) => {\n        const prefix = timestamps ? `[${new Date().toISOString()}] ` : \"\";\n        return `${prefix}[${name}] ${levelStr}: ${message}`;\n    };\n    const formatMeta = (meta) => {\n        if (!meta) {\n            return \"\";\n        }\n        if (meta instanceof Error) {\n            return `\\n  Error: ${meta.message}\\n  Stack: ${meta.stack}`;\n        }\n        try {\n            return `\n  ${JSON.stringify(meta, null, 2)}`;\n        }\n        catch {\n            return \"\\n  [Circular or non-serializable metadata]\";\n        }\n    };\n    return {\n        debug(message, meta) {\n            if (level <= LogLevel.DEBUG) {\n                console.debug(formatMessage(\"DEBUG\", message) + formatMeta(meta));\n            }\n        },\n        info(message, meta) {\n            if (level <= LogLevel.INFO) {\n                console.info(formatMessage(\"INFO\", message) + formatMeta(meta));\n            }\n        },\n        warn(message, meta) {\n            if (level <= LogLevel.WARN) {\n                console.warn(formatMessage(\"WARN\", message) + formatMeta(meta));\n            }\n        },\n        error(message, meta) {\n            if (level <= LogLevel.ERROR) {\n                console.error(formatMessage(\"ERROR\", message) + formatMeta(meta));\n            }\n        },\n    };\n}\n/**\n * No-op logger (silences all logs)\n *\n * Useful for testing or when logs should be completely disabled.\n */\nexport function createSilentLogger() {\n    return {\n        debug: () => { },\n        info: () => { },\n        warn: () => { },\n        error: () => { },\n    };\n}\n","// ESM imports fixed for Node.js v22+\nimport { FEATURE_FLAGS } from \"./index.js\";\nimport { createLogger, LogLevel } from \"./logger.js\";\n// Environment variables should be loaded by the application entry point (e.g. Next.js, or dotenv/config in scripts)\nconst logger = createLogger({ name: \"feature-manager\", level: LogLevel.INFO });\nexport class FeatureManager {\n    static instance;\n    flags = new Map();\n    posthogClient = null;\n    constructor() {\n        // Initialize with default values\n        for (const [key, value] of Object.entries(FEATURE_FLAGS)) {\n            this.flags.set(key, value);\n        }\n        // Override with environment variables\n        this.loadEnvironmentOverrides();\n    }\n    static getInstance() {\n        if (!FeatureManager.instance) {\n            FeatureManager.instance = new FeatureManager();\n        }\n        return FeatureManager.instance;\n    }\n    isEnabled(flag) {\n        const value = this.flags.get(flag) ?? FEATURE_FLAGS[flag];\n        // For sampling rate flags, compare with random value\n        if (flag === \"telemetry.sampling_rate\" && typeof value === \"number\") {\n            return Math.random() < value;\n        }\n        return Boolean(value);\n    }\n    getValue(flag) {\n        return this.flags.get(flag);\n    }\n    setFlag(flag, value) {\n        this.flags.set(flag, value);\n    }\n    /**\n     * Set PostHog client for dynamic feature flag evaluation\n     */\n    setPostHogClient(client) {\n        this.posthogClient = client;\n        if (client) {\n            logger.info(\"PostHog client configured\");\n        }\n        else {\n            logger.info(\"PostHog client cleared, falling back to static config\");\n        }\n    }\n    /**\n     * Asynchronously check if feature is enabled (with PostHog fallback)\n     * @param flag - Feature flag name\n     * @param userId - User ID for targeting rules (optional)\n     * @param context - Additional context for PostHog targeting (optional)\n     * @returns Promise<boolean> - True if feature is enabled\n     */\n    async isEnabledAsync(flag, userId, context) {\n        // If PostHog is configured and we have a userId, try to use it\n        if (this.posthogClient && userId) {\n            try {\n                const defaultSubscriptionTier = process.env.SNAPBACK_DEFAULT_SUBSCRIPTION_TIER || \"free\";\n                const posthogContext = {\n                    subscriptionTier: defaultSubscriptionTier,\n                    ...context,\n                };\n                const result = await this.posthogClient.isFeatureEnabled(flag, userId, posthogContext);\n                // If PostHog returns a value, use it. Otherwise fall back to static config\n                if (result !== null && result !== undefined) {\n                    logger.info(\"Feature flag evaluated via PostHog\", {\n                        flag,\n                        userId,\n                        enabled: result,\n                    });\n                    return result;\n                }\n            }\n            catch (error) {\n                logger.warn(\"PostHog feature flag check failed, falling back to static config\", {\n                    flag,\n                    userId,\n                    error: error instanceof Error ? error.message : String(error),\n                });\n            }\n        }\n        // Fall back to static configuration\n        return this.isEnabled(flag);\n    }\n    loadEnvironmentOverrides() {\n        // Check for environment variable overrides\n        for (const flag of Object.keys(FEATURE_FLAGS)) {\n            const envVar = `SNAPBACK_${flag.replace(/\\./g, \"_\").toUpperCase()}`;\n            const envValue = process.env[envVar];\n            if (envValue !== undefined) {\n                // Parse boolean values\n                if (envValue === \"true\" || envValue === \"false\") {\n                    this.flags.set(flag, envValue === \"true\");\n                }\n                // Parse numeric values\n                else if (!Number.isNaN(Number(envValue))) {\n                    this.flags.set(flag, Number(envValue));\n                }\n                // Keep as string for other values (though we don't expect string flags)\n            }\n        }\n    }\n    reset() {\n        this.flags.clear();\n        this.posthogClient = null;\n        for (const [key, value] of Object.entries(FEATURE_FLAGS)) {\n            this.flags.set(key, value);\n        }\n        this.loadEnvironmentOverrides();\n    }\n}\n","/**\n * Core Observability Types\n *\n * Vendor-neutral abstractions for instrumentation.\n * These types enable swapping implementations (OTel, Datadog, custom)\n * without changing business logic.\n */\n/**\n * Span status codes (aligned with OpenTelemetry)\n * @see https://github.com/open-telemetry/opentelemetry-js/blob/main/api/src/trace/status.ts\n */\nexport var SpanStatusCode;\n(function (SpanStatusCode) {\n    /** The default status */\n    SpanStatusCode[SpanStatusCode[\"UNSET\"] = 0] = \"UNSET\";\n    /** The operation completed successfully */\n    SpanStatusCode[SpanStatusCode[\"OK\"] = 1] = \"OK\";\n    /** The operation contains an error */\n    SpanStatusCode[SpanStatusCode[\"ERROR\"] = 2] = \"ERROR\";\n})(SpanStatusCode || (SpanStatusCode = {}));\n/**\n * Span kinds aligned with OpenTelemetry\n */\nexport var SpanKind;\n(function (SpanKind) {\n    SpanKind[SpanKind[\"INTERNAL\"] = 0] = \"INTERNAL\";\n    SpanKind[SpanKind[\"SERVER\"] = 1] = \"SERVER\";\n    SpanKind[SpanKind[\"CLIENT\"] = 2] = \"CLIENT\";\n    SpanKind[SpanKind[\"PRODUCER\"] = 3] = \"PRODUCER\";\n    SpanKind[SpanKind[\"CONSUMER\"] = 4] = \"CONSUMER\";\n})(SpanKind || (SpanKind = {}));\n","import { z } from \"zod\";\nimport { RiskSeveritySchema } from \"./types/analysis.js\";\nexport const DiffChangeSchema = z.object({\n    added: z.boolean().optional().default(false),\n    removed: z.boolean().optional().default(false),\n    value: z.string(),\n    count: z.number().optional(),\n});\n/**\n * Risk score schema using standardized 0-10 scale\n *\n * This is the canonical risk scoring schema used across all SnapBack components.\n * The 0-10 scale provides:\n * - Intuitive 1-10 rating (familiar to users)\n * - Better granularity than 0-1\n * - More practical than 0-100\n * - Aligns with industry standards (CVE scores use 0-10)\n * - Matches THRESHOLDS configuration (risk.blockingThreshold: 8.0, etc.)\n *\n * Severity mappings:\n * - low: 0 - 2.9\n * - medium: 3.0 - 4.9\n * - high: 5.0 - 6.9\n * - critical: 7.0 - 10.0\n *\n * For backward compatibility with 0-1 scale, use conversion utilities from risk-conversion.ts\n */\nexport const RiskScoreSchema = z.object({\n    score: z.number().min(0).max(10),\n    factors: z.array(z.string()),\n    severity: RiskSeveritySchema,\n});\n// =============================================================================\n// ADR-004: Snapshot types consolidated in types/snapshot.ts\n// The following canonical types are now exported from types/snapshot.ts:\n// - SnapshotSchema, Snapshot, SnapshotInput\n// - FileMetadataSchema, FileMetadata\n// - SnapshotMetadataSchema, SnapshotMetadata\n// Import from @snapback/contracts for these types.\n// =============================================================================\nexport const AnalyticsResponseSchema = z.object({\n    metrics: z.record(z.string(), z.number()),\n    trends: z.record(z.string(), z.array(z.number())),\n    insights: z.array(z.string()),\n    timestamp: z.number(),\n    snapshotRecommendations: z\n        .object({\n        shouldCreateSnapshot: z.boolean(),\n        reason: z.string(),\n        urgency: RiskSeveritySchema,\n        suggestedTiming: z.string(),\n    })\n        .optional(),\n});\nexport const CreateSnapshotArgsSchema = z.object({\n    trigger: z.string().default(\"manual\"),\n    risk: z.number().min(0).max(10).optional(),\n    content: z.string().optional(),\n    files: z.array(z.string()).optional(),\n});\nexport const CreateCheckpointArgsSchema = z.object({\n    trigger: z.string().default(\"manual\"),\n    risk: z.number().min(0).max(10).optional(),\n    content: z.string().optional(),\n});\nexport const CheckpointSchema = z.object({\n    id: z.string(),\n    timestamp: z.number(),\n    meta: z\n        .object({\n        trigger: z.string().optional(),\n        risk: z.number().optional(),\n    })\n        .optional(),\n});\nexport const AnalyzeRiskArgsSchema = z.object({\n    changes: z.array(DiffChangeSchema),\n});\nexport const DepQuickArgsSchema = z.object({\n    before: z.record(z.string(), z.any()),\n    after: z.record(z.string(), z.any()),\n});\nexport const CommonErrorSchema = z.object({\n    message: z.string(),\n    code: z.string().optional(),\n    details: z.any().optional(),\n});\n// MCP Configuration Schemas\nexport const RetrySchema = z.object({\n    retries: z.number().int().min(0).default(2),\n    factor: z.number().min(1).default(2),\n    min: z.number().int().default(250),\n    max: z.number().int().default(1500),\n    jitter: z.boolean().default(true),\n});\nexport const CircuitSchema = z.object({\n    enabled: z.boolean().default(true),\n    errorThresholdPercentage: z.number().int().min(1).max(100).default(50),\n    volumeThreshold: z.number().int().min(1).default(10),\n    timeoutMs: z.number().int().default(5000),\n    resetMs: z.number().int().default(30000),\n    rollingCountMs: z.number().int().default(60000),\n    rollingCountBuckets: z.number().int().default(6),\n});\nexport const McpSchema = z.object({\n    timeoutMs: z.number().int().default(5000),\n    maxConcurrent: z.number().int().min(1).default(4),\n    retry: RetrySchema,\n    circuit: CircuitSchema,\n    batch: z.object({\n        size: z.number().int().min(1).default(5),\n        maxWaitMs: z.number().int().default(150),\n    }),\n});\nexport const WatcherSchema = z.object({\n    debounceMs: z.number().int().default(120),\n    awaitWriteFinish: z.object({\n        stabilityThreshold: z.number().int().default(200),\n        pollInterval: z.number().int().default(50),\n    }),\n    ignored: z.array(z.string()).default([\"**/{node_modules,.git,.vscode,dist,.next,.nuxt,coverage}/**\"]),\n});\n","/**\n * Workspace Resolution Contract (Gap 6 - Moderate Priority)\n *\n * Defines the 5-layer workspace resolution hierarchy for proper\n * metrics isolation across different work contexts.\n *\n * @module workspace-resolution\n */\n/**\n * Helper: Create default workspace binding\n */\nexport function createDefaultWorkspace(userId, repoPath) {\n    return {\n        workspaceId: `ws_default_${userId}`,\n        workspaceName: \"Personal Workspace\",\n        repoPath,\n        userId,\n        permissions: {\n            read: true,\n            write: true,\n            manage: true,\n            invite: false,\n        },\n        resolvedFrom: \"default_workspace\",\n    };\n}\n/**\n * Helper: Check if user has permission\n */\nexport function hasPermission(binding, permission) {\n    return binding.permissions[permission];\n}\n/**\n * Helper: Generate cache key for resolution\n */\nexport function generateCacheKey(repoPath, userId) {\n    return `workspace_resolution:${userId}:${repoPath}`;\n}\n","import { z } from \"zod\";\n/**\n * Session Layer Contracts\n *\n * Sessions are metadata overlays on the snapshot infrastructure that provide:\n * - Contextual grouping of file changes during logical work periods\n * - Selective rollback capabilities for session-scoped changes\n * - Privacy-safe analytics without exposing file contents\n *\n * Design Principles:\n * - Sessions reference Content-Addressable Storage (CAS) blobs via SHA-256 hashes\n * - No duplicate storage - all file content lives in CAS\n * - POSIX path normalization for cross-platform compatibility\n * - Lazy hash computation for <50ms tracking performance\n */\n/**\n * Session schema version for backward compatibility\n */\nexport const SessionSchemaVersion = \"sb.session.v1\";\n/**\n * File change operation types\n */\nexport const ChangeOpSchema = z.enum([\"created\", \"modified\", \"deleted\", \"renamed\"]);\n/**\n * Line ending types for cross-platform consistency\n */\nexport const EOLTypeSchema = z.enum([\"lf\", \"crlf\"]);\n/**\n * Session trigger sources for analytics\n */\nexport const SessionTriggerSchema = z.enum([\"filewatch\", \"pre-commit\", \"manual\", \"idle-finalize\"]);\n/**\n * Individual file change within a session\n *\n * Captures metadata and CAS references for efficient storage.\n * Hashes (hOld/hNew) are computed lazily during session finalization.\n *\n * Path normalization:\n * - Always relative to workspace root\n * - Always POSIX-style (forward slashes) even on Windows\n * - Example: \"src/auth/login.ts\" (not \"src\\\\auth\\\\login.ts\")\n */\nexport const SessionChangeSchema = z.object({\n    /** Relative POSIX path from workspace root */\n    p: z.string(),\n    /** Operation type */\n    op: ChangeOpSchema,\n    /** Prior relative path (for rename operations only) */\n    from: z.string().optional(),\n    /** SHA-256 hash before change (CAS reference) - computed on finalize */\n    hOld: z.string().optional(),\n    /** SHA-256 hash after change (CAS reference) - computed on finalize */\n    hNew: z.string().optional(),\n    /** File size before change (bytes) */\n    sizeBefore: z.number().int().nonnegative().optional(),\n    /** File size after change (bytes) */\n    sizeAfter: z.number().int().nonnegative().optional(),\n    /** Modification time before change (Unix epoch ms) */\n    mtimeBefore: z.number().int().nonnegative().optional(),\n    /** Modification time after change (Unix epoch ms) */\n    mtimeAfter: z.number().int().nonnegative().optional(),\n    /** File permissions before change (Unix mode) */\n    modeBefore: z.number().int().nonnegative().optional(),\n    /** File permissions after change (Unix mode) */\n    modeAfter: z.number().int().nonnegative().optional(),\n    /** Line ending style before change */\n    eolBefore: EOLTypeSchema.optional(),\n    /** Line ending style after change */\n    eolAfter: EOLTypeSchema.optional(),\n});\n/**\n * Complete session manifest with all metadata and changes\n *\n * Sessions track logical work periods and link to snapshots created during\n * that period. The `name` field is generated offline (never transmitted) and\n * used only for UI display.\n *\n * Privacy guarantees:\n * - workspaceUri is stored locally only (never transmitted)\n * - name is generated offline (never transmitted)\n * - Only changeCount and triggers are sent to analytics (no file paths)\n */\nexport const SessionManifestV1Schema = z.object({\n    /** Schema version for backward compatibility */\n    schema: z.literal(SessionSchemaVersion),\n    /** Unique session identifier (CUID) */\n    sessionId: z.string(),\n    /** Session start timestamp (ISO 8601) */\n    startedAt: z.string().datetime(),\n    /** Session end timestamp (ISO 8601) - undefined if active */\n    endedAt: z.string().datetime().optional(),\n    /** VS Code workspace folder URI (multi-root workspace safe) */\n    workspaceUri: z.string(),\n    /** Offline-generated semantic label (never transmitted) */\n    name: z.string().optional(),\n    /** Trigger sources for this session */\n    triggers: z.array(SessionTriggerSchema),\n    /** Total number of file changes in this session */\n    changeCount: z.number().int().nonnegative(),\n    /** Chronological list of file changes */\n    filesChanged: z.array(SessionChangeSchema),\n    /** Array of snapshot IDs created during this session */\n    snapshots: z.array(z.string()).optional(),\n});\n/**\n * Minimal session data for list views\n */\nexport const SessionSummarySchema = z.object({\n    sessionId: z.string(),\n    startedAt: z.string().datetime(),\n    endedAt: z.string().datetime().optional(),\n    name: z.string().optional(),\n    changeCount: z.number().int().nonnegative(),\n    triggers: z.array(SessionTriggerSchema),\n});\n/**\n * Session filters for querying\n */\nexport const SessionFiltersSchema = z.object({\n    /** Only return sessions for this workspace URI */\n    workspaceUri: z.string().optional(),\n    /** Only return active sessions (endedAt is null) */\n    activeOnly: z.boolean().optional(),\n    /** Only return finalized sessions (endedAt is not null) */\n    finalizedOnly: z.boolean().optional(),\n    /** Return sessions that started after this timestamp */\n    after: z.date().optional(),\n    /** Return sessions that started before this timestamp */\n    before: z.date().optional(),\n    /** Maximum number of results */\n    limit: z.number().int().positive().optional(),\n    /** Offset for pagination */\n    offset: z.number().int().nonnegative().optional(),\n});\n/**\n * Session creation options\n */\nexport const CreateSessionOptionsSchema = z.object({\n    /** VS Code workspace folder URI */\n    workspaceUri: z.string(),\n    /** Initial trigger sources */\n    triggers: z.array(SessionTriggerSchema).default([\"filewatch\"]),\n    /** Optional semantic name (generated offline) */\n    name: z.string().optional(),\n});\n/**\n * Session manager configuration\n */\nexport const SessionManagerConfigSchema = z.object({\n    /** VS Code workspace folder URI (multi-root safe) */\n    workspaceUri: z.string(),\n    /** Idle timeout in milliseconds (default: 15 minutes) */\n    idleMs: z\n        .number()\n        .int()\n        .positive()\n        .default(15 * 60_000),\n    /** Batch size for flushing changes to database (default: 50) */\n    flushBatchSize: z.number().int().positive().default(50),\n    /** Flush interval in milliseconds (default: 5 seconds) */\n    flushIntervalMs: z.number().int().positive().default(5000),\n    /** Use VS Code file system watcher (default: true) */\n    useVSCodeWatcher: z.boolean().default(true),\n    /** Patterns to ignore (.snapbackignore) */\n    ignorePatterns: z\n        .array(z.string())\n        .default([\n        \"node_modules/**\",\n        \".next/**\",\n        \"dist/**\",\n        \"build/**\",\n        \"coverage/**\",\n        \".git/**\",\n        \"*.log\",\n        \"*.tmp\",\n        \"*.swp\",\n        \".DS_Store\",\n    ]),\n    /** @enterprise User tier (for analytics) */\n    tier: z.enum([\"free\", \"solo\"]).default(\"free\"),\n    /** @enterprise Analytics consent (Solo tier only) */\n    consent: z.boolean().default(false),\n});\n/**\n * Trigger bitmask encoding for database storage\n *\n * Bit 0 (1): filewatch\n * Bit 1 (2): pre-commit\n * Bit 2 (4): manual\n * Bit 3 (8): idle-finalize\n *\n * Example: bitmask = 5  filewatch (1) + manual (4)\n */\nexport function encodeTriggerBitmask(triggers) {\n    let mask = 0;\n    for (const trigger of triggers) {\n        switch (trigger) {\n            case \"filewatch\":\n                mask |= 1;\n                break;\n            case \"pre-commit\":\n                mask |= 2;\n                break;\n            case \"manual\":\n                mask |= 4;\n                break;\n            case \"idle-finalize\":\n                mask |= 8;\n                break;\n        }\n    }\n    return mask;\n}\n/**\n * Decode trigger bitmask to array of trigger types\n */\nexport function decodeTriggerBitmask(mask) {\n    const triggers = [];\n    if (mask & 1) {\n        triggers.push(\"filewatch\");\n    }\n    if (mask & 2) {\n        triggers.push(\"pre-commit\");\n    }\n    if (mask & 4) {\n        triggers.push(\"manual\");\n    }\n    if (mask & 8) {\n        triggers.push(\"idle-finalize\");\n    }\n    return triggers;\n}\n","/**\n * File Modification Contracts\n *\n * Canonical type for real-time file modification tracking across all surfaces:\n * - VS Code Extension (records modifications on save)\n * - MCP Server (queries modifications for what_changed)\n * - CLI Daemon (receives modifications from extension)\n * - Intelligence package (stores and queries modifications)\n *\n * Design Decisions:\n * - 'path' (not 'file') - consistent with Node.js/VS Code conventions\n * - 'update' (not 'modified') - matches VS Code file system events\n * - 'source' required - enables debugging cross-surface issues\n * - AI attribution optional - graceful when detection unavailable\n */\nimport { z } from \"zod\";\n/**\n * Source surfaces that can record file modifications\n */\nexport const ModificationSourceSchema = z.enum([\"extension\", \"mcp\", \"daemon\", \"cli\"]);\n/**\n * File modification operation types\n * - create: New file created\n * - update: Existing file modified\n * - delete: File deleted\n */\nexport const ModificationTypeSchema = z.enum([\"create\", \"update\", \"delete\"]);\n/**\n * Canonical file modification type used across all surfaces.\n *\n * All fields with sensible defaults to minimize required data at recording time.\n */\nexport const FileModificationSchema = z.object({\n    /** Absolute path to the modified file */\n    path: z.string().min(1, \"Path cannot be empty\"),\n    /** Modification timestamp (ms since epoch) */\n    timestamp: z.number().positive(\"Timestamp must be positive\"),\n    /** Type of modification */\n    type: ModificationTypeSchema,\n    /** Lines changed (0 if unknown or delete) */\n    linesChanged: z.number().int().nonnegative().default(0),\n    /** Whether this change was AI-attributed (detected by AIPresenceDetector) */\n    aiAttributed: z.boolean().default(false),\n    /** Which AI tool made the change, if detected (e.g., 'copilot', 'cursor', 'claude') */\n    aiTool: z.string().nullable().default(null),\n    /** Source surface that recorded this modification */\n    source: ModificationSourceSchema,\n});\n/**\n * Parse and validate a FileModification input\n */\nexport function parseFileModification(input) {\n    return FileModificationSchema.parse(input);\n}\n/**\n * Convert MCP's FileChange to canonical FileModification\n */\nexport function fromMCPFileChange(change) {\n    return {\n        path: change.file,\n        timestamp: change.timestamp,\n        type: change.type === \"created\" ? \"create\" : change.type === \"deleted\" ? \"delete\" : \"update\",\n        linesChanged: change.linesChanged,\n        aiAttributed: change.aiAttributed,\n        aiTool: null, // MCP doesn't track specific AI tool\n        source: \"mcp\",\n    };\n}\n/**\n * Convert canonical FileModification to MCP's FileChange\n */\nexport function toMCPFileChange(mod) {\n    return {\n        file: mod.path,\n        type: mod.type === \"create\" ? \"created\" : mod.type === \"delete\" ? \"deleted\" : \"modified\",\n        timestamp: mod.timestamp,\n        aiAttributed: mod.aiAttributed,\n        linesChanged: mod.linesChanged,\n    };\n}\n/**\n * Convert Intelligence's FileModification to canonical FileModification\n */\nexport function fromIntelligenceFileModification(mod, source = \"extension\") {\n    return {\n        path: mod.path,\n        timestamp: mod.timestamp,\n        type: mod.type,\n        linesChanged: mod.linesChanged ?? 0,\n        aiAttributed: false, // Intelligence doesn't track this currently\n        aiTool: null,\n        source,\n    };\n}\n/**\n * Convert canonical FileModification to Intelligence's format\n * (for backwards compatibility during migration)\n */\nexport function toIntelligenceFileModification(mod) {\n    return {\n        path: mod.path,\n        timestamp: mod.timestamp,\n        type: mod.type,\n        linesChanged: mod.linesChanged,\n    };\n}\n// =============================================================================\n// UTILITY FUNCTIONS\n// =============================================================================\n/**\n * Filter modifications to only those after a given timestamp\n */\nexport function filterModificationsSince(mods, since) {\n    return mods.filter((m) => m.timestamp >= since);\n}\n/**\n * Get unique file paths from modifications\n */\nexport function getUniqueModifiedPaths(mods) {\n    return [...new Set(mods.map((m) => m.path))];\n}\n/**\n * Count AI-attributed modifications\n */\nexport function countAIAttributedModifications(mods) {\n    return mods.filter((m) => m.aiAttributed).length;\n}\n/**\n * Get total lines changed across all modifications\n */\nexport function getTotalLinesChanged(mods) {\n    return mods.reduce((sum, m) => sum + m.linesChanged, 0);\n}\n/**\n * Group modifications by AI tool\n */\nexport function groupByAITool(mods) {\n    const groups = new Map();\n    for (const mod of mods) {\n        const tool = mod.aiTool;\n        if (!groups.has(tool)) {\n            groups.set(tool, []);\n        }\n        groups.get(tool)?.push(mod);\n    }\n    return groups;\n}\n","/**\n * Signal API Schemas\n *\n * Zod schemas for signal analysis API endpoints.\n * These are the HTTP transport schemas, separate from engine types.\n *\n * Design principles:\n * - HTTP-friendly inputs (strings, primitives)\n * - Rich output types for client consumption\n * - Adapter layer bridges these to engine internals\n */\nimport { z } from \"zod\";\n// =============================================================================\n// AI Detection Schemas\n// =============================================================================\n/**\n * AI Detection Input\n *\n * Detects AI tool presence and code generation patterns.\n */\nexport const AiDetectionInputSchema = z.object({\n    /** Active extension IDs in the IDE environment */\n    extensionIds: z.array(z.string()).default([]),\n    /** Optional file content to analyze for AI signatures */\n    content: z.string().optional(),\n    /** Character velocity (chars/ms) from burst detection */\n    velocity: z.number().nonnegative().optional(),\n    /** Total characters changed in the operation */\n    charCount: z.number().int().nonnegative().optional(),\n});\n/**\n * AI Detection Output\n */\nexport const AiDetectionOutputSchema = z.object({\n    /** Detected AI tool name, or null if none detected */\n    tool: z.string().nullable(),\n    /** Confidence score (0-1) */\n    confidence: z.number().min(0).max(1),\n    /** Detection method that triggered */\n    method: z.enum([\"extension\", \"velocity\", \"pattern\", \"combined\"]).nullable(),\n    /** Indicators that contributed to detection */\n    indicators: z.array(z.string()).optional(),\n});\n// =============================================================================\n// Threat Detection Schemas\n// =============================================================================\n/**\n * Threat Detection Input\n *\n * Scans code content for security threat patterns.\n */\nexport const ThreatDetectionInputSchema = z.object({\n    /** Code content to scan for threats */\n    content: z.string(),\n});\n/**\n * Individual threat pattern match\n */\nexport const ThreatPatternSchema = z.object({\n    /** Description of the threat pattern */\n    description: z.string(),\n    /** Severity score (0-1), where 1 is most critical */\n    severity: z.number().min(0).max(1),\n});\n/**\n * Threat Detection Output\n */\nexport const ThreatDetectionOutputSchema = z.object({\n    /** Total number of threats detected */\n    threatCount: z.number().int().nonnegative(),\n    /** List of detected threat patterns */\n    patterns: z.array(ThreatPatternSchema),\n    /** Overall severity level */\n    severity: z.enum([\"none\", \"low\", \"medium\", \"high\", \"critical\"]),\n    /** Aggregated threat score (0-10) */\n    score: z.number().min(0).max(10),\n});\n// =============================================================================\n// Burst Detection Schemas\n// =============================================================================\n/**\n * Burst Detection Input\n *\n * Analyzes edit velocity to detect rapid code changes (AI paste detection).\n */\nexport const BurstDetectionInputSchema = z.object({\n    /** File path being analyzed */\n    filePath: z.string(),\n    /** Number of characters changed */\n    charCount: z.number().int().nonnegative(),\n    /** Timestamp of the change (ms since epoch) */\n    timestamp: z.number().int().positive().optional(),\n});\n/**\n * Burst Detection Output\n */\nexport const BurstDetectionOutputSchema = z.object({\n    /** Whether a burst was detected */\n    isBurst: z.boolean(),\n    /** Character velocity (chars/ms) */\n    velocity: z.number().nonnegative(),\n    /** File path analyzed */\n    filePath: z.string(),\n    /** Total characters in the change */\n    charCount: z.number().int().nonnegative(),\n    /** Timestamp of detection */\n    timestamp: z.number().int().positive(),\n});\n// =============================================================================\n// Complexity Analysis Schemas\n// =============================================================================\n/**\n * File input for complexity analysis\n */\nexport const ComplexityFileInputSchema = z.object({\n    /** File path */\n    path: z.string(),\n    /** File content */\n    content: z.string(),\n    /** Line count of the file */\n    lineCount: z.number().int().nonnegative(),\n});\n/**\n * Complexity Analysis Input\n */\nexport const ComplexityAnalysisInputSchema = z.object({\n    /** Files to analyze */\n    files: z.array(ComplexityFileInputSchema),\n});\n/**\n * Complexity Analysis Output\n */\nexport const ComplexityAnalysisOutputSchema = z.object({\n    /** Average complexity score across all files (0-1) */\n    avgComplexity: z.number().min(0).max(1),\n    /** Maximum complexity score of any single file (0-1) */\n    maxComplexity: z.number().min(0).max(1),\n    /** List of files with complexity > 0.7 */\n    highComplexityFiles: z.array(z.string()),\n    /** Number of files analyzed */\n    fileCount: z.number().int().nonnegative(),\n    /** Overall complexity value (same as avgComplexity) */\n    value: z.number().min(0).max(1),\n});\n// =============================================================================\n// Comprehensive Signal Analysis Schemas\n// =============================================================================\n/**\n * Comprehensive Signal Analysis Input\n *\n * Runs all signals in parallel and computes overall risk score.\n */\nexport const ComprehensiveSignalInputSchema = z.object({\n    /** Extension IDs for AI detection */\n    extensionIds: z.array(z.string()).default([]),\n    /** Content to analyze (for threats, AI patterns, complexity) */\n    content: z.string(),\n    /** File path being analyzed */\n    filePath: z.string(),\n    /** Line count (for complexity calculation) */\n    lineCount: z.number().int().nonnegative().optional(),\n    /** Character count (for burst detection) */\n    charCount: z.number().int().nonnegative().optional(),\n    /** Velocity (for AI detection) */\n    velocity: z.number().nonnegative().optional(),\n    /** Timestamp (for burst detection) */\n    timestamp: z.number().int().positive().optional(),\n});\n/**\n * Individual signal result in comprehensive output\n */\nexport const SignalResultSchema = z.object({\n    /** Signal name */\n    signal: z.enum([\"ai\", \"threats\", \"burst\", \"complexity\"]),\n    /** Signal-specific score/value */\n    value: z.number(),\n    /** Whether this signal is considered \"triggered\" */\n    triggered: z.boolean(),\n});\n/**\n * Comprehensive Signal Analysis Output\n */\nexport const ComprehensiveSignalOutputSchema = z.object({\n    /** Individual signal results */\n    signals: z.object({\n        ai: AiDetectionOutputSchema,\n        threats: ThreatDetectionOutputSchema,\n        burst: BurstDetectionOutputSchema.optional(),\n        complexity: ComplexityAnalysisOutputSchema,\n    }),\n    /** Overall risk score (0-1), weighted combination of all signals */\n    overallRisk: z.number().min(0).max(1),\n    /** Risk level classification */\n    riskLevel: z.enum([\"low\", \"medium\", \"high\", \"critical\"]),\n    /** Summary of triggered signals */\n    triggeredSignals: z.array(z.enum([\"ai\", \"threats\", \"burst\", \"complexity\"])),\n    /** Processing time in milliseconds */\n    processingTimeMs: z.number().nonnegative(),\n});\n// =============================================================================\n// Shared Types\n// =============================================================================\n/**\n * Signal type enumeration\n */\nexport const SignalTypeSchema = z.enum([\"ai\", \"threats\", \"burst\", \"complexity\", \"comprehensive\"]);\n/**\n * Common error response for signal endpoints\n */\nexport const SignalErrorSchema = z.object({\n    /** Error code */\n    code: z.string(),\n    /** Human-readable error message */\n    message: z.string(),\n    /** Signal type that failed */\n    signal: SignalTypeSchema.optional(),\n});\n","import { z } from \"zod\";\n/**\n * Configuration file types\n */\nexport const ConfigFileTypeSchema = z.enum([\n    \"package\",\n    \"typescript\",\n    \"linting\",\n    \"build\",\n    \"environment\",\n    \"testing\",\n    \"framework\",\n    \"database\",\n    \"ci\",\n]);\n/**\n * Supported programming languages\n */\nexport const SupportedLanguageSchema = z.enum([\"javascript\", \"typescript\", \"python\", \"universal\"]);\n/**\n * File baseline information for config files\n */\nexport const FileBaselineSchema = z.object({\n    path: z.string(),\n    hash: z.string(),\n    timestamp: z.number(),\n    size: z.number(),\n});\n/**\n * Base configuration file interface\n */\nexport const ConfigFileSchema = z.object({\n    path: z.string(),\n    type: ConfigFileTypeSchema,\n    language: SupportedLanguageSchema,\n    critical: z.boolean().default(false),\n    baseline: FileBaselineSchema.optional(),\n});\n/**\n * Detected configuration file\n */\nexport const DetectedConfigFileSchema = z.object({\n    type: z.string(),\n    path: z.string(),\n    name: z.string(),\n    critical: z.boolean().default(false),\n});\n/**\n * Config parse result\n */\nexport const ConfigParseResultSchema = z.object({\n    content: z.any(),\n    valid: z.boolean(),\n    error: z.string().optional(),\n    metadata: z.record(z.string(), z.any()).optional(),\n});\n/**\n * Config validation result\n */\nexport const ConfigValidationResultSchema = z.object({\n    valid: z.boolean(),\n    errors: z.array(z.string()).default([]),\n    warnings: z.array(z.string()).default([]),\n});\n/**\n * Config file change\n */\nexport const ConfigChangeSchema = z.object({\n    type: z.enum([\"added\", \"modified\", \"deleted\"]),\n    file: z.string(),\n    timestamp: z.number(),\n    baseline: FileBaselineSchema.optional(),\n});\n/**\n * Config manager options\n */\nexport const ConfigManagerOptionsSchema = z.object({\n    autoDetect: z.boolean().default(true),\n    watchChanges: z.boolean().default(true),\n    autoProtect: z.boolean().default(true),\n    customPatterns: z.array(z.any()).optional(),\n});\n/**\n * Selective snapshot configuration\n */\nexport const SelectiveSnapshotConfigSchema = z.object({\n    enabled: z.boolean(),\n    patterns: z.array(z.string()).optional(),\n    threshold: z.number().optional(),\n    includePatterns: z.array(z.string()).optional(),\n    excludePatterns: z.array(z.string()).optional(),\n});\n","import { z } from \"zod\";\n/**\n * Protection levels for files\n * - watch: Silent auto-snapshot on save (green)\n * - warn: Show notification before save (yellow/orange)\n * - block: Require explicit snapshot or override (red)\n */\nexport const ProtectionLevelSchema = z.enum([\"watch\", \"warn\", \"block\"]);\n/**\n * UI metadata for protection levels\n */\nexport const ProtectionLevelMetadataSchema = z.object({\n    level: ProtectionLevelSchema,\n    icon: z.string(),\n    label: z.string(),\n    description: z.string(),\n    color: z.string(),\n    themeColor: z.string().optional(),\n});\n/**\n * Protection level configurations with UI metadata\n */\nexport const PROTECTION_LEVELS = {\n    watch: {\n        level: \"watch\",\n        icon: \"\",\n        label: \"Watch\",\n        description: \"Silent auto-snapshot on save\",\n        color: \"#10B981\",\n        themeColor: \"charts.green\",\n    },\n    warn: {\n        level: \"warn\",\n        icon: \"\",\n        label: \"Warn\",\n        description: \"Notify before save with options\",\n        color: \"#FF6B35\",\n        themeColor: \"charts.orange\",\n    },\n    block: {\n        level: \"block\",\n        icon: \"\",\n        label: \"Block\",\n        description: \"Require snapshot or explicit override\",\n        color: \"#EF4444\",\n        themeColor: \"charts.red\",\n    },\n};\n/**\n * Protected file entry\n */\nexport const ProtectedFileSchema = z.object({\n    path: z.string(),\n    level: ProtectionLevelSchema,\n    reason: z.string().optional(),\n    addedAt: z.date(),\n    pattern: z.string().optional(), // If added via pattern match\n});\n/**\n * Pattern rule for automatic protection\n */\nexport const PatternRuleSchema = z.object({\n    pattern: z.string(),\n    level: ProtectionLevelSchema,\n    reason: z.string().optional(),\n    enabled: z.boolean().default(true),\n});\n/**\n * Protection configuration\n */\nexport const ProtectionConfigSchema = z.object({\n    patterns: z.array(PatternRuleSchema).default([]),\n    defaultLevel: ProtectionLevelSchema.default(\"watch\"),\n    enabled: z.boolean().default(true),\n    autoProtectConfigs: z.boolean().default(true),\n});\n/**\n * Protection manager options\n */\nexport const ProtectionManagerOptionsSchema = z.object({\n    config: ProtectionConfigSchema.optional(),\n    persistRegistry: z.boolean().default(true),\n    registryPath: z.string().optional(),\n});\n/**\n * Protection check result\n */\nexport const ProtectionCheckResultSchema = z.object({\n    isProtected: z.boolean(),\n    level: ProtectionLevelSchema.optional(),\n    reason: z.string().optional(),\n    file: ProtectedFileSchema.optional(),\n});\n","var __rewriteRelativeImportExtension = (this && this.__rewriteRelativeImportExtension) || function (path, preserveJsx) {\n    if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\n        return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\n            return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\n        });\n    }\n    return path;\n};\nimport { z } from \"zod\";\nimport { RiskScoreSchema } from \"../schemas.js\";\nimport { RiskSeveritySchema } from \"./analysis.js\";\n// =============================================================================\n// SNAPSHOT TRIGGER & ORIGIN TYPES (ADR-004 Consolidated)\n// =============================================================================\n/**\n * Snapshot trigger sources - canonical enum for all surfaces\n * Consolidates triggers from VSCode, MCP, CLI, and API\n */\nexport const SnapshotTriggerSchema = z.enum([\n    \"manual\",\n    \"auto\",\n    \"auto_save\",\n    \"ai_detected\",\n    \"ai-detected\", // Legacy alias\n    \"pre_save\",\n    \"pre-save\", // Legacy alias\n    \"session_start\",\n    \"session_end\",\n    \"mcp_snap_start\",\n    \"cli_protect\",\n    \"api_request\",\n    \"engine_internal\",\n    \"recovery\",\n]);\n/**\n * Snapshot origin classification for DORA metrics\n * Distinguishes user-initiated vs automated snapshots\n */\nexport const SnapshotOriginSchema = z.enum([\"manual\", \"auto\", \"ai-detected\", \"recovery\", \"INTERACTIVE\", \"AUTOMATED\"]);\n/**\n * Reason codes for snapshot creation (from VSCode ManifestV2)\n * Used for explainability and debugging\n */\nexport const SnapshotReasonCodeSchema = z.enum([\n    \"AI_DETECTED\",\n    \"MANUAL_CHECKPOINT\",\n    \"CRITICAL_FILE\",\n    \"HIGH_RISK\",\n    \"SESSION_START\",\n    \"SESSION_END\",\n    \"PRE_ROLLBACK\",\n    \"BURST_MODE\",\n    \"IDLE_FINALIZE\",\n]);\n/**\n * Checkpoint type for V2 manifests\n * PRE = pointer-only (marks start of risky operation)\n * POST = contains actual file content\n * PRE_ROLLBACK = pointer before rollback operation\n */\nexport const CheckpointTypeSchema = z.enum([\"PRE\", \"POST\", \"PRE_ROLLBACK\"]);\n/**\n * Base Snapshot interface\n * This is the core data structure for snapshots across all SnapBack clients\n *\n * Session Linkage (Non-Breaking Extension):\n * Snapshots can optionally link to a parent session via meta.sessionId.\n * This enables:\n * - Displaying snapshots within session tree view\n * - Understanding snapshot creation context\n * - Grouping snapshots by logical work period\n *\n * Example meta object:\n * {\n *   name: \"Pre-refactor checkpoint\",\n *   protected: true,\n *   sessionId: \"clx1a2b3c4d5e6f7g8h9\" // Optional link to session\n * }\n *\n * Version Compatibility:\n * - version: Snapshot format version (default: \"1.0\")\n * - Compatible versions: [\"1.0\"]\n */\nexport const SnapshotSchema = z.object({\n    id: z.string(),\n    timestamp: z.number(),\n    version: z.string().optional().default(\"1.0\"),\n    meta: z.record(z.string(), z.any()).optional(),\n    files: z.array(z.string()).optional(),\n    fileContents: z.record(z.string(), z.string()).optional(),\n});\n/**\n * File state at a specific snapshot\n * Used for deduplication and change tracking\n * Enhanced per ADR-004 with encryption support\n *\n * Note: `hash` is optional to support:\n * - Files being added before hashing\n * - Encrypted content where hash is computed separately\n */\nexport const FileStateSchema = z.object({\n    path: z.string(),\n    content: z.string(),\n    /** SHA-256 hash of content (optional, computed for dedup) */\n    hash: z.string().optional(),\n    /** File size in bytes */\n    size: z.number().optional(),\n    /** Encrypted data (for sensitive files - VSCode format) */\n    encrypted: z\n        .object({\n        /** Initialization vector */\n        iv: z.string(),\n        /** Authentication tag */\n        tag: z.string(),\n        /** Optional: algorithm used (default: aes-256-gcm) */\n        algorithm: z.string().optional(),\n    })\n        .optional(),\n});\n/**\n * V2 File reference for content-addressable storage\n * Used in SnapshotManifestV2 - references blobs by hash\n */\nexport const SnapshotFileRefV2Schema = z.object({\n    /** SHA-256 hash of file content (CAS reference) */\n    blobHash: z.string(),\n    /** File size in bytes */\n    size: z.number(),\n});\n/**\n * Complete snapshot state for deduplication\n */\nexport const SnapshotStateSchema = z.object({\n    id: z.string(),\n    timestamp: z.number(),\n    files: z.array(FileStateSchema),\n});\n/**\n * Rich Snapshot with UI metadata\n * Used by VS Code extension and other clients with UI\n */\nexport const RichSnapshotSchema = SnapshotSchema.extend({\n    name: z.string(),\n    fileStates: z.array(FileStateSchema).optional(),\n    isProtected: z.boolean(),\n    icon: z.string().optional(),\n    iconColor: z.string().optional(),\n});\n/**\n * Minimal snapshot for deletion operations\n */\nexport const MinimalSnapshotSchema = z.object({\n    id: z.string(),\n    name: z.string(),\n    timestamp: z.number(),\n    isProtected: z.boolean(),\n});\n/**\n * File input for snapshot creation\n */\nexport const FileInputSchema = z.object({\n    path: z.string(),\n    content: z.string(),\n    action: z.enum([\"add\", \"modify\", \"delete\"]),\n});\n/**\n * Snapshot creation options\n * Enhanced per ADR-004 with DORA metric extensions from VSCode\n */\nexport const CreateSnapshotOptionsSchema = z.object({\n    /** Description/reason for the snapshot */\n    description: z.string().optional(),\n    /** Whether to protect from auto-deletion */\n    protected: z.boolean().optional(),\n    /** What triggered the snapshot */\n    trigger: SnapshotTriggerSchema.optional(),\n    /** Origin classification for DORA metrics */\n    origin: SnapshotOriginSchema.optional(),\n    /** Time since last file change in ms (DORA lead time metric) */\n    timeSinceLastChangeMs: z.number().optional(),\n});\n/**\n * Snapshot filters for querying\n */\nexport const SnapshotFiltersSchema = z.object({\n    filePath: z.string().optional(),\n    before: z.date().optional(),\n    after: z.date().optional(),\n    protected: z.boolean().optional(),\n    limit: z.number().int().positive().optional(),\n    offset: z.number().int().nonnegative().optional(),\n});\n/**\n * File diff for restore preview\n */\nexport const FileDiffSchema = z.object({\n    path: z.string(),\n    operation: z.enum([\"create\", \"modify\", \"delete\"]),\n    linesAdded: z.number(),\n    linesRemoved: z.number(),\n    preview: z.string(),\n    currentChecksum: z.string().optional(),\n    snapshotChecksum: z.string().optional(),\n});\n/**\n * Diff preview for restore operations\n */\nexport const DiffPreviewSchema = z.object({\n    totalFiles: z.number(),\n    filesCreated: z.number(),\n    filesModified: z.number(),\n    filesDeleted: z.number(),\n    totalLinesAdded: z.number(),\n    totalLinesRemoved: z.number(),\n    diffs: z.array(FileDiffSchema),\n});\n/**\n * Conflict report for restore operations\n */\nexport const ConflictReportSchema = z.object({\n    path: z.string(),\n    reason: z.string(),\n    currentChecksum: z.string(),\n    snapshotChecksum: z.string(),\n});\n/**\n * Snapshot restore result (enhanced with diff previews and conflicts)\n */\nexport const SnapshotRestoreResultSchema = z.object({\n    success: z.boolean(),\n    restoredFiles: z.array(z.string()),\n    errors: z.array(z.string()).optional(),\n    diffPreview: DiffPreviewSchema.optional(),\n    conflicts: z.array(ConflictReportSchema).optional(),\n    verification: z\n        .object({\n        allVerified: z.boolean(),\n        results: z.array(z.object({\n            path: z.string(),\n            verified: z.boolean(),\n            checksum: z.string(),\n            expected: z.string(),\n        })),\n    })\n        .optional(),\n});\n/**\n * Snapshot manager configuration\n */\nexport const SnapshotManagerConfigSchema = z.object({\n    enableDeduplication: z.boolean().default(true),\n    namingStrategy: z.enum([\"git\", \"semantic\", \"timestamp\", \"custom\"]).default(\"semantic\"),\n    autoProtect: z.boolean().default(false),\n    maxSnapshots: z.number().int().positive().optional(),\n});\n/**\n * File metadata for analytics and tracking\n *\n * Note: Uses canonical RiskScoreSchema from schemas.ts (0-10 scale)\n */\nexport const FileMetadataSchema = z.object({\n    id: z.string(),\n    path: z.string(),\n    hash: z.string().optional(),\n    size: z.number().optional(),\n    language: z.string().optional(),\n    risk: RiskScoreSchema.optional(),\n    lastModified: z.number().optional(),\n    createdAt: z.number().optional(),\n});\n/**\n * Snapshot metadata for analytics (Enhanced per ADR-004)\n * Includes VSCode ManifestV2 fields for full surface parity\n */\nexport const SnapshotMetadataSchema = z.object({\n    // Core fields (required)\n    id: z.string(),\n    timestamp: z.number(),\n    fileCount: z.number(),\n    // Analytics fields (optional)\n    totalSize: z.number().optional(),\n    riskScore: RiskScoreSchema.optional(),\n    tags: z.array(z.string()).optional(),\n    // V2 Hierarchy fields (from VSCode ManifestV2)\n    /** Sequential snapshot number (1-based, monotonic) */\n    seq: z.number().int().positive().optional(),\n    /** Parent snapshot seq (null for root) */\n    parentSeq: z.number().int().positive().nullable().optional(),\n    /** Parent snapshot ID */\n    parentId: z.string().nullable().optional(),\n    /** Checkpoint type */\n    type: CheckpointTypeSchema.optional(),\n    /** Main file that triggered this snapshot */\n    anchorFile: z.string().optional(),\n    // DORA Metrics fields\n    /** Time since last file change in ms (for lead time metric) */\n    timeSinceLastChangeMs: z.number().optional(),\n    /** Compression ratio achieved (for storage efficiency) */\n    compressionRatio: z.number().optional(),\n    /** Storage size in bytes (after compression) */\n    storageSizeBytes: z.number().optional(),\n    // Origin & Classification\n    /** Origin classification for analytics */\n    origin: SnapshotOriginSchema.optional(),\n    /** Reason codes for explainability */\n    reasons: z.array(SnapshotReasonCodeSchema).optional(),\n    // AI Detection\n    aiDetection: z\n        .object({\n        detected: z.boolean(),\n        tool: z.string().optional(),\n        confidence: z.number().min(0).max(1).optional(),\n    })\n        .optional(),\n    // Session linkage\n    /** SnapBack session ID */\n    sessionId: z.string().optional(),\n    /** External task ID (from LLM agent) */\n    taskId: z.string().optional(),\n    // UI fields\n    name: z.string().optional(),\n    icon: z.string().optional(),\n});\n// =============================================================================\n// SNAPSHOT MANIFEST V2 (ADR-004 - Canonical Definition)\n// =============================================================================\n/**\n * V2 Snapshot Manifest - Canonical definition from VSCode extension\n * This is the SINGLE SOURCE OF TRUTH for V2 manifest structure.\n *\n * Features:\n * - Sequential numbering (seq) for ordering\n * - Parent chain (parentSeq, parentId) for history\n * - Checkpoint types (PRE/POST/PRE_ROLLBACK)\n * - Content-addressable file storage via blobHash\n * - Rich metadata for analytics and DORA metrics\n */\nexport const SnapshotManifestV2Schema = z.object({\n    /** Schema version - always 2 for V2 */\n    schemaVersion: z.literal(2),\n    /** Unique ID: snap-{timestamp}-{random} */\n    id: z.string(),\n    /** Sequential snapshot number (1-based, monotonic) */\n    seq: z.number().int().positive(),\n    /** Parent snapshot seq (null for root) */\n    parentSeq: z.number().int().positive().nullable(),\n    /** Parent snapshot ID (null for root) */\n    parentId: z.string().nullable(),\n    /** Unix timestamp (ms) */\n    timestamp: z.number(),\n    /** Human-readable name */\n    name: z.string(),\n    /** Checkpoint type */\n    type: CheckpointTypeSchema,\n    /** The main file that triggered this snapshot */\n    anchorFile: z.string(),\n    /** Files in snapshot (path  ref). Empty for PRE checkpoints. */\n    files: z.record(z.string(), SnapshotFileRefV2Schema),\n    /** Optional metadata */\n    metadata: z\n        .object({\n        /** Risk score 0-1 */\n        riskScore: z.number().min(0).max(1).optional(),\n        /** Origin classification */\n        origin: SnapshotOriginSchema.optional(),\n        /** Stable reason codes */\n        reasons: z.array(SnapshotReasonCodeSchema).optional(),\n        /** AI detection info */\n        aiDetection: z\n            .object({\n            detected: z.boolean(),\n            tool: z.string().optional(),\n            confidence: z.number().optional(),\n        })\n            .optional(),\n        /** SnapBack session ID */\n        sessionId: z.string().optional(),\n        /** External task ID */\n        taskId: z.string().optional(),\n        /** DORA: Time since last change */\n        timeSinceLastChangeMs: z.number().optional(),\n    })\n        .optional(),\n});\n/**\n * V1 Snapshot Manifest - Legacy format for backward compatibility\n */\nexport const SnapshotManifestV1Schema = z.object({\n    /** Unique ID */\n    id: z.string(),\n    /** Unix timestamp (ms) */\n    timestamp: z.number(),\n    /** Human-readable name */\n    name: z.string(),\n    /** Trigger reason */\n    trigger: z.enum([\"auto\", \"manual\", \"ai-detected\", \"pre-save\"]),\n    /** Main file that triggered snapshot */\n    anchorFile: z.string(),\n    /** Files in snapshot (path  ref) */\n    files: z.record(z.string(), z.object({\n        blob: z.string(),\n        size: z.number(),\n    })),\n    /** Optional metadata */\n    metadata: z\n        .object({\n        riskScore: z.number().optional(),\n        aiDetection: z\n            .object({\n            detected: z.boolean(),\n            tool: z.string().optional(),\n            confidence: z.number().optional(),\n        })\n            .optional(),\n        sessionId: z.string().optional(),\n        taskId: z.string().optional(),\n    })\n        .optional(),\n});\n/**\n * Type guard for V2 manifests\n */\nexport function isSnapshotManifestV2(manifest) {\n    return (typeof manifest === \"object\" &&\n        manifest !== null &&\n        \"schemaVersion\" in manifest &&\n        manifest.schemaVersion === 2);\n}\n/**\n * Type guard for POST checkpoints (have content)\n */\nexport function isPostCheckpoint(manifest) {\n    if (!isSnapshotManifestV2(manifest)) {\n        return true; // V1 manifests always have content\n    }\n    return manifest.type === \"POST\";\n}\n/**\n * Type guard for pointer checkpoints (PRE, PRE_ROLLBACK)\n */\nexport function isPointerCheckpoint(manifest) {\n    if (!isSnapshotManifestV2(manifest)) {\n        return false;\n    }\n    return manifest.type === \"PRE\" || manifest.type === \"PRE_ROLLBACK\";\n}\n/**\n * Analytics response structure\n */\nexport const AnalyticsResponseSchema = z.object({\n    workspaceId: z.string(),\n    period: z.object({\n        start: z.number(),\n        end: z.number(),\n    }),\n    risk: RiskScoreSchema,\n    fileStats: z.object({\n        total: z.number(),\n        byLanguage: z.record(z.string(), z.number()),\n        byRisk: z.record(z.string(), z.number()),\n    }),\n    snapshotStats: z.object({\n        total: z.number(),\n        frequency: z.number(),\n        averageSize: z.number().optional(),\n    }),\n    snapshotRecommendations: z.object({\n        shouldCreateSnapshot: z.boolean(),\n        reason: z.string(),\n        urgency: RiskSeveritySchema,\n        suggestedTiming: z.string(),\n    }),\n    trends: z.object({\n        risk: z.array(z.object({\n            timestamp: z.number(),\n            score: z.number(),\n        })),\n        activity: z.array(z.object({\n            timestamp: z.number(),\n            count: z.number(),\n        })),\n    }),\n});\n/**\n * Factory function to create a snapshot storage instance\n * This allows public packages to create storage instances without\n * directly depending on the private @snapback/storage package.\n *\n * @param basePath The base path for storage operations\n * @returns A SnapshotStorage instance\n */\nexport async function createSnapshotStorage(basePath) {\n    // Dynamically import the storage package to avoid circular dependencies\n    // The import path is resolved at runtime after both packages are built\n    try {\n        const { StorageBrokerAdapter } = await import(__rewriteRelativeImportExtension(\"@snapback/sdk/storage\"));\n        // Use the standard workspace database path\n        const storage = new StorageBrokerAdapter(`${basePath}/.snapback/snapback.db`);\n        await storage.initialize();\n        return {\n            create: async (data) => {\n                const snapshot = {\n                    id: `snap-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,\n                    timestamp: Date.now(),\n                    version: \"1.0\",\n                    meta: {\n                        ...data,\n                        protected: data.protected || false,\n                        description: data.description || \"\",\n                    },\n                };\n                await storage.save(snapshot);\n                return snapshot;\n            },\n            retrieve: async (id) => {\n                return await storage.get(id);\n            },\n            list: async () => {\n                return await storage.list();\n            },\n            restore: async (id, _targetPath, options) => {\n                // Note: Full restore implementation requires file system operations\n                // This is a simplified version - real implementation in storage package\n                const snapshot = await storage.get(id);\n                if (!snapshot) {\n                    return {\n                        success: false,\n                        restoredFiles: [],\n                        errors: [`Snapshot ${id} not found`],\n                    };\n                }\n                if (options?.dryRun) {\n                    return {\n                        success: true,\n                        restoredFiles: snapshot.files || [],\n                        errors: [],\n                    };\n                }\n                return {\n                    success: true,\n                    restoredFiles: snapshot.files || [],\n                    errors: [],\n                };\n            },\n        };\n    }\n    catch (error) {\n        throw new Error(`Failed to initialize snapshot storage: ${error instanceof Error ? error.message : String(error)}. ` +\n            \"Ensure @snapback/sdk is installed and storage path is writable.\");\n    }\n}\n","import { z } from \"zod\";\n/**\n * Dashboard Metrics Contracts\n *\n * Type definitions for dashboard home page metrics display.\n * Uses discriminated unions for type safety and exhaustive pattern matching.\n *\n * Follows SnapBack TypeScript patterns:\n * - Discriminated unions (protection_status, action)\n * - Const assertions for readonly values\n * - Zod schemas for runtime validation\n */\n/**\n * Protection status discriminated union\n * Enables type-safe rendering of status-specific UI\n */\nexport const PROTECTION_STATUSES = [\"active\", \"inactive\"];\n/**\n * Recent activity action discriminated union\n * Enables type-safe handling of different activity types\n */\nexport const RECENT_ACTIVITY_ACTIONS = [\"snapshot_created\", \"recovery_performed\", \"ai_detected\"];\n/**\n * AI tool names for activity tracking\n */\nexport const AI_TOOLS = [\"copilot\", \"cursor\", \"claude\", \"windsurf\"];\n/**\n * Recent activity entry schema\n * Represents a single action in the activity feed\n *\n * Example:\n * {\n *   timestamp: 1701676000000,\n *   action: \"recovery_performed\",\n *   file: \"src/utils/api.ts\",\n *   ai_tool: \"copilot\"\n * }\n */\nexport const RecentActivitySchema = z.object({\n    timestamp: z.number().int().positive(),\n    action: z.enum(RECENT_ACTIVITY_ACTIONS),\n    file: z.string().min(1),\n    ai_tool: z.enum(AI_TOOLS).optional(),\n});\n/**\n * AI activity breakdown by tool\n * Shows how many interactions detected per AI tool\n *\n * Example:\n * {\n *   copilot: 847,\n *   cursor: 412,\n *   claude: 183,\n *   windsurf: 0\n * }\n */\nexport const AIActivityBreakdownSchema = z.object({\n    copilot: z.number().int().nonnegative(),\n    cursor: z.number().int().nonnegative(),\n    claude: z.number().int().nonnegative(),\n    windsurf: z.number().int().nonnegative().optional(),\n});\n/**\n * Dashboard metrics response\n * Complete metrics for dashboard home page display\n *\n * Properties:\n * - protection_status: Current protection state (active/inactive)\n * - total_snapshots: Lifetime snapshots created\n * - total_recoveries: Times user recovered from AI errors\n * - files_protected: Unique files with checkpoints\n * - ai_detection_rate: Percentage (0-100) of changes recognized as AI\n * - recent_activity: Last 10 actions (for activity feed)\n * - ai_breakdown: Detection count per AI tool\n *\n * Example response:\n * {\n *   protection_status: \"active\",\n *   total_snapshots: 1247,\n *   total_recoveries: 23,\n *   files_protected: 3892,\n *   ai_detection_rate: 94,\n *   recent_activity: [\n *     {\n *       timestamp: 1701676000000,\n *       action: \"snapshot_created\",\n *       file: \"src/utils/api.ts\",\n *       ai_tool: \"copilot\"\n *     }\n *   ],\n *   ai_breakdown: {\n *     copilot: 847,\n *     cursor: 412,\n *     claude: 183\n *   }\n * }\n */\nexport const DashboardMetricsSchema = z.object({\n    protection_status: z.enum(PROTECTION_STATUSES),\n    total_snapshots: z.number().int().nonnegative(),\n    total_recoveries: z.number().int().nonnegative(),\n    files_protected: z.number().int().nonnegative(),\n    ai_detection_rate: z.number().min(0).max(100),\n    recent_activity: z.array(RecentActivitySchema).max(10),\n    ai_breakdown: AIActivityBreakdownSchema,\n});\n/**\n * Error response for dashboard metrics endpoint\n * Discriminated union for safe error handling\n */\nexport const DashboardMetricsErrorSchema = z.object({\n    error: z.literal(true),\n    code: z.enum([\"UNAUTHORIZED\", \"NOT_FOUND\", \"INTERNAL_ERROR\"]),\n    message: z.string(),\n});\n/**\n * Dashboard API response (success | error)\n * Type guard helpers for pattern matching\n */\nexport const DashboardMetricsResponseSchema = z.union([DashboardMetricsSchema, DashboardMetricsErrorSchema]);\n/**\n * Type guards for discriminated unions\n * Enables safe pattern matching in UI components\n */\nexport function isDashboardMetrics(response) {\n    return !(\"error\" in response) || response.error !== true;\n}\nexport function isDashboardMetricsError(response) {\n    return \"error\" in response && response.error === true;\n}\nexport function isProtectionActive(metrics) {\n    return metrics.protection_status === \"active\";\n}\nexport function isProtectionInactive(metrics) {\n    return metrics.protection_status === \"inactive\";\n}\n","/**\n * Query Classifier for Adaptive Retrieval\n *\n * Classifies queries into types and returns optimal RRF weights.\n * Based on 2025 Adaptive RAG research:\n * - Factual queries benefit from keyword-heavy retrieval (exact matching)\n * - Conceptual queries benefit from semantic-heavy retrieval (understanding)\n * - Exploratory queries use balanced weights\n *\n * @see https://www.meilisearch.com/blog/adaptive-rag\n * @see https://superlinked.com/vectorhub/articles/optimizing-rag-with-hybrid-search-reranking\n */\n\nexport type QueryType = \"factual\" | \"conceptual\" | \"exploratory\";\n\n/**\n * Query complexity level for retrieval strategy selection\n * @see https://arxiv.org/abs/2501.07391 - Adaptive RAG complexity classification\n */\nexport type QueryComplexity = \"simple\" | \"moderate\" | \"complex\";\n\nexport interface QueryClassification {\n\t/** The classified query type */\n\ttype: QueryType;\n\t/** Query complexity for retrieval strategy */\n\tcomplexity: QueryComplexity;\n\t/** Classification confidence (0-1) */\n\tconfidence: number;\n\t/** Adaptive RRF weights for this query type */\n\tweights: {\n\t\tsemantic: number;\n\t\tkeyword: number;\n\t};\n\t/** Reasoning for classification (for debugging) */\n\treason: string;\n}\n\n/**\n * Retrieval strategy based on query complexity\n * @see https://medium.com/@tuhinsharma121/understanding-adaptive-rag\n */\nexport interface RetrievalStrategy {\n\t/** Whether to perform retrieval at all */\n\tshouldRetrieve: boolean;\n\t/** Number of results to retrieve */\n\ttopK: number;\n\t/** Whether to apply reranking */\n\tuseReranking: boolean;\n\t/** Whether to expand query with synonyms */\n\tuseExpansion: boolean;\n}\n\n/**\n * Weight configurations per query type\n * Based on research: factual needs keyword=0.7, conceptual needs semantic=0.7\n */\nconst WEIGHT_CONFIGS: Record<QueryType, { semantic: number; keyword: number }> = {\n\tfactual: { semantic: 0.3, keyword: 0.7 },\n\tconceptual: { semantic: 0.7, keyword: 0.3 },\n\texploratory: { semantic: 0.5, keyword: 0.5 },\n};\n\n/**\n * Pattern sets for query classification\n */\nconst PATTERNS = {\n\t// Factual: specific lookups, exact terms, \"what is\", \"how to\"\n\tfactual: {\n\t\tprefixes: [\n\t\t\t/^what\\s+is\\s+/i,\n\t\t\t/^what's\\s+/i,\n\t\t\t/^where\\s+is\\s+/i,\n\t\t\t/^where\\s+/i, // \"where is the X defined?\"\n\t\t\t/^which\\s+/i,\n\t\t\t/^how\\s+to\\s+/i,\n\t\t\t/^how\\s+do\\s+(?:i|you|we)\\s+/i,\n\t\t\t/^show\\s+me\\s+/i,\n\t\t\t/^find\\s+/i,\n\t\t\t/^get\\s+/i,\n\t\t\t/^list\\s+/i,\n\t\t],\n\t\t// Specific technical terms, paths, function names\n\t\tindicators: [\n\t\t\t/\\b[A-Z][a-z]+[A-Z]\\w+\\b/, // CamelCase (class names)\n\t\t\t/\\b[a-z]+_[a-z]+\\b/, // snake_case (variables)\n\t\t\t/\\b\\w+\\.\\w+\\b/, // dot notation (file.ext, obj.prop)\n\t\t\t/\\b(?:import|export|from|require)\\b/, // import statements\n\t\t\t/['\"`][\\w./]+['\"`]/, // quoted strings (paths, names)\n\t\t\t/\\b(?:function|class|const|let|var|type|interface)\\s+\\w+/, // declarations\n\t\t\t/\\b\\d+\\.\\d+(?:\\.\\d+)?\\b/, // version numbers\n\t\t\t/\\b[A-Z_]{2,}\\b/, // CONSTANTS\n\t\t\t/\\b\\w+\\/\\w+/, // file paths with slashes\n\t\t\t/\\.(?:ts|tsx|js|jsx|py|go|rs|java|cpp|c|h)(?:\\b|$)/i, // file extensions\n\t\t\t/=>|->|\\(\\)|{}|\\[\\]/, // code syntax patterns\n\t\t\t/\\b(?:TypeError|Error|Exception|undefined|null)\\b/, // error types\n\t\t],\n\t\t// Weight boost for exact match signals\n\t\texactMatchBoost: [\n\t\t\t/\\bexact\\b/i,\n\t\t\t/\\bspecific\\b/i,\n\t\t\t/\\bpath\\b/i,\n\t\t\t/\\bfile\\b/i,\n\t\t\t/\\bfunction\\b/i,\n\t\t\t/\\bclass\\b/i,\n\t\t\t/\\bimport\\b/i,\n\t\t\t/\\berror\\b/i,\n\t\t\t/\\bfix\\b/i,\n\t\t\t/\\bbug\\b/i,\n\t\t\t/\\bdefined\\b/i,\n\t\t\t/\\blocated\\b/i,\n\t\t\t/\\bmiddleware\\b/i,\n\t\t\t/\\bsocket\\b/i,\n\t\t\t/\\bIPC\\b/i,\n\t\t\t/\\bdaemon\\b/i,\n\t\t\t/\\btrigger\\b/i,\n\t\t\t/\\btest(?:s|ing)?\\b/i,\n\t\t],\n\t},\n\n\t// Conceptual: understanding, reasoning, \"why\", \"explain\"\n\tconceptual: {\n\t\tprefixes: [\n\t\t\t/^why\\s+/i,\n\t\t\t/^explain\\s+/i,\n\t\t\t/^what\\s+(?:does|do|is\\s+the\\s+purpose|is\\s+the\\s+difference|are\\s+the\\s+best)\\s+/i,\n\t\t\t/^how\\s+does\\s+/i,\n\t\t\t/^understand\\s+/i,\n\t\t\t/^describe\\s+/i,\n\t\t\t/^compare\\s+/i,\n\t\t\t/^when\\s+should\\s+/i,\n\t\t],\n\t\tindicators: [\n\t\t\t/\\b(?:concept|pattern|principle|approach|strategy|architecture)\\b/i,\n\t\t\t/\\b(?:best\\s+practice|trade-?off|pros?\\s+and\\s+cons?)\\b/i,\n\t\t\t/\\b(?:difference\\s+between|versus|vs\\.?)\\b/i,\n\t\t\t/\\b(?:should\\s+i|when\\s+to|when\\s+should)\\b/i,\n\t\t\t/\\b(?:better|worse|prefer|recommend)\\b/i,\n\t\t\t/\\b(?:design|philosophy|reasoning|rationale)\\b/i,\n\t\t\t/\\b(?:purpose\\s+of|purpose)\\b/i,\n\t\t\t/\\b(?:authentication|authorization)\\s+work/i,\n\t\t\t/\\bSSR\\b.*\\bCSR\\b|\\bCSR\\b.*\\bSSR\\b/i, // SSR vs CSR comparison\n\t\t],\n\t},\n\n\t// Exploratory: open-ended, general browsing (NOT \"how does X work\")\n\texploratory: {\n\t\tprefixes: [/^tell\\s+me\\s+about\\s+/i, /^can\\s+(?:i|you|we)\\s+/i, /^is\\s+(?:it|there)\\s+/i],\n\t\tindicators: [\n\t\t\t/\\b(?:overview|general|introduction|getting\\s+started)\\b/i,\n\t\t\t/\\b(?:example|sample|demo|tutorial)\\b/i,\n\t\t\t/\\?$/, // Questions without specific type\n\t\t],\n\t},\n};\n\n/**\n * Classify a query to determine optimal retrieval weights\n *\n * @param query - The user's query string\n * @returns Classification with type, confidence, and adaptive weights\n *\n * @example\n * ```typescript\n * const result = classifyQuery(\"What is the import path for RuntimeRouter?\");\n * // { type: \"factual\", confidence: 0.9, weights: { semantic: 0.3, keyword: 0.7 } }\n *\n * const result2 = classifyQuery(\"Why should I use dependency injection?\");\n * // { type: \"conceptual\", confidence: 0.85, weights: { semantic: 0.7, keyword: 0.3 } }\n * ```\n */\nexport function classifyQuery(query: string): QueryClassification {\n\tconst normalizedQuery = query.trim();\n\n\tif (!normalizedQuery) {\n\t\treturn {\n\t\t\ttype: \"exploratory\",\n\t\t\tcomplexity: \"simple\",\n\t\t\tconfidence: 0.5,\n\t\t\tweights: WEIGHT_CONFIGS.exploratory,\n\t\t\treason: \"Empty query, defaulting to exploratory [simple]\",\n\t\t};\n\t}\n\n\t// Calculate scores for each type\n\tconst scores = {\n\t\tfactual: calculateFactualScore(normalizedQuery),\n\t\tconceptual: calculateConceptualScore(normalizedQuery),\n\t\texploratory: calculateExploratoryScore(normalizedQuery),\n\t};\n\n\t// Find the winning type\n\tconst entries = Object.entries(scores) as [QueryType, number][];\n\tentries.sort((a, b) => b[1] - a[1]);\n\n\tconst [winningType, winningScore] = entries[0];\n\tconst [, secondScore] = entries[1];\n\n\t// Calculate confidence based on margin\n\tconst margin = winningScore - secondScore;\n\tconst confidence = Math.min(0.95, 0.5 + margin * 0.5);\n\n\t// Calculate complexity for retrieval strategy\n\tconst complexity = calculateComplexity(normalizedQuery);\n\n\t// Build reason string\n\tconst reason = buildReason(winningType, normalizedQuery, scores, complexity);\n\n\treturn {\n\t\ttype: winningType,\n\t\tcomplexity,\n\t\tconfidence,\n\t\tweights: WEIGHT_CONFIGS[winningType],\n\t\treason,\n\t};\n}\n\n/**\n * Calculate factual score (specific lookups, exact terms)\n */\nfunction calculateFactualScore(query: string): number {\n\tlet score = 0;\n\tconst lowerQuery = query.toLowerCase();\n\n\t// Check prefixes (strong signal)\n\tfor (const pattern of PATTERNS.factual.prefixes) {\n\t\tif (pattern.test(query)) {\n\t\t\tscore += 0.45;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t// Check indicators (moderate signal) - accumulate more aggressively\n\tlet indicatorCount = 0;\n\tfor (const pattern of PATTERNS.factual.indicators) {\n\t\tif (pattern.test(query)) {\n\t\t\tindicatorCount++;\n\t\t}\n\t}\n\t// First indicator worth more, diminishing returns\n\tif (indicatorCount > 0) {\n\t\tscore += 0.25 + Math.min(indicatorCount - 1, 3) * 0.1;\n\t}\n\n\t// Exact match boost\n\tfor (const pattern of PATTERNS.factual.exactMatchBoost) {\n\t\tif (pattern.test(query)) {\n\t\t\tscore += 0.12;\n\t\t}\n\t}\n\n\t// Short queries with specific terms are likely factual (2-5 words)\n\tconst words = query.split(/\\s+/);\n\tif (words.length >= 2 && words.length <= 5 && score > 0) {\n\t\tscore += 0.15;\n\t}\n\n\t// Acronyms and abbreviations boost (but NOT when comparing them)\n\tconst acronymCount = (query.match(/\\b[A-Z]{2,}\\b/g) || []).length;\n\tconst hasComparison =\n\t\tlowerQuery.includes(\"vs\") ||\n\t\tlowerQuery.includes(\"versus\") ||\n\t\tlowerQuery.includes(\"between\") ||\n\t\tlowerQuery.includes(\"trade-off\") ||\n\t\tlowerQuery.includes(\"tradeoff\") ||\n\t\tlowerQuery.includes(\"compare\");\n\t// Reduce acronym boost when comparing (likely conceptual)\n\tscore += acronymCount * (hasComparison ? 0.05 : 0.15);\n\n\t// Pure code snippet detection (no question words, just code)\n\tif (/^(?:const|let|var|function|class|import|export|async|await)\\s/.test(query)) {\n\t\tscore += 0.3;\n\t}\n\n\treturn Math.min(1.0, score);\n}\n\n/**\n * Calculate conceptual score (understanding, reasoning)\n */\nfunction calculateConceptualScore(query: string): number {\n\tlet score = 0;\n\tconst lowerQuery = query.toLowerCase();\n\n\t// Check prefixes (strong signal)\n\tfor (const pattern of PATTERNS.conceptual.prefixes) {\n\t\tif (pattern.test(query)) {\n\t\t\tscore += 0.55;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t// Check indicators - accumulate\n\tlet indicatorCount = 0;\n\tfor (const pattern of PATTERNS.conceptual.indicators) {\n\t\tif (pattern.test(query)) {\n\t\t\tindicatorCount++;\n\t\t}\n\t}\n\tif (indicatorCount > 0) {\n\t\tscore += 0.25 + Math.min(indicatorCount - 1, 2) * 0.15;\n\t}\n\n\t// Longer queries tend to be more conceptual\n\tconst words = query.split(/\\s+/);\n\tif (words.length > 8) {\n\t\tscore += 0.15;\n\t}\n\n\t// \"What is the purpose\" pattern (strong conceptual signal)\n\tif (/what\\s+is\\s+the\\s+purpose/i.test(query)) {\n\t\tscore += 0.4;\n\t}\n\n\t// \"How does X work\" pattern (conceptual about understanding)\n\tif (/how\\s+does\\s+.*\\s+work/i.test(query)) {\n\t\tscore += 0.35;\n\t}\n\n\t// \"WHY\" anywhere in caps suggests emphasis on reasoning\n\tif (/\\bWHY\\b/.test(query)) {\n\t\tscore += 0.3;\n\t}\n\n\t// \"why does X\" with code identifiers is still conceptual (understanding behavior)\n\t// Boost to counter code identifier factual boost\n\tif (/^why\\s+does\\s+/i.test(query)) {\n\t\tconst hasCodeIdentifier = /\\b[A-Z][a-z]+[A-Z]\\w+\\b/.test(query) || /\\b[a-z]+_[a-z]+\\b/.test(query);\n\t\tif (hasCodeIdentifier) {\n\t\t\tscore += 0.35; // Extra boost to overcome code identifier factual score\n\t\t}\n\t}\n\n\t// \"best practices\" is conceptual\n\tif (lowerQuery.includes(\"best practice\")) {\n\t\tscore += 0.3;\n\t}\n\n\t// \"trade-off\" is explicitly conceptual (comparing approaches)\n\tif (lowerQuery.includes(\"trade-off\") || lowerQuery.includes(\"tradeoff\") || lowerQuery.includes(\"trade off\")) {\n\t\tscore += 0.55;\n\t}\n\n\t// Comparisons with acronyms are conceptual (e.g., \"JWT vs session\")\n\tconst hasComparison =\n\t\tlowerQuery.includes(\" vs \") ||\n\t\tlowerQuery.includes(\" versus \") ||\n\t\tlowerQuery.includes(\"difference between\") ||\n\t\tlowerQuery.includes(\"compare \");\n\tconst acronymCount = (query.match(/\\b[A-Z]{2,}\\b/g) || []).length;\n\tif (hasComparison && acronymCount > 0) {\n\t\tscore += 0.4; // Strong conceptual signal when comparing acronyms\n\t}\n\n\t// \"what is the difference\" pattern (explicitly conceptual)\n\tif (/what\\s+is\\s+the\\s+difference/i.test(query)) {\n\t\tscore += 0.45;\n\t}\n\n\treturn Math.min(1.0, score);\n}\n\n/**\n * Calculate exploratory score (general browsing, open-ended)\n */\nfunction calculateExploratoryScore(query: string): number {\n\tlet score = 0.15; // Lower base score - exploratory is fallback, not default\n\n\t// Check prefixes\n\tfor (const pattern of PATTERNS.exploratory.prefixes) {\n\t\tif (pattern.test(query)) {\n\t\t\tscore += 0.25;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t// Check indicators\n\tfor (const pattern of PATTERNS.exploratory.indicators) {\n\t\tif (pattern.test(query)) {\n\t\t\tscore += 0.15;\n\t\t}\n\t}\n\n\t// Medium-length queries are often exploratory\n\tconst words = query.split(/\\s+/);\n\tif (words.length >= 4 && words.length <= 8) {\n\t\tscore += 0.1;\n\t}\n\n\t// Questions ending with \"?\" without strong signals elsewhere\n\tif (/\\?$/.test(query) && words.length <= 6) {\n\t\tscore += 0.1;\n\t}\n\n\treturn Math.min(1.0, score);\n}\n\n/**\n * Build a human-readable reason for the classification\n */\nfunction buildReason(\n\ttype: QueryType,\n\tquery: string,\n\tscores: Record<QueryType, number>,\n\tcomplexity: QueryComplexity,\n): string {\n\tconst scoreStr = Object.entries(scores)\n\t\t.map(([t, s]) => `${t}=${s.toFixed(2)}`)\n\t\t.join(\", \");\n\n\tconst complexityStr = `[${complexity}]`;\n\n\tswitch (type) {\n\t\tcase \"factual\":\n\t\t\tif (/\\b[A-Z][a-z]+[A-Z]\\w+\\b/.test(query)) {\n\t\t\t\treturn `CamelCase identifier detected ${complexityStr} (${scoreStr})`;\n\t\t\t}\n\t\t\tif (/^(?:what|where|which|how\\s+to)\\s+/i.test(query)) {\n\t\t\t\treturn `Factual prefix pattern ${complexityStr} (${scoreStr})`;\n\t\t\t}\n\t\t\treturn `Technical term patterns ${complexityStr} (${scoreStr})`;\n\n\t\tcase \"conceptual\":\n\t\t\tif (/^why\\s+/i.test(query)) {\n\t\t\t\treturn `\"Why\" question ${complexityStr} (${scoreStr})`;\n\t\t\t}\n\t\t\tif (/^explain\\s+/i.test(query)) {\n\t\t\t\treturn `Explanation request ${complexityStr} (${scoreStr})`;\n\t\t\t}\n\t\t\treturn `Conceptual indicators ${complexityStr} (${scoreStr})`;\n\n\t\tcase \"exploratory\":\n\t\t\treturn `General exploration ${complexityStr} (${scoreStr})`;\n\t}\n}\n\n/**\n * Get weight configuration for a specific query type\n */\nexport function getWeightsForType(type: QueryType): { semantic: number; keyword: number } {\n\treturn { ...WEIGHT_CONFIGS[type] };\n}\n\n/**\n * Validate that weights sum to 1.0\n */\nexport function validateWeights(weights: { semantic: number; keyword: number }): boolean {\n\tconst sum = weights.semantic + weights.keyword;\n\treturn Math.abs(sum - 1.0) < 0.01;\n}\n\n/**\n * Calculate query complexity for retrieval strategy selection\n *\n * @see https://arxiv.org/abs/2501.07391 - Adaptive RAG complexity classification\n *\n * Complexity levels:\n * - simple: Short queries, single entity lookups (skip or minimal retrieval)\n * - moderate: Standard queries (normal retrieval)\n * - complex: Multi-part questions, comparisons, conditionals (aggressive retrieval)\n */\nexport function calculateComplexity(query: string): QueryComplexity {\n\tconst words = query.split(/\\s+/).filter((w) => w.length > 0);\n\tconst wordCount = words.length;\n\n\tlet complexityScore = 0;\n\n\t// Word count impact - standard queries (5-10 words) get baseline boost\n\tif (wordCount < 4) {\n\t\tcomplexityScore -= 0.3;\n\t} else if (wordCount >= 5 && wordCount <= 10) {\n\t\tcomplexityScore += 0.1; // Standard queries baseline\n\t} else if (wordCount > 15) {\n\t\tcomplexityScore += 0.4;\n\t} else if (wordCount > 10) {\n\t\tcomplexityScore += 0.2;\n\t}\n\n\t// Multiple clauses indicate complexity\n\tconst hasMultipleClauses = /\\b(and|or|but|while|whereas|although)\\b/i.test(query);\n\tif (hasMultipleClauses) {\n\t\tcomplexityScore += 0.25;\n\t}\n\n\t// Comparisons add complexity\n\tconst hasComparison = /\\b(compare|vs\\.?|versus|difference\\s+between|better\\s+than|worse\\s+than)\\b/i.test(query);\n\tif (hasComparison) {\n\t\tcomplexityScore += 0.25;\n\t}\n\n\t// Conditionals add complexity\n\tconst hasConditional = /\\b(if|when|unless|whether|in\\s+case|depending)\\b/i.test(query);\n\tif (hasConditional) {\n\t\tcomplexityScore += 0.2;\n\t}\n\n\t// Multiple questions in one query\n\tconst questionCount = (query.match(/\\?/g) || []).length;\n\tif (questionCount > 1) {\n\t\tcomplexityScore += 0.3;\n\t}\n\n\t// Multi-part structure (e.g., \"first... then... finally\")\n\tconst hasSequence = /\\b(first|then|next|finally|also|additionally|furthermore)\\b/i.test(query);\n\tif (hasSequence) {\n\t\tcomplexityScore += 0.15;\n\t}\n\n\t// Nested concepts (e.g., \"how does X affect Y's Z\")\n\tconst hasPossessive = /'s\\s+\\w+/.test(query) || /\\bof\\s+the\\s+\\w+/.test(query);\n\tif (hasPossessive && wordCount > 6) {\n\t\tcomplexityScore += 0.1;\n\t}\n\n\t// Simple patterns that reduce complexity\n\tconst isSimpleLookup = /^(?:what\\s+is|where\\s+is|show\\s+me|find|get)\\s+\\w+$/i.test(query);\n\tif (isSimpleLookup) {\n\t\tcomplexityScore -= 0.4;\n\t}\n\n\t// Single entity lookup\n\tconst isSingleEntity = wordCount <= 3 && /^[A-Z]\\w+$/.test(words[0] || \"\");\n\tif (isSingleEntity) {\n\t\tcomplexityScore -= 0.3;\n\t}\n\n\t// Classify based on score\n\t// Thresholds calibrated for: simple (<0.1), moderate (0.1-0.35), complex (>0.35)\n\tif (complexityScore < 0.1) {\n\t\treturn \"simple\";\n\t}\n\tif (complexityScore <= 0.35) {\n\t\treturn \"moderate\";\n\t}\n\treturn \"complex\";\n}\n\n/**\n * Get retrieval strategy based on query complexity and type\n *\n * @see https://www.meilisearch.com/blog/adaptive-rag\n *\n * Strategies:\n * - simple + high confidence: skip retrieval or use k=3\n * - moderate: standard k=10 with reranking\n * - complex: aggressive k=20 with reranking and expansion\n */\nexport function getRetrievalStrategy(\n\tcomplexity: QueryComplexity,\n\ttype: QueryType,\n\tconfidence: number,\n): RetrievalStrategy {\n\t// Simple queries with high confidence can skip or minimize retrieval\n\tif (complexity === \"simple\" && confidence > 0.85) {\n\t\treturn {\n\t\t\tshouldRetrieve: false, // Skip retrieval - LLM can handle\n\t\t\ttopK: 0,\n\t\t\tuseReranking: false,\n\t\t\tuseExpansion: false,\n\t\t};\n\t}\n\n\tif (complexity === \"simple\") {\n\t\treturn {\n\t\t\tshouldRetrieve: true,\n\t\t\ttopK: 3, // Minimal retrieval\n\t\t\tuseReranking: false,\n\t\t\tuseExpansion: false,\n\t\t};\n\t}\n\n\t// Moderate complexity: standard retrieval with reranking\n\tif (complexity === \"moderate\") {\n\t\treturn {\n\t\t\tshouldRetrieve: true,\n\t\t\ttopK: 10,\n\t\t\tuseReranking: true,\n\t\t\tuseExpansion: type === \"factual\", // Expand factual queries\n\t\t};\n\t}\n\n\t// Complex queries: aggressive retrieval\n\treturn {\n\t\tshouldRetrieve: true,\n\t\ttopK: 20,\n\t\tuseReranking: true,\n\t\tuseExpansion: true,\n\t};\n}\n\n/**\n * Code-related synonyms for query expansion\n * Used for factual queries to improve recall\n */\nexport const CODE_SYNONYMS: Record<string, string[]> = {\n\tfunction: [\"method\", \"fn\", \"func\", \"handler\", \"callback\"],\n\tclass: [\"type\", \"interface\", \"struct\", \"model\"],\n\terror: [\"exception\", \"bug\", \"issue\", \"failure\", \"fault\"],\n\timport: [\"require\", \"include\", \"use\", \"dependency\"],\n\tconfig: [\"configuration\", \"settings\", \"options\", \"prefs\"],\n\tapi: [\"endpoint\", \"route\", \"service\", \"handler\"],\n\tdatabase: [\"db\", \"store\", \"persistence\", \"repository\"],\n\ttest: [\"spec\", \"unit test\", \"assertion\", \"check\"],\n\tcomponent: [\"widget\", \"element\", \"module\", \"part\"],\n\tstate: [\"data\", \"store\", \"context\", \"props\"],\n};\n\n/**\n * Expand query with code synonyms for better recall\n * Only expands factual queries to avoid noise\n *\n * @param query - Original query\n * @param type - Query type\n * @returns Array of query variants (original + expanded)\n */\nexport function expandQuery(query: string, type: QueryType): string[] {\n\t// Only expand factual queries\n\tif (type !== \"factual\") {\n\t\treturn [query];\n\t}\n\n\tconst expanded = [query];\n\tconst lowerQuery = query.toLowerCase();\n\n\tfor (const [term, synonyms] of Object.entries(CODE_SYNONYMS)) {\n\t\tif (lowerQuery.includes(term)) {\n\t\t\t// Add one synonym variant per term found\n\t\t\tconst synonym = synonyms[0]; // Use first synonym\n\t\t\tif (synonym) {\n\t\t\t\texpanded.push(query.replace(new RegExp(`\\\\b${term}\\\\b`, \"gi\"), synonym));\n\t\t\t}\n\t\t}\n\t}\n\n\t// Limit to 3 variants to avoid over-expansion\n\treturn expanded.slice(0, 3);\n}\n","/**\n * Advisory Context Types\n *\n * Structured warnings, suggestions, and contextual guidance for LLMs.\n *\n * Based on research:\n * - GitHub Copilot Autofix - structured feedback model\n * - CodeGuard security framework - layered warnings\n * - Context Engineering patterns - proactive guidance\n */\n\n/**\n * Warning severity levels\n */\nexport type WarningSeverity = \"error\" | \"warning\" | \"info\";\n\n/**\n * Structured warning with code reference\n */\nexport interface AdvisoryWarning {\n\t/** Severity level */\n\tlevel: WarningSeverity;\n\t/** Warning code (e.g., 'FRAGILE_FILE', 'LOOP_DETECTED') */\n\tcode: string;\n\t/** Human-readable message */\n\tmessage: string;\n\t/** File path (if applicable) */\n\tfile?: string;\n\t/** Line number (if applicable) */\n\tline?: number;\n\t/** Related files */\n\trelatedFiles?: string[];\n\t/** Suggested action */\n\tsuggestion?: string;\n\t/** Documentation link */\n\tdocUrl?: string;\n}\n\n/**\n * File history context\n */\nexport interface FileHistory {\n\t/** File path */\n\tpath: string;\n\t/** Modifications today */\n\tmodificationsToday: number;\n\t/** Modifications this session */\n\tmodificationsThisSession: number;\n\t/** Rollbacks this week */\n\trollbacksThisWeek: number;\n\t/** Last modified by (user/agent) */\n\tlastModifiedBy: string;\n\t/** Last modified timestamp */\n\tlastModified: number;\n\t/** Fragility score (0-1, 1 = very fragile) */\n\tfragilityScore: number;\n\t/** Average time to rollback (ms) */\n\taverageTimeToRollback?: number;\n}\n\n/**\n * Related file suggestion\n */\nexport interface RelatedFile {\n\t/** File path */\n\tpath: string;\n\t/** Relationship reason */\n\treason: string;\n\t/** Co-change frequency (0-1) */\n\tcoChangeFrequency?: number;\n}\n\n/**\n * Proactive suggestion for LLM\n */\nexport interface ProactiveSuggestion {\n\t/** Suggestion text */\n\ttext: string;\n\t/** Priority (1 = highest) */\n\tpriority: number;\n\t/** Confidence (0-1) */\n\tconfidence: number;\n\t/** Category */\n\tcategory: \"testing\" | \"snapshot\" | \"validation\" | \"documentation\" | \"safety\";\n\t/** Relevant files */\n\tfiles?: string[];\n}\n\n/**\n * Advisory context enrichment\n * Injected into every tool response to guide LLM behavior\n */\nexport interface AdvisoryContext {\n\t/** Brief summary for LLM */\n\tsummary: string;\n\n\t/** Structured warnings */\n\twarnings: AdvisoryWarning[];\n\n\t/** Proactive suggestions (ranked by priority) */\n\tsuggestions: ProactiveSuggestion[];\n\n\t/** Related files to consider */\n\trelatedFiles: RelatedFile[];\n\n\t/** Historical context for relevant files */\n\tfileHistory: FileHistory[];\n\n\t/** Session-level context */\n\tsession?: {\n\t\t/** Current risk level */\n\t\triskLevel: \"low\" | \"medium\" | \"high\" | \"critical\";\n\t\t/** Tool calls so far */\n\t\ttoolCallCount: number;\n\t\t/** Files modified so far */\n\t\tfilesModified: number;\n\t\t/** Loops detected */\n\t\tloopsDetected: number;\n\t};\n\n\t/** Next recommended actions (for tool chaining) */\n\tnextActions?: string[];\n}\n\n/**\n * Advisory rule for generating context\n */\nexport interface AdvisoryRule {\n\t/** Rule ID */\n\tid: string;\n\t/** Trigger condition */\n\ttrigger: (context: AdvisoryTriggerContext) => boolean;\n\t/** Generate advisory content */\n\tgenerate: (context: AdvisoryTriggerContext) => Partial<AdvisoryContext>;\n\t/** Priority (1 = highest) */\n\tpriority: number;\n}\n\n/**\n * Context available to advisory rules\n */\nexport interface AdvisoryTriggerContext {\n\t/** Current tool call */\n\ttoolCall?: {\n\t\tname: string;\n\t\targs: Record<string, unknown>;\n\t};\n\t/** Target files */\n\tfiles: string[];\n\t/** Session state */\n\tsession: {\n\t\triskLevel: \"low\" | \"medium\" | \"high\" | \"critical\";\n\t\ttoolCallCount: number;\n\t\tfilesModified: number;\n\t\tloopsDetected: number;\n\t\tconsecutiveFileModifications: Map<string, number>;\n\t};\n\t/** File fragility scores */\n\tfragility: Map<string, number>;\n\t/** Recent violations */\n\trecentViolations: Array<{ type: string; file: string }>;\n}\n\n/**\n * Advisory engine configuration\n */\nexport interface AdvisoryConfig {\n\t/** Enable advisory enrichment */\n\tenabled: boolean;\n\t/** Max warnings per response */\n\tmaxWarnings: number;\n\t/** Max suggestions per response */\n\tmaxSuggestions: number;\n\t/** Max related files */\n\tmaxRelatedFiles: number;\n\t/** Include session context */\n\tincludeSessionContext: boolean;\n\t/** Include file history */\n\tincludeFileHistory: boolean;\n\t/** Custom advisory rules */\n\tcustomRules?: AdvisoryRule[];\n}\n\n/**\n * Default advisory configuration\n */\nexport const DEFAULT_ADVISORY_CONFIG: AdvisoryConfig = {\n\tenabled: true,\n\tmaxWarnings: 5,\n\tmaxSuggestions: 3,\n\tmaxRelatedFiles: 5,\n\tincludeSessionContext: true,\n\tincludeFileHistory: true,\n};\n","/**\n * Logger for Intelligence package\n *\n * Uses the contracts Logger interface for consistency across packages.\n * Wraps createLogger from @snapback/contracts with intelligence-specific configuration.\n */\n\nimport { createLogger, type Logger } from \"@snapback/contracts\";\n\n/**\n * Intelligence package logger instance\n * Uses contracts' createLogger for consistent logging interface\n */\nexport const logger: Logger = createLogger({\n\tname: \"intelligence\",\n\ttimestamps: process.env.NODE_ENV !== \"test\",\n});\n","/**\n * Consecutive Modification Rule\n *\n * Triggers warnings when files are modified repeatedly in session.\n * Indicates potential thrashing or uncertainty about implementation.\n */\n\nimport type { AdvisoryRule, AdvisoryWarning } from \"../../types/advisory.js\";\n\nexport const ConsecutiveModificationRule: AdvisoryRule = {\n\tid: \"consecutive-modification-warning\",\n\tpriority: 1,\n\ttrigger: (ctx) => {\n\t\tfor (const [_file, count] of ctx.session.consecutiveFileModifications.entries()) {\n\t\t\tif (count >= 3) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\tgenerate: (ctx) => {\n\t\tconst warnings: AdvisoryWarning[] = [];\n\n\t\tfor (const [file, count] of ctx.session.consecutiveFileModifications.entries()) {\n\t\t\tif (count >= 3) {\n\t\t\t\twarnings.push({\n\t\t\t\t\tlevel: \"warning\",\n\t\t\t\t\tcode: \"CONSECUTIVE_MODIFICATIONS\",\n\t\t\t\t\tmessage: `File modified ${count} times this session`,\n\t\t\t\t\tfile,\n\t\t\t\t\tsuggestion: \"Consider creating a snapshot before further modifications\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn { warnings };\n\t},\n};\n","/**\n * Fragile File Rule\n *\n * Triggers warnings when files have high fragility scores.\n * Fragility indicates rollback risk based on historical patterns.\n */\n\nimport type { AdvisoryRule, AdvisoryWarning } from \"../../types/advisory.js\";\n\n/**\n * Fragility score thresholds (0-1 where 1 = very fragile)\n */\nconst FRAGILITY_THRESHOLDS = {\n\t/** Critical fragility - file very prone to rollbacks */\n\tHIGH: 0.7,\n\t/** Moderate fragility - file somewhat prone to issues */\n\tMODERATE: 0.5,\n} as const;\n\nexport const FragileFileRule: AdvisoryRule = {\n\tid: \"fragile-file-warning\",\n\tpriority: 2,\n\ttrigger: (ctx) => {\n\t\tfor (const [_file, score] of ctx.fragility.entries()) {\n\t\t\tif (score > FRAGILITY_THRESHOLDS.MODERATE) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\tgenerate: (ctx) => {\n\t\tconst warnings: AdvisoryWarning[] = [];\n\n\t\tfor (const [file, score] of ctx.fragility.entries()) {\n\t\t\tif (score > FRAGILITY_THRESHOLDS.HIGH) {\n\t\t\t\twarnings.push({\n\t\t\t\t\tlevel: \"error\",\n\t\t\t\t\tcode: \"FRAGILE_FILE\",\n\t\t\t\t\tmessage: `File has high fragility score (${(score * 100).toFixed(0)}%)`,\n\t\t\t\t\tfile,\n\t\t\t\t\tsuggestion: \"Create snapshot before modifying - high rollback risk\",\n\t\t\t\t});\n\t\t\t} else if (score > FRAGILITY_THRESHOLDS.MODERATE) {\n\t\t\t\twarnings.push({\n\t\t\t\t\tlevel: \"warning\",\n\t\t\t\t\tcode: \"FRAGILE_FILE\",\n\t\t\t\t\tmessage: `File has moderate fragility score (${(score * 100).toFixed(0)}%)`,\n\t\t\t\t\tfile,\n\t\t\t\t\tsuggestion: \"Proceed with caution - potential rollback risk\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn { warnings };\n\t},\n};\n","/**\n * Generic Suggestions Rule\n *\n * Provides general best-practice suggestions based on session context.\n * Always applies - serves as baseline guidance.\n */\n\nimport type { AdvisoryRule, ProactiveSuggestion } from \"../../types/advisory.js\";\n\n/**\n * Session activity threshold for complexity warning\n */\nconst HIGH_TOOL_CALL_THRESHOLD = 20;\n\n/**\n * File type detection helpers\n */\nconst isTestFile = (file: string): boolean => /\\.(test|spec)\\.(ts|tsx|js|jsx)$/.test(file);\nconst isCodeFile = (file: string): boolean => /\\.(ts|tsx|js|jsx)$/.test(file);\n\nexport const GenericSuggestionsRule: AdvisoryRule = {\n\tid: \"generic-suggestions\",\n\tpriority: 10, // Low priority (runs last)\n\ttrigger: () => true, // Always applies\n\tgenerate: (ctx) => {\n\t\tconst suggestions: ProactiveSuggestion[] = [];\n\n\t\t// Snapshot suggestion for medium+ risk\n\t\tif (ctx.session.riskLevel === \"medium\" || ctx.session.riskLevel === \"high\") {\n\t\t\tsuggestions.push({\n\t\t\t\ttext: \"Create snapshot before continuing\",\n\t\t\t\tpriority: 1,\n\t\t\t\tconfidence: 0.8,\n\t\t\t\tcategory: \"snapshot\",\n\t\t\t\tfiles: ctx.files,\n\t\t\t});\n\t\t}\n\n\t\t// Testing suggestion for code changes\n\t\tif (ctx.files.some((f) => isCodeFile(f) && !isTestFile(f))) {\n\t\t\tsuggestions.push({\n\t\t\t\ttext: \"Run tests before committing\",\n\t\t\t\tpriority: 2,\n\t\t\t\tconfidence: 0.9,\n\t\t\t\tcategory: \"testing\",\n\t\t\t});\n\t\t}\n\n\t\t// Validation suggestion for high tool call count\n\t\tif (ctx.session.toolCallCount > HIGH_TOOL_CALL_THRESHOLD) {\n\t\t\tsuggestions.push({\n\t\t\t\ttext: \"Review changes - high tool call count may indicate complexity\",\n\t\t\t\tpriority: 3,\n\t\t\t\tconfidence: 0.7,\n\t\t\t\tcategory: \"validation\",\n\t\t\t});\n\t\t}\n\n\t\treturn { suggestions };\n\t},\n};\n","/**\n * Loop Detection Rule\n *\n * Triggers warnings when session loop detection indicates repeated operations.\n * Helps prevent infinite loops and wasted LLM cycles.\n */\n\nimport type { AdvisoryRule, AdvisoryWarning } from \"../../types/advisory.js\";\n\nexport const LoopDetectionRule: AdvisoryRule = {\n\tid: \"loop-detection-warning\",\n\tpriority: 1, // High priority - critical safety issue\n\ttrigger: (ctx) => {\n\t\treturn ctx.session.loopsDetected > 0;\n\t},\n\tgenerate: (ctx) => {\n\t\tconst warnings: AdvisoryWarning[] = [];\n\n\t\tif (ctx.session.loopsDetected > 0) {\n\t\t\twarnings.push({\n\t\t\t\tlevel: \"error\",\n\t\t\t\tcode: \"LOOP_DETECTED\",\n\t\t\t\tmessage: `${ctx.session.loopsDetected} loop${ctx.session.loopsDetected > 1 ? \"s\" : \"\"} detected in session`,\n\t\t\t\tsuggestion: \"Review recent tool calls - may be repeating same operations\",\n\t\t\t});\n\t\t}\n\n\t\treturn { warnings };\n\t},\n};\n","/**\n * Skipped Test Rule\n *\n * Advisory rule that detects skipped tests (describe.skip, it.skip, test.skip)\n * and generates proactive suggestions for AI agents.\n *\n * This enables the \"proactive pattern suggestions\" feature from the\n * Session Feedback Implementation spec.\n *\n * @module advisory/rules/SkippedTestRule\n */\n\nimport { detectSkippedTests, type SkippedTestResult } from \"@snapback/core/analysis\";\nimport type { AdvisoryRule, ProactiveSuggestion } from \"../../types/advisory.js\";\n\n/**\n * Check if a file is a test file\n */\nfunction isTestFile(filePath: string): boolean {\n\treturn filePath.includes(\".test.\") || filePath.includes(\".spec.\") || filePath.includes(\"__tests__\");\n}\n\n/**\n * SkippedTestRule - Detects skipped tests and generates suggestions\n *\n * Triggers when any test file is in the target files list.\n * Generates suggestions based on skipped test count:\n * - 1-2 skipped: priority 3 (low)\n * - 3-5 skipped: priority 2 (medium)\n * - 6+ skipped: priority 1 (high)\n */\nexport const SkippedTestRule: AdvisoryRule = {\n\tid: \"skipped-vitest-tests\",\n\tpriority: 2,\n\n\t/**\n\t * Trigger when any test file is in the target files\n\t */\n\ttrigger: (ctx) => {\n\t\treturn ctx.files.some(isTestFile);\n\t},\n\n\t/**\n\t * Generate suggestions based on skipped tests detected\n\t */\n\tgenerate: (ctx) => {\n\t\tconst suggestions: ProactiveSuggestion[] = [];\n\t\tconst allSkipped: SkippedTestResult[] = [];\n\t\tconst filesWithSkipped: string[] = [];\n\n\t\t// Analyze each test file\n\t\tfor (const file of ctx.files) {\n\t\t\tif (!isTestFile(file)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\t// Get code content - may come from context or need to be read\n\t\t\t\t// For now, we use detectSkippedTests which requires code content\n\t\t\t\t// The actual code reading happens in the facade that calls this rule\n\t\t\t\tconst code = (ctx as { code?: string }).code;\n\t\t\t\tif (!code) {\n\t\t\t\t\t// No code available, skip this file\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst result = detectSkippedTests(code, file);\n\t\t\t\tif (result.parsed && result.skipped.length > 0) {\n\t\t\t\t\tallSkipped.push(result);\n\t\t\t\t\tfilesWithSkipped.push(file);\n\t\t\t\t}\n\t\t\t} catch {}\n\t\t}\n\n\t\t// Calculate total skipped tests\n\t\tconst totalSkipped = allSkipped.reduce((sum, r) => sum + r.skipped.length, 0);\n\n\t\tif (totalSkipped === 0) {\n\t\t\treturn { suggestions: [] };\n\t\t}\n\n\t\t// Determine priority based on count\n\t\tlet priority: number;\n\t\tif (totalSkipped >= 6) {\n\t\t\tpriority = 1; // High priority\n\t\t} else if (totalSkipped >= 3) {\n\t\t\tpriority = 2; // Medium priority\n\t\t} else {\n\t\t\tpriority = 3; // Low priority\n\t\t}\n\n\t\t// Generate suggestion\n\t\tconst filesList =\n\t\t\tfilesWithSkipped.length <= 3 ? filesWithSkipped.join(\", \") : `${filesWithSkipped.length} files`;\n\n\t\tsuggestions.push({\n\t\t\ttext: `Found ${totalSkipped} skipped test${totalSkipped > 1 ? \"s\" : \"\"} in ${filesList}. Consider re-enabling these tests or removing if obsolete.`,\n\t\t\tpriority,\n\t\t\tconfidence: 0.9,\n\t\t\tcategory: \"testing\",\n\t\t\tfiles: filesWithSkipped,\n\t\t});\n\n\t\treturn { suggestions };\n\t},\n};\n","/**\n * Violation History Rule\n *\n * Surfaces past violations for files being modified.\n * Helps prevent repeating past mistakes.\n */\n\nimport type { AdvisoryRule, AdvisoryWarning } from \"../../types/advisory.js\";\n\nexport const ViolationHistoryRule: AdvisoryRule = {\n\tid: \"violation-history-warning\",\n\tpriority: 3,\n\ttrigger: (ctx) => {\n\t\treturn ctx.recentViolations.length > 0;\n\t},\n\tgenerate: (ctx) => {\n\t\tconst warnings: AdvisoryWarning[] = [];\n\n\t\t// Group violations by file\n\t\tconst violationsByFile = new Map<string, string[]>();\n\t\tfor (const violation of ctx.recentViolations) {\n\t\t\tconst existing = violationsByFile.get(violation.file) ?? [];\n\t\t\texisting.push(violation.type);\n\t\t\tviolationsByFile.set(violation.file, existing);\n\t\t}\n\n\t\t// Generate warnings\n\t\tfor (const [file, types] of violationsByFile.entries()) {\n\t\t\tconst uniqueTypes = [...new Set(types)];\n\t\t\twarnings.push({\n\t\t\t\tlevel: \"warning\",\n\t\t\t\tcode: \"VIOLATION_HISTORY\",\n\t\t\t\tmessage: `${uniqueTypes.length} past violation type${uniqueTypes.length > 1 ? \"s\" : \"\"}: ${uniqueTypes.join(\", \")}`,\n\t\t\t\tfile,\n\t\t\t\tsuggestion: \"Review past mistakes before modifying\",\n\t\t\t});\n\t\t}\n\n\t\treturn { warnings };\n\t},\n};\n","/**\n * Advisory Engine\n *\n * Generates structured warnings, suggestions, and contextual guidance for LLMs.\n * Enriches every tool response with actionable intelligence.\n *\n * Based on research:\n * - GitHub Copilot Autofix - structured feedback model\n * - CodeGuard security framework - layered warnings\n * - Context Engineering patterns - proactive guidance\n */\n\nimport type {\n\tAdvisoryConfig,\n\tAdvisoryContext,\n\tAdvisoryRule,\n\tAdvisoryTriggerContext,\n\tAdvisoryWarning,\n\tFileHistory,\n\tProactiveSuggestion,\n\tRelatedFile,\n} from \"../types/advisory.js\";\nimport { DEFAULT_ADVISORY_CONFIG } from \"../types/advisory.js\";\nimport { logger } from \"../utils/logger.js\";\nimport {\n\tConsecutiveModificationRule,\n\tFragileFileRule,\n\tGenericSuggestionsRule,\n\tLoopDetectionRule,\n\tViolationHistoryRule,\n} from \"./rules/index.js\";\n\n/**\n * Advisory Engine\n *\n * Orchestrates multiple advisory rules to generate contextual guidance.\n * Rules are executed by priority and results are merged with limit enforcement.\n */\nexport class AdvisoryEngine {\n\tprivate config: AdvisoryConfig;\n\tprivate rules: AdvisoryRule[] = [];\n\n\tconstructor(config: Partial<AdvisoryConfig> = {}) {\n\t\t// Validate configuration\n\t\tif (config.maxWarnings !== undefined && config.maxWarnings < 0) {\n\t\t\tthrow new Error(\"AdvisoryConfig.maxWarnings must be non-negative\");\n\t\t}\n\t\tif (config.maxSuggestions !== undefined && config.maxSuggestions < 0) {\n\t\t\tthrow new Error(\"AdvisoryConfig.maxSuggestions must be non-negative\");\n\t\t}\n\t\tif (config.maxRelatedFiles !== undefined && config.maxRelatedFiles < 0) {\n\t\t\tthrow new Error(\"AdvisoryConfig.maxRelatedFiles must be non-negative\");\n\t\t}\n\n\t\tthis.config = { ...DEFAULT_ADVISORY_CONFIG, ...config };\n\t\tthis.initializeBuiltInRules();\n\t}\n\n\t/**\n\t * Initialize built-in advisory rules\n\t */\n\tprivate initializeBuiltInRules(): void {\n\t\t// Register modular rules\n\t\tthis.registerRule(ConsecutiveModificationRule);\n\t\tthis.registerRule(FragileFileRule);\n\t\tthis.registerRule(LoopDetectionRule);\n\t\tthis.registerRule(ViolationHistoryRule);\n\t\tthis.registerRule(GenericSuggestionsRule);\n\t}\n\n\t/**\n\t * Register a custom advisory rule\n\t * Uses insertion sort for O(n) performance with small rule counts\n\t */\n\tregisterRule(rule: AdvisoryRule): void {\n\t\t// Find insertion point using binary search for O(log n)\n\t\tlet left = 0;\n\t\tlet right = this.rules.length;\n\n\t\twhile (left < right) {\n\t\t\tconst mid = Math.floor((left + right) / 2);\n\t\t\tif (this.rules[mid].priority < rule.priority) {\n\t\t\t\tleft = mid + 1;\n\t\t\t} else {\n\t\t\t\tright = mid;\n\t\t\t}\n\t\t}\n\n\t\t// Insert at correct position\n\t\tthis.rules.splice(left, 0, rule);\n\t}\n\n\t/**\n\t * Enrich context with advisory guidance\n\t */\n\tenrich(context: AdvisoryTriggerContext): AdvisoryContext {\n\t\t// Disabled check\n\t\tif (!this.config.enabled) {\n\t\t\treturn {\n\t\t\t\tsummary: \"Advisory system disabled\",\n\t\t\t\twarnings: [],\n\t\t\t\tsuggestions: [],\n\t\t\t\trelatedFiles: [],\n\t\t\t\tfileHistory: [],\n\t\t\t};\n\t\t}\n\n\t\t// Build advisory context\n\t\tconst warnings: AdvisoryWarning[] = [];\n\t\tconst suggestions: ProactiveSuggestion[] = [];\n\t\tconst relatedFiles: RelatedFile[] = [];\n\n\t\t// Execute triggered rules\n\t\tfor (const rule of this.rules) {\n\t\t\ttry {\n\t\t\t\tif (rule.trigger(context)) {\n\t\t\t\t\tconst result = rule.generate(context);\n\n\t\t\t\t\tif (result.warnings) {\n\t\t\t\t\t\twarnings.push(...result.warnings);\n\t\t\t\t\t}\n\t\t\t\t\tif (result.suggestions) {\n\t\t\t\t\t\tsuggestions.push(...result.suggestions);\n\t\t\t\t\t}\n\t\t\t\t\tif (result.relatedFiles) {\n\t\t\t\t\t\trelatedFiles.push(...result.relatedFiles);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error(\"Advisory rule failed\", {\n\t\t\t\t\truleId: rule.id,\n\t\t\t\t\terror: error instanceof Error ? error.message : String(error),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Enforce limits\n\t\tconst limitedWarnings = warnings.slice(0, this.config.maxWarnings);\n\t\tconst limitedSuggestions = suggestions\n\t\t\t.sort((a, b) => a.priority - b.priority)\n\t\t\t.slice(0, this.config.maxSuggestions);\n\t\tconst limitedRelatedFiles = relatedFiles.slice(0, this.config.maxRelatedFiles);\n\n\t\t// Generate file history\n\t\tconst fileHistory = this.config.includeFileHistory ? this.generateFileHistory(context) : [];\n\n\t\t// Generate summary\n\t\tconst summary = this.generateSummary(context);\n\n\t\t// Build session context\n\t\tconst sessionContext = this.config.includeSessionContext\n\t\t\t? {\n\t\t\t\t\triskLevel: context.session.riskLevel,\n\t\t\t\t\ttoolCallCount: context.session.toolCallCount,\n\t\t\t\t\tfilesModified: context.session.filesModified,\n\t\t\t\t\tloopsDetected: context.session.loopsDetected,\n\t\t\t\t}\n\t\t\t: undefined;\n\n\t\treturn {\n\t\t\tsummary,\n\t\t\twarnings: limitedWarnings,\n\t\t\tsuggestions: limitedSuggestions,\n\t\t\trelatedFiles: limitedRelatedFiles,\n\t\t\tfileHistory,\n\t\t\tsession: sessionContext,\n\t\t};\n\t}\n\n\t/**\n\t * Generate file history for target files\n\t */\n\tprivate generateFileHistory(context: AdvisoryTriggerContext): FileHistory[] {\n\t\treturn context.files.map((file) => {\n\t\t\tconst modificationsThisSession = context.session.consecutiveFileModifications.get(file) ?? 0;\n\t\t\tconst fragilityScore = context.fragility.get(file) ?? 0;\n\n\t\t\treturn {\n\t\t\t\tpath: file,\n\t\t\t\t// Phase 2 Enhancement (INT-010): Add persistent file modification tracking\n\t\t\t\t// TODO: Would need persistent tracking across sessions\n\t\t\t\tmodificationsToday: 0,\n\t\t\t\tmodificationsThisSession,\n\t\t\t\t// Phase 2 Enhancement (INT-011): Integrate with FragilityTracker\n\t\t\t\t// TODO: Would need fragility tracker with rollback event history\n\t\t\t\trollbacksThisWeek: 0,\n\t\t\t\t// Phase 2 Enhancement (INT-012): Add git integration for author tracking\n\t\t\t\t// TODO: Would need git blame/log integration\n\t\t\t\tlastModifiedBy: \"unknown\",\n\t\t\t\tlastModified: Date.now(),\n\t\t\t\tfragilityScore,\n\t\t\t};\n\t\t});\n\t}\n\n\t/**\n\t * Generate summary text\n\t */\n\tprivate generateSummary(context: AdvisoryTriggerContext): string {\n\t\tif (context.files.length === 0) {\n\t\t\treturn \"No specific files targeted\";\n\t\t}\n\n\t\t// Find most modified file\n\t\tlet maxMods = 0;\n\t\tlet maxModFile = \"\";\n\t\tfor (const [file, count] of context.session.consecutiveFileModifications.entries()) {\n\t\t\tif (count > maxMods) {\n\t\t\t\tmaxMods = count;\n\t\t\t\tmaxModFile = file;\n\t\t\t}\n\t\t}\n\n\t\tif (maxMods > 0) {\n\t\t\tconst fragility = context.fragility.get(maxModFile) ?? 0;\n\t\t\tconst fragilityLevel =\n\t\t\t\tfragility > 0.7 ? \"HIGH\" : fragility > 0.5 ? \"MODERATE\" : fragility > 0.3 ? \"LOW\" : \"STABLE\";\n\n\t\t\treturn `${maxModFile} has been modified ${maxMods} times this session (fragility: ${fragilityLevel})`;\n\t\t}\n\n\t\treturn `Analyzing ${context.files.length} file${context.files.length > 1 ? \"s\" : \"\"}`;\n\t}\n\n\t/**\n\t * Get file history (stub for future implementation)\n\t */\n\tgetFileHistory(file: string): FileHistory {\n\t\treturn {\n\t\t\tpath: file,\n\t\t\tmodificationsToday: 0,\n\t\t\tmodificationsThisSession: 0,\n\t\t\trollbacksThisWeek: 0,\n\t\t\tlastModifiedBy: \"unknown\",\n\t\t\tlastModified: Date.now(),\n\t\t\tfragilityScore: 0,\n\t\t};\n\t}\n}\n","/**\n * Composer Core Types\n *\n * Type definitions for the deterministic context assembly system.\n * These types enable:\n * - Lane-based artifact categorization\n * - Type-safe artifact handling\n * - Privacy-safe references (no paths exposed)\n * - Shrinkable content for budget fitting\n */\n\n/**\n * Lanes categorize artifacts by purpose and priority.\n * Priority 0 = highest (always included first).\n */\nexport type Lane =\n\t| \"policy\" // Priority 0: Constraints, invariants, danger zones\n\t| \"rules\" // Priority 1: Protection rules, config\n\t| \"local\" // Priority 2: Current diff, recent edits\n\t| \"structure\" // Priority 3: Dependency graphs\n\t| \"retrieved\" // Priority 4: Semantic retrieval\n\t| \"history\"; // Priority 5: Session context\n\n/**\n * Lane priority mapping (lower = higher priority)\n */\nexport const LANE_PRIORITIES: Readonly<Record<Lane, number>> = {\n\tpolicy: 0,\n\trules: 1,\n\tlocal: 2,\n\tstructure: 3,\n\tretrieved: 4,\n\thistory: 5,\n} as const;\n\n/**\n * All valid lanes in priority order\n */\nexport const LANES_BY_PRIORITY: readonly Lane[] = [\n\t\"policy\",\n\t\"rules\",\n\t\"local\",\n\t\"structure\",\n\t\"retrieved\",\n\t\"history\",\n] as const;\n\n/**\n * Artifact kinds for fine-grained control.\n */\nexport type ArtifactKind =\n\t| \"constraint\" // Hard rules, invariants\n\t| \"rule_doc\" // Protection rules\n\t| \"local_diff\" // Current changes\n\t| \"recent_edit\" // Recent file edits\n\t| \"symbol_context\" // Symbol definitions\n\t| \"dependency_graph\" // Import/export relationships\n\t| \"test_context\" // Related tests\n\t| \"semantic_match\" // Embedding-based retrieval\n\t| \"session_history\" // Previous conversation context\n\t| \"violation\" // Recent violations\n\t| \"learning\"; // Relevant learnings\n\n/**\n * Kind priority mapping (lower = higher priority)\n */\nexport const KIND_PRIORITIES: Readonly<Record<ArtifactKind, number>> = {\n\tconstraint: 0,\n\trule_doc: 1,\n\tlocal_diff: 2,\n\trecent_edit: 3,\n\tsymbol_context: 4,\n\tdependency_graph: 5,\n\ttest_context: 6,\n\tsemantic_match: 7,\n\tsession_history: 8,\n\tviolation: 9,\n\tlearning: 10,\n} as const;\n\n/**\n * Shrink strategies per artifact kind.\n * Determines how content is reduced when budget is exceeded.\n */\nexport type ShrinkStrategy =\n\t| \"truncate_oldest\" // For diffs: drop oldest hunks first\n\t| \"keep_signatures\" // For code: keep signatures, drop bodies\n\t| \"collapse_summary\" // For graphs: collapse to summary\n\t| \"drop_entries\" // For history: drop oldest entries\n\t| \"never\"; // For rules: never shrink (hard constraint)\n\n/**\n * Reference to an artifact (safe for logs/telemetry).\n * Contains NO paths or content.\n */\nexport interface ArtifactRef {\n\t/** HMAC-based, stable, path-free identifier */\n\tid: string;\n\t/** The type of content this artifact contains */\n\tkind: ArtifactKind;\n\t/** The lane this artifact belongs to */\n\tlane: Lane;\n\t/** Estimated token count (may differ from actual) */\n\ttokenEstimate: number;\n}\n\n/**\n * Candidate artifact before selection.\n * Has content access internally but never exposes it in logs.\n */\nexport interface ArtifactCandidate extends ArtifactRef {\n\t/**\n\t * Recency bucket (0-5, higher = more recent)\n\t * Quantized to prevent time-based non-determinism\n\t */\n\trecencyBucket: number;\n\n\t/**\n\t * Relevance score (0-1, quantized to 0.001)\n\t * How well this artifact matches the current context\n\t */\n\trelevanceScore: number;\n\n\t/**\n\t * Specificity score (0-1, quantized to 0.001)\n\t * How targeted this artifact is to the specific task\n\t */\n\tspecificityScore: number;\n\n\t/**\n\t * Risk alignment (0-1)\n\t * How well this artifact relates to current risk factors\n\t */\n\triskAlignment: number;\n\n\t/**\n\t * Get the content of this artifact (internal use only, never logged)\n\t */\n\tgetContent(): string;\n\n\t/**\n\t * Create a shrunk version of this artifact to fit target tokens\n\t * @param targetTokens Maximum tokens for the result\n\t */\n\tshrink(targetTokens: number): RenderedArtifact;\n}\n\n/**\n * Rendered artifact with exact token count.\n * Content is internal only, never logged externally.\n */\nexport interface RenderedArtifact {\n\t/** HMAC-based, stable, path-free identifier */\n\tid: string;\n\t/** The type of content this artifact contains */\n\tkind: ArtifactKind;\n\t/** The lane this artifact belongs to */\n\tlane: Lane;\n\n\t/**\n\t * Final rendered content (internal only, never logged)\n\t */\n\tcontent: string;\n\n\t/**\n\t * Exact token count after rendering/shrinking\n\t */\n\texactTokenCount: number;\n\n\t/**\n\t * Whether this artifact was shrunk to fit budget\n\t */\n\tshrunk: boolean;\n\n\t/**\n\t * Original token count before shrinking (if shrunk)\n\t */\n\toriginalTokenCount?: number;\n\n\t/**\n\t * Strategy used for shrinking (if shrunk)\n\t */\n\tshrinkStrategy?: ShrinkStrategy;\n}\n\n/**\n * Token counting function type\n * Allows plugging in different tokenizers\n */\nexport type TokenCounter = (text: string) => number;\n\n/**\n * Default token counter using approximate word-based estimation\n * ~4 characters per token on average for English text\n */\nexport function defaultTokenCounter(text: string): number {\n\tif (!text) {\n\t\treturn 0;\n\t}\n\t// Approximation: ~4 characters per token\n\t// This is a reasonable estimate for GPT-style tokenizers\n\treturn Math.ceil(text.length / 4);\n}\n\n/**\n * Artifact source interface for generating candidates\n * Implemented by ContextEngine, PolicyEngine, etc.\n */\nexport interface ArtifactSource {\n\t/**\n\t * Generate artifact candidates for the given trigger\n\t * @param trigger What triggered this composition\n\t * @param workspaceSecret Secret for HMAC-based ID generation\n\t */\n\tgenerateCandidates(trigger: ComposeTriggerInput, workspaceSecret: string): Promise<ArtifactCandidate[]>;\n}\n\n/**\n * Input for triggering composition\n */\nexport interface ComposeTriggerInput {\n\t/** What triggered this composition */\n\tevent: string;\n\t/** Workspace fingerprint for cache keying */\n\tworkspaceFingerprint: string;\n\t/** Git commit or equivalent */\n\tcommitish?: string;\n\t/** Keywords for relevance scoring */\n\tkeywords?: string[];\n\t/** Files currently being edited */\n\tfiles?: string[];\n}\n\n/**\n * Validate that a value is a valid Lane\n */\nexport function isValidLane(value: string): value is Lane {\n\treturn value in LANE_PRIORITIES;\n}\n\n/**\n * Validate that a value is a valid ArtifactKind\n */\nexport function isValidArtifactKind(value: string): value is ArtifactKind {\n\treturn value in KIND_PRIORITIES;\n}\n\n/**\n * Compare two artifact refs by lane and kind priority\n * Returns negative if a comes before b, positive if after, 0 if equal\n */\nexport function compareArtifactPriority(a: ArtifactRef, b: ArtifactRef): number {\n\t// First compare by lane priority\n\tconst laneDiff = LANE_PRIORITIES[a.lane] - LANE_PRIORITIES[b.lane];\n\tif (laneDiff !== 0) {\n\t\treturn laneDiff;\n\t}\n\n\t// Then compare by kind priority\n\tconst kindDiff = KIND_PRIORITIES[a.kind] - KIND_PRIORITIES[b.kind];\n\tif (kindDiff !== 0) {\n\t\treturn kindDiff;\n\t}\n\n\t// Finally compare by ID for stability\n\treturn a.id.localeCompare(b.id);\n}\n","/**\n * Budget Configuration and Management\n *\n * Defines token budgets for each lane and enforces constraints:\n * - Minimum allocations per lane (guaranteed if content available)\n * - Maximum caps per lane (never exceeded)\n * - Total budget constraint (absolute limit)\n *\n * Invariant: sum(lane.min) <= totalTokens\n */\n\nimport type { Lane } from \"./types.js\";\nimport { LANES_BY_PRIORITY } from \"./types.js\";\n\n/**\n * Lane-specific budget configuration\n */\nexport interface LaneBudget {\n\t/** Minimum tokens to allocate (if available) */\n\tmin: number;\n\t/** Maximum tokens allowed */\n\tmax: number;\n\t/** Lower = higher priority (0 = highest) */\n\tpriority: number;\n}\n\n/**\n * Complete budget configuration\n */\nexport interface BudgetConfig {\n\t/** Total token budget (absolute limit) */\n\ttotalTokens: number;\n\t/** Per-lane budget configuration */\n\tlanes: Record<Lane, LaneBudget>;\n}\n\n/**\n * Default budget configuration.\n * Optimized for 8000 token context window.\n *\n * Invariant: sum(lane.min) = 1700 <= 8000 = totalTokens \n *\n * Lane breakdown:\n * - policy:    200-500   (Priority 0) - Constraints, invariants\n * - rules:     500-2000  (Priority 1) - Protection rules\n * - local:     1000-3000 (Priority 2) - Current diff, recent edits\n * - structure: 0-1500    (Priority 3) - Dependency graphs\n * - retrieved: 0-2000    (Priority 4) - Semantic retrieval\n * - history:   0-1000    (Priority 5) - Session context\n */\nexport const DEFAULT_BUDGET_CONFIG: BudgetConfig = {\n\ttotalTokens: 8000,\n\tlanes: {\n\t\tpolicy: { min: 200, max: 500, priority: 0 },\n\t\trules: { min: 500, max: 2000, priority: 1 },\n\t\tlocal: { min: 1000, max: 3000, priority: 2 },\n\t\tstructure: { min: 0, max: 1500, priority: 3 },\n\t\tretrieved: { min: 0, max: 2000, priority: 4 },\n\t\thistory: { min: 0, max: 1000, priority: 5 },\n\t},\n} as const;\n\n/**\n * Validate budget configuration.\n * Throws Error if invalid.\n *\n * Checks:\n * 1. Sum of lane mins doesn't exceed total\n * 2. Each lane's min <= max\n * 3. No negative values\n * 4. All lanes are defined\n *\n * @param config - Budget configuration to validate\n * @throws Error if configuration is invalid\n *\n * @example\n * // Valid config\n * validateBudgetConfig(DEFAULT_BUDGET_CONFIG); // OK\n *\n * // Invalid: mins exceed total\n * validateBudgetConfig({\n *   totalTokens: 1000,\n *   lanes: { policy: { min: 500, max: 600, priority: 0 }, ... }\n * }); // Throws\n */\nexport function validateBudgetConfig(config: BudgetConfig): void {\n\tif (!config) {\n\t\tthrow new Error(\"Budget config is required\");\n\t}\n\n\tif (!Number.isFinite(config.totalTokens) || config.totalTokens <= 0) {\n\t\tthrow new Error(`Invalid totalTokens: ${config.totalTokens}. Must be positive.`);\n\t}\n\n\t// Check all required lanes are defined\n\tfor (const lane of LANES_BY_PRIORITY) {\n\t\tif (!config.lanes[lane]) {\n\t\t\tthrow new Error(`Missing lane configuration: ${lane}`);\n\t\t}\n\t}\n\n\t// Calculate sum of minimums\n\tconst sumMins = Object.values(config.lanes).reduce((sum, lane) => sum + lane.min, 0);\n\n\tif (sumMins > config.totalTokens) {\n\t\tthrow new Error(\n\t\t\t`Invalid budget: sum of lane mins (${sumMins}) exceeds total (${config.totalTokens}). ` +\n\t\t\t\t\"Reduce mins or increase totalTokens.\",\n\t\t);\n\t}\n\n\t// Validate each lane\n\tfor (const [name, lane] of Object.entries(config.lanes)) {\n\t\tif (lane.min > lane.max) {\n\t\t\tthrow new Error(`Lane ${name}: min (${lane.min}) > max (${lane.max})`);\n\t\t}\n\t\tif (lane.min < 0) {\n\t\t\tthrow new Error(`Lane ${name}: negative min (${lane.min})`);\n\t\t}\n\t\tif (lane.max < 0) {\n\t\t\tthrow new Error(`Lane ${name}: negative max (${lane.max})`);\n\t\t}\n\t\tif (!Number.isFinite(lane.priority)) {\n\t\t\tthrow new Error(`Lane ${name}: invalid priority (${lane.priority})`);\n\t\t}\n\t}\n}\n\n/**\n * Get lanes sorted by priority (lowest first = highest priority)\n *\n * @param config - Budget configuration\n * @returns Lanes sorted by priority\n */\nexport function getLanesByPriority(config: BudgetConfig): Lane[] {\n\treturn (Object.entries(config.lanes) as [Lane, LaneBudget][])\n\t\t.sort((a, b) => a[1].priority - b[1].priority)\n\t\t.map(([lane]) => lane);\n}\n\n/**\n * Calculate available budget after minimums are satisfied\n *\n * @param config - Budget configuration\n * @returns Remaining budget for discretionary allocation\n */\nexport function getDiscretionaryBudget(config: BudgetConfig): number {\n\tconst sumMins = Object.values(config.lanes).reduce((sum, lane) => sum + lane.min, 0);\n\treturn config.totalTokens - sumMins;\n}\n\n/**\n * Create a modified budget config with adjusted total\n *\n * @param config - Base budget configuration\n * @param newTotal - New total token budget\n * @returns Modified configuration with scaled lanes\n */\nexport function withTotalBudget(config: BudgetConfig, newTotal: number): BudgetConfig {\n\tif (newTotal <= 0) {\n\t\tthrow new Error(`Invalid total budget: ${newTotal}`);\n\t}\n\n\tconst ratio = newTotal / config.totalTokens;\n\n\tconst newLanes = {} as Record<Lane, LaneBudget>;\n\tfor (const [lane, budget] of Object.entries(config.lanes) as [Lane, LaneBudget][]) {\n\t\tnewLanes[lane] = {\n\t\t\tmin: Math.floor(budget.min * ratio),\n\t\t\tmax: Math.floor(budget.max * ratio),\n\t\t\tpriority: budget.priority,\n\t\t};\n\t}\n\n\tconst result = {\n\t\ttotalTokens: newTotal,\n\t\tlanes: newLanes,\n\t};\n\n\t// Validate the result\n\tvalidateBudgetConfig(result);\n\n\treturn result;\n}\n\n/**\n * Create a budget config with lane overrides\n *\n * @param config - Base budget configuration\n * @param overrides - Lane-specific overrides\n * @returns Modified configuration\n */\nexport function withLaneOverrides(\n\tconfig: BudgetConfig,\n\toverrides: Partial<Record<Lane, Partial<LaneBudget>>>,\n): BudgetConfig {\n\tconst newLanes = {} as Record<Lane, LaneBudget>;\n\n\tfor (const [lane, budget] of Object.entries(config.lanes) as [Lane, LaneBudget][]) {\n\t\tconst override = overrides[lane];\n\t\tnewLanes[lane] = {\n\t\t\tmin: override?.min ?? budget.min,\n\t\t\tmax: override?.max ?? budget.max,\n\t\t\tpriority: override?.priority ?? budget.priority,\n\t\t};\n\t}\n\n\tconst result = {\n\t\ttotalTokens: config.totalTokens,\n\t\tlanes: newLanes,\n\t};\n\n\t// Validate the result\n\tvalidateBudgetConfig(result);\n\n\treturn result;\n}\n\n/**\n * Budget usage tracking\n */\nexport interface BudgetUsage {\n\t/** Tokens used per lane */\n\tbyLane: Record<Lane, number>;\n\t/** Total tokens used */\n\ttotal: number;\n\t/** Remaining budget */\n\tremaining: number;\n\t/** Per-lane remaining */\n\tremainingByLane: Record<Lane, number>;\n}\n\n/**\n * Create a new budget usage tracker\n *\n * @param config - Budget configuration\n * @returns Initial usage state\n */\nexport function createBudgetUsage(config: BudgetConfig): BudgetUsage {\n\tconst byLane = {} as Record<Lane, number>;\n\tconst remainingByLane = {} as Record<Lane, number>;\n\n\tfor (const [lane, budget] of Object.entries(config.lanes) as [Lane, LaneBudget][]) {\n\t\tbyLane[lane] = 0;\n\t\tremainingByLane[lane] = budget.max;\n\t}\n\n\treturn {\n\t\tbyLane,\n\t\ttotal: 0,\n\t\tremaining: config.totalTokens,\n\t\tremainingByLane,\n\t};\n}\n\n/**\n * Check if tokens can be allocated to a lane\n *\n * @param usage - Current usage state\n * @param config - Budget configuration\n * @param lane - Target lane\n * @param tokens - Tokens to allocate\n * @returns true if allocation is possible\n */\nexport function canAllocate(usage: BudgetUsage, config: BudgetConfig, lane: Lane, tokens: number): boolean {\n\tconst laneConfig = config.lanes[lane];\n\n\t// Check lane max\n\tif (usage.byLane[lane] + tokens > laneConfig.max) {\n\t\treturn false;\n\t}\n\n\t// Check total budget\n\tif (usage.total + tokens > config.totalTokens) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\n/**\n * Allocate tokens to a lane\n *\n * @param usage - Current usage state (mutated)\n * @param config - Budget configuration\n * @param lane - Target lane\n * @param tokens - Tokens to allocate\n * @returns Updated usage state\n */\nexport function allocate(usage: BudgetUsage, config: BudgetConfig, lane: Lane, tokens: number): BudgetUsage {\n\tif (!canAllocate(usage, config, lane, tokens)) {\n\t\tthrow new Error(\n\t\t\t`Cannot allocate ${tokens} tokens to ${lane}: ` +\n\t\t\t\t`lane=${usage.byLane[lane]}/${config.lanes[lane].max}, ` +\n\t\t\t\t`total=${usage.total}/${config.totalTokens}`,\n\t\t);\n\t}\n\n\tusage.byLane[lane] += tokens;\n\tusage.total += tokens;\n\tusage.remaining -= tokens;\n\tusage.remainingByLane[lane] -= tokens;\n\n\treturn usage;\n}\n","/**\n * Budget Allocation Module\n *\n * Allocates token budgets to lanes based on:\n * - Lane minimum requirements\n * - Available candidates per lane\n * - Priority ordering\n *\n * Key feature: If a lane can't fill its minimum, the unused budget\n * is reallocated to the global pool for other lanes.\n */\n\nimport type { BudgetConfig } from \"./budget.js\";\nimport { getLanesByPriority } from \"./budget.js\";\nimport type { ArtifactCandidate, Lane } from \"./types.js\";\n\n/**\n * Result of budget allocation\n */\nexport interface AllocationResult {\n\t/** Tokens allocated to each lane */\n\tallocation: Record<Lane, number>;\n\t/** Remaining tokens available for global selection */\n\tpool: number;\n\t/** Lanes that couldn't meet their minimum */\n\tshortfalls: Array<{\n\t\tlane: Lane;\n\t\trequested: number;\n\t\tavailable: number;\n\t}>;\n}\n\n/**\n * Group candidates by their lane\n *\n * @param candidates - Array of candidates\n * @returns Map of lane to candidates\n */\nexport function groupByLane(candidates: ArtifactCandidate[]): Map<Lane, ArtifactCandidate[]> {\n\tconst byLane = new Map<Lane, ArtifactCandidate[]>();\n\n\tfor (const candidate of candidates) {\n\t\tconst list = byLane.get(candidate.lane) ?? [];\n\t\tlist.push(candidate);\n\t\tbyLane.set(candidate.lane, list);\n\t}\n\n\treturn byLane;\n}\n\n/**\n * Calculate total token estimate for candidates\n *\n * @param candidates - Array of candidates\n * @returns Total estimated tokens\n */\nexport function sumTokenEstimates(candidates: ArtifactCandidate[]): number {\n\treturn candidates.reduce((sum, c) => sum + c.tokenEstimate, 0);\n}\n\n/**\n * Allocate minimum budgets per lane.\n *\n * Algorithm:\n * 1. Group candidates by lane\n * 2. For each lane (by priority order):\n *    - Calculate available tokens from candidates\n *    - Allocate min(laneMin, available, remainingPool)\n *    - Track shortfalls if can't meet min\n * 3. Return allocation and remaining pool\n *\n * The pool contains tokens that can be used by any lane after\n * minimums are satisfied.\n *\n * @param candidates - All artifact candidates\n * @param config - Budget configuration\n * @returns Allocation result with per-lane budgets and remaining pool\n *\n * @example\n * const { allocation, pool, shortfalls } = allocateMinBudgets(candidates, config);\n * // allocation: { policy: 200, rules: 500, local: 1000, ... }\n * // pool: 6300 (remaining for discretionary use)\n * // shortfalls: [] (all mins met)\n */\nexport function allocateMinBudgets(candidates: ArtifactCandidate[], config: BudgetConfig): AllocationResult {\n\tconst allocation = {} as Record<Lane, number>;\n\tconst shortfalls: AllocationResult[\"shortfalls\"] = [];\n\tlet pool = config.totalTokens;\n\n\t// Group candidates by lane\n\tconst byLane = groupByLane(candidates);\n\n\t// Get lanes in priority order\n\tconst lanes = getLanesByPriority(config);\n\n\t// Allocate minimums by priority\n\tfor (const lane of lanes) {\n\t\tconst laneCandidates = byLane.get(lane) ?? [];\n\t\tconst available = sumTokenEstimates(laneCandidates);\n\t\tconst laneMin = config.lanes[lane].min;\n\n\t\t// Can only allocate: min of (lane minimum, available content, remaining pool)\n\t\tconst allocated = Math.min(laneMin, available, pool);\n\t\tallocation[lane] = allocated;\n\t\tpool -= allocated;\n\n\t\t// Track shortfall for debugging/explainability\n\t\tif (allocated < laneMin) {\n\t\t\tshortfalls.push({\n\t\t\t\tlane,\n\t\t\t\trequested: laneMin,\n\t\t\t\tavailable,\n\t\t\t});\n\t\t}\n\t}\n\n\treturn { allocation, pool, shortfalls };\n}\n\n/**\n * Calculate how much more budget a lane can use\n *\n * @param lane - Lane to check\n * @param currentUsage - Current usage per lane\n * @param config - Budget configuration\n * @param remainingPool - Remaining global pool\n * @returns Maximum additional tokens that can be allocated\n */\nexport function getLaneHeadroom(\n\tlane: Lane,\n\tcurrentUsage: Record<Lane, number>,\n\tconfig: BudgetConfig,\n\tremainingPool: number,\n): number {\n\tconst laneMax = config.lanes[lane].max;\n\tconst laneUsed = currentUsage[lane];\n\tconst laneRemaining = laneMax - laneUsed;\n\n\t// Can use up to: min(lane remaining, global pool remaining)\n\treturn Math.min(laneRemaining, remainingPool);\n}\n\n/**\n * Check if an artifact can be allocated given current state\n *\n * @param candidate - Candidate to check\n * @param currentUsage - Current usage per lane\n * @param totalUsed - Total tokens used\n * @param config - Budget configuration\n * @returns true if allocation is possible\n */\nexport function canAllocateArtifact(\n\tcandidate: ArtifactCandidate,\n\tcurrentUsage: Record<Lane, number>,\n\ttotalUsed: number,\n\tconfig: BudgetConfig,\n): boolean {\n\tconst lane = candidate.lane;\n\tconst tokens = candidate.tokenEstimate;\n\tconst laneMax = config.lanes[lane].max;\n\n\t// Check lane max\n\tif (currentUsage[lane] + tokens > laneMax) {\n\t\treturn false;\n\t}\n\n\t// Check total budget\n\tif (totalUsed + tokens > config.totalTokens) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\n/**\n * Result of trying to select artifacts within budget\n */\nexport interface SelectionBudgetResult {\n\t/** Artifacts that fit within budget */\n\tselected: ArtifactCandidate[];\n\t/** Artifacts that didn't fit */\n\trejected: Array<{\n\t\tcandidate: ArtifactCandidate;\n\t\treason: \"lane_max_reached\" | \"budget_exceeded\";\n\t}>;\n\t/** Final usage per lane */\n\tusage: Record<Lane, number>;\n\t/** Total tokens used */\n\ttotalUsed: number;\n}\n\n/**\n * Select artifacts from a scored list within budget constraints\n *\n * @param scored - Candidates sorted by score (highest first)\n * @param alreadySelected - Candidates already selected (pinned, must-include)\n * @param config - Budget configuration\n * @returns Selection result with selected, rejected, and usage\n */\nexport function selectWithinBudget(\n\tscored: ArtifactCandidate[],\n\talreadySelected: ArtifactCandidate[],\n\tconfig: BudgetConfig,\n): SelectionBudgetResult {\n\tconst selected: ArtifactCandidate[] = [];\n\tconst rejected: SelectionBudgetResult[\"rejected\"] = [];\n\n\t// Initialize usage from already-selected artifacts\n\tconst usage = {} as Record<Lane, number>;\n\tfor (const lane of Object.keys(config.lanes) as Lane[]) {\n\t\tusage[lane] = 0;\n\t}\n\n\tlet totalUsed = 0;\n\n\t// Account for already-selected artifacts\n\tfor (const s of alreadySelected) {\n\t\tusage[s.lane] += s.tokenEstimate;\n\t\ttotalUsed += s.tokenEstimate;\n\t}\n\n\t// Select from scored list\n\tfor (const candidate of scored) {\n\t\tconst lane = candidate.lane;\n\t\tconst tokens = candidate.tokenEstimate;\n\t\tconst laneMax = config.lanes[lane].max;\n\n\t\t// Check lane max\n\t\tif (usage[lane] + tokens > laneMax) {\n\t\t\trejected.push({\n\t\t\t\tcandidate,\n\t\t\t\treason: \"lane_max_reached\",\n\t\t\t});\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Check total budget\n\t\tif (totalUsed + tokens > config.totalTokens) {\n\t\t\trejected.push({\n\t\t\t\tcandidate,\n\t\t\t\treason: \"budget_exceeded\",\n\t\t\t});\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Select!\n\t\tselected.push(candidate);\n\t\tusage[lane] += tokens;\n\t\ttotalUsed += tokens;\n\t}\n\n\treturn {\n\t\tselected,\n\t\trejected,\n\t\tusage,\n\t\ttotalUsed,\n\t};\n}\n\n/**\n * Calculate budget utilization metrics\n *\n * @param usage - Current usage per lane\n * @param config - Budget configuration\n * @returns Utilization metrics\n */\nexport function calculateUtilization(\n\tusage: Record<Lane, number>,\n\tconfig: BudgetConfig,\n): {\n\ttotal: number;\n\ttotalPercent: number;\n\tbyLane: Record<Lane, { used: number; max: number; percent: number }>;\n} {\n\tconst totalUsed = Object.values(usage).reduce((a, b) => a + b, 0);\n\tconst totalPercent = Math.round((totalUsed / config.totalTokens) * 100);\n\n\tconst byLane = {} as Record<Lane, { used: number; max: number; percent: number }>;\n\tfor (const [lane, used] of Object.entries(usage) as [Lane, number][]) {\n\t\tconst max = config.lanes[lane].max;\n\t\tbyLane[lane] = {\n\t\t\tused,\n\t\t\tmax,\n\t\t\tpercent: Math.round((used / max) * 100),\n\t\t};\n\t}\n\n\treturn {\n\t\ttotal: totalUsed,\n\t\ttotalPercent,\n\t\tbyLane,\n\t};\n}\n","/**\n * Cache Module\n *\n * Implements input-based caching for selection results.\n * Key insight: Cache key is computed from INPUTS, not outputs.\n *\n * Cache invalidation triggers:\n * - File saved\n * - Git commit\n * - Config changed\n * - Rules changed\n * - Constraints changed\n * - Session expired (5 min TTL)\n */\n\nimport { createHash } from \"node:crypto\";\nimport type { ComposerConstraints } from \"./constraints.js\";\nimport type { ArtifactCandidate } from \"./types.js\";\n\n/**\n * Inputs for cache key computation.\n * Key is computed BEFORE selection (not from output).\n */\nexport interface CacheKeyInputs {\n\t/** Hash of workspace structure */\n\tworkspaceFingerprint: string;\n\t/** What triggered composition */\n\ttriggerEvent: string;\n\t/** Git HEAD or equivalent */\n\tcommitish: string;\n\t/** Hash of candidate set */\n\tcandidateDigest: string;\n\t/** Hash of active rules */\n\trulesDigest: string;\n\t/** Hash of budget config */\n\tbudgetConfigDigest: string;\n\t/** Hash of constraints */\n\tconstraintsDigest: string;\n\t/** Composer version (so upgrades invalidate) */\n\tcomposerVersion: string;\n}\n\n/**\n * Current composer version for cache invalidation\n */\nexport const COMPOSER_VERSION = \"1.0.0\";\n\n/**\n * Cache TTL in milliseconds (5 minutes)\n */\nexport const CACHE_TTL_MS = 5 * 60 * 1000;\n\n/**\n * Invalidation triggers for cache\n */\nexport type InvalidationTrigger =\n\t| \"file_saved\"\n\t| \"git_commit\"\n\t| \"config_changed\"\n\t| \"rules_changed\"\n\t| \"constraints_changed\"\n\t| \"session_expired\";\n\n/**\n * Compute cache key from inputs.\n * This key is computed BEFORE doing selection work.\n *\n * @param inputs - Cache key inputs\n * @returns 32-character cache key\n *\n * @example\n * const key = computeCacheKey({\n *   workspaceFingerprint: 'abc123',\n *   triggerEvent: 'file_saved',\n *   commitish: 'HEAD',\n *   candidateDigest: 'def456',\n *   rulesDigest: 'ghi789',\n *   budgetConfigDigest: 'jkl012',\n *   constraintsDigest: 'mno345',\n *   composerVersion: '1.0.0',\n * });\n * // Returns something like: \"Xk9mQ2vN8pL3Rm5sYt7uWxAb\"\n */\nexport function computeCacheKey(inputs: CacheKeyInputs): string {\n\t// Sort keys for determinism\n\tconst normalized = JSON.stringify(inputs, Object.keys(inputs).sort());\n\treturn createHash(\"sha256\").update(normalized).digest(\"base64url\").slice(0, 32);\n}\n\n/**\n * Compute candidate digest from candidate set.\n * Includes id, lane, kind, tokenEstimate for each candidate.\n *\n * @param candidates - Array of candidates\n * @returns 16-character digest\n */\nexport function computeCandidateDigest(candidates: ArtifactCandidate[]): string {\n\t// Sort by ID for determinism\n\tconst sorted = [...candidates].sort((a, b) => a.id.localeCompare(b.id));\n\n\t// Build deterministic representation\n\tconst data = sorted.map((c) => `${c.id}:${c.lane}:${c.kind}:${c.tokenEstimate}`);\n\n\treturn createHash(\"sha256\").update(data.join(\"|\")).digest(\"base64url\").slice(0, 16);\n}\n\n/**\n * Compute constraints digest\n *\n * @param constraints - Composer constraints\n * @returns 16-character digest\n */\nexport function computeConstraintsDigest(constraints: ComposerConstraints): string {\n\t// Create deterministic representation\n\tconst data = {\n\t\tmustInclude: constraints.mustInclude.map((c) => JSON.stringify(c.match)).sort(),\n\t\tmustExclude: constraints.mustExclude.map((c) => JSON.stringify(c.match)).sort(),\n\t\tpinned: constraints.pinned.map((c) => JSON.stringify(c.match)).sort(),\n\t\tlaneRequirements: constraints.laneRequirements.map((r) => `${r.lane}:${r.minTokens}`).sort(),\n\t};\n\n\treturn createHash(\"sha256\").update(JSON.stringify(data)).digest(\"base64url\").slice(0, 16);\n}\n\n/**\n * Compute budget config digest\n *\n * @param config - Budget configuration object\n * @returns 16-character digest\n */\nexport function computeBudgetConfigDigest(config: Record<string, unknown>): string {\n\tconst normalized = JSON.stringify(config, Object.keys(config).sort());\n\treturn createHash(\"sha256\").update(normalized).digest(\"base64url\").slice(0, 16);\n}\n\n/**\n * Cache entry with value and metadata\n */\nexport interface CacheEntry<T> {\n\t/** Cached value */\n\tvalue: T;\n\t/** Cache key */\n\tkey: string;\n\t/** When the entry was created */\n\tcreatedAt: number;\n\t/** When the entry expires */\n\texpiresAt: number;\n\t/** Trigger that would invalidate this entry */\n\tinvalidatedBy?: InvalidationTrigger;\n}\n\n/**\n * Simple in-memory cache for selection results\n */\nexport class SelectionCache<T> {\n\tprivate cache = new Map<string, CacheEntry<T>>();\n\tprivate ttlMs: number;\n\n\tconstructor(ttlMs: number = CACHE_TTL_MS) {\n\t\tthis.ttlMs = ttlMs;\n\t}\n\n\t/**\n\t * Get a cached value\n\t *\n\t * @param key - Cache key\n\t * @returns Cached value or undefined if not found/expired\n\t */\n\tget(key: string): T | undefined {\n\t\tconst entry = this.cache.get(key);\n\t\tif (!entry) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// Check expiration\n\t\tif (Date.now() > entry.expiresAt) {\n\t\t\tthis.cache.delete(key);\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn entry.value;\n\t}\n\n\t/**\n\t * Set a cached value\n\t *\n\t * @param key - Cache key\n\t * @param value - Value to cache\n\t */\n\tset(key: string, value: T): void {\n\t\tconst now = Date.now();\n\t\tthis.cache.set(key, {\n\t\t\tvalue,\n\t\t\tkey,\n\t\t\tcreatedAt: now,\n\t\t\texpiresAt: now + this.ttlMs,\n\t\t});\n\t}\n\n\t/**\n\t * Invalidate entries matching a trigger\n\t *\n\t * @param trigger - Invalidation trigger\n\t */\n\tinvalidate(_trigger: InvalidationTrigger): void {\n\t\t// For simplicity, clear all on any trigger\n\t\t// A more sophisticated implementation would track triggers per entry\n\t\tthis.cache.clear();\n\t}\n\n\t/**\n\t * Clear all cached entries\n\t */\n\tclear(): void {\n\t\tthis.cache.clear();\n\t}\n\n\t/**\n\t * Get cache statistics\n\t */\n\tgetStats(): { size: number; hitRate: number } {\n\t\treturn {\n\t\t\tsize: this.cache.size,\n\t\t\thitRate: 0, // Would need tracking for real hit rate\n\t\t};\n\t}\n\n\t/**\n\t * Check if key exists and is valid\n\t */\n\thas(key: string): boolean {\n\t\tconst entry = this.cache.get(key);\n\t\tif (!entry) {\n\t\t\treturn false;\n\t\t}\n\t\tif (Date.now() > entry.expiresAt) {\n\t\t\tthis.cache.delete(key);\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\t/**\n\t * Prune expired entries\n\t */\n\tprune(): number {\n\t\tconst now = Date.now();\n\t\tlet pruned = 0;\n\n\t\tfor (const [key, entry] of this.cache.entries()) {\n\t\t\tif (now > entry.expiresAt) {\n\t\t\t\tthis.cache.delete(key);\n\t\t\t\tpruned++;\n\t\t\t}\n\t\t}\n\n\t\treturn pruned;\n\t}\n}\n\n/**\n * Build complete cache key inputs from context\n *\n * @param candidates - Artifact candidates\n * @param constraints - Composer constraints\n * @param budgetConfig - Budget configuration\n * @param context - Additional context\n * @returns Complete cache key inputs\n */\nexport function buildCacheKeyInputs(\n\tcandidates: ArtifactCandidate[],\n\tconstraints: ComposerConstraints,\n\tbudgetConfig: Record<string, unknown>,\n\tcontext: {\n\t\tworkspaceFingerprint: string;\n\t\ttriggerEvent: string;\n\t\tcommitish: string;\n\t\trulesDigest: string;\n\t},\n): CacheKeyInputs {\n\treturn {\n\t\tworkspaceFingerprint: context.workspaceFingerprint,\n\t\ttriggerEvent: context.triggerEvent,\n\t\tcommitish: context.commitish,\n\t\tcandidateDigest: computeCandidateDigest(candidates),\n\t\trulesDigest: context.rulesDigest,\n\t\tbudgetConfigDigest: computeBudgetConfigDigest(budgetConfig),\n\t\tconstraintsDigest: computeConstraintsDigest(constraints),\n\t\tcomposerVersion: COMPOSER_VERSION,\n\t};\n}\n","/**\n * Constraints Interface (Policy  Composer)\n *\n * Defines the interface between PolicyEngine and Composer.\n * PolicyEngine outputs constraints; Composer executes them.\n *\n * Constraint types:\n * - mustInclude: Artifacts that MUST be selected (policy-mandated)\n * - mustExclude: Artifacts that MUST NOT be selected (policy-blocked)\n * - pinned: Artifacts selected first (e.g., current diff)\n * - laneRequirements: Minimum tokens per lane\n */\n\nimport type { ArtifactCandidate, ArtifactKind, Lane } from \"./types.js\";\n\n/**\n * Matcher for identifying artifacts.\n * Used to specify which artifacts a constraint applies to.\n */\nexport type ArtifactMatcher =\n\t| { type: \"id\"; id: string }\n\t| { type: \"kind\"; kind: ArtifactKind }\n\t| { type: \"lane\"; lane: Lane }\n\t| { type: \"pattern\"; pattern: string }; // Glob pattern on internal path\n\n/**\n * Create an ID matcher\n */\nexport function matchId(id: string): ArtifactMatcher {\n\treturn { type: \"id\", id };\n}\n\n/**\n * Create a kind matcher\n */\nexport function matchKind(kind: ArtifactKind): ArtifactMatcher {\n\treturn { type: \"kind\", kind };\n}\n\n/**\n * Create a lane matcher\n */\nexport function matchLane(lane: Lane): ArtifactMatcher {\n\treturn { type: \"lane\", lane };\n}\n\n/**\n * Create a pattern matcher\n */\nexport function matchPattern(pattern: string): ArtifactMatcher {\n\treturn { type: \"pattern\", pattern };\n}\n\n/**\n * Constraint with reason for explainability.\n * Every constraint includes a reason for transparency.\n */\nexport interface Constraint {\n\t/** How to identify matching artifacts */\n\tmatch: ArtifactMatcher;\n\t/** Human-readable reason for this constraint */\n\treason: string;\n}\n\n/**\n * Lane requirement from policy.\n * Specifies minimum tokens for a lane.\n */\nexport interface LaneRequirement {\n\t/** Target lane */\n\tlane: Lane;\n\t/** Minimum tokens required */\n\tminTokens: number;\n\t/** Reason for this requirement */\n\treason: string;\n}\n\n/**\n * Constraints from Policy Engine to Composer.\n * Hard constraints that must be respected.\n */\nexport interface ComposerConstraints {\n\t/**\n\t * Must include these artifacts (policy-mandated).\n\t * Selected before scoring, use budget from their lane.\n\t */\n\tmustInclude: Constraint[];\n\n\t/**\n\t * Must exclude these artifacts (policy-blocked).\n\t * Removed before scoring, never selected.\n\t */\n\tmustExclude: Constraint[];\n\n\t/**\n\t * Pinned artifacts (always selected first).\n\t * E.g., current diff is always pinned.\n\t */\n\tpinned: Constraint[];\n\n\t/**\n\t * Lane requirements from policy.\n\t * E.g., \"rules lane must have at least 300 tokens\"\n\t */\n\tlaneRequirements: LaneRequirement[];\n}\n\n/**\n * Default empty constraints.\n * Used when no policy constraints apply.\n */\nexport const EMPTY_CONSTRAINTS: ComposerConstraints = {\n\tmustInclude: [],\n\tmustExclude: [],\n\tpinned: [],\n\tlaneRequirements: [],\n} as const;\n\n/**\n * Simple glob pattern matching.\n * Supports * (any characters) and ? (single character).\n *\n * @param pattern - Glob pattern\n * @param text - Text to match\n * @returns true if text matches pattern\n */\nfunction matchGlob(pattern: string, text: string): boolean {\n\t// Convert glob to regex\n\tconst regexPattern = pattern\n\t\t.replace(/[.+^${}()|[\\]\\\\]/g, \"\\\\$&\") // Escape special regex chars\n\t\t.replace(/\\*/g, \".*\") // *  .*\n\t\t.replace(/\\?/g, \".\"); // ?  .\n\n\tconst regex = new RegExp(`^${regexPattern}$`, \"i\");\n\treturn regex.test(text);\n}\n\n/**\n * Check if an artifact matches a constraint matcher.\n *\n * @param artifact - Artifact to check\n * @param matcher - Matcher to apply\n * @param getPath - Optional function to get artifact path (for pattern matching)\n * @returns true if artifact matches\n *\n * @example\n * // Match by ID\n * matches(artifact, { type: 'id', id: 'abc123' });\n *\n * // Match by kind\n * matches(artifact, { type: 'kind', kind: 'local_diff' });\n *\n * // Match by lane\n * matches(artifact, { type: 'lane', lane: 'policy' });\n */\nexport function matches(\n\tartifact: ArtifactCandidate,\n\tmatcher: ArtifactMatcher,\n\tgetPath?: (artifact: ArtifactCandidate) => string | undefined,\n): boolean {\n\tswitch (matcher.type) {\n\t\tcase \"id\":\n\t\t\treturn artifact.id === matcher.id;\n\n\t\tcase \"kind\":\n\t\t\treturn artifact.kind === matcher.kind;\n\n\t\tcase \"lane\":\n\t\t\treturn artifact.lane === matcher.lane;\n\n\t\tcase \"pattern\": {\n\t\t\t// Pattern matching requires path access\n\t\t\t// This is only used during selection, path is never logged\n\t\t\tif (!getPath) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst path = getPath(artifact);\n\t\t\tif (!path) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn matchGlob(matcher.pattern, path);\n\t\t}\n\t}\n}\n\n/**\n * Check if an artifact matches any of the constraints.\n *\n * @param artifact - Artifact to check\n * @param constraints - Array of constraints to check\n * @param getPath - Optional function to get artifact path\n * @returns The first matching constraint, or undefined if none match\n */\nexport function findMatchingConstraint(\n\tartifact: ArtifactCandidate,\n\tconstraints: Constraint[],\n\tgetPath?: (artifact: ArtifactCandidate) => string | undefined,\n): Constraint | undefined {\n\treturn constraints.find((c) => matches(artifact, c.match, getPath));\n}\n\n/**\n * Check if an artifact is excluded by any constraint.\n *\n * @param artifact - Artifact to check\n * @param constraints - Composer constraints\n * @param getPath - Optional function to get artifact path\n * @returns Constraint that excludes the artifact, or undefined\n */\nexport function isExcluded(\n\tartifact: ArtifactCandidate,\n\tconstraints: ComposerConstraints,\n\tgetPath?: (artifact: ArtifactCandidate) => string | undefined,\n): Constraint | undefined {\n\treturn findMatchingConstraint(artifact, constraints.mustExclude, getPath);\n}\n\n/**\n * Check if an artifact is pinned.\n *\n * @param artifact - Artifact to check\n * @param constraints - Composer constraints\n * @param getPath - Optional function to get artifact path\n * @returns Constraint that pins the artifact, or undefined\n */\nexport function isPinned(\n\tartifact: ArtifactCandidate,\n\tconstraints: ComposerConstraints,\n\tgetPath?: (artifact: ArtifactCandidate) => string | undefined,\n): Constraint | undefined {\n\treturn findMatchingConstraint(artifact, constraints.pinned, getPath);\n}\n\n/**\n * Check if an artifact must be included.\n *\n * @param artifact - Artifact to check\n * @param constraints - Composer constraints\n * @param getPath - Optional function to get artifact path\n * @returns Constraint that requires the artifact, or undefined\n */\nexport function isMustInclude(\n\tartifact: ArtifactCandidate,\n\tconstraints: ComposerConstraints,\n\tgetPath?: (artifact: ArtifactCandidate) => string | undefined,\n): Constraint | undefined {\n\treturn findMatchingConstraint(artifact, constraints.mustInclude, getPath);\n}\n\n/**\n * Builder for creating ComposerConstraints\n */\nexport class ConstraintsBuilder {\n\tprivate constraints: ComposerConstraints = {\n\t\tmustInclude: [],\n\t\tmustExclude: [],\n\t\tpinned: [],\n\t\tlaneRequirements: [],\n\t};\n\n\t/**\n\t * Add a must-include constraint\n\t */\n\tmustInclude(match: ArtifactMatcher, reason: string): this {\n\t\tthis.constraints.mustInclude.push({ match, reason });\n\t\treturn this;\n\t}\n\n\t/**\n\t * Add a must-exclude constraint\n\t */\n\tmustExclude(match: ArtifactMatcher, reason: string): this {\n\t\tthis.constraints.mustExclude.push({ match, reason });\n\t\treturn this;\n\t}\n\n\t/**\n\t * Add a pinned constraint\n\t */\n\tpin(match: ArtifactMatcher, reason: string): this {\n\t\tthis.constraints.pinned.push({ match, reason });\n\t\treturn this;\n\t}\n\n\t/**\n\t * Add a lane requirement\n\t */\n\trequireLane(lane: Lane, minTokens: number, reason: string): this {\n\t\tthis.constraints.laneRequirements.push({ lane, minTokens, reason });\n\t\treturn this;\n\t}\n\n\t/**\n\t * Build the constraints\n\t */\n\tbuild(): ComposerConstraints {\n\t\treturn { ...this.constraints };\n\t}\n}\n\n/**\n * Create a new constraints builder\n */\nexport function constraints(): ConstraintsBuilder {\n\treturn new ConstraintsBuilder();\n}\n\n/**\n * Merge multiple constraint sets\n *\n * @param constraintSets - Constraint sets to merge\n * @returns Merged constraints\n */\nexport function mergeConstraints(...constraintSets: ComposerConstraints[]): ComposerConstraints {\n\treturn {\n\t\tmustInclude: constraintSets.flatMap((c) => c.mustInclude),\n\t\tmustExclude: constraintSets.flatMap((c) => c.mustExclude),\n\t\tpinned: constraintSets.flatMap((c) => c.pinned),\n\t\tlaneRequirements: constraintSets.flatMap((c) => c.laneRequirements),\n\t};\n}\n","/**\n * Determinism Guardrails\n *\n * Ensures reproducible selection by:\n * - Quantizing floating-point scores to fixed precision\n * - Bucketing time-based values to prevent \"now\" drift\n * - Providing stable tie-breakers for equal scores\n *\n * Core guarantee: Same inputs  Same outputs (verifiable via replay)\n */\n\nimport { type ArtifactCandidate, KIND_PRIORITIES, LANE_PRIORITIES } from \"./types.js\";\n\n/**\n * Quantization precision for relevance scores.\n * Prevents floating-point differences from changing selection order.\n *\n * 0.001 means scores are rounded to 3 decimal places.\n * Example: 0.123456  0.123\n */\nexport const RELEVANCE_PRECISION = 1e-3;\n\n/**\n * Recency bucket thresholds in seconds.\n * Each threshold defines the boundary for a recency level.\n *\n * Bucketing prevents \"now\" from causing non-determinism:\n * - Two runs 1 second apart will get the same bucket\n * - Only large time differences change the bucket\n */\nexport const RECENCY_BUCKETS = [\n\t0, // Bucket 5: current (< 1 min)\n\t60, // Bucket 4: recent (1-5 min)\n\t300, // Bucket 3: warm (5-30 min)\n\t1800, // Bucket 2: cold (30min-2hr)\n\t7200, // Bucket 1: stale (2hr-24hr)\n\t86400, // Bucket 0: old (> 24hr)\n] as const;\n\n/**\n * Number of recency buckets (0-5)\n */\nexport const MAX_RECENCY_BUCKET = RECENCY_BUCKETS.length;\n\n/**\n * Quantize a relevance score to fixed precision.\n * This ensures that minor floating-point variations don't affect ordering.\n *\n * @param score - Raw score value (0-1)\n * @returns Quantized score rounded to RELEVANCE_PRECISION\n *\n * @example\n * quantizeRelevance(0.123456789) //  0.123\n * quantizeRelevance(0.9999)      //  1.000\n */\nexport function quantizeRelevance(score: number): number {\n\tif (!Number.isFinite(score)) {\n\t\treturn 0;\n\t}\n\t// Clamp to valid range\n\tconst clamped = Math.max(0, Math.min(1, score));\n\t// Round to precision\n\treturn Math.round(clamped / RELEVANCE_PRECISION) * RELEVANCE_PRECISION;\n}\n\n/**\n * Bucket recency by age in milliseconds.\n * Returns bucket number (higher = more recent).\n *\n * Bucket mapping:\n * - 5: Current (< 1 min)\n * - 4: Recent (1-5 min)\n * - 3: Warm (5-30 min)\n * - 2: Cold (30min-2hr)\n * - 1: Stale (2hr-24hr)\n * - 0: Old (> 24hr)\n *\n * @param ageMs - Age in milliseconds since the artifact was created/modified\n * @returns Bucket number 0-5 (higher = more recent)\n *\n * @example\n * bucketRecency(30 * 1000)       // 30 seconds  bucket 5 (current)\n * bucketRecency(2 * 60 * 1000)   // 2 minutes  bucket 4 (recent)\n * bucketRecency(10 * 60 * 1000)  // 10 minutes  bucket 3 (warm)\n */\nexport function bucketRecency(ageMs: number): number {\n\tif (!Number.isFinite(ageMs) || ageMs < 0) {\n\t\treturn MAX_RECENCY_BUCKET - 1; // Treat invalid as most recent\n\t}\n\n\tconst ageSec = ageMs / 1000;\n\n\t// Find the bucket threshold that the age exceeds\n\t// Iterate from oldest to newest thresholds\n\tfor (let i = RECENCY_BUCKETS.length - 1; i >= 0; i--) {\n\t\tif (ageSec >= RECENCY_BUCKETS[i]) {\n\t\t\t// Return bucket number (higher = more recent)\n\t\t\t// RECENCY_BUCKETS.length - 1 - i converts threshold index to bucket\n\t\t\treturn RECENCY_BUCKETS.length - 1 - i;\n\t\t}\n\t}\n\n\t// Age is less than smallest threshold (0), so it's the most recent bucket\n\treturn MAX_RECENCY_BUCKET - 1;\n}\n\n/**\n * Get the recency bucket label for display\n *\n * @param bucket - Bucket number 0-5\n * @returns Human-readable label\n */\nexport function getRecencyLabel(bucket: number): string {\n\tconst labels: Record<number, string> = {\n\t\t5: \"current\",\n\t\t4: \"recent\",\n\t\t3: \"warm\",\n\t\t2: \"cold\",\n\t\t1: \"stale\",\n\t\t0: \"old\",\n\t};\n\treturn labels[bucket] ?? \"unknown\";\n}\n\n/**\n * Stable tie-breaker when scores are equal.\n * Ensures deterministic ordering even with identical scores.\n *\n * Order priority:\n * 1. Lane priority (lower = higher priority, e.g., policy > rules > local)\n * 2. Kind priority (lower = higher priority, e.g., constraint > rule_doc)\n * 3. Lexicographic by ID (stable, deterministic)\n *\n * @param a - First candidate to compare\n * @param b - Second candidate to compare\n * @returns Negative if a comes before b, positive if after, 0 if equal\n *\n * @example\n * // Policy lane beats rules lane\n * tieBreaker(\n *   { lane: 'policy', kind: 'constraint', id: 'a' },\n *   { lane: 'rules', kind: 'rule_doc', id: 'b' }\n * ) //  -1 (policy comes first)\n */\nexport function tieBreaker(a: ArtifactCandidate, b: ArtifactCandidate): number {\n\t// 1. Lane priority (lower = higher priority)\n\tconst lanePriorityA = LANE_PRIORITIES[a.lane];\n\tconst lanePriorityB = LANE_PRIORITIES[b.lane];\n\tif (lanePriorityA !== lanePriorityB) {\n\t\treturn lanePriorityA - lanePriorityB;\n\t}\n\n\t// 2. Kind priority (lower = higher priority)\n\tconst kindPriorityA = KIND_PRIORITIES[a.kind] ?? 99;\n\tconst kindPriorityB = KIND_PRIORITIES[b.kind] ?? 99;\n\tif (kindPriorityA !== kindPriorityB) {\n\t\treturn kindPriorityA - kindPriorityB;\n\t}\n\n\t// 3. Lexicographic by ID (stable)\n\treturn a.id.localeCompare(b.id);\n}\n\n/**\n * Check if two scores are effectively equal after quantization\n *\n * @param a - First score\n * @param b - Second score\n * @returns true if scores are equal after quantization\n */\nexport function scoresEqual(a: number, b: number): boolean {\n\treturn quantizeRelevance(a) === quantizeRelevance(b);\n}\n\n/**\n * Normalize a timestamp to bucket boundaries for deterministic caching\n *\n * @param timestamp - Unix timestamp in milliseconds\n * @param bucketSizeMs - Size of time buckets in milliseconds\n * @returns Normalized timestamp at bucket boundary\n */\nexport function normalizeTimestamp(\n\ttimestamp: number,\n\tbucketSizeMs = 60000, // 1 minute default\n): number {\n\treturn Math.floor(timestamp / bucketSizeMs) * bucketSizeMs;\n}\n\n/**\n * Create a deterministic hash of an array of strings\n * Used for cache key components\n *\n * @param items - Array of strings to hash\n * @returns Deterministic string representation\n */\nexport function deterministicArrayHash(items: string[]): string {\n\t// Sort for determinism, then join with delimiter that won't appear in data\n\treturn [...items].sort().join(\"\\x00\");\n}\n\n/**\n * Quantize a number to a specific number of decimal places\n *\n * @param value - The value to quantize\n * @param decimals - Number of decimal places\n * @returns Quantized value\n */\nexport function quantizeToDecimals(value: number, decimals: number): number {\n\tconst factor = 10 ** decimals;\n\treturn Math.round(value * factor) / factor;\n}\n","/**\n * Scoring Module\n *\n * Computes composite scores for artifact candidates.\n * Scores are quantized for determinism and sorted with stable tie-breakers.\n *\n * Scoring dimensions:\n * - Recency: How recently the artifact was modified (30%)\n * - Relevance: How well it matches the current context (35%)\n * - Specificity: How targeted it is to the task (20%)\n * - Risk alignment: How relevant to current risk factors (15%)\n */\n\nimport { quantizeRelevance, tieBreaker } from \"./determinism.js\";\nimport type { ArtifactCandidate } from \"./types.js\";\n\n/**\n * Scoring weights (must sum to 1.0).\n * These weights balance the importance of each dimension.\n */\nexport const SCORING_WEIGHTS = {\n\t/** How recently the artifact was modified */\n\trecency: 0.3,\n\t/** How well it matches the current context */\n\trelevance: 0.35,\n\t/** How targeted it is to the specific task */\n\tspecificity: 0.2,\n\t/** How well it relates to current risk factors */\n\triskAlignment: 0.15,\n} as const;\n\n/**\n * Maximum recency bucket value (for normalization)\n */\nconst MAX_RECENCY_BUCKET = 5;\n\n/**\n * Compute composite score for an artifact candidate.\n * All inputs are pre-quantized for determinism.\n *\n * Formula:\n * score = 0.30  (recencyBucket/5) +\n *         0.35  relevanceScore +\n *         0.20  specificityScore +\n *         0.15  riskAlignment\n *\n * @param candidate - Artifact candidate with scoring inputs\n * @returns Composite score (0-1, quantized to 0.001)\n *\n * @example\n * const score = computeScore({\n *   recencyBucket: 4,        // Recent\n *   relevanceScore: 0.8,     // High relevance\n *   specificityScore: 0.6,   // Medium specificity\n *   riskAlignment: 0.5,      // Medium risk alignment\n * });\n * // score  0.300.8 + 0.350.8 + 0.200.6 + 0.150.5 = 0.715\n */\nexport function computeScore(candidate: ArtifactCandidate): number {\n\t// Normalize recency to 0-1 range\n\tconst normalizedRecency = candidate.recencyBucket / MAX_RECENCY_BUCKET;\n\n\tconst score =\n\t\tSCORING_WEIGHTS.recency * normalizedRecency +\n\t\tSCORING_WEIGHTS.relevance * candidate.relevanceScore +\n\t\tSCORING_WEIGHTS.specificity * candidate.specificityScore +\n\t\tSCORING_WEIGHTS.riskAlignment * candidate.riskAlignment;\n\n\t// Quantize output for determinism\n\treturn quantizeRelevance(score);\n}\n\n/**\n * Scored candidate with computed score attached.\n */\nexport interface ScoredCandidate {\n\t/** Original candidate */\n\tcandidate: ArtifactCandidate;\n\t/** Computed composite score */\n\tscore: number;\n}\n\n/**\n * Score and sort candidates deterministically.\n * Same inputs  Same order (guaranteed).\n *\n * Sorting order:\n * 1. Higher score first\n * 2. If scores equal, use tie-breaker (lane priority  kind priority  ID)\n *\n * @param candidates - Array of candidates to score\n * @returns Scored candidates sorted by score descending\n *\n * @example\n * const sorted = scoreAndSort(candidates);\n * // sorted[0] has highest score\n * // sorted[sorted.length - 1] has lowest score\n */\nexport function scoreAndSort(candidates: ArtifactCandidate[]): ScoredCandidate[] {\n\t// Score all candidates\n\tconst scored = candidates.map((candidate) => ({\n\t\tcandidate,\n\t\tscore: computeScore(candidate),\n\t}));\n\n\t// Sort by score descending, then tie-breaker\n\tscored.sort((a, b) => {\n\t\tif (a.score !== b.score) {\n\t\t\treturn b.score - a.score; // Higher score first\n\t\t}\n\t\treturn tieBreaker(a.candidate, b.candidate);\n\t});\n\n\treturn scored;\n}\n\n/**\n * Get the top N candidates by score\n *\n * @param candidates - Array of candidates\n * @param n - Number of top candidates to return\n * @returns Top N scored candidates\n */\nexport function topN(candidates: ArtifactCandidate[], n: number): ScoredCandidate[] {\n\tconst sorted = scoreAndSort(candidates);\n\treturn sorted.slice(0, n);\n}\n\n/**\n * Get candidates with score above threshold\n *\n * @param candidates - Array of candidates\n * @param threshold - Minimum score (0-1)\n * @returns Scored candidates above threshold\n */\nexport function aboveThreshold(candidates: ArtifactCandidate[], threshold: number): ScoredCandidate[] {\n\tconst sorted = scoreAndSort(candidates);\n\treturn sorted.filter((s) => s.score >= threshold);\n}\n\n/**\n * Adjust candidate scores based on context.\n * Used by WorkspaceVitals to boost relevant artifacts.\n *\n * @param candidates - Candidates to adjust\n * @param adjustments - Score adjustments by ID\n * @returns Adjusted candidates (new array, inputs not mutated)\n */\nexport function applyScoreAdjustments(\n\tcandidates: ArtifactCandidate[],\n\tadjustments: Map<string, number>,\n): ArtifactCandidate[] {\n\treturn candidates.map((c) => {\n\t\tconst adjustment = adjustments.get(c.id) ?? 0;\n\t\tif (adjustment === 0) {\n\t\t\treturn c;\n\t\t}\n\n\t\t// Create new candidate with adjusted relevance\n\t\treturn {\n\t\t\t...c,\n\t\t\trelevanceScore: quantizeRelevance(Math.min(1, Math.max(0, c.relevanceScore + adjustment))),\n\t\t};\n\t});\n}\n\n/**\n * Calculate score statistics for a set of candidates\n *\n * @param candidates - Array of candidates\n * @returns Score statistics\n */\nexport function getScoreStats(candidates: ArtifactCandidate[]): {\n\tmin: number;\n\tmax: number;\n\tmean: number;\n\tmedian: number;\n} {\n\tif (candidates.length === 0) {\n\t\treturn { min: 0, max: 0, mean: 0, median: 0 };\n\t}\n\n\tconst scores = candidates.map(computeScore).sort((a, b) => a - b);\n\tconst sum = scores.reduce((a, b) => a + b, 0);\n\n\treturn {\n\t\tmin: scores[0],\n\t\tmax: scores[scores.length - 1],\n\t\tmean: quantizeRelevance(sum / scores.length),\n\t\tmedian: scores[Math.floor(scores.length / 2)],\n\t};\n}\n\n/**\n * Validate scoring weights sum to 1.0\n * @throws Error if weights don't sum to 1.0\n */\nexport function validateScoringWeights(): void {\n\tconst sum =\n\t\tSCORING_WEIGHTS.recency +\n\t\tSCORING_WEIGHTS.relevance +\n\t\tSCORING_WEIGHTS.specificity +\n\t\tSCORING_WEIGHTS.riskAlignment;\n\n\tif (Math.abs(sum - 1.0) > 0.001) {\n\t\tthrow new Error(`Scoring weights must sum to 1.0, got ${sum}`);\n\t}\n}\n\n// Validate on module load\nvalidateScoringWeights();\n","/**\n * Explainability Module\n *\n * Provides human-readable explanations for selection decisions.\n * Every rejection is logged with a reason for transparency.\n *\n * Output formats:\n * - Structured data for programmatic access\n * - CLI-formatted output for humans\n * - JSON for logging and telemetry\n */\n\nimport type { BudgetConfig } from \"./budget.js\";\nimport { computeScore } from \"./scoring.js\";\nimport type { RejectionReason, RejectionRecord } from \"./selection.js\";\nimport type { ArtifactCandidate, ArtifactKind, ArtifactRef, Lane } from \"./types.js\";\n\n/**\n * Selection explanation for debugging and transparency.\n * Contains all information needed to understand a selection decision.\n */\nexport interface SelectionExplanation {\n\t/** Human-readable summary */\n\tsummary: string;\n\n\t/** Breakdown by lane */\n\tlaneBreakdown: Array<{\n\t\tlane: Lane;\n\t\tselectedCount: number;\n\t\tbudgetUsed: number;\n\t\tbudgetMax: number;\n\t\ttopArtifacts: Array<{\n\t\t\tid: string;\n\t\t\tkind: ArtifactKind;\n\t\t\tscore: number;\n\t\t}>;\n\t}>;\n\n\t/** Top rejections for visibility */\n\ttopRejections: Array<{\n\t\tartifact: ArtifactRef;\n\t\treason: RejectionReason;\n\t\tdetail?: string;\n\t}>;\n\n\t/** Constraint summary */\n\tconstraints: {\n\t\tpinnedCount: number;\n\t\tmustIncludeCount: number;\n\t\texcludedCount: number;\n\t};\n\n\t/** Performance metrics */\n\tperformance: {\n\t\tcandidateCount: number;\n\t\tselectedCount: number;\n\t\tcompressionRatio: number;\n\t\tcacheHit: boolean;\n\t};\n}\n\n/**\n * Build a human-readable explanation from selection data.\n *\n * @param selected - Selected candidates\n * @param rejections - Rejection records\n * @param laneUsage - Tokens used per lane\n * @param config - Budget configuration\n * @param shortfalls - Lanes that couldn't meet minimum\n * @param constraintCounts - Counts from constraint enforcement\n * @returns Complete explanation\n */\nexport function buildExplanation(\n\tselected: ArtifactCandidate[],\n\trejections: RejectionRecord[],\n\tlaneUsage: Record<Lane, number>,\n\tconfig: BudgetConfig,\n\tshortfalls: Array<{ lane: Lane; requested: number; available: number }>,\n\tconstraintCounts?: {\n\t\tpinned: number;\n\t\tmustInclude: number;\n\t\texcluded: number;\n\t},\n): SelectionExplanation {\n\tconst lanes = Object.keys(config.lanes) as Lane[];\n\n\t// Build lane breakdown\n\tconst laneBreakdown = lanes.map((lane) => {\n\t\tconst laneSelected = selected.filter((s) => s.lane === lane);\n\t\tconst laneConfig = config.lanes[lane];\n\n\t\treturn {\n\t\t\tlane,\n\t\t\tselectedCount: laneSelected.length,\n\t\t\tbudgetUsed: laneUsage[lane] ?? 0,\n\t\t\tbudgetMax: laneConfig.max,\n\t\t\ttopArtifacts: laneSelected.slice(0, 3).map((s) => ({\n\t\t\t\tid: s.id,\n\t\t\t\tkind: s.kind,\n\t\t\t\tscore: computeScore(s),\n\t\t\t})),\n\t\t};\n\t});\n\n\t// Calculate totals\n\tconst totalUsed = Object.values(laneUsage).reduce((a, b) => a + b, 0);\n\tconst totalCandidates = selected.length + rejections.length;\n\n\t// Build summary\n\tconst summaryParts = [`Selected ${selected.length} artifacts`, `using ${totalUsed}/${config.totalTokens} tokens`];\n\n\tif (shortfalls.length > 0) {\n\t\tsummaryParts.push(`(${shortfalls.length} lanes under-filled)`);\n\t}\n\n\tconst summary = summaryParts.join(\" \");\n\n\t// Top rejections (limit to 5)\n\tconst topRejections = rejections.slice(0, 5).map((r) => ({\n\t\tartifact: r.artifact,\n\t\treason: r.reason,\n\t\tdetail: r.detail,\n\t}));\n\n\treturn {\n\t\tsummary,\n\t\tlaneBreakdown,\n\t\ttopRejections,\n\t\tconstraints: {\n\t\t\tpinnedCount: constraintCounts?.pinned ?? 0,\n\t\t\tmustIncludeCount: constraintCounts?.mustInclude ?? 0,\n\t\t\texcludedCount:\n\t\t\t\tconstraintCounts?.excluded ?? rejections.filter((r) => r.reason === \"excluded_by_policy\").length,\n\t\t},\n\t\tperformance: {\n\t\t\tcandidateCount: totalCandidates,\n\t\t\tselectedCount: selected.length,\n\t\t\tcompressionRatio: totalCandidates > 0 ? Math.round((selected.length / totalCandidates) * 100) / 100 : 0,\n\t\t\tcacheHit: false, // Filled by caller\n\t\t},\n\t};\n}\n\n/**\n * Format explanation for CLI output.\n * Produces human-readable text with visual bars.\n *\n * @param exp - Selection explanation\n * @returns Formatted string for terminal output\n */\nexport function formatExplanationForCLI(exp: SelectionExplanation): string {\n\tconst lines: string[] = [\"\", \" Composition Summary\", `   ${exp.summary}`, \"\", \" Lane Breakdown:\"];\n\n\tfor (const lane of exp.laneBreakdown) {\n\t\tconst pct = lane.budgetMax > 0 ? Math.round((lane.budgetUsed / lane.budgetMax) * 100) : 0;\n\t\tconst filledBars = Math.round(pct / 10);\n\t\tconst emptyBars = 10 - filledBars;\n\t\tconst bar = \"\".repeat(filledBars) + \"\".repeat(emptyBars);\n\n\t\tlines.push(\n\t\t\t`   ${lane.lane.padEnd(10)} ${bar} ${lane.selectedCount} artifacts (${lane.budgetUsed}/${lane.budgetMax} tokens)`,\n\t\t);\n\t}\n\n\tif (exp.topRejections.length > 0) {\n\t\tlines.push(\"\");\n\t\tlines.push(\"  Top Rejections:\");\n\t\tfor (const rej of exp.topRejections.slice(0, 3)) {\n\t\t\tconst detail = rej.detail ? ` (${rej.detail})` : \"\";\n\t\t\tlines.push(`    ${rej.artifact.kind}: ${formatRejectionReason(rej.reason)}${detail}`);\n\t\t}\n\t}\n\n\tif (exp.constraints.pinnedCount > 0 || exp.constraints.mustIncludeCount > 0) {\n\t\tlines.push(\"\");\n\t\tlines.push(\" Constraints:\");\n\t\tif (exp.constraints.pinnedCount > 0) {\n\t\t\tlines.push(`    ${exp.constraints.pinnedCount} pinned artifacts`);\n\t\t}\n\t\tif (exp.constraints.mustIncludeCount > 0) {\n\t\t\tlines.push(`    ${exp.constraints.mustIncludeCount} must-include artifacts`);\n\t\t}\n\t\tif (exp.constraints.excludedCount > 0) {\n\t\t\tlines.push(`    ${exp.constraints.excludedCount} excluded by policy`);\n\t\t}\n\t}\n\n\tlines.push(\"\");\n\tlines.push(\n\t\t` Performance: ${exp.performance.selectedCount}/${exp.performance.candidateCount} candidates selected (${Math.round(exp.performance.compressionRatio * 100)}%)`,\n\t);\n\n\tif (exp.performance.cacheHit) {\n\t\tlines.push(\"   (cache hit)\");\n\t}\n\n\treturn lines.join(\"\\n\");\n}\n\n/**\n * Format rejection reason for display\n *\n * @param reason - Rejection reason code\n * @returns Human-readable reason\n */\nexport function formatRejectionReason(reason: RejectionReason): string {\n\tconst reasonMap: Record<RejectionReason, string> = {\n\t\texcluded_by_policy: \"excluded by policy\",\n\t\tlane_max_reached: \"lane budget exceeded\",\n\t\tbudget_exceeded: \"total budget exceeded\",\n\t\tlower_priority: \"lower priority\",\n\t};\n\n\treturn reasonMap[reason] ?? reason;\n}\n\n/**\n * Format explanation as JSON for logging\n *\n * @param exp - Selection explanation\n * @returns JSON string\n */\nexport function formatExplanationAsJSON(exp: SelectionExplanation): string {\n\treturn JSON.stringify(exp, null, 2);\n}\n\n/**\n * Create a minimal explanation for logging (no artifact details)\n *\n * @param exp - Full explanation\n * @returns Minimal explanation\n */\nexport function toMinimalExplanation(exp: SelectionExplanation): {\n\tsummary: string;\n\tselectedCount: number;\n\trejectedCount: number;\n\tcacheHit: boolean;\n} {\n\treturn {\n\t\tsummary: exp.summary,\n\t\tselectedCount: exp.performance.selectedCount,\n\t\trejectedCount: exp.topRejections.length,\n\t\tcacheHit: exp.performance.cacheHit,\n\t};\n}\n\n/**\n * Build explanation for an empty selection (no candidates)\n *\n * @returns Explanation for empty selection\n */\nexport function buildEmptyExplanation(): SelectionExplanation {\n\treturn {\n\t\tsummary: \"No candidates available for selection\",\n\t\tlaneBreakdown: [],\n\t\ttopRejections: [],\n\t\tconstraints: {\n\t\t\tpinnedCount: 0,\n\t\t\tmustIncludeCount: 0,\n\t\t\texcludedCount: 0,\n\t\t},\n\t\tperformance: {\n\t\t\tcandidateCount: 0,\n\t\t\tselectedCount: 0,\n\t\t\tcompressionRatio: 0,\n\t\t\tcacheHit: false,\n\t\t},\n\t};\n}\n\n/**\n * Add cache hit status to explanation\n *\n * @param exp - Explanation\n * @param cacheHit - Whether this was a cache hit\n * @returns Updated explanation\n */\nexport function withCacheHit(exp: SelectionExplanation, cacheHit: boolean): SelectionExplanation {\n\treturn {\n\t\t...exp,\n\t\tperformance: {\n\t\t\t...exp.performance,\n\t\t\tcacheHit,\n\t\t},\n\t};\n}\n\n/**\n * Calculate rejection statistics\n *\n * @param rejections - All rejections\n * @returns Statistics by reason\n */\nexport function getRejectionStats(rejections: RejectionRecord[]): Record<RejectionReason, number> {\n\tconst stats = {} as Record<RejectionReason, number>;\n\n\tfor (const r of rejections) {\n\t\tstats[r.reason] = (stats[r.reason] ?? 0) + 1;\n\t}\n\n\treturn stats;\n}\n","/**\n * Artifact Fingerprinting\n *\n * Generates stable, privacy-safe artifact identifiers using HMAC.\n * These IDs are:\n * - Deterministic: Same inputs  Same ID\n * - Stable: ID doesn't change if file content changes\n * - Privacy-safe: File paths are not exposed in logs/telemetry\n * - Collision-resistant: Different artifacts get different IDs\n */\n\nimport { createHash, createHmac, randomUUID } from \"node:crypto\";\nimport type { ArtifactKind, Lane } from \"./types.js\";\n\n/**\n * Configuration for fingerprinting.\n * The workspace secret is generated once per workspace and stored locally.\n */\nexport interface FingerprintConfig {\n\t/** Generated once per workspace, stored locally */\n\tworkspaceSecret: string;\n\t/** Hash algorithm to use */\n\talgorithm: \"sha256\";\n\t/** Output encoding */\n\tencoding: \"base64url\";\n}\n\n/**\n * Default fingerprint configuration\n */\nexport const DEFAULT_FINGERPRINT_CONFIG: Omit<FingerprintConfig, \"workspaceSecret\"> = {\n\talgorithm: \"sha256\",\n\tencoding: \"base64url\",\n} as const;\n\n/**\n * Generate a new workspace secret.\n * Called once per workspace during initialization.\n *\n * The secret is used to create HMAC-based artifact IDs that:\n * - Are deterministic within the workspace\n * - Cannot be reversed to reveal file paths\n * - Are unique per workspace (different workspaces get different IDs for same paths)\n *\n * @returns A cryptographically secure random secret\n *\n * @example\n * const secret = generateWorkspaceSecret();\n * // Store in .snapback/config or equivalent\n * await writeFile('.snapback/secret', secret);\n */\nexport function generateWorkspaceSecret(): string {\n\t// Combine multiple sources of randomness for extra security\n\treturn createHash(\"sha256\")\n\t\t.update(randomUUID())\n\t\t.update(Date.now().toString())\n\t\t.update(Math.random().toString())\n\t\t.digest(\"base64url\");\n}\n\n/**\n * Input for computing an artifact ID\n */\nexport interface ArtifactIdInput {\n\t/** The type of content this artifact contains */\n\tkind: ArtifactKind;\n\t/** The lane this artifact belongs to */\n\tlane: Lane;\n\t/** Relative path within the workspace (internal only, never logged) */\n\trelativePath: string;\n\t/** Chunk index for multi-chunk artifacts (default: 0) */\n\tchunkIndex?: number;\n}\n\n/**\n * Generate a stable artifact ID using HMAC.\n * Safe for logs/telemetry (no paths exposed).\n *\n * The ID is computed as:\n * 1. HMAC the relative path with workspace secret  path fingerprint\n * 2. Combine kind, lane, path fingerprint, chunk index\n * 3. Hash the combination  final ID\n *\n * @param artifact - The artifact properties to fingerprint\n * @param secret - The workspace secret for HMAC\n * @returns A 24-character base64url-encoded ID\n *\n * @example\n * const id = computeArtifactId(\n *   { kind: 'local_diff', lane: 'local', relativePath: 'src/auth.ts', chunkIndex: 0 },\n *   workspaceSecret\n * );\n * // Returns something like: \"Xk9mQ2vN8pL3Rm5sYt7uWx\"\n */\nexport function computeArtifactId(artifact: ArtifactIdInput, secret: string): string {\n\tif (!artifact.relativePath) {\n\t\tthrow new Error(\"Artifact relativePath is required for ID generation\");\n\t}\n\tif (!secret) {\n\t\tthrow new Error(\"Workspace secret is required for ID generation\");\n\t}\n\n\t// Step 1: Create path fingerprint using HMAC (not reversible)\n\tconst pathFingerprint = createHmac(\"sha256\", secret).update(artifact.relativePath).digest(\"base64url\").slice(0, 12);\n\n\t// Step 2: Combine components\n\tconst components = [artifact.kind, artifact.lane, pathFingerprint, (artifact.chunkIndex ?? 0).toString()];\n\n\t// Step 3: Hash the combination\n\treturn createHash(\"sha256\").update(components.join(\":\")).digest(\"base64url\").slice(0, 24);\n}\n\n/**\n * Compute a digest of multiple artifact IDs for cache keying.\n * The digest is deterministic regardless of input order.\n *\n * @param artifactIds - Array of artifact IDs\n * @returns A 16-character digest\n */\nexport function computeArtifactSetDigest(artifactIds: string[]): string {\n\t// Sort for determinism\n\tconst sorted = [...artifactIds].sort();\n\treturn createHash(\"sha256\").update(sorted.join(\"|\")).digest(\"base64url\").slice(0, 16);\n}\n\n/**\n * Compute a deterministic hash of an object for cache keying.\n * Keys are sorted to ensure deterministic output.\n *\n * @param obj - Object to hash\n * @returns A 16-character digest\n */\nexport function hashObject(obj: Record<string, unknown>): string {\n\t// Sort keys for determinism\n\tconst normalized = JSON.stringify(obj, Object.keys(obj).sort());\n\treturn createHash(\"sha256\").update(normalized).digest(\"base64url\").slice(0, 16);\n}\n\n/**\n * Generate a unique log ID for decision logging\n *\n * @returns A unique ID with timestamp prefix for sorting\n */\nexport function generateLogId(): string {\n\tconst timestamp = Date.now().toString(36); // Base36 for compact representation\n\tconst random = randomUUID().split(\"-\")[0]; // First segment of UUID\n\treturn `${timestamp}-${random}`;\n}\n\n/**\n * Validate that a string looks like a valid artifact ID\n *\n * @param id - String to validate\n * @returns true if the string matches artifact ID format\n */\nexport function isValidArtifactId(id: string): boolean {\n\t// Artifact IDs are 24 characters of base64url\n\tif (!id || id.length !== 24) {\n\t\treturn false;\n\t}\n\t// Base64url alphabet: A-Z, a-z, 0-9, -, _\n\treturn /^[A-Za-z0-9_-]{24}$/.test(id);\n}\n\n/**\n * Compute a workspace fingerprint from its path.\n * Used for cache keying across sessions.\n *\n * @param workspacePath - Absolute path to the workspace\n * @returns A 16-character fingerprint\n */\nexport function computeWorkspaceFingerprint(workspacePath: string): string {\n\treturn createHash(\"sha256\").update(workspacePath).digest(\"base64url\").slice(0, 16);\n}\n\n/**\n * Compute a content fingerprint for change detection.\n * Used to invalidate cache when content changes.\n *\n * @param content - Content to fingerprint\n * @returns A 16-character fingerprint\n */\nexport function computeContentFingerprint(content: string): string {\n\treturn createHash(\"sha256\").update(content).digest(\"base64url\").slice(0, 16);\n}\n","/**\n * Rendering Module\n *\n * Second pass of the two-pass pipeline:\n * 1. Selection: Pick artifacts using coarse estimates\n * 2. Rendering: Render content, measure exact tokens, shrink if needed\n *\n * This module handles:\n * - Rendering artifact content\n * - Measuring exact token counts\n * - Shrinking content to fit budget\n * - Strategy-based shrinking per artifact kind\n */\n\nimport type {\n\tArtifactCandidate,\n\tArtifactKind,\n\tArtifactRef,\n\tRenderedArtifact,\n\tShrinkStrategy,\n\tTokenCounter,\n} from \"./types.js\";\nimport { defaultTokenCounter, LANE_PRIORITIES } from \"./types.js\";\n\n/**\n * Shrink strategies per artifact kind.\n * Determines how content is reduced when budget is exceeded.\n */\nexport const SHRINK_STRATEGIES: Readonly<Record<ArtifactKind, ShrinkStrategy>> = {\n\tconstraint: \"never\", // Never shrink rules\n\trule_doc: \"never\", // Never shrink rules\n\tlocal_diff: \"truncate_oldest\", // Drop oldest hunks\n\trecent_edit: \"truncate_oldest\", // Drop oldest content\n\tsymbol_context: \"keep_signatures\", // Keep signatures, drop bodies\n\tdependency_graph: \"collapse_summary\", // Collapse to summary\n\ttest_context: \"keep_signatures\", // Keep signatures, drop bodies\n\tsemantic_match: \"truncate_oldest\", // Truncate if needed\n\tsession_history: \"drop_entries\", // Drop oldest entries\n\tviolation: \"drop_entries\", // Drop oldest entries\n\tlearning: \"drop_entries\", // Drop oldest entries\n} as const;\n\n/**\n * Minimum content size after shrinking (tokens)\n */\nexport const MIN_SHRUNK_SIZE = 50;\n\n/**\n * Render a single artifact from ref to full content.\n *\n * @param ref - Artifact reference\n * @param candidates - All candidates (to find matching content)\n * @param countTokens - Token counting function\n * @returns Rendered artifact with exact token count\n * @throws Error if candidate not found\n */\nexport function renderArtifact(\n\tref: ArtifactRef,\n\tcandidates: ArtifactCandidate[],\n\tcountTokens: TokenCounter = defaultTokenCounter,\n): RenderedArtifact {\n\tconst candidate = candidates.find((c) => c.id === ref.id);\n\tif (!candidate) {\n\t\tthrow new Error(`Candidate not found: ${ref.id}`);\n\t}\n\n\tconst content = candidate.getContent();\n\tconst exactTokenCount = countTokens(content);\n\n\treturn {\n\t\tid: ref.id,\n\t\tkind: ref.kind,\n\t\tlane: ref.lane,\n\t\tcontent,\n\t\texactTokenCount,\n\t\tshrunk: false,\n\t};\n}\n\n/**\n * Render multiple artifacts.\n *\n * @param refs - Artifact references\n * @param candidates - All candidates\n * @param countTokens - Token counting function\n * @returns Array of rendered artifacts\n */\nexport function renderArtifacts(\n\trefs: ArtifactRef[],\n\tcandidates: ArtifactCandidate[],\n\tcountTokens: TokenCounter = defaultTokenCounter,\n): RenderedArtifact[] {\n\treturn refs.map((ref) => renderArtifact(ref, candidates, countTokens));\n}\n\n/**\n * Get total token count of rendered artifacts\n *\n * @param rendered - Rendered artifacts\n * @returns Total token count\n */\nexport function getTotalTokens(rendered: RenderedArtifact[]): number {\n\treturn rendered.reduce((sum, r) => sum + r.exactTokenCount, 0);\n}\n\n/**\n * Shrink rendered artifacts to fit within target budget.\n *\n * Algorithm:\n * 1. Calculate overflow (current - target)\n * 2. Sort artifacts by shrinkability (never-shrink last, low priority first)\n * 3. Shrink artifacts one by one until budget is met\n *\n * @param rendered - Rendered artifacts\n * @param targetTokens - Target token budget\n * @param countTokens - Token counting function\n * @returns Shrunk artifacts that fit budget\n */\nexport function shrinkToFit(\n\trendered: RenderedArtifact[],\n\ttargetTokens: number,\n\tcountTokens: TokenCounter = defaultTokenCounter,\n): RenderedArtifact[] {\n\tconst current = getTotalTokens(rendered);\n\n\tif (current <= targetTokens) {\n\t\treturn rendered;\n\t}\n\n\t// Sort by shrinkability (never-shrink last, then by lane priority descending)\n\tconst ordered = [...rendered].sort((a, b) => {\n\t\tconst stratA = SHRINK_STRATEGIES[a.kind];\n\t\tconst stratB = SHRINK_STRATEGIES[b.kind];\n\n\t\t// Never-shrink goes last\n\t\tif (stratA === \"never\" && stratB !== \"never\") {\n\t\t\treturn 1;\n\t\t}\n\t\tif (stratB === \"never\" && stratA !== \"never\") {\n\t\t\treturn -1;\n\t\t}\n\n\t\t// Otherwise, shrink lower priority lanes first (higher priority number = lower priority)\n\t\treturn LANE_PRIORITIES[b.lane] - LANE_PRIORITIES[a.lane];\n\t});\n\n\tconst result: RenderedArtifact[] = [];\n\tconst overflow = current - targetTokens;\n\tlet shrunk = 0;\n\n\tfor (const artifact of ordered) {\n\t\t// If we've shrunk enough or this artifact can't shrink\n\t\tif (shrunk >= overflow || SHRINK_STRATEGIES[artifact.kind] === \"never\") {\n\t\t\tresult.push(artifact);\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Calculate target size for this artifact\n\t\tconst tokensToShrink = overflow - shrunk;\n\t\tconst newTarget = Math.max(artifact.exactTokenCount - tokensToShrink, MIN_SHRUNK_SIZE);\n\n\t\t// If already at or below target, no shrink needed\n\t\tif (artifact.exactTokenCount <= newTarget) {\n\t\t\tresult.push(artifact);\n\t\t\tcontinue;\n\t\t}\n\n\t\t// Apply shrink strategy\n\t\tconst shrunkArtifact = applyShrinkStrategy(artifact, newTarget, countTokens);\n\t\tconst saved = artifact.exactTokenCount - shrunkArtifact.exactTokenCount;\n\t\tshrunk += saved;\n\t\tresult.push(shrunkArtifact);\n\t}\n\n\treturn result;\n}\n\n/**\n * Apply shrink strategy to a single artifact.\n *\n * @param artifact - Artifact to shrink\n * @param targetTokens - Target token count\n * @param countTokens - Token counting function\n * @returns Shrunk artifact\n */\nexport function applyShrinkStrategy(\n\tartifact: RenderedArtifact,\n\ttargetTokens: number,\n\tcountTokens: TokenCounter = defaultTokenCounter,\n): RenderedArtifact {\n\tconst strategy = SHRINK_STRATEGIES[artifact.kind];\n\n\tswitch (strategy) {\n\t\tcase \"truncate_oldest\":\n\t\t\treturn truncateOldest(artifact, targetTokens, countTokens);\n\t\tcase \"keep_signatures\":\n\t\t\treturn keepSignatures(artifact, targetTokens, countTokens);\n\t\tcase \"collapse_summary\":\n\t\t\treturn collapseSummary(artifact, targetTokens, countTokens);\n\t\tcase \"drop_entries\":\n\t\t\treturn dropEntries(artifact, targetTokens, countTokens);\n\t\tdefault:\n\t\t\treturn artifact;\n\t}\n}\n\n/**\n * Truncate oldest content strategy.\n * Used for diffs, histories, and other time-ordered content.\n * Removes lines from the beginning until target is reached.\n *\n * @param artifact - Artifact to shrink\n * @param targetTokens - Target token count\n * @param countTokens - Token counting function\n * @returns Shrunk artifact\n */\nexport function truncateOldest(\n\tartifact: RenderedArtifact,\n\ttargetTokens: number,\n\tcountTokens: TokenCounter = defaultTokenCounter,\n): RenderedArtifact {\n\tconst lines = artifact.content.split(\"\\n\");\n\tlet startIndex = 0;\n\n\t// Remove lines from the start until we're at target\n\twhile (startIndex < lines.length - 1) {\n\t\tconst remaining = lines.slice(startIndex).join(\"\\n\");\n\t\tconst tokens = countTokens(remaining);\n\n\t\tif (tokens <= targetTokens) {\n\t\t\tbreak;\n\t\t}\n\n\t\tstartIndex++;\n\t}\n\n\tconst newContent = (startIndex > 0 ? \"... (truncated)\\n\" : \"\") + lines.slice(startIndex).join(\"\\n\");\n\tconst exactTokenCount = countTokens(newContent);\n\n\treturn {\n\t\t...artifact,\n\t\tcontent: newContent,\n\t\texactTokenCount,\n\t\tshrunk: true,\n\t\toriginalTokenCount: artifact.exactTokenCount,\n\t\tshrinkStrategy: \"truncate_oldest\",\n\t};\n}\n\n/**\n * Keep signatures strategy.\n * Used for code artifacts - keeps function/class signatures, drops bodies.\n *\n * @param artifact - Artifact to shrink\n * @param targetTokens - Target token count\n * @param countTokens - Token counting function\n * @returns Shrunk artifact\n */\nexport function keepSignatures(\n\tartifact: RenderedArtifact,\n\ttargetTokens: number,\n\tcountTokens: TokenCounter = defaultTokenCounter,\n): RenderedArtifact {\n\tconst lines = artifact.content.split(\"\\n\");\n\tconst signatures: string[] = [];\n\tlet inBody = false;\n\tlet braceDepth = 0;\n\n\tfor (const line of lines) {\n\t\tconst trimmed = line.trim();\n\n\t\t// Track brace depth for body detection\n\t\tconst openBraces = (line.match(/{/g) || []).length;\n\t\tconst closeBraces = (line.match(/}/g) || []).length;\n\n\t\tif (!inBody) {\n\t\t\t// Look for function/class/interface signatures\n\t\t\tif (\n\t\t\t\ttrimmed.match(/^(export\\s+)?(async\\s+)?function\\s+\\w+/) ||\n\t\t\t\ttrimmed.match(/^(export\\s+)?(class|interface|type|enum)\\s+\\w+/) ||\n\t\t\t\ttrimmed.match(/^\\w+\\s*\\([^)]*\\)\\s*[:{]/) ||\n\t\t\t\ttrimmed.match(/^(public|private|protected|static|async)\\s+\\w+/)\n\t\t\t) {\n\t\t\t\tsignatures.push(line);\n\t\t\t\tif (openBraces > closeBraces) {\n\t\t\t\t\tinBody = true;\n\t\t\t\t\tbraceDepth = openBraces - closeBraces;\n\t\t\t\t\tsignatures.push(\"  // ... body omitted\");\n\t\t\t\t}\n\t\t\t} else if (!trimmed.startsWith(\"//\") && !trimmed.startsWith(\"/*\") && !trimmed.startsWith(\"*\")) {\n\t\t\t\t// Keep non-body, non-comment lines\n\t\t\t\tif (trimmed !== \"\" && !trimmed.startsWith(\"import\") && !trimmed.startsWith(\"require\")) {\n\t\t\t\t\tsignatures.push(line);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Track body depth\n\t\t\tbraceDepth += openBraces - closeBraces;\n\t\t\tif (braceDepth <= 0) {\n\t\t\t\tinBody = false;\n\t\t\t\tbraceDepth = 0;\n\t\t\t\tsignatures.push(line); // Include closing brace\n\t\t\t}\n\t\t}\n\n\t\t// Check if we're at target\n\t\tconst current = signatures.join(\"\\n\");\n\t\tif (countTokens(current) >= targetTokens) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tconst newContent = signatures.join(\"\\n\");\n\tconst exactTokenCount = countTokens(newContent);\n\n\treturn {\n\t\t...artifact,\n\t\tcontent: newContent,\n\t\texactTokenCount,\n\t\tshrunk: true,\n\t\toriginalTokenCount: artifact.exactTokenCount,\n\t\tshrinkStrategy: \"keep_signatures\",\n\t};\n}\n\n/**\n * Collapse summary strategy.\n * Used for dependency graphs - collapses to high-level summary.\n *\n * @param artifact - Artifact to shrink\n * @param targetTokens - Target token count\n * @param countTokens - Token counting function\n * @returns Shrunk artifact\n */\nexport function collapseSummary(\n\tartifact: RenderedArtifact,\n\ttargetTokens: number,\n\tcountTokens: TokenCounter = defaultTokenCounter,\n): RenderedArtifact {\n\tconst lines = artifact.content.split(\"\\n\");\n\n\t// Extract summary lines (headers, top-level items)\n\tconst summary: string[] = [];\n\tlet itemCount = 0;\n\n\tfor (const line of lines) {\n\t\tconst trimmed = line.trim();\n\n\t\t// Keep headers and top-level items\n\t\tif (\n\t\t\ttrimmed.startsWith(\"#\") ||\n\t\t\ttrimmed.startsWith(\"##\") ||\n\t\t\ttrimmed.startsWith(\"- \") ||\n\t\t\ttrimmed.startsWith(\"* \") ||\n\t\t\ttrimmed.match(/^\\d+\\./)\n\t\t) {\n\t\t\tsummary.push(line);\n\t\t\titemCount++;\n\t\t}\n\n\t\t// Stop if we've reached target\n\t\tconst current = summary.join(\"\\n\");\n\t\tif (countTokens(current) >= targetTokens - 20) {\n\t\t\t// Leave room for summary note\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tconst totalItems = lines.filter((l) => l.trim().startsWith(\"- \") || l.trim().startsWith(\"* \")).length;\n\n\tconst summaryNote = itemCount < totalItems ? `\\n... and ${totalItems - itemCount} more items (collapsed)` : \"\";\n\n\tconst newContent = summary.join(\"\\n\") + summaryNote;\n\tconst exactTokenCount = countTokens(newContent);\n\n\treturn {\n\t\t...artifact,\n\t\tcontent: newContent,\n\t\texactTokenCount,\n\t\tshrunk: true,\n\t\toriginalTokenCount: artifact.exactTokenCount,\n\t\tshrinkStrategy: \"collapse_summary\",\n\t};\n}\n\n/**\n * Drop entries strategy.\n * Used for lists/histories - drops oldest entries first.\n *\n * @param artifact - Artifact to shrink\n * @param targetTokens - Target token count\n * @param countTokens - Token counting function\n * @returns Shrunk artifact\n */\nexport function dropEntries(\n\tartifact: RenderedArtifact,\n\ttargetTokens: number,\n\tcountTokens: TokenCounter = defaultTokenCounter,\n): RenderedArtifact {\n\tconst lines = artifact.content.split(\"\\n\");\n\n\t// Find entry boundaries (empty lines or entry markers)\n\tconst entries: string[][] = [];\n\tlet currentEntry: string[] = [];\n\n\tfor (const line of lines) {\n\t\tif (line.trim() === \"\" && currentEntry.length > 0) {\n\t\t\tentries.push(currentEntry);\n\t\t\tcurrentEntry = [];\n\t\t} else {\n\t\t\tcurrentEntry.push(line);\n\t\t}\n\t}\n\tif (currentEntry.length > 0) {\n\t\tentries.push(currentEntry);\n\t}\n\n\t// Keep entries from the end (most recent)\n\tconst kept: string[][] = [];\n\tlet totalTokens = 0;\n\n\tfor (let i = entries.length - 1; i >= 0; i--) {\n\t\tconst entry = entries[i];\n\t\tconst entryContent = entry.join(\"\\n\");\n\t\tconst entryTokens = countTokens(entryContent);\n\n\t\tif (totalTokens + entryTokens <= targetTokens - 30) {\n\t\t\t// Leave room for note\n\t\t\tkept.unshift(entry);\n\t\t\ttotalTokens += entryTokens;\n\t\t} else if (kept.length === 0) {\n\t\t\t// Keep at least one entry\n\t\t\tkept.unshift(entry);\n\t\t\tbreak;\n\t\t} else {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tconst droppedCount = entries.length - kept.length;\n\tconst droppedNote = droppedCount > 0 ? `... ${droppedCount} older entries dropped\\n\\n` : \"\";\n\n\tconst newContent = droppedNote + kept.map((e) => e.join(\"\\n\")).join(\"\\n\\n\");\n\tconst exactTokenCount = countTokens(newContent);\n\n\treturn {\n\t\t...artifact,\n\t\tcontent: newContent,\n\t\texactTokenCount,\n\t\tshrunk: true,\n\t\toriginalTokenCount: artifact.exactTokenCount,\n\t\tshrinkStrategy: \"drop_entries\",\n\t};\n}\n\n/**\n * Check if shrinking is needed for a set of rendered artifacts\n *\n * @param rendered - Rendered artifacts\n * @param budget - Token budget\n * @returns true if total exceeds budget\n */\nexport function needsShrinking(rendered: RenderedArtifact[], budget: number): boolean {\n\treturn getTotalTokens(rendered) > budget;\n}\n\n/**\n * Calculate shrink statistics\n *\n * @param rendered - Rendered artifacts (after shrinking)\n * @returns Shrink statistics\n */\nexport function getShrinkStats(rendered: RenderedArtifact[]): {\n\tshrunkCount: number;\n\ttotalSaved: number;\n\tbyStrategy: Record<ShrinkStrategy, number>;\n} {\n\tlet shrunkCount = 0;\n\tlet totalSaved = 0;\n\tconst byStrategy = {} as Record<ShrinkStrategy, number>;\n\n\tfor (const r of rendered) {\n\t\tif (r.shrunk && r.originalTokenCount !== undefined && r.shrinkStrategy) {\n\t\t\tshrunkCount++;\n\t\t\tconst saved = r.originalTokenCount - r.exactTokenCount;\n\t\t\ttotalSaved += saved;\n\t\t\tbyStrategy[r.shrinkStrategy] = (byStrategy[r.shrinkStrategy] ?? 0) + 1;\n\t\t}\n\t}\n\n\treturn { shrunkCount, totalSaved, byStrategy };\n}\n","/**\n * Replay Module\n *\n * Records decision logs for:\n * - Determinism verification (replay same inputs  same outputs)\n * - Debugging (why was artifact X selected/rejected?)\n * - Evaluation (A/B testing selection strategies)\n * - Auditing (what context was provided to AI?)\n *\n * Decision logs are safe for external storage (no file content).\n */\n\nimport { COMPOSER_VERSION, computeCandidateDigest } from \"./cache.js\";\nimport type { ComposerConstraints } from \"./constraints.js\";\nimport { hashObject } from \"./fingerprint.js\";\nimport type { ArtifactCandidate, ArtifactRef, Lane } from \"./types.js\";\n\n/**\n * Decision log for replay and evaluation.\n * Saved after each composition for determinism verification.\n * Contains NO file content - safe for external storage.\n */\nexport interface ComposerDecisionLog {\n\t// Identification\n\t/** Unique log ID */\n\tid: string;\n\t/** Unix timestamp */\n\ttimestamp: number;\n\t/** Composer version for compatibility */\n\tcomposerVersion: string;\n\n\t// Context\n\t/** Workspace fingerprint */\n\tworkspaceFingerprint: string;\n\t/** Trigger event type */\n\ttriggerEvent: string;\n\t/** Git commit or equivalent */\n\tcommitish: string;\n\n\t// Inputs\n\t/** Number of candidates considered */\n\tcandidateCount: number;\n\t/** Digest of candidate set for verification */\n\tcandidateDigest: string;\n\t/** Digest of constraints */\n\tconstraintsDigest: string;\n\t/** Digest of budget configuration */\n\tbudgetConfigDigest: string;\n\n\t// Outputs\n\t/** Selected artifact references */\n\tselectedArtifacts: ArtifactRef[];\n\t/** Token allocation by lane */\n\tbudgetAllocation: Record<Lane, number>;\n\t/** Total tokens used */\n\ttotalTokensUsed: number;\n\n\t// Rankings (for debugging)\n\trankings: Array<{\n\t\tartifact: ArtifactRef;\n\t\tscore: number;\n\t\tselected: boolean;\n\t\trejectionReason?: string;\n\t}>;\n\n\t// Cache\n\t/** Cache key for this composition */\n\tcacheKey: string;\n\t/** Whether this was a cache hit */\n\tcacheHit: boolean;\n\n\t// Expected (for golden tests)\n\texpectedSelection?: ArtifactRef[];\n\n\t// Performance\n\t/** Duration in milliseconds */\n\tdurationMs: number;\n}\n\n/**\n * Generate a unique log ID.\n *\n * @returns Log ID with timestamp prefix for sorting\n */\nexport function generateLogId(): string {\n\tconst timestamp = Date.now().toString(36);\n\tconst random = Math.random().toString(36).slice(2, 10);\n\treturn `log_${timestamp}_${random}`;\n}\n\n/**\n * Emit a decision log after composition.\n *\n * @param params - Parameters for the decision log\n * @returns Complete decision log\n */\nexport function emitDecisionLog(params: {\n\tresult: {\n\t\tselected: ArtifactRef[];\n\t\tallocation: Record<Lane, number>;\n\t\tcacheKey: string;\n\t\tcacheHit: boolean;\n\t\tactualTokens: number;\n\t};\n\ttrigger: {\n\t\tevent: string;\n\t\tworkspaceFingerprint: string;\n\t\tcommitish?: string;\n\t};\n\tconstraints: ComposerConstraints;\n\tcandidates: ArtifactCandidate[];\n\tbudgetConfig: Record<string, unknown>;\n\trankings: Array<{\n\t\tartifact: ArtifactRef;\n\t\tscore: number;\n\t\tselected: boolean;\n\t\trejectionReason?: string;\n\t}>;\n\tstartTime: number;\n}): ComposerDecisionLog {\n\tconst { result, trigger, constraints, candidates, budgetConfig, rankings, startTime } = params;\n\n\treturn {\n\t\tid: generateLogId(),\n\t\ttimestamp: Date.now(),\n\t\tcomposerVersion: COMPOSER_VERSION,\n\n\t\tworkspaceFingerprint: trigger.workspaceFingerprint,\n\t\ttriggerEvent: trigger.event,\n\t\tcommitish: trigger.commitish ?? \"HEAD\",\n\n\t\tcandidateCount: candidates.length,\n\t\tcandidateDigest: computeCandidateDigest(candidates),\n\t\tconstraintsDigest: hashObject(constraints as unknown as Record<string, unknown>),\n\t\tbudgetConfigDigest: hashObject(budgetConfig),\n\n\t\tselectedArtifacts: result.selected,\n\t\tbudgetAllocation: result.allocation,\n\t\ttotalTokensUsed: result.actualTokens,\n\n\t\trankings,\n\n\t\tcacheKey: result.cacheKey,\n\t\tcacheHit: result.cacheHit,\n\n\t\tdurationMs: Date.now() - startTime,\n\t};\n}\n\n/**\n * Result of determinism verification\n */\nexport interface VerificationResult {\n\t/** Whether verification passed */\n\tpassed: boolean;\n\t/** List of differences found */\n\tdifferences: string[];\n\t/** Original log */\n\toriginal: ComposerDecisionLog;\n\t/** Replay result */\n\treplay?: Partial<ComposerDecisionLog>;\n}\n\n/**\n * Verify determinism by comparing a log with a replay.\n *\n * @param original - Original decision log\n * @param replay - Replay result\n * @returns Verification result with differences\n */\nexport function verifyDeterminism(\n\toriginal: ComposerDecisionLog,\n\treplay: {\n\t\tselected: ArtifactRef[];\n\t\tallocation: Record<Lane, number>;\n\t\ttotalTokensUsed: number;\n\t\tcacheKey: string;\n\t},\n): VerificationResult {\n\tconst differences: string[] = [];\n\n\t// Compare selected artifacts\n\tconst originalIds = new Set(original.selectedArtifacts.map((a) => a.id));\n\tconst replayIds = new Set(replay.selected.map((a) => a.id));\n\n\tfor (const id of originalIds) {\n\t\tif (!replayIds.has(id)) {\n\t\t\tdifferences.push(`Missing in replay: ${id}`);\n\t\t}\n\t}\n\n\tfor (const id of replayIds) {\n\t\tif (!originalIds.has(id)) {\n\t\t\tdifferences.push(`Extra in replay: ${id}`);\n\t\t}\n\t}\n\n\t// Compare order (if IDs match)\n\tif (differences.length === 0) {\n\t\tconst originalOrder = original.selectedArtifacts.map((a) => a.id);\n\t\tconst replayOrder = replay.selected.map((a) => a.id);\n\n\t\tfor (let i = 0; i < originalOrder.length; i++) {\n\t\t\tif (originalOrder[i] !== replayOrder[i]) {\n\t\t\t\tdifferences.push(`Order mismatch at position ${i}: ${originalOrder[i]} vs ${replayOrder[i]}`);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Compare token usage\n\tif (original.totalTokensUsed !== replay.totalTokensUsed) {\n\t\tdifferences.push(`Token mismatch: original=${original.totalTokensUsed}, replay=${replay.totalTokensUsed}`);\n\t}\n\n\t// Compare allocation\n\tfor (const lane of Object.keys(original.budgetAllocation) as Lane[]) {\n\t\tconst origLane = original.budgetAllocation[lane];\n\t\tconst replayLane = replay.allocation[lane];\n\t\tif (origLane !== replayLane) {\n\t\t\tdifferences.push(`Lane ${lane} mismatch: original=${origLane}, replay=${replayLane}`);\n\t\t}\n\t}\n\n\t// Compare cache keys\n\tif (original.cacheKey !== replay.cacheKey) {\n\t\tdifferences.push(`Cache key mismatch: original=${original.cacheKey}, replay=${replay.cacheKey}`);\n\t}\n\n\treturn {\n\t\tpassed: differences.length === 0,\n\t\tdifferences,\n\t\toriginal,\n\t\treplay: {\n\t\t\tselectedArtifacts: replay.selected,\n\t\t\tbudgetAllocation: replay.allocation,\n\t\t\ttotalTokensUsed: replay.totalTokensUsed,\n\t\t\tcacheKey: replay.cacheKey,\n\t\t},\n\t};\n}\n\n/**\n * Format a decision log for display\n *\n * @param log - Decision log\n * @returns Formatted string\n */\nexport function formatDecisionLog(log: ComposerDecisionLog): string {\n\tconst lines: string[] = [\n\t\t`Decision Log: ${log.id}`,\n\t\t`  Timestamp: ${new Date(log.timestamp).toISOString()}`,\n\t\t`  Version: ${log.composerVersion}`,\n\t\t`  Trigger: ${log.triggerEvent}`,\n\t\t`  Commit: ${log.commitish}`,\n\t\t\"\",\n\t\t`  Candidates: ${log.candidateCount}`,\n\t\t`  Selected: ${log.selectedArtifacts.length}`,\n\t\t`  Tokens: ${log.totalTokensUsed}`,\n\t\t`  Duration: ${log.durationMs}ms`,\n\t\t`  Cache: ${log.cacheHit ? \"HIT\" : \"MISS\"}`,\n\t\t\"\",\n\t\t\"  Allocation:\",\n\t];\n\n\tfor (const [lane, tokens] of Object.entries(log.budgetAllocation)) {\n\t\tlines.push(`    ${lane}: ${tokens}`);\n\t}\n\n\tif (log.rankings.length > 0) {\n\t\tlines.push(\"\");\n\t\tlines.push(\"  Top Rankings:\");\n\t\tfor (const r of log.rankings.slice(0, 5)) {\n\t\t\tconst status = r.selected ? \"\" : ` (${r.rejectionReason})`;\n\t\t\tlines.push(`    ${status} ${r.artifact.kind}: ${r.score.toFixed(3)}`);\n\t\t}\n\t}\n\n\treturn lines.join(\"\\n\");\n}\n\n/**\n * Create a minimal log for storage (no rankings)\n *\n * @param log - Full decision log\n * @returns Minimal log\n */\nexport function toMinimalLog(log: ComposerDecisionLog): Omit<ComposerDecisionLog, \"rankings\"> {\n\tconst { rankings: _rankings, ...minimal } = log;\n\treturn minimal;\n}\n\n/**\n * Validate a decision log structure\n *\n * @param log - Log to validate\n * @returns true if valid\n */\nexport function isValidDecisionLog(log: unknown): log is ComposerDecisionLog {\n\tif (!log || typeof log !== \"object\") {\n\t\treturn false;\n\t}\n\n\tconst l = log as Record<string, unknown>;\n\n\treturn (\n\t\ttypeof l.id === \"string\" &&\n\t\ttypeof l.timestamp === \"number\" &&\n\t\ttypeof l.composerVersion === \"string\" &&\n\t\ttypeof l.workspaceFingerprint === \"string\" &&\n\t\ttypeof l.triggerEvent === \"string\" &&\n\t\ttypeof l.candidateCount === \"number\" &&\n\t\tArray.isArray(l.selectedArtifacts) &&\n\t\ttypeof l.totalTokensUsed === \"number\"\n\t);\n}\n\n/**\n * Compare two logs for equality (ignoring timing/cache)\n *\n * @param a - First log\n * @param b - Second log\n * @returns true if selections are equivalent\n */\nexport function logsAreEquivalent(a: ComposerDecisionLog, b: ComposerDecisionLog): boolean {\n\t// Compare selected artifact IDs\n\tconst aIds = a.selectedArtifacts\n\t\t.map((x) => x.id)\n\t\t.sort()\n\t\t.join(\",\");\n\tconst bIds = b.selectedArtifacts\n\t\t.map((x) => x.id)\n\t\t.sort()\n\t\t.join(\",\");\n\n\tif (aIds !== bIds) {\n\t\treturn false;\n\t}\n\n\t// Compare token totals\n\tif (a.totalTokensUsed !== b.totalTokensUsed) {\n\t\treturn false;\n\t}\n\n\t// Compare allocations\n\tfor (const lane of Object.keys(a.budgetAllocation) as Lane[]) {\n\t\tif (a.budgetAllocation[lane] !== b.budgetAllocation[lane]) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n","/**\n * Selection Pipeline\n *\n * The core selection algorithm that:\n * 1. Applies exclusions (policy-blocked artifacts)\n * 2. Extracts pinned artifacts (always selected first)\n * 3. Extracts must-include artifacts (after pinned)\n * 4. Scores and ranks remaining candidates\n * 5. Selects within budget constraints\n * 6. Generates explainable results\n *\n * Key guarantee: Deterministic - same inputs  same outputs\n */\n\nimport type { AllocationResult } from \"./allocation.js\";\nimport { allocateMinBudgets, selectWithinBudget } from \"./allocation.js\";\nimport type { BudgetConfig } from \"./budget.js\";\nimport type { ComposerConstraints } from \"./constraints.js\";\nimport { isExcluded, isMustInclude, isPinned } from \"./constraints.js\";\nimport { scoreAndSort } from \"./scoring.js\";\nimport type { ArtifactCandidate, ArtifactRef, Lane, RenderedArtifact } from \"./types.js\";\n\n/**\n * Reason why an artifact was rejected\n */\nexport type RejectionReason = \"excluded_by_policy\" | \"lane_max_reached\" | \"budget_exceeded\" | \"lower_priority\";\n\n/**\n * Record of a rejected artifact with reason\n */\nexport interface RejectionRecord {\n\tartifact: ArtifactRef;\n\treason: RejectionReason;\n\tdetail?: string;\n}\n\n/**\n * Context for selection (used for cache key computation)\n */\nexport interface SelectionContext {\n\t/** Workspace fingerprint for cache keying */\n\tworkspaceFingerprint: string;\n\t/** What triggered this selection */\n\ttriggerEvent: string;\n\t/** Git commit or equivalent */\n\tcommitish: string;\n\t/** Hash of active rules */\n\trulesDigest: string;\n}\n\n/**\n * Selection result (safe for logging/telemetry)\n */\nexport interface SelectionResult {\n\t/** Selected artifact references (IDs only, no content) */\n\tselected: ArtifactRef[];\n\t/** Tokens used per lane */\n\tallocation: Record<Lane, number>;\n\t/** Rejection records for explainability */\n\trejections: RejectionRecord[];\n\t/** Cache key for this selection */\n\tcacheKey: string;\n\t/** Whether this was a cache hit */\n\tcacheHit: boolean;\n\t/** Allocation details (for debugging) */\n\tallocationDetails: AllocationResult;\n\n\t/**\n\t * Rendered artifacts (internal only, filled in render pass)\n\t * Content is never logged externally\n\t */\n\trendered: RenderedArtifact[];\n}\n\n/**\n * Convert an ArtifactCandidate to an ArtifactRef (safe for logging)\n *\n * @param candidate - Full candidate with content\n * @returns Reference without content\n */\nexport function toRef(candidate: ArtifactCandidate): ArtifactRef {\n\treturn {\n\t\tid: candidate.id,\n\t\tkind: candidate.kind,\n\t\tlane: candidate.lane,\n\t\ttokenEstimate: candidate.tokenEstimate,\n\t};\n}\n\n/**\n * Main selection function.\n * Implements the constraint-aware selection pipeline.\n *\n * Algorithm:\n * 1. Apply exclusions (remove policy-blocked)\n * 2. Extract pinned (selected unconditionally)\n * 3. Extract must-include (selected after pinned)\n * 4. Allocate minimum budgets per lane\n * 5. Score and sort remaining candidates\n * 6. Select within budget constraints\n * 7. Generate cache key and result\n *\n * @param candidates - All artifact candidates\n * @param config - Budget configuration\n * @param constraints - Policy constraints\n * @param context - Selection context for cache key\n * @param getPath - Optional function to get artifact paths (for pattern matching)\n * @returns Selection result with selected, rejections, and allocation\n */\nexport function selectArtifacts(\n\tcandidates: ArtifactCandidate[],\n\tconfig: BudgetConfig,\n\tconstraints: ComposerConstraints,\n\tcontext: SelectionContext,\n\tgetPath?: (artifact: ArtifactCandidate) => string | undefined,\n): SelectionResult {\n\t// Track selected by ID (not object identity) - Set<string> for determinism\n\tconst selectedIds = new Set<string>();\n\tconst selected: ArtifactCandidate[] = [];\n\tconst rejections: RejectionRecord[] = [];\n\n\t// =========================================================================\n\t// STEP 1: Apply exclusions\n\t// =========================================================================\n\tconst afterExclude = candidates.filter((c) => {\n\t\tconst exclusion = isExcluded(c, constraints, getPath);\n\t\tif (exclusion) {\n\t\t\trejections.push({\n\t\t\t\tartifact: toRef(c),\n\t\t\t\treason: \"excluded_by_policy\",\n\t\t\t\tdetail: exclusion.reason,\n\t\t\t});\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t});\n\n\t// =========================================================================\n\t// STEP 2: Extract pinned (selected first, unconditionally)\n\t// =========================================================================\n\tfor (const candidate of afterExclude) {\n\t\tconst pinConstraint = isPinned(candidate, constraints, getPath);\n\t\tif (pinConstraint && !selectedIds.has(candidate.id)) {\n\t\t\tselectedIds.add(candidate.id);\n\t\t\tselected.push(candidate);\n\t\t}\n\t}\n\n\t// =========================================================================\n\t// STEP 3: Extract must-include (after pinned)\n\t// =========================================================================\n\tfor (const candidate of afterExclude) {\n\t\tif (selectedIds.has(candidate.id)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst mustIncludeConstraint = isMustInclude(candidate, constraints, getPath);\n\t\tif (mustIncludeConstraint) {\n\t\t\tselectedIds.add(candidate.id);\n\t\t\tselected.push(candidate);\n\t\t}\n\t}\n\n\t// =========================================================================\n\t// STEP 4: Remaining candidates for scoring\n\t// =========================================================================\n\tconst eligible = afterExclude.filter((c) => !selectedIds.has(c.id));\n\n\t// =========================================================================\n\t// STEP 5: Allocate budgets and score candidates\n\t// =========================================================================\n\tconst allocationDetails = allocateMinBudgets(eligible, config);\n\n\t// Score and sort eligible candidates\n\tconst scored = scoreAndSort(eligible);\n\n\t// =========================================================================\n\t// STEP 6: Select within budget constraints\n\t// =========================================================================\n\tconst budgetResult = selectWithinBudget(\n\t\tscored.map((s) => s.candidate),\n\t\tselected,\n\t\tconfig,\n\t);\n\n\t// Add budget-selected artifacts\n\tfor (const s of budgetResult.selected) {\n\t\tif (!selectedIds.has(s.id)) {\n\t\t\tselectedIds.add(s.id);\n\t\t\tselected.push(s);\n\t\t}\n\t}\n\n\t// Record rejections\n\tfor (const r of budgetResult.rejected) {\n\t\trejections.push({\n\t\t\tartifact: toRef(r.candidate),\n\t\t\treason: r.reason,\n\t\t\tdetail: r.reason === \"lane_max_reached\" ? `${r.candidate.lane} lane at max` : \"Total budget exhausted\",\n\t\t});\n\t}\n\n\t// =========================================================================\n\t// STEP 7: Compute cache key\n\t// =========================================================================\n\tconst cacheKey = computeSelectionCacheKey(candidates, config, constraints, context);\n\n\t// =========================================================================\n\t// STEP 8: Build result\n\t// =========================================================================\n\treturn {\n\t\tselected: selected.map(toRef),\n\t\tallocation: budgetResult.usage,\n\t\trejections,\n\t\tcacheKey,\n\t\tcacheHit: false,\n\t\tallocationDetails,\n\t\trendered: [], // Filled in render pass\n\t};\n}\n\n/**\n * Compute a cache key for the selection inputs.\n * Key is computed BEFORE selection work, not from output.\n *\n * @param candidates - All candidates\n * @param config - Budget configuration\n * @param constraints - Policy constraints\n * @param context - Selection context\n * @returns Cache key string\n */\nfunction computeSelectionCacheKey(\n\tcandidates: ArtifactCandidate[],\n\tconfig: BudgetConfig,\n\tconstraints: ComposerConstraints,\n\tcontext: SelectionContext,\n): string {\n\t// Build cache key components\n\tconst components = [\n\t\tcontext.workspaceFingerprint,\n\t\tcontext.triggerEvent,\n\t\tcontext.commitish,\n\t\tcontext.rulesDigest,\n\t\tconfig.totalTokens.toString(),\n\t\tcandidates.length.toString(),\n\t\t// Include candidate IDs (sorted for determinism)\n\t\t...candidates.map((c) => c.id).sort(),\n\t\t// Include constraint counts\n\t\tconstraints.mustInclude.length.toString(),\n\t\tconstraints.mustExclude.length.toString(),\n\t\tconstraints.pinned.length.toString(),\n\t];\n\n\t// Simple hash for cache key\n\tlet hash = 0;\n\tconst str = components.join(\"|\");\n\tfor (let i = 0; i < str.length; i++) {\n\t\tconst char = str.charCodeAt(i);\n\t\thash = ((hash << 5) - hash + char) | 0;\n\t}\n\n\treturn `sel_${Math.abs(hash).toString(36)}`;\n}\n\n/**\n * Verify that selection is deterministic by running twice\n *\n * @param candidates - All candidates\n * @param config - Budget configuration\n * @param constraints - Policy constraints\n * @param context - Selection context\n * @returns true if both runs produce identical results\n */\nexport function verifySelectionDeterminism(\n\tcandidates: ArtifactCandidate[],\n\tconfig: BudgetConfig,\n\tconstraints: ComposerConstraints,\n\tcontext: SelectionContext,\n): boolean {\n\tconst result1 = selectArtifacts(candidates, config, constraints, context);\n\tconst result2 = selectArtifacts(candidates, config, constraints, context);\n\n\t// Compare selected IDs\n\tconst ids1 = result1.selected.map((s) => s.id).join(\",\");\n\tconst ids2 = result2.selected.map((s) => s.id).join(\",\");\n\n\tif (ids1 !== ids2) {\n\t\treturn false;\n\t}\n\n\t// Compare cache keys\n\tif (result1.cacheKey !== result2.cacheKey) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\n/**\n * Get selection statistics\n *\n * @param result - Selection result\n * @returns Statistics for monitoring\n */\nexport function getSelectionStats(result: SelectionResult): {\n\ttotalSelected: number;\n\ttotalRejected: number;\n\tbyLane: Record<Lane, number>;\n\trejectionsByReason: Record<RejectionReason, number>;\n} {\n\tconst byLane = {} as Record<Lane, number>;\n\tfor (const s of result.selected) {\n\t\tbyLane[s.lane] = (byLane[s.lane] ?? 0) + 1;\n\t}\n\n\tconst rejectionsByReason = {} as Record<RejectionReason, number>;\n\tfor (const r of result.rejections) {\n\t\trejectionsByReason[r.reason] = (rejectionsByReason[r.reason] ?? 0) + 1;\n\t}\n\n\treturn {\n\t\ttotalSelected: result.selected.length,\n\t\ttotalRejected: result.rejections.length,\n\t\tbyLane,\n\t\trejectionsByReason,\n\t};\n}\n","/**\n * Composer - Main Orchestrator\n *\n * The trust core of SnapBack's context assembly system.\n * Provides deterministic, reproducible artifact selection under strict token budgets.\n *\n * Pipeline:\n * 1. Gather candidates from sources\n * 2. Check cache (input-based key)\n * 3. PASS 1: Select using coarse token estimates\n * 4. PASS 2: Render, measure exact tokens, shrink if needed\n * 5. Emit decision log for replay\n * 6. Return result with explanation\n *\n * Guarantees:\n * - Determinism: Same inputs  Same outputs\n * - Budget compliance: Never exceeds allocated tokens\n * - Explainability: Every decision logged with reason\n * - Privacy: Artifact IDs are path-free (HMAC-based)\n */\n\nimport type { BudgetConfig } from \"./budget.js\";\nimport { DEFAULT_BUDGET_CONFIG, validateBudgetConfig } from \"./budget.js\";\nimport { buildCacheKeyInputs, CACHE_TTL_MS, computeCacheKey, SelectionCache } from \"./cache.js\";\nimport type { ComposerConstraints } from \"./constraints.js\";\nimport { EMPTY_CONSTRAINTS } from \"./constraints.js\";\nimport { buildExplanation, type SelectionExplanation, withCacheHit } from \"./explainability.js\";\nimport { generateWorkspaceSecret } from \"./fingerprint.js\";\nimport { getTotalTokens, renderArtifacts, shrinkToFit } from \"./rendering.js\";\nimport { type ComposerDecisionLog, emitDecisionLog } from \"./replay.js\";\nimport { scoreAndSort } from \"./scoring.js\";\nimport { selectArtifacts, toRef } from \"./selection.js\";\nimport type { ArtifactCandidate, ArtifactRef, ArtifactSource, Lane, RenderedArtifact, TokenCounter } from \"./types.js\";\nimport { defaultTokenCounter } from \"./types.js\";\n\n/**\n * Composer configuration options\n */\nexport interface ComposerOptions {\n\t/** Budget configuration (defaults to DEFAULT_BUDGET_CONFIG) */\n\tbudgetConfig?: BudgetConfig;\n\t/** Artifact sources to gather candidates from */\n\tsources?: ArtifactSource[];\n\t/** Cache TTL in milliseconds (defaults to 5 minutes) */\n\tcacheTtlMs?: number;\n\t/** Token counter function (defaults to char/4 approximation) */\n\ttokenCounter?: TokenCounter;\n\t/** Workspace secret for HMAC-based artifact IDs */\n\tworkspaceSecret?: string;\n\t/** Whether to emit decision logs */\n\temitDecisionLogs?: boolean;\n}\n\n/**\n * Trigger for composition\n */\nexport interface ComposeTrigger {\n\t/** What triggered this composition */\n\tevent: string;\n\t/** Workspace fingerprint for cache keying */\n\tworkspaceFingerprint: string;\n\t/** Git commit or equivalent */\n\tcommitish?: string;\n\t/** Keywords for relevance scoring */\n\tkeywords?: string[];\n\t/** Files currently being edited */\n\tfiles?: string[];\n}\n\n/**\n * Complete composition result\n */\nexport interface CompositionResult {\n\t/** Selected artifact references (safe for logging) */\n\tselected: ArtifactRef[];\n\t/** Token allocation by lane */\n\tallocation: Record<Lane, number>;\n\t/** Human-readable explanation */\n\texplanation: SelectionExplanation;\n\t/** Cache key for this composition */\n\tcacheKey: string;\n\t/** Whether this was a cache hit */\n\tcacheHit: boolean;\n\t/** Actual token count after rendering */\n\tactualTokens: number;\n\t/** Rendered artifacts (internal use only) */\n\trendered: RenderedArtifact[];\n\t/** Decision log (if emitDecisionLogs is true) */\n\tdecisionLog?: ComposerDecisionLog;\n}\n\n/**\n * Resolved composer configuration\n */\ninterface ResolvedConfig {\n\tbudgetConfig: BudgetConfig;\n\tsources: ArtifactSource[];\n\tcacheTtlMs: number;\n\ttokenCounter: TokenCounter;\n\tworkspaceSecret: string;\n\temitDecisionLogs: boolean;\n}\n\n/**\n * Main Composer class.\n * Orchestrates the two-pass selection + rendering pipeline.\n */\nexport class Composer {\n\tprivate config: ResolvedConfig;\n\tprivate cache: SelectionCache<CompositionResult>;\n\tprivate rulesDigest = \"\";\n\n\tconstructor(options: ComposerOptions = {}) {\n\t\tthis.config = this.resolveConfig(options);\n\n\t\t// Validate budget config on construction\n\t\tvalidateBudgetConfig(this.config.budgetConfig);\n\n\t\t// Initialize cache\n\t\tthis.cache = new SelectionCache(this.config.cacheTtlMs);\n\t}\n\n\t/**\n\t * Main entry point: compose context for a trigger.\n\t *\n\t * @param trigger - What triggered this composition\n\t * @param constraints - Policy constraints (optional)\n\t * @returns Composition result with selected artifacts\n\t */\n\tasync compose(\n\t\ttrigger: ComposeTrigger,\n\t\tconstraints: ComposerConstraints = EMPTY_CONSTRAINTS,\n\t): Promise<CompositionResult> {\n\t\tconst startTime = Date.now();\n\n\t\t// =========================================================================\n\t\t// STEP 1: Gather candidates from all sources\n\t\t// =========================================================================\n\t\tconst candidates = await this.gatherCandidates(trigger);\n\n\t\t// =========================================================================\n\t\t// STEP 2: Build context for cache key\n\t\t// =========================================================================\n\t\tconst context = {\n\t\t\tworkspaceFingerprint: trigger.workspaceFingerprint,\n\t\t\ttriggerEvent: trigger.event,\n\t\t\tcommitish: trigger.commitish ?? \"HEAD\",\n\t\t\trulesDigest: this.rulesDigest,\n\t\t};\n\n\t\t// =========================================================================\n\t\t// STEP 3: Check cache\n\t\t// =========================================================================\n\t\tconst cacheKeyInputs = buildCacheKeyInputs(\n\t\t\tcandidates,\n\t\t\tconstraints,\n\t\t\tthis.config.budgetConfig as unknown as Record<string, unknown>,\n\t\t\tcontext,\n\t\t);\n\t\tconst cacheKey = computeCacheKey(cacheKeyInputs);\n\n\t\tconst cached = this.cache.get(cacheKey);\n\t\tif (cached) {\n\t\t\treturn {\n\t\t\t\t...cached,\n\t\t\t\tcacheHit: true,\n\t\t\t\texplanation: withCacheHit(cached.explanation, true),\n\t\t\t};\n\t\t}\n\n\t\t// =========================================================================\n\t\t// STEP 4: PASS 1 - Select using coarse estimates\n\t\t// =========================================================================\n\t\tconst selection = selectArtifacts(candidates, this.config.budgetConfig, constraints, context);\n\n\t\t// =========================================================================\n\t\t// STEP 5: PASS 2 - Render and measure actual tokens\n\t\t// =========================================================================\n\t\tconst rendered = renderArtifacts(selection.selected, candidates, this.config.tokenCounter);\n\n\t\t// =========================================================================\n\t\t// STEP 6: Measure actual tokens\n\t\t// =========================================================================\n\t\tlet actualTotal = getTotalTokens(rendered);\n\n\t\t// =========================================================================\n\t\t// STEP 7: If over budget, shrink\n\t\t// =========================================================================\n\t\tlet finalRendered = rendered;\n\t\tif (actualTotal > this.config.budgetConfig.totalTokens) {\n\t\t\tfinalRendered = shrinkToFit(rendered, this.config.budgetConfig.totalTokens, this.config.tokenCounter);\n\t\t\tactualTotal = getTotalTokens(finalRendered);\n\t\t}\n\n\t\t// =========================================================================\n\t\t// STEP 8: Build explanation\n\t\t// =========================================================================\n\t\tconst selectedCandidates = candidates.filter((c) => selection.selected.some((s) => s.id === c.id));\n\n\t\tconst explanation = buildExplanation(\n\t\t\tselectedCandidates,\n\t\t\tselection.rejections,\n\t\t\tselection.allocation,\n\t\t\tthis.config.budgetConfig,\n\t\t\tselection.allocationDetails.shortfalls,\n\t\t\t{\n\t\t\t\tpinned: constraints.pinned.length,\n\t\t\t\tmustInclude: constraints.mustInclude.length,\n\t\t\t\texcluded: constraints.mustExclude.length,\n\t\t\t},\n\t\t);\n\n\t\t// =========================================================================\n\t\t// STEP 9: Build result\n\t\t// =========================================================================\n\t\tconst result: CompositionResult = {\n\t\t\tselected: selection.selected,\n\t\t\tallocation: selection.allocation,\n\t\t\texplanation,\n\t\t\tcacheKey,\n\t\t\tcacheHit: false,\n\t\t\tactualTokens: actualTotal,\n\t\t\trendered: finalRendered,\n\t\t};\n\n\t\t// =========================================================================\n\t\t// STEP 10: Emit decision log\n\t\t// =========================================================================\n\t\tif (this.config.emitDecisionLogs) {\n\t\t\tconst rankings = scoreAndSort(candidates).map((sc) => ({\n\t\t\t\tartifact: toRef(sc.candidate),\n\t\t\t\tscore: sc.score,\n\t\t\t\tselected: selection.selected.some((s) => s.id === sc.candidate.id),\n\t\t\t\trejectionReason: selection.rejections.find((r) => r.artifact.id === sc.candidate.id)?.reason,\n\t\t\t}));\n\n\t\t\tresult.decisionLog = emitDecisionLog({\n\t\t\t\tresult: {\n\t\t\t\t\tselected: result.selected,\n\t\t\t\t\tallocation: result.allocation,\n\t\t\t\t\tcacheKey: result.cacheKey,\n\t\t\t\t\tcacheHit: result.cacheHit,\n\t\t\t\t\tactualTokens: result.actualTokens,\n\t\t\t\t},\n\t\t\t\ttrigger,\n\t\t\t\tconstraints,\n\t\t\t\tcandidates,\n\t\t\t\tbudgetConfig: this.config.budgetConfig as unknown as Record<string, unknown>,\n\t\t\t\trankings,\n\t\t\t\tstartTime,\n\t\t\t});\n\t\t}\n\n\t\t// =========================================================================\n\t\t// STEP 11: Cache result\n\t\t// =========================================================================\n\t\tthis.cache.set(cacheKey, result);\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Compose with explicit candidates (for testing)\n\t */\n\tasync composeWithCandidates(\n\t\tcandidates: ArtifactCandidate[],\n\t\ttrigger: ComposeTrigger,\n\t\tconstraints: ComposerConstraints = EMPTY_CONSTRAINTS,\n\t): Promise<CompositionResult> {\n\t\t// Store candidates temporarily as a source\n\t\tconst tempSource: ArtifactSource = {\n\t\t\tgenerateCandidates: async () => candidates,\n\t\t};\n\n\t\tconst originalSources = this.config.sources;\n\t\tthis.config.sources = [tempSource];\n\n\t\ttry {\n\t\t\treturn await this.compose(trigger, constraints);\n\t\t} finally {\n\t\t\tthis.config.sources = originalSources;\n\t\t}\n\t}\n\n\t/**\n\t * Get the current configuration\n\t */\n\tgetConfig(): BudgetConfig {\n\t\treturn this.config.budgetConfig;\n\t}\n\n\t/**\n\t * Update the rules digest (invalidates cache)\n\t */\n\tsetRulesDigest(digest: string): void {\n\t\tthis.rulesDigest = digest;\n\t\tthis.cache.clear();\n\t}\n\n\t/**\n\t * Clear the cache\n\t */\n\tclearCache(): void {\n\t\tthis.cache.clear();\n\t}\n\n\t/**\n\t * Get cache statistics\n\t */\n\tgetCacheStats(): { size: number; hitRate: number } {\n\t\treturn this.cache.getStats();\n\t}\n\n\t/**\n\t * Get the workspace secret\n\t */\n\tgetWorkspaceSecret(): string {\n\t\treturn this.config.workspaceSecret;\n\t}\n\n\t/**\n\t * Gather candidates from all configured sources\n\t */\n\tprivate async gatherCandidates(trigger: ComposeTrigger): Promise<ArtifactCandidate[]> {\n\t\tconst allCandidates: ArtifactCandidate[] = [];\n\n\t\tfor (const source of this.config.sources) {\n\t\t\tconst candidates = await source.generateCandidates(trigger, this.config.workspaceSecret);\n\t\t\tallCandidates.push(...candidates);\n\t\t}\n\n\t\treturn allCandidates;\n\t}\n\n\t/**\n\t * Resolve configuration with defaults\n\t */\n\tprivate resolveConfig(options: ComposerOptions): ResolvedConfig {\n\t\treturn {\n\t\t\tbudgetConfig: options.budgetConfig ?? DEFAULT_BUDGET_CONFIG,\n\t\t\tsources: options.sources ?? [],\n\t\t\tcacheTtlMs: options.cacheTtlMs ?? CACHE_TTL_MS,\n\t\t\ttokenCounter: options.tokenCounter ?? defaultTokenCounter,\n\t\t\tworkspaceSecret: options.workspaceSecret ?? generateWorkspaceSecret(),\n\t\t\temitDecisionLogs: options.emitDecisionLogs ?? false,\n\t\t};\n\t}\n}\n\n/**\n * Create a composer with default configuration\n */\nexport function createComposer(options?: ComposerOptions): Composer {\n\treturn new Composer(options);\n}\n\n/**\n * Create a mock artifact candidate for testing\n */\nexport function createMockCandidate(params: {\n\tid: string;\n\tkind: ArtifactCandidate[\"kind\"];\n\tlane: Lane;\n\tcontent: string;\n\ttokenEstimate?: number;\n\trecencyBucket?: number;\n\trelevanceScore?: number;\n\tspecificityScore?: number;\n\triskAlignment?: number;\n}): ArtifactCandidate {\n\tconst tokenEstimate = params.tokenEstimate ?? Math.ceil(params.content.length / 4);\n\n\treturn {\n\t\tid: params.id,\n\t\tkind: params.kind,\n\t\tlane: params.lane,\n\t\ttokenEstimate,\n\t\trecencyBucket: params.recencyBucket ?? 3,\n\t\trelevanceScore: params.relevanceScore ?? 0.5,\n\t\tspecificityScore: params.specificityScore ?? 0.5,\n\t\triskAlignment: params.riskAlignment ?? 0.5,\n\t\tgetContent: () => params.content,\n\t\tshrink: (targetTokens: number) => ({\n\t\t\tid: params.id,\n\t\t\tkind: params.kind,\n\t\t\tlane: params.lane,\n\t\t\tcontent: params.content.slice(0, targetTokens * 4),\n\t\t\texactTokenCount: targetTokens,\n\t\t\tshrunk: true,\n\t\t\toriginalTokenCount: tokenEstimate,\n\t\t\tshrinkStrategy: \"truncate_oldest\",\n\t\t}),\n\t};\n}\n","/**\n * Confidence Calculator\n *\n * Calculates honest confidence scores based on analyzer results.\n * Follows the principle: \"If you can't prove it's safe, don't say it is.\"\n *\n * Key differences from the old arbitrary 0.95 approach:\n * - Confidence is capped by what was actually analyzed\n * - Critical issues cause dramatic confidence drops\n * - Incomplete analysis means lower confidence ceiling\n *\n * @module confidence/ConfidenceCalculator\n */\n\nimport type { AnalyzerResult, ConfidenceResult, CoverageInfo, Severity } from \"@snapback/core\";\n\n/**\n * Weight assigned to each analyzer for confidence calculation\n */\nconst ANALYZER_WEIGHTS: Record<string, number> = {\n\tsyntax: 0.15, // Basic parsing is essential\n\ttypes: 0.05, // Type safety is nice but not critical for merge decision\n\tsecurity: 0.25, // Security is high priority\n\t\"eslint-security\": 0.1, // Additional security rules\n\tbiome: 0.1, // Lint quality\n\t\"circular-deps\": 0.05, // Architecture quality\n\t\"duplicate-code\": 0.05, // Code quality\n\tcompleteness: 0.1, // Code completeness\n\tdependencies: 0.1, // Dependency health\n\t\"domain-patterns\": 0.05, // Domain-specific patterns\n};\n\n/**\n * Penalty applied per issue by severity\n */\nconst SEVERITY_PENALTIES: Record<Severity, number> = {\n\tcritical: 0.25, // Each critical issue reduces confidence by 25%\n\thigh: 0.1, // High issues are significant\n\tmedium: 0.02, // Medium issues add up\n\tlow: 0.005, // Low issues are minor\n\tinfo: 0, // Info doesn't affect confidence\n};\n\n/**\n * Maximum confidence based on coverage gaps\n */\nconst COVERAGE_CAPS = {\n\tnoAST: 0.2, // Without AST parsing, we can only be 20% confident\n\tnoSecurity: 0.5, // Without security analysis, cap at 50%\n\tnoCompleteness: 0.7, // Without completeness check, cap at 70%\n\tnoArchitecture: 0.8, // Without architecture check, cap at 80%\n\tfull: 1.0, // Full analysis can achieve 100%\n};\n\n/**\n * Review recommendation type\n */\nexport type ReviewRecommendation = \"manual_review_required\" | \"review_recommended\" | \"auto_merge_candidate\";\n\n/**\n * Confidence thresholds for recommendations\n */\nconst RECOMMENDATION_THRESHOLDS = {\n\tautoMerge: 0.6, // Lowered from 0.95 - honest analysis rarely hits this\n\tquickReview: 0.3, // Lowered - most code needs review\n};\n\n/**\n * Calculates honest confidence scores based on analysis results\n */\nexport class ConfidenceCalculator {\n\t/**\n\t * Calculate confidence from analyzer results\n\t */\n\tcalculate(analyzerResults: AnalyzerResult[], coverage: CoverageInfo): ConfidenceResult {\n\t\tlet totalWeight = 0;\n\t\tlet weightedScore = 0;\n\t\tconst breakdown: Record<string, number> = {};\n\n\t\t// Base confidence from analyzer success/coverage\n\t\tfor (const result of analyzerResults) {\n\t\t\tconst weight = ANALYZER_WEIGHTS[result.analyzer] ?? 0.05;\n\t\t\ttotalWeight += weight;\n\n\t\t\t// Score based on success and coverage\n\t\t\tconst score = result.success ? result.coverage : 0;\n\t\t\tweightedScore += weight * score;\n\t\t\tbreakdown[result.analyzer] = score;\n\t\t}\n\n\t\t// Calculate base confidence\n\t\tlet confidence = totalWeight > 0 ? weightedScore / totalWeight : 0;\n\n\t\t// Apply penalties for issues\n\t\tfor (const result of analyzerResults) {\n\t\t\tfor (const issue of result.issues) {\n\t\t\t\tconst penalty = SEVERITY_PENALTIES[issue.severity] ?? 0;\n\t\t\t\tconfidence = Math.max(0, confidence - penalty);\n\t\t\t}\n\t\t}\n\n\t\t// Cap confidence based on coverage gaps\n\t\tconst maxPossibleConfidence = this.calculateMaxConfidence(coverage);\n\t\tconfidence = Math.min(confidence, maxPossibleConfidence);\n\n\t\t// Round to 2 decimal places\n\t\tconfidence = Math.round(confidence * 100) / 100;\n\n\t\treturn {\n\t\t\tconfidence,\n\t\t\tbreakdown,\n\t\t\texplanation: this.generateExplanation(confidence, coverage, analyzerResults),\n\t\t\tmaxPossibleConfidence,\n\t\t};\n\t}\n\n\t/**\n\t * Get review recommendation based on confidence\n\t */\n\tgetRecommendation(confidenceResult: ConfidenceResult, hasCriticalIssues: boolean): ReviewRecommendation {\n\t\t// Critical issues always require manual review\n\t\tif (hasCriticalIssues) {\n\t\t\treturn \"manual_review_required\";\n\t\t}\n\n\t\tconst { confidence } = confidenceResult;\n\n\t\tif (confidence >= RECOMMENDATION_THRESHOLDS.autoMerge) {\n\t\t\treturn \"auto_merge_candidate\";\n\t\t}\n\n\t\tif (confidence >= RECOMMENDATION_THRESHOLDS.quickReview) {\n\t\t\treturn \"review_recommended\";\n\t\t}\n\n\t\treturn \"manual_review_required\";\n\t}\n\n\t/**\n\t * Calculate maximum possible confidence based on coverage\n\t */\n\tprivate calculateMaxConfidence(coverage: CoverageInfo): number {\n\t\t// Start with minimum possible\n\t\tlet maxConfidence = COVERAGE_CAPS.full;\n\n\t\t// If no AST parsing, we can't trust much\n\t\tif (!coverage.astParsed) {\n\t\t\tmaxConfidence = Math.min(maxConfidence, COVERAGE_CAPS.noAST);\n\t\t}\n\n\t\t// If no security analysis, cap confidence\n\t\tif (!coverage.securityChecked) {\n\t\t\tmaxConfidence = Math.min(maxConfidence, COVERAGE_CAPS.noSecurity);\n\t\t}\n\n\t\t// If no completeness check, cap confidence\n\t\tif (!coverage.completenessChecked) {\n\t\t\tmaxConfidence = Math.min(maxConfidence, COVERAGE_CAPS.noCompleteness);\n\t\t}\n\n\t\t// If no architecture check, cap confidence\n\t\tif (!coverage.architectureChecked) {\n\t\t\tmaxConfidence = Math.min(maxConfidence, COVERAGE_CAPS.noArchitecture);\n\t\t}\n\n\t\t// Also cap based on file coverage\n\t\tmaxConfidence = Math.min(maxConfidence, coverage.filesCoverage);\n\n\t\treturn maxConfidence;\n\t}\n\n\t/**\n\t * Generate human-readable explanation\n\t */\n\tprivate generateExplanation(confidence: number, coverage: CoverageInfo, results: AnalyzerResult[]): string {\n\t\tconst parts: string[] = [];\n\n\t\t// Overall confidence statement\n\t\tif (confidence < 0.3) {\n\t\t\tparts.push(`Low confidence (${Math.round(confidence * 100)}%): Manual review required.`);\n\t\t} else if (confidence < 0.6) {\n\t\t\tparts.push(`Moderate confidence (${Math.round(confidence * 100)}%): Review recommended.`);\n\t\t} else {\n\t\t\tparts.push(`Good confidence (${Math.round(confidence * 100)}%): Auto-merge candidate.`);\n\t\t}\n\n\t\t// Coverage gaps\n\t\tconst gaps: string[] = [];\n\t\tif (!coverage.astParsed) {\n\t\t\tgaps.push(\"AST parsing failed\");\n\t\t}\n\t\tif (!coverage.securityChecked) {\n\t\t\tgaps.push(\"security not analyzed\");\n\t\t}\n\t\tif (!coverage.completenessChecked) {\n\t\t\tgaps.push(\"completeness not checked\");\n\t\t}\n\t\tif (!coverage.architectureChecked) {\n\t\t\tgaps.push(\"architecture not validated\");\n\t\t}\n\n\t\tif (gaps.length > 0) {\n\t\t\tparts.push(`Coverage gaps: ${gaps.join(\", \")}.`);\n\t\t}\n\n\t\t// Issue summary\n\t\tconst totalIssues = results.reduce((sum, r) => sum + r.issues.length, 0);\n\t\tconst criticalIssues = results.flatMap((r) => r.issues).filter((i) => i.severity === \"critical\").length;\n\t\tconst highIssues = results.flatMap((r) => r.issues).filter((i) => i.severity === \"high\").length;\n\n\t\tif (criticalIssues > 0 || highIssues > 0) {\n\t\t\tparts.push(`Issues: ${criticalIssues} critical, ${highIssues} high, ${totalIssues} total.`);\n\t\t} else if (totalIssues > 0) {\n\t\t\tparts.push(`Found ${totalIssues} issues (none critical).`);\n\t\t} else {\n\t\t\tparts.push(\"No issues detected.\");\n\t\t}\n\n\t\treturn parts.join(\" \");\n\t}\n\n\t/**\n\t * Build coverage info from analyzer results\n\t */\n\tstatic buildCoverageInfo(results: AnalyzerResult[]): CoverageInfo {\n\t\tconst analyzerIds = new Set(results.map((r) => r.analyzer));\n\t\tconst avgCoverage = results.length > 0 ? results.reduce((sum, r) => sum + r.coverage, 0) / results.length : 0;\n\n\t\treturn {\n\t\t\tastParsed: analyzerIds.has(\"syntax\") && results.find((r) => r.analyzer === \"syntax\")?.success === true,\n\t\t\tsecurityChecked:\n\t\t\t\tanalyzerIds.has(\"security\") && results.find((r) => r.analyzer === \"security\")?.success === true,\n\t\t\tcompletenessChecked:\n\t\t\t\tanalyzerIds.has(\"completeness\") && results.find((r) => r.analyzer === \"completeness\")?.success === true,\n\t\t\tarchitectureChecked:\n\t\t\t\tanalyzerIds.has(\"architecture\") && results.find((r) => r.analyzer === \"architecture\")?.success === true,\n\t\t\tfilesCoverage: avgCoverage,\n\t\t};\n\t}\n}\n","/**\n * JSONL Store\n *\n * Atomic JSONL file operations for learnings, violations, and interactions.\n * Uses atomically package for safe writes that prevent corruption.\n */\n\nimport * as fs from \"node:fs\";\nimport * as path from \"node:path\";\nimport { generateId as contractsGenerateId } from \"@snapback/contracts/id-generator\";\nimport { writeFile } from \"atomically\";\n\n/**\n * Load all records from a JSONL file\n */\nexport function loadJsonl<T>(filepath: string): T[] {\n\tif (!fs.existsSync(filepath)) {\n\t\treturn [];\n\t}\n\ttry {\n\t\treturn fs\n\t\t\t.readFileSync(filepath, \"utf-8\")\n\t\t\t.split(/\\r?\\n/) // Cross-platform: handles both \\n (Unix) and \\r\\n (Windows)\n\t\t\t.filter((line) => line.trim())\n\t\t\t.map((line) => JSON.parse(line) as T);\n\t} catch (e) {\n\t\tconsole.error(`[JsonlStore] Error loading ${filepath}:`, e);\n\t\treturn [];\n\t}\n}\n\n/**\n * Append a record to a JSONL file (sync)\n */\nexport function appendJsonl<T>(filepath: string, data: T): void {\n\tconst dir = path.dirname(filepath);\n\tif (!fs.existsSync(dir)) {\n\t\tfs.mkdirSync(dir, { recursive: true });\n\t}\n\tfs.appendFileSync(filepath, `${JSON.stringify(data)}\\n`);\n}\n\n/**\n * Append a record to a JSONL file (async, atomic)\n */\nexport async function appendJsonlAsync<T>(filepath: string, data: T): Promise<void> {\n\tconst dir = path.dirname(filepath);\n\tif (!fs.existsSync(dir)) {\n\t\tfs.mkdirSync(dir, { recursive: true });\n\t}\n\ttry {\n\t\tconst existing = fs.existsSync(filepath) ? fs.readFileSync(filepath, \"utf-8\") : \"\";\n\t\tawait writeFile(filepath, `${existing + JSON.stringify(data)}\\n`);\n\t} catch {\n\t\t// Fallback to sync append\n\t\tfs.appendFileSync(filepath, `${JSON.stringify(data)}\\n`);\n\t}\n}\n\n/**\n * Write all records to a JSONL file (atomic replace)\n */\nexport async function writeJsonl<T>(filepath: string, records: T[]): Promise<void> {\n\tconst dir = path.dirname(filepath);\n\tif (!fs.existsSync(dir)) {\n\t\tfs.mkdirSync(dir, { recursive: true });\n\t}\n\tconst content = `${records.map((r) => JSON.stringify(r)).join(\"\\n\")}\\n`;\n\ttry {\n\t\tawait writeFile(filepath, content);\n\t} catch {\n\t\t// Fallback to sync write\n\t\tfs.writeFileSync(filepath, content);\n\t}\n}\n\n/**\n * Find a record by predicate\n */\nexport function findInJsonl<T>(filepath: string, predicate: (item: T) => boolean): T | undefined {\n\tconst records = loadJsonl<T>(filepath);\n\treturn records.find(predicate);\n}\n\n/**\n * Update a record that matches the predicate\n */\nexport async function updateInJsonl<T>(\n\tfilepath: string,\n\tpredicate: (item: T) => boolean,\n\tupdater: (item: T) => T,\n): Promise<boolean> {\n\tconst records = loadJsonl<T>(filepath);\n\tlet updated = false;\n\n\tconst newRecords = records.map((record) => {\n\t\tif (predicate(record)) {\n\t\t\tupdated = true;\n\t\t\treturn updater(record);\n\t\t}\n\t\treturn record;\n\t});\n\n\tif (updated) {\n\t\tawait writeJsonl(filepath, newRecords);\n\t}\n\n\treturn updated;\n}\n\n/**\n * Count records matching a predicate\n */\nexport function countInJsonl<T>(filepath: string, predicate?: (item: T) => boolean): number {\n\tconst records = loadJsonl<T>(filepath);\n\tif (!predicate) {\n\t\treturn records.length;\n\t}\n\treturn records.filter(predicate).length;\n}\n\n/**\n * Generate a unique ID - delegates to @snapback/contracts\n * Re-exported for backwards compatibility\n */\nexport function generateId(prefix = \"ID\"): string {\n\treturn contractsGenerateId(prefix);\n}\n","/**\n * Context Engine\n *\n * Assembles relevant context for tasks from:\n * - Architecture documentation\n * - Constraints and rules\n * - Codebase patterns\n * - Recent violations\n * - Relevant learnings\n *\n * Uses keyword matching for fast retrieval.\n * Optional: semantic search when enableSemanticSearch is true.\n */\n\nimport * as path from \"node:path\";\nimport type { ConfigStore } from \"../storage/ConfigStore.js\";\nimport { loadJsonl } from \"../storage/JsonlStore.js\";\nimport type { ResolvedConfig } from \"../types/config.js\";\nimport type { ContextInput, ContextResult, Learning, Violation } from \"../types/index.js\";\n\n/**\n * Context Engine for intelligent context assembly\n */\nexport class ContextEngine {\n\tprivate config: ResolvedConfig;\n\tprivate configStore: ConfigStore;\n\tprivate initialized = false;\n\n\tconstructor(config: ResolvedConfig, configStore: ConfigStore) {\n\t\tthis.config = config;\n\t\tthis.configStore = configStore;\n\t}\n\n\t/**\n\t * Initialize async resources (embeddings, database)\n\t * Only needed when semantic search is enabled\n\t */\n\tasync initialize(): Promise<void> {\n\t\tif (this.initialized) {\n\t\t\treturn;\n\t\t}\n\n\t\t// For now, just mark as initialized\n\t\t// Semantic search initialization would go here\n\t\tthis.initialized = true;\n\t}\n\n\t/**\n\t * Get relevant context for a task\n\t * Primary entry point - used before implementing anything\n\t */\n\tasync getContext(params: ContextInput): Promise<ContextResult> {\n\t\tconst { task, files = [], keywords = [] } = params;\n\n\t\t// Extract keywords from task if none provided\n\t\tconst effectiveKeywords = keywords.length > 0 ? keywords : this.extractKeywords(task);\n\n\t\t// Load context sections\n\t\tconst architecture = this.configStore.loadArchitecture();\n\t\tconst constraints = this.configStore.loadConstraints();\n\t\tconst patterns = this.configStore.loadPatterns();\n\n\t\t// Filter to relevant sections\n\t\tconst contextSections = this.filterRelevantSections([architecture, patterns].join(\"\\n\\n\"), effectiveKeywords);\n\n\t\t// Get hard rules (always include)\n\t\tconst hardRules = this.extractHardRules(constraints);\n\n\t\t// Load recent violations\n\t\tconst recentViolations = this.getRecentViolations(effectiveKeywords, files);\n\n\t\t// Load relevant learnings\n\t\tconst relevantLearnings = this.getRelevantLearnings(effectiveKeywords);\n\n\t\treturn {\n\t\t\ttask,\n\t\t\tcontextSections,\n\t\t\thardRules,\n\t\t\tpatterns,\n\t\t\trecentViolations,\n\t\t\trelevantLearnings,\n\t\t\thint: this.generateHint(recentViolations.length, relevantLearnings.length),\n\t\t};\n\t}\n\n\t/**\n\t * Extract keywords from a task description\n\t */\n\tprivate extractKeywords(task: string): string[] {\n\t\tconst stopWords = new Set([\n\t\t\t\"the\",\n\t\t\t\"a\",\n\t\t\t\"an\",\n\t\t\t\"is\",\n\t\t\t\"are\",\n\t\t\t\"was\",\n\t\t\t\"were\",\n\t\t\t\"be\",\n\t\t\t\"been\",\n\t\t\t\"being\",\n\t\t\t\"have\",\n\t\t\t\"has\",\n\t\t\t\"had\",\n\t\t\t\"do\",\n\t\t\t\"does\",\n\t\t\t\"did\",\n\t\t\t\"will\",\n\t\t\t\"would\",\n\t\t\t\"could\",\n\t\t\t\"should\",\n\t\t\t\"may\",\n\t\t\t\"might\",\n\t\t\t\"must\",\n\t\t\t\"shall\",\n\t\t\t\"can\",\n\t\t\t\"need\",\n\t\t\t\"to\",\n\t\t\t\"of\",\n\t\t\t\"in\",\n\t\t\t\"for\",\n\t\t\t\"on\",\n\t\t\t\"with\",\n\t\t\t\"at\",\n\t\t\t\"by\",\n\t\t\t\"from\",\n\t\t\t\"as\",\n\t\t\t\"into\",\n\t\t\t\"through\",\n\t\t\t\"during\",\n\t\t\t\"before\",\n\t\t\t\"after\",\n\t\t\t\"above\",\n\t\t\t\"below\",\n\t\t\t\"between\",\n\t\t\t\"under\",\n\t\t\t\"again\",\n\t\t\t\"further\",\n\t\t\t\"then\",\n\t\t\t\"once\",\n\t\t\t\"here\",\n\t\t\t\"there\",\n\t\t\t\"when\",\n\t\t\t\"where\",\n\t\t\t\"why\",\n\t\t\t\"how\",\n\t\t\t\"all\",\n\t\t\t\"each\",\n\t\t\t\"few\",\n\t\t\t\"more\",\n\t\t\t\"most\",\n\t\t\t\"other\",\n\t\t\t\"some\",\n\t\t\t\"such\",\n\t\t\t\"no\",\n\t\t\t\"nor\",\n\t\t\t\"not\",\n\t\t\t\"only\",\n\t\t\t\"own\",\n\t\t\t\"same\",\n\t\t\t\"so\",\n\t\t\t\"than\",\n\t\t\t\"too\",\n\t\t\t\"very\",\n\t\t\t\"just\",\n\t\t\t\"and\",\n\t\t\t\"but\",\n\t\t\t\"if\",\n\t\t\t\"or\",\n\t\t\t\"because\",\n\t\t\t\"until\",\n\t\t\t\"while\",\n\t\t\t\"this\",\n\t\t\t\"that\",\n\t\t\t\"these\",\n\t\t\t\"those\",\n\t\t\t\"i\",\n\t\t\t\"me\",\n\t\t\t\"my\",\n\t\t\t\"we\",\n\t\t\t\"our\",\n\t\t\t\"you\",\n\t\t\t\"your\",\n\t\t\t\"it\",\n\t\t\t\"its\",\n\t\t]);\n\n\t\treturn task\n\t\t\t.toLowerCase()\n\t\t\t.split(/\\W+/)\n\t\t\t.filter((word) => word.length > 2 && !stopWords.has(word))\n\t\t\t.slice(0, 10);\n\t}\n\n\t/**\n\t * Filter content to relevant sections based on keywords\n\t */\n\tprivate filterRelevantSections(content: string, keywords: string[]): string {\n\t\tconst sections = content.split(/(?=## )/);\n\t\tconst lowerKeywords = keywords.map((k) => k.toLowerCase());\n\n\t\tconst relevantSections = sections.filter((section) => {\n\t\t\tconst lowerSection = section.toLowerCase();\n\t\t\treturn lowerKeywords.some((kw) => lowerSection.includes(kw));\n\t\t});\n\n\t\t// If no relevant sections found, return first few sections as fallback\n\t\tif (relevantSections.length === 0) {\n\t\t\treturn sections.slice(0, 3).join(\"\\n\");\n\t\t}\n\n\t\treturn relevantSections.join(\"\\n\");\n\t}\n\n\t/**\n\t * Extract hard rules from constraints\n\t */\n\tprivate extractHardRules(constraints: string): string {\n\t\t// Find the \"Hard Rules\" section\n\t\tconst hardRulesMatch = constraints.match(/## Hard Rules[\\s\\S]*?(?=## |$)/i);\n\t\treturn hardRulesMatch ? hardRulesMatch[0] : \"\";\n\t}\n\n\t/**\n\t * Get recent violations relevant to keywords/files\n\t */\n\tprivate getRecentViolations(\n\t\tkeywords: string[],\n\t\tfiles: string[],\n\t): Array<{ type: string; file: string; message: string; timestamp: string; prevention?: string }> {\n\t\tconst violationsPath = path.join(this.config.rootDir, this.config.violationsFile);\n\t\tconst violations = loadJsonl<Violation>(violationsPath);\n\n\t\tconst lowerKeywords = keywords.map((k) => k.toLowerCase());\n\n\t\treturn violations\n\t\t\t.filter((v) => {\n\t\t\t\t// Match by file\n\t\t\t\tif (files.some((f) => v.file.includes(f))) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\t// Match by keyword in type or message\n\t\t\t\tconst text = `${v.type} ${v.whatHappened}`.toLowerCase();\n\t\t\t\treturn lowerKeywords.some((kw) => text.includes(kw));\n\t\t\t})\n\t\t\t.slice(-5)\n\t\t\t.map((v) => ({\n\t\t\t\ttype: v.type,\n\t\t\t\tfile: v.file,\n\t\t\t\tmessage: v.whatHappened,\n\t\t\t\ttimestamp: v.timestamp,\n\t\t\t\tprevention: v.prevention,\n\t\t\t}));\n\t}\n\n\t/**\n\t * Get learnings relevant to keywords\n\t */\n\tprivate getRelevantLearnings(keywords: string[]): Array<{ trigger: string; action: string; type: string }> {\n\t\tconst learningsPath = path.join(this.config.rootDir, this.config.learningsDir, \"learnings.jsonl\");\n\t\tconst learnings = loadJsonl<Learning>(learningsPath);\n\n\t\tconst lowerKeywords = keywords.map((k) => k.toLowerCase());\n\n\t\treturn learnings\n\t\t\t.filter((l) => {\n\t\t\t\tconst triggers = Array.isArray(l.trigger) ? l.trigger : [l.trigger];\n\t\t\t\tconst text = [...triggers, l.action].join(\" \").toLowerCase();\n\t\t\t\treturn lowerKeywords.some((kw) => text.includes(kw));\n\t\t\t})\n\t\t\t.slice(-5)\n\t\t\t.map((l) => ({\n\t\t\t\ttrigger: Array.isArray(l.trigger) ? l.trigger.join(\", \") : l.trigger,\n\t\t\t\taction: l.action,\n\t\t\t\ttype: l.type,\n\t\t\t}));\n\t}\n\n\t/**\n\t * Generate a contextual hint based on findings\n\t */\n\tprivate generateHint(violationCount: number, learningCount: number): string {\n\t\tif (violationCount > 0 && learningCount > 0) {\n\t\t\treturn \"Review violations and learnings before implementing. These are patterns learned from past mistakes.\";\n\t\t}\n\t\tif (violationCount > 0) {\n\t\t\treturn \"Recent violations found for this area. Review before proceeding.\";\n\t\t}\n\t\tif (learningCount > 0) {\n\t\t\treturn \"Relevant learnings found. Apply these patterns.\";\n\t\t}\n\t\treturn \"No specific patterns found. Check CONSTRAINTS.md for rules.\";\n\t}\n\n\t/**\n\t * Dispose resources\n\t */\n\tasync dispose(): Promise<void> {\n\t\t// Clean up any resources (embeddings database, etc.)\n\t\tthis.initialized = false;\n\t}\n}\n","/**\n * Semantic Context Retriever\n *\n * Provides 88% token reduction via semantic search:\n * - Local embeddings using @huggingface/transformers (no API cost)\n * - SQLite database for section embeddings (sql.js)\n * - Returns only relevant context sections within token budget\n *\n * Dependencies are optional - gracefully degrades if not available.\n *\n * @example\n * ```typescript\n * const retriever = new SemanticRetriever({ rootDir: \"/project\" });\n * await retriever.initialize();\n * await retriever.indexContextFiles();\n * const result = await retriever.getRelevantContext(\"authentication\", 2000);\n * ```\n */\n\nimport * as fs from \"node:fs\";\nimport * as path from \"node:path\";\n\nimport type { IndexStatus, ScoredSection, SearchResult, Section } from \"../types/context.js\";\n\n// Optional dependencies - loaded dynamically\ntype FeatureExtractionPipeline = (\n\ttext: string,\n\toptions?: { pooling?: string; normalize?: boolean },\n) => Promise<{ data: Float32Array }>;\n\ninterface SemanticRetrieverConfig {\n\t/** Root directory containing context files */\n\trootDir: string;\n\t/** Path to embeddings database (relative to rootDir or absolute) */\n\tdbPath?: string;\n\t/** Files to index for semantic search */\n\tcontextFiles?: string[];\n}\n\nconst DEFAULT_CONTEXT_FILES = [\"ARCHITECTURE.md\", \"CONSTRAINTS.md\", \"ROUTER.md\", \"patterns/codebase-patterns.md\"];\n\n/**\n * Semantic Context Retriever\n *\n * Uses local embeddings to find and return only relevant context sections,\n * dramatically reducing token usage while maintaining context quality.\n */\nexport class SemanticRetriever {\n\tprivate embedder: FeatureExtractionPipeline | null = null;\n\tprivate db: any = null;\n\tprivate initialized = false;\n\tprivate available = true;\n\tprivate readonly rootDir: string;\n\tprivate readonly dbPath: string;\n\tprivate readonly contextFiles: string[];\n\n\tconstructor(config: SemanticRetrieverConfig) {\n\t\tthis.rootDir = config.rootDir;\n\t\tthis.dbPath = config.dbPath\n\t\t\t? path.isAbsolute(config.dbPath)\n\t\t\t\t? config.dbPath\n\t\t\t\t: path.join(config.rootDir, config.dbPath)\n\t\t\t: path.join(config.rootDir, \"embeddings.db\");\n\t\tthis.contextFiles = config.contextFiles || DEFAULT_CONTEXT_FILES;\n\t}\n\n\t/**\n\t * Check if semantic retrieval is available (deps installed)\n\t */\n\tisAvailable(): boolean {\n\t\treturn this.available;\n\t}\n\n\t/**\n\t * Ensure database is loaded and schema exists\n\t */\n\tprivate async ensureDb(): Promise<any> {\n\t\tif (this.db) {\n\t\t\treturn this.db;\n\t\t}\n\n\t\ttry {\n\t\t\t// Dynamic import for optional dependency\n\t\t\t// @ts-expect-error - sql.js lacks type declarations\n\t\t\tconst initSqlJs = await import(\"sql.js\").then((m) => m.default);\n\t\t\tconst SQL = await initSqlJs();\n\n\t\t\t// Load existing database or create new one\n\t\t\tif (fs.existsSync(this.dbPath)) {\n\t\t\t\tconst fileBuffer = fs.readFileSync(this.dbPath);\n\t\t\t\tthis.db = new SQL.Database(fileBuffer);\n\t\t\t} else {\n\t\t\t\tthis.db = new SQL.Database();\n\t\t\t}\n\n\t\t\t// Ensure schema\n\t\t\tthis.db.run(`\n        CREATE TABLE IF NOT EXISTS sections (\n          id INTEGER PRIMARY KEY AUTOINCREMENT,\n          file TEXT NOT NULL,\n          section TEXT NOT NULL,\n          content TEXT NOT NULL,\n          embedding BLOB,\n          tokens INTEGER,\n          indexed_at TEXT DEFAULT CURRENT_TIMESTAMP,\n          UNIQUE(file, section)\n        )\n      `);\n\n\t\t\treturn this.db;\n\t\t} catch (_err) {\n\t\t\tthis.available = false;\n\t\t\tthrow new Error(\n\t\t\t\t\"SemanticRetriever requires sql.js as optional peer dependency. Install with: pnpm add sql.js\",\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Save database to disk\n\t */\n\tprivate saveDb(): void {\n\t\tif (!this.db) {\n\t\t\treturn;\n\t\t}\n\t\tconst data = this.db.export();\n\t\tconst buffer = Buffer.from(data);\n\n\t\t// Ensure directory exists\n\t\tconst dir = path.dirname(this.dbPath);\n\t\tif (!fs.existsSync(dir)) {\n\t\t\tfs.mkdirSync(dir, { recursive: true });\n\t\t}\n\n\t\tfs.writeFileSync(this.dbPath, buffer);\n\t}\n\n\t/**\n\t * Initialize the embedder and database (lazy loading)\n\t */\n\tasync initialize(): Promise<void> {\n\t\tif (this.initialized) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Initialize database\n\t\tawait this.ensureDb();\n\n\t\ttry {\n\t\t\t// Dynamic import for optional dependency\n\t\t\tconst { pipeline } = await import(\"@huggingface/transformers\");\n\n\t\t\t// Use all-MiniLM-L6-v2: fast, 384-dimensional vectors\n\t\t\tthis.embedder = (await pipeline(\n\t\t\t\t\"feature-extraction\",\n\t\t\t\t\"Xenova/all-MiniLM-L6-v2\",\n\t\t\t)) as unknown as FeatureExtractionPipeline;\n\n\t\t\tthis.initialized = true;\n\t\t} catch (_err) {\n\t\t\tthis.available = false;\n\t\t\tthrow new Error(\n\t\t\t\t\"SemanticRetriever requires @huggingface/transformers as optional peer dependency. Install with: pnpm add @huggingface/transformers\",\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Index all context files (run on startup or after changes)\n\t */\n\tasync indexContextFiles(): Promise<IndexStatus> {\n\t\tawait this.initialize();\n\n\t\tlet indexed = 0;\n\t\tlet skipped = 0;\n\n\t\tfor (const file of this.contextFiles) {\n\t\t\tconst fullPath = path.join(this.rootDir, file);\n\t\t\tif (!fs.existsSync(fullPath)) {\n\t\t\t\tskipped++;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst content = fs.readFileSync(fullPath, \"utf-8\");\n\t\t\tconst sections = this.splitIntoSections(content);\n\n\t\t\tfor (const section of sections) {\n\t\t\t\t// Check if section exists with same content\n\t\t\t\tconst stmt = this.db?.prepare(\"SELECT id, content FROM sections WHERE file = ? AND section = ?\");\n\t\t\t\tstmt.bind([file, section.header]);\n\n\t\t\t\tlet existingContent: string | null = null;\n\t\t\t\tif (stmt.step()) {\n\t\t\t\t\tconst row = stmt.getAsObject();\n\t\t\t\t\texistingContent = row.content as string;\n\t\t\t\t}\n\t\t\t\tstmt.free();\n\n\t\t\t\t// Skip if content unchanged\n\t\t\t\tif (existingContent === section.content) {\n\t\t\t\t\tskipped++;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Generate embedding\n\t\t\t\tconst embedding = await this.embed(section.content);\n\t\t\t\tconst tokens = this.estimateTokens(section.content);\n\t\t\t\tconst embeddingBlob = new Uint8Array(new Float32Array(embedding).buffer);\n\n\t\t\t\t// Upsert section\n\t\t\t\tthis.db?.run(\n\t\t\t\t\t`INSERT OR REPLACE INTO sections (file, section, content, embedding, tokens, indexed_at)\n           VALUES (?, ?, ?, ?, ?, datetime('now'))`,\n\t\t\t\t\t[file, section.header, section.content, embeddingBlob, tokens],\n\t\t\t\t);\n\n\t\t\t\tindexed++;\n\t\t\t}\n\t\t}\n\n\t\t// Save to disk after indexing\n\t\tthis.saveDb();\n\n\t\treturn { indexed, skipped };\n\t}\n\n\t/**\n\t * Get relevant context for a query within token budget\n\t */\n\tasync getRelevantContext(query: string, maxTokens = 2000): Promise<SearchResult> {\n\t\tawait this.initialize();\n\n\t\t// Get all sections with embeddings\n\t\tconst sections: Section[] = [];\n\t\tconst stmt = this.db?.prepare(\n\t\t\t\"SELECT id, file, section, content, embedding, tokens FROM sections WHERE embedding IS NOT NULL\",\n\t\t);\n\t\twhile (stmt.step()) {\n\t\t\tconst row = stmt.getAsObject();\n\t\t\tsections.push({\n\t\t\t\tid: row.id as number,\n\t\t\t\tfile: row.file as string,\n\t\t\t\tsection: row.section as string,\n\t\t\t\tcontent: row.content as string,\n\t\t\t\tembedding: row.embedding as Uint8Array,\n\t\t\t\ttokens: row.tokens as number,\n\t\t\t});\n\t\t}\n\t\tstmt.free();\n\n\t\tif (sections.length === 0) {\n\t\t\treturn {\n\t\t\t\tcontext: \"\",\n\t\t\t\ttokensUsed: 0,\n\t\t\t\tsectionsIncluded: 0,\n\t\t\t\tcompressionRatio: 0,\n\t\t\t};\n\t\t}\n\n\t\t// Embed the query\n\t\tconst queryEmbedding = await this.embed(query);\n\n\t\t// Score all sections by similarity\n\t\tconst scored: ScoredSection[] = sections\n\t\t\t.filter((s): s is Section & { embedding: Uint8Array } => s.embedding !== undefined && s.embedding !== null)\n\t\t\t.map((s) => {\n\t\t\t\tconst embeddingArray = new Float32Array(\n\t\t\t\t\ts.embedding.buffer,\n\t\t\t\t\ts.embedding.byteOffset,\n\t\t\t\t\ts.embedding.byteLength / 4,\n\t\t\t\t);\n\t\t\t\treturn {\n\t\t\t\t\t...s,\n\t\t\t\t\tscore: this.cosineSimilarity(queryEmbedding, embeddingArray),\n\t\t\t\t};\n\t\t\t})\n\t\t\t.sort((a, b) => b.score - a.score);\n\n\t\t// Select top sections within token budget\n\t\tlet totalTokens = 0;\n\t\tconst selected: ScoredSection[] = [];\n\n\t\tfor (const section of scored) {\n\t\t\tif (totalTokens + section.tokens <= maxTokens) {\n\t\t\t\tselected.push(section);\n\t\t\t\ttotalTokens += section.tokens;\n\t\t\t} else if (selected.length >= 3) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// Calculate compression ratio\n\t\tconst totalDbTokens = sections.reduce((sum, s) => sum + s.tokens, 0);\n\t\tconst context = selected.map((s) => `## ${s.file} - ${s.section}\\n${s.content}`).join(\"\\n\\n---\\n\\n\");\n\n\t\treturn {\n\t\t\tcontext,\n\t\t\ttokensUsed: totalTokens,\n\t\t\tsectionsIncluded: selected.length,\n\t\t\tcompressionRatio: totalDbTokens > 0 ? 1 - totalTokens / totalDbTokens : 0,\n\t\t};\n\t}\n\n\t/**\n\t * Embed text using local model\n\t */\n\tprivate async embed(text: string): Promise<number[]> {\n\t\tif (!this.embedder) {\n\t\t\tthrow new Error(\"Embedder not initialized. Call initialize() first.\");\n\t\t}\n\n\t\tconst result = await this.embedder(text, { pooling: \"mean\", normalize: true });\n\t\treturn Array.from(result.data);\n\t}\n\n\t/**\n\t * Calculate cosine similarity between two vectors\n\t */\n\tprivate cosineSimilarity(a: number[], b: Float32Array): number {\n\t\tlet dotProduct = 0;\n\t\tlet normA = 0;\n\t\tlet normB = 0;\n\n\t\tfor (let i = 0; i < a.length; i++) {\n\t\t\tdotProduct += a[i] * b[i];\n\t\t\tnormA += a[i] * a[i];\n\t\t\tnormB += b[i] * b[i];\n\t\t}\n\n\t\tconst denominator = Math.sqrt(normA) * Math.sqrt(normB);\n\t\treturn denominator === 0 ? 0 : dotProduct / denominator;\n\t}\n\n\t/**\n\t * Split markdown content into sections by ## headers\n\t */\n\tprivate splitIntoSections(content: string): Array<{ header: string; content: string }> {\n\t\tconst sections: Array<{ header: string; content: string }> = [];\n\t\tconst lines = content.split(\"\\n\");\n\n\t\tlet currentHeader = \"Introduction\";\n\t\tlet currentContent: string[] = [];\n\n\t\tfor (const line of lines) {\n\t\t\tif (line.startsWith(\"## \")) {\n\t\t\t\tif (currentContent.length > 0) {\n\t\t\t\t\tconst sectionContent = currentContent.join(\"\\n\").trim();\n\t\t\t\t\tif (sectionContent.length > 50) {\n\t\t\t\t\t\tsections.push({ header: currentHeader, content: sectionContent });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcurrentHeader = line.replace(\"## \", \"\").trim();\n\t\t\t\tcurrentContent = [];\n\t\t\t} else {\n\t\t\t\tcurrentContent.push(line);\n\t\t\t}\n\t\t}\n\n\t\t// Last section\n\t\tif (currentContent.length > 0) {\n\t\t\tconst sectionContent = currentContent.join(\"\\n\").trim();\n\t\t\tif (sectionContent.length > 50) {\n\t\t\t\tsections.push({ header: currentHeader, content: sectionContent });\n\t\t\t}\n\t\t}\n\n\t\treturn sections;\n\t}\n\n\t/**\n\t * Estimate token count (~4 chars per token)\n\t */\n\tprivate estimateTokens(text: string): number {\n\t\treturn Math.ceil(text.length / 4);\n\t}\n\n\t/**\n\t * Get statistics about indexed content\n\t */\n\tgetStats(): { totalSections: number; totalTokens: number; files: string[] } {\n\t\tif (!this.db) {\n\t\t\treturn { totalSections: 0, totalTokens: 0, files: [] };\n\t\t}\n\n\t\tconst countStmt = this.db.prepare(\"SELECT COUNT(*) as cnt, COALESCE(SUM(tokens), 0) as total FROM sections\");\n\t\tlet totalSections = 0;\n\t\tlet totalTokens = 0;\n\t\tif (countStmt.step()) {\n\t\t\tconst row = countStmt.getAsObject();\n\t\t\ttotalSections = row.cnt as number;\n\t\t\ttotalTokens = row.total as number;\n\t\t}\n\t\tcountStmt.free();\n\n\t\tconst files: string[] = [];\n\t\tconst filesStmt = this.db.prepare(\"SELECT DISTINCT file FROM sections\");\n\t\twhile (filesStmt.step()) {\n\t\t\tconst row = filesStmt.getAsObject();\n\t\t\tfiles.push(row.file as string);\n\t\t}\n\t\tfilesStmt.free();\n\n\t\treturn { totalSections, totalTokens, files };\n\t}\n\n\t/**\n\t * Close database connection and save\n\t */\n\tclose(): void {\n\t\tif (this.db) {\n\t\t\tthis.saveDb();\n\t\t\tthis.db.close();\n\t\t\tthis.db = null;\n\t\t}\n\t}\n}\n","/**\n * API Domain Bundle\n *\n * Patterns for validating API endpoint implementation.\n * Covers input validation, error handling, response formatting,\n * and security best practices for HTTP APIs.\n *\n * @module domain/bundles/api\n */\n\nimport type { DomainBundle, DomainPattern } from \"@snapback/core/analysis\";\n\nconst patterns: DomainPattern[] = [\n\t{\n\t\tid: \"api-input-validation\",\n\t\tname: \"Input Validation\",\n\t\tdescription: \"All API inputs must be validated using a schema validator (zod, joi, yup)\",\n\t\trequired: true,\n\t\tseverity: \"critical\",\n\t\tdetectWith: {\n\t\t\tastPattern: \"zod.parse || schema.validate || yup.validate\",\n\t\t\tkeywords: [\"zod\", \"joi\", \"yup\", \"validate\", \"parse\", \"schema\"],\n\t\t},\n\t\tfailureMessage: \"API endpoint accepts input without schema validation\",\n\t\tfixSuggestion: \"Add input validation: const input = schema.parse(req.body)\",\n\t},\n\t{\n\t\tid: \"api-error-handling\",\n\t\tname: \"Structured Error Handling\",\n\t\tdescription: \"API errors should be caught and returned in a consistent format\",\n\t\trequired: true,\n\t\tseverity: \"high\",\n\t\tdetectWith: {\n\t\t\tastPattern: \"try-catch && (res.status || throw)\",\n\t\t\tkeywords: [\"try\", \"catch\", \"error\", \"status\", \"errorHandler\"],\n\t\t},\n\t\tfailureMessage: \"API endpoint missing structured error handling\",\n\t\tfixSuggestion: \"Wrap handler in try-catch with consistent error response format\",\n\t},\n\t{\n\t\tid: \"api-no-stack-traces\",\n\t\tname: \"No Stack Traces in Production\",\n\t\tdescription: \"API error responses should not expose stack traces in production\",\n\t\trequired: true,\n\t\tseverity: \"high\",\n\t\tdetectWith: {\n\t\t\tastPattern: \"!error.stack in response || process.env.NODE_ENV check\",\n\t\t\tkeywords: [\"stack\", \"NODE_ENV\", \"production\", \"development\"],\n\t\t},\n\t\tfailureMessage: \"API may expose stack traces in error responses\",\n\t\tfixSuggestion: \"Only include stack traces when NODE_ENV !== 'production'\",\n\t},\n\t{\n\t\tid: \"api-content-type\",\n\t\tname: \"Content-Type Headers\",\n\t\tdescription: \"API responses should set appropriate Content-Type headers\",\n\t\trequired: true,\n\t\tseverity: \"medium\",\n\t\tdetectWith: {\n\t\t\tastPattern: \"res.json || res.setHeader('Content-Type')\",\n\t\t\tkeywords: [\"Content-Type\", \"application/json\", \"json\"],\n\t\t},\n\t\tfailureMessage: \"API response missing Content-Type header\",\n\t\tfixSuggestion: \"Use res.json() or explicitly set Content-Type header\",\n\t},\n\t{\n\t\tid: \"api-cors-config\",\n\t\tname: \"CORS Configuration\",\n\t\tdescription: \"Cross-origin requests should be explicitly configured, not use wildcard\",\n\t\trequired: true,\n\t\tseverity: \"high\",\n\t\tdetectWith: {\n\t\t\tastPattern: \"cors && origin !== '*'\",\n\t\t\tkeywords: [\"cors\", \"origin\", \"Access-Control\"],\n\t\t},\n\t\tfailureMessage: \"CORS configured with wildcard origin (*)\",\n\t\tfixSuggestion: \"Specify allowed origins explicitly: cors({ origin: ['https://app.example.com'] })\",\n\t},\n\t{\n\t\tid: \"api-response-sanitization\",\n\t\tname: \"Response Data Sanitization\",\n\t\tdescription: \"Sensitive fields should be excluded from API responses\",\n\t\trequired: true,\n\t\tseverity: \"critical\",\n\t\tdetectWith: {\n\t\t\tastPattern: \"select || omit || pick || exclude password/token/secret\",\n\t\t\tkeywords: [\"select\", \"omit\", \"pick\", \"exclude\", \"sanitize\"],\n\t\t},\n\t\tfailureMessage: \"API response may include sensitive fields (password, tokens, secrets)\",\n\t\tfixSuggestion: \"Use omit() or select() to exclude sensitive fields from responses\",\n\t},\n\t{\n\t\tid: \"api-method-validation\",\n\t\tname: \"HTTP Method Validation\",\n\t\tdescription: \"Endpoints should only accept intended HTTP methods\",\n\t\trequired: true,\n\t\tseverity: \"medium\",\n\t\tdetectWith: {\n\t\t\tastPattern: \"app.get || app.post || app.put || router.method\",\n\t\t\tkeywords: [\"get\", \"post\", \"put\", \"delete\", \"patch\", \"method\"],\n\t\t},\n\t\tfailureMessage: \"Endpoint may accept unintended HTTP methods\",\n\t\tfixSuggestion: \"Use specific method handlers: app.post('/users', handler) not app.use('/users', handler)\",\n\t},\n\t{\n\t\tid: \"api-pagination\",\n\t\tname: \"Pagination for List Endpoints\",\n\t\tdescription: \"List endpoints should implement pagination to prevent memory issues\",\n\t\trequired: true,\n\t\tseverity: \"high\",\n\t\tdetectWith: {\n\t\t\tastPattern: \"limit && (offset || page || cursor)\",\n\t\t\tkeywords: [\"limit\", \"offset\", \"page\", \"cursor\", \"pagination\", \"take\", \"skip\"],\n\t\t},\n\t\tfailureMessage: \"List endpoint without pagination (potential memory/performance issue)\",\n\t\tfixSuggestion: \"Add pagination: query.limit(pageSize).offset(page * pageSize)\",\n\t},\n\t{\n\t\tid: \"api-request-size-limit\",\n\t\tname: \"Request Size Limit\",\n\t\tdescription: \"API should limit request body size to prevent DoS attacks\",\n\t\trequired: true,\n\t\tseverity: \"high\",\n\t\tdetectWith: {\n\t\t\tastPattern: \"bodyParser.json({ limit }) || express.json({ limit })\",\n\t\t\tkeywords: [\"limit\", \"bodyParser\", \"json\", \"urlencoded\"],\n\t\t},\n\t\tfailureMessage: \"API accepts unlimited request body size\",\n\t\tfixSuggestion: \"Add body size limit: express.json({ limit: '1mb' })\",\n\t},\n];\n\n/**\n * API domain pattern bundle\n */\nexport const apiPatterns: DomainBundle = {\n\tid: \"api\",\n\tname: \"API Endpoints\",\n\tdescription: \"Patterns for secure and robust API endpoint implementation\",\n\tpatterns,\n\tapplicableTo: [\"api\", \"endpoint\", \"route\", \"handler\", \"controller\", \"rest\", \"graphql\"],\n};\n","/**\n * Authentication Domain Bundle\n *\n * Patterns for validating authentication and authorization code.\n * Covers session management, token handling, password security,\n * and access control patterns.\n *\n * @module domain/bundles/auth\n */\n\nimport type { DomainBundle, DomainPattern } from \"@snapback/core/analysis\";\n\nconst patterns: DomainPattern[] = [\n\t{\n\t\tid: \"auth-session-expiry\",\n\t\tname: \"Session Expiry Configuration\",\n\t\tdescription: \"Sessions should have explicit expiry times to prevent session hijacking\",\n\t\trequired: true,\n\t\tseverity: \"high\",\n\t\tdetectWith: {\n\t\t\tastPattern: \"session && (maxAge || expires || expiresIn)\",\n\t\t\tkeywords: [\"session\", \"maxAge\", \"expires\", \"expiresIn\", \"ttl\"],\n\t\t},\n\t\tfailureMessage: \"Session created without explicit expiry time\",\n\t\tfixSuggestion: \"Add session expiry: { maxAge: 3600000 } or similar\",\n\t},\n\t{\n\t\tid: \"auth-password-hashing\",\n\t\tname: \"Password Hashing\",\n\t\tdescription: \"Passwords must be hashed using bcrypt, argon2, or scrypt\",\n\t\trequired: true,\n\t\tseverity: \"critical\",\n\t\tdetectWith: {\n\t\t\tastPattern: \"password && (bcrypt || argon2 || scrypt)\",\n\t\t\tkeywords: [\"bcrypt\", \"argon2\", \"scrypt\", \"hash\", \"password\"],\n\t\t},\n\t\tfailureMessage: \"Password storage without proper hashing detected\",\n\t\tfixSuggestion: \"Use bcrypt.hash() or argon2.hash() for password storage\",\n\t},\n\t{\n\t\tid: \"auth-token-validation\",\n\t\tname: \"JWT Token Validation\",\n\t\tdescription: \"JWT tokens must be validated with signature verification\",\n\t\trequired: true,\n\t\tseverity: \"critical\",\n\t\tdetectWith: {\n\t\t\tastPattern: \"jwt.verify || jsonwebtoken.verify\",\n\t\t\tkeywords: [\"jwt\", \"verify\", \"jsonwebtoken\", \"token\"],\n\t\t},\n\t\tfailureMessage: \"JWT used without proper verification\",\n\t\tfixSuggestion: \"Use jwt.verify(token, secret) with a strong secret\",\n\t},\n\t{\n\t\tid: \"auth-csrf-protection\",\n\t\tname: \"CSRF Protection\",\n\t\tdescription: \"State-changing endpoints should have CSRF protection\",\n\t\trequired: true,\n\t\tseverity: \"high\",\n\t\tdetectWith: {\n\t\t\tastPattern: \"csrf || csrfToken || _csrf\",\n\t\t\tkeywords: [\"csrf\", \"csrfToken\", \"xsrf\", \"csurf\"],\n\t\t},\n\t\tfailureMessage: \"State-changing endpoint without CSRF protection\",\n\t\tfixSuggestion: \"Add CSRF token validation using csurf or similar middleware\",\n\t},\n\t{\n\t\tid: \"auth-rate-limiting\",\n\t\tname: \"Rate Limiting on Auth Endpoints\",\n\t\tdescription: \"Authentication endpoints should be rate-limited to prevent brute force\",\n\t\trequired: true,\n\t\tseverity: \"high\",\n\t\tdetectWith: {\n\t\t\tastPattern: \"rateLimit || rateLimiter || express-rate-limit\",\n\t\t\tkeywords: [\"rateLimit\", \"rateLimiter\", \"throttle\", \"brute\"],\n\t\t},\n\t\tfailureMessage: \"Authentication endpoint without rate limiting\",\n\t\tfixSuggestion: \"Add rate limiting: app.use('/login', rateLimit({ max: 5, windowMs: 15*60*1000 }))\",\n\t},\n\t{\n\t\tid: \"auth-secure-cookies\",\n\t\tname: \"Secure Cookie Configuration\",\n\t\tdescription: \"Authentication cookies must have secure, httpOnly, and sameSite flags\",\n\t\trequired: true,\n\t\tseverity: \"high\",\n\t\tdetectWith: {\n\t\t\tastPattern: \"cookie && (secure && httpOnly && sameSite)\",\n\t\t\tkeywords: [\"secure\", \"httpOnly\", \"sameSite\", \"cookie\"],\n\t\t},\n\t\tfailureMessage: \"Authentication cookie missing security flags\",\n\t\tfixSuggestion: \"Set cookie options: { secure: true, httpOnly: true, sameSite: 'strict' }\",\n\t},\n\t{\n\t\tid: \"auth-constant-time-compare\",\n\t\tname: \"Constant-Time Comparison\",\n\t\tdescription: \"Secret comparisons should use timing-safe comparison to prevent timing attacks\",\n\t\trequired: true,\n\t\tseverity: \"high\",\n\t\tdetectWith: {\n\t\t\tastPattern: \"timingSafeEqual || crypto.timingSafeEqual\",\n\t\t\tkeywords: [\"timingSafeEqual\", \"constantTimeCompare\", \"safeCompare\"],\n\t\t},\n\t\tfailureMessage: \"Secret comparison using non-constant-time method (vulnerable to timing attacks)\",\n\t\tfixSuggestion: \"Use crypto.timingSafeEqual(Buffer.from(a), Buffer.from(b))\",\n\t},\n];\n\n/**\n * Authentication domain pattern bundle\n */\nexport const authPatterns: DomainBundle = {\n\tid: \"auth\",\n\tname: \"Authentication & Authorization\",\n\tdescription: \"Patterns for secure authentication and authorization implementation\",\n\tpatterns,\n\tapplicableTo: [\"auth\", \"login\", \"session\", \"jwt\", \"oauth\", \"passport\"],\n};\n","/**\n * Daemon Domain Bundle\n *\n * Domain-specific patterns for daemon/server code.\n * Detects missing signal handlers, socket permissions, buffer limits, etc.\n *\n * @module domain/bundles/daemon\n */\n\nimport type { AnalysisIssue, DomainBundle, Severity } from \"@snapback/core\";\n\n/**\n * Helper to create issue ID\n */\nfunction createIssueId(pattern: string, file: string, line?: number): string {\n\treturn `domain/daemon/${pattern}/${file}${line ? `/${line}` : \"\"}`;\n}\n\n/**\n * Helper to find line number for a pattern\n */\nfunction findLine(content: string, search: string): number | undefined {\n\tconst lines = content.split(\"\\n\");\n\tconst idx = lines.findIndex((l) => l.includes(search));\n\treturn idx >= 0 ? idx + 1 : undefined;\n}\n\n/**\n * Daemon/Server domain-specific patterns\n */\nexport const daemonPatterns: DomainBundle = {\n\tid: \"daemon\",\n\tname: \"Daemon/Server Patterns\",\n\tkeywords: [\"daemon\", \"server\", \"socket\", \"ipc\", \"listen\", \"spawn\", \"worker\", \"process\"],\n\tpatterns: [\n\t\t{\n\t\t\tid: \"daemon/signal-handlers\",\n\t\t\tname: \"Missing Signal Handlers\",\n\t\t\tdetect: (content: string, file: string): AnalysisIssue[] => {\n\t\t\t\tconst issues: AnalysisIssue[] = [];\n\n\t\t\t\t// Detect daemon/server context\n\t\t\t\tconst isDaemon =\n\t\t\t\t\tcontent.includes(\".listen(\") ||\n\t\t\t\t\tfile.includes(\"daemon\") ||\n\t\t\t\t\tfile.includes(\"server\") ||\n\t\t\t\t\tfile.includes(\"worker\") ||\n\t\t\t\t\tcontent.includes(\"net.createServer\") ||\n\t\t\t\t\tcontent.includes(\"http.createServer\");\n\n\t\t\t\tif (!isDaemon) {\n\t\t\t\t\treturn issues;\n\t\t\t\t}\n\n\t\t\t\t// Check for signal handlers\n\t\t\t\tconst hasSIGTERM = content.includes(\"process.on('SIGTERM'\") || content.includes('process.on(\"SIGTERM\"');\n\t\t\t\tconst hasSIGINT = content.includes(\"process.on('SIGINT'\") || content.includes('process.on(\"SIGINT\"');\n\n\t\t\t\tif (!hasSIGTERM && !hasSIGINT) {\n\t\t\t\t\tissues.push({\n\t\t\t\t\t\tid: createIssueId(\"signal-handlers\", file),\n\t\t\t\t\t\tseverity: \"high\" as Severity,\n\t\t\t\t\t\ttype: \"MISSING_PATTERN\",\n\t\t\t\t\t\tmessage: \"Daemon/server missing signal handlers (SIGTERM/SIGINT)\",\n\t\t\t\t\t\tfile,\n\t\t\t\t\t\tfix: \"Add process.on('SIGTERM', gracefulShutdown) for clean shutdown\",\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn issues;\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"daemon/socket-permissions\",\n\t\t\tname: \"Socket Permissions\",\n\t\t\tdetect: (content: string, file: string): AnalysisIssue[] => {\n\t\t\t\tconst issues: AnalysisIssue[] = [];\n\n\t\t\t\t// Check for Unix socket usage\n\t\t\t\tconst hasUnixSocket =\n\t\t\t\t\t(content.includes(\".listen(\") && content.includes(\".sock\")) ||\n\t\t\t\t\t(content.includes(\"createServer\") && content.includes(\".sock\"));\n\n\t\t\t\tif (!hasUnixSocket) {\n\t\t\t\t\treturn issues;\n\t\t\t\t}\n\n\t\t\t\t// Check for permission setting\n\t\t\t\tconst setsPermissions =\n\t\t\t\t\tcontent.includes(\"chmod\") ||\n\t\t\t\t\tcontent.includes(\"0o600\") ||\n\t\t\t\t\tcontent.includes(\"0o700\") ||\n\t\t\t\t\tcontent.includes(\"chmodSync\");\n\n\t\t\t\tif (!setsPermissions) {\n\t\t\t\t\tconst line = findLine(content, \".sock\");\n\t\t\t\t\tissues.push({\n\t\t\t\t\t\tid: createIssueId(\"socket-permissions\", file, line),\n\t\t\t\t\t\tseverity: \"high\" as Severity,\n\t\t\t\t\t\ttype: \"MISSING_PATTERN\",\n\t\t\t\t\t\tmessage: \"Unix socket without explicit permissions\",\n\t\t\t\t\t\tfile,\n\t\t\t\t\t\tline,\n\t\t\t\t\t\tfix: \"Add fs.chmodSync(socketPath, 0o600) after listen() to restrict access\",\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn issues;\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"daemon/buffer-limits\",\n\t\t\tname: \"Buffer Limits\",\n\t\t\tdetect: (content: string, file: string): AnalysisIssue[] => {\n\t\t\t\tconst issues: AnalysisIssue[] = [];\n\n\t\t\t\t// Check for data reading\n\t\t\t\tconst readsData =\n\t\t\t\t\tcontent.includes(\".on('data'\") ||\n\t\t\t\t\tcontent.includes('.on(\"data\"') ||\n\t\t\t\t\tcontent.includes(\"socket.read\") ||\n\t\t\t\t\tcontent.includes(\"stream.read\");\n\n\t\t\t\tif (!readsData) {\n\t\t\t\t\treturn issues;\n\t\t\t\t}\n\n\t\t\t\t// Check for buffer limits\n\t\t\t\tconst hasLimit =\n\t\t\t\t\tcontent.includes(\"MAX_BUFFER\") ||\n\t\t\t\t\tcontent.includes(\"maxSize\") ||\n\t\t\t\t\tcontent.includes(\"maxLength\") ||\n\t\t\t\t\t/\\.length\\s*[<>]/.test(content) ||\n\t\t\t\t\tcontent.includes(\"Buffer.allocUnsafe\") ||\n\t\t\t\t\tcontent.includes(\"highWaterMark\");\n\n\t\t\t\tif (!hasLimit) {\n\t\t\t\t\tconst line = findLine(content, \".on('data'\") || findLine(content, '.on(\"data\"');\n\t\t\t\t\tissues.push({\n\t\t\t\t\t\tid: createIssueId(\"buffer-limits\", file, line),\n\t\t\t\t\t\tseverity: \"high\" as Severity,\n\t\t\t\t\t\ttype: \"BUFFER_OVERFLOW\",\n\t\t\t\t\t\tmessage: \"Reading data without buffer limits (potential DoS vulnerability)\",\n\t\t\t\t\t\tfile,\n\t\t\t\t\t\tline,\n\t\t\t\t\t\tfix: \"Add buffer size limit check before processing data\",\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn issues;\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"daemon/lock-acquisition\",\n\t\t\tname: \"Lock Acquisition\",\n\t\t\tdetect: (content: string, file: string): AnalysisIssue[] => {\n\t\t\t\tconst issues: AnalysisIssue[] = [];\n\n\t\t\t\t// Check for daemon start code\n\t\t\t\tconst isDaemonStart =\n\t\t\t\t\tcontent.includes(\"daemon.start\") ||\n\t\t\t\t\tcontent.includes(\"startDaemon\") ||\n\t\t\t\t\tcontent.includes(\"spawnDaemon\") ||\n\t\t\t\t\t(file.includes(\"daemon\") && content.includes(\".start(\"));\n\n\t\t\t\tif (!isDaemonStart) {\n\t\t\t\t\treturn issues;\n\t\t\t\t}\n\n\t\t\t\t// Check for lock/pid file\n\t\t\t\tconst hasLock =\n\t\t\t\t\tcontent.includes(\"acquireLock\") ||\n\t\t\t\t\tcontent.includes(\".pid\") ||\n\t\t\t\t\tcontent.includes(\"pidFile\") ||\n\t\t\t\t\tcontent.includes(\"lockFile\") ||\n\t\t\t\t\tcontent.includes(\"proper-lockfile\") ||\n\t\t\t\t\t(content.includes(\"fs.writeFileSync\") && content.includes(\"process.pid\"));\n\n\t\t\t\tif (!hasLock) {\n\t\t\t\t\tissues.push({\n\t\t\t\t\t\tid: createIssueId(\"lock-acquisition\", file),\n\t\t\t\t\t\tseverity: \"medium\" as Severity,\n\t\t\t\t\t\ttype: \"MISSING_PATTERN\",\n\t\t\t\t\t\tmessage: \"Daemon starts without lock file (may allow multiple instances)\",\n\t\t\t\t\t\tfile,\n\t\t\t\t\t\tfix: \"Acquire lock via PID file before starting daemon to prevent duplicates\",\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn issues;\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"daemon/error-recovery\",\n\t\t\tname: \"Error Recovery\",\n\t\t\tdetect: (content: string, file: string): AnalysisIssue[] => {\n\t\t\t\tconst issues: AnalysisIssue[] = [];\n\n\t\t\t\t// Check if this is daemon/server code\n\t\t\t\tconst isDaemon =\n\t\t\t\t\tcontent.includes(\".listen(\") ||\n\t\t\t\t\tfile.includes(\"daemon\") ||\n\t\t\t\t\tfile.includes(\"server\") ||\n\t\t\t\t\tcontent.includes(\"net.createServer\");\n\n\t\t\t\tif (!isDaemon) {\n\t\t\t\t\treturn issues;\n\t\t\t\t}\n\n\t\t\t\t// Check for uncaughtException handler\n\t\t\t\tconst hasUncaughtHandler =\n\t\t\t\t\tcontent.includes(\"process.on('uncaughtException'\") ||\n\t\t\t\t\tcontent.includes('process.on(\"uncaughtException\"') ||\n\t\t\t\t\tcontent.includes(\"process.on('unhandledRejection'\") ||\n\t\t\t\t\tcontent.includes('process.on(\"unhandledRejection\"');\n\n\t\t\t\tif (!hasUncaughtHandler) {\n\t\t\t\t\tissues.push({\n\t\t\t\t\t\tid: createIssueId(\"error-recovery\", file),\n\t\t\t\t\t\tseverity: \"medium\" as Severity,\n\t\t\t\t\t\ttype: \"MISSING_PATTERN\",\n\t\t\t\t\t\tmessage: \"Daemon missing uncaughtException/unhandledRejection handlers\",\n\t\t\t\t\t\tfile,\n\t\t\t\t\t\tfix: \"Add handlers to log errors and optionally restart gracefully\",\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn issues;\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"daemon/health-check\",\n\t\t\tname: \"Health Check Endpoint\",\n\t\t\tdetect: (content: string, file: string): AnalysisIssue[] => {\n\t\t\t\tconst issues: AnalysisIssue[] = [];\n\n\t\t\t\t// Check if this is HTTP server code\n\t\t\t\tconst isHttpServer =\n\t\t\t\t\tcontent.includes(\"http.createServer\") ||\n\t\t\t\t\tcontent.includes(\"express()\") ||\n\t\t\t\t\tcontent.includes(\"fastify\") ||\n\t\t\t\t\tcontent.includes(\"Hono\") ||\n\t\t\t\t\tcontent.includes(\"koa\");\n\n\t\t\t\tif (!isHttpServer) {\n\t\t\t\t\treturn issues;\n\t\t\t\t}\n\n\t\t\t\t// Check for health endpoint\n\t\t\t\tconst hasHealthEndpoint =\n\t\t\t\t\tcontent.includes(\"/health\") ||\n\t\t\t\t\tcontent.includes(\"/healthz\") ||\n\t\t\t\t\tcontent.includes(\"/ready\") ||\n\t\t\t\t\tcontent.includes(\"/live\") ||\n\t\t\t\t\tcontent.includes(\"healthCheck\");\n\n\t\t\t\tif (!hasHealthEndpoint) {\n\t\t\t\t\tissues.push({\n\t\t\t\t\t\tid: createIssueId(\"health-check\", file),\n\t\t\t\t\t\tseverity: \"low\" as Severity,\n\t\t\t\t\t\ttype: \"MISSING_PATTERN\",\n\t\t\t\t\t\tmessage: \"HTTP server missing health check endpoint\",\n\t\t\t\t\t\tfile,\n\t\t\t\t\t\tfix: \"Add /health or /healthz endpoint for monitoring and orchestration\",\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn issues;\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"daemon/graceful-shutdown\",\n\t\t\tname: \"Graceful Shutdown\",\n\t\t\tdetect: (content: string, file: string): AnalysisIssue[] => {\n\t\t\t\tconst issues: AnalysisIssue[] = [];\n\n\t\t\t\t// Check if this is server code with connections\n\t\t\t\tconst hasServer =\n\t\t\t\t\tcontent.includes(\".listen(\") ||\n\t\t\t\t\tcontent.includes(\"server.close\") ||\n\t\t\t\t\tcontent.includes(\"createServer\");\n\n\t\t\t\tif (!hasServer) {\n\t\t\t\t\treturn issues;\n\t\t\t\t}\n\n\t\t\t\t// Check for graceful shutdown implementation\n\t\t\t\tconst hasGracefulShutdown =\n\t\t\t\t\tcontent.includes(\"server.close\") ||\n\t\t\t\t\tcontent.includes(\"gracefulShutdown\") ||\n\t\t\t\t\tcontent.includes(\"drainConnections\") ||\n\t\t\t\t\tcontent.includes(\"closeAllConnections\") ||\n\t\t\t\t\t(content.includes(\"SIGTERM\") && content.includes(\".close(\"));\n\n\t\t\t\tif (!hasGracefulShutdown) {\n\t\t\t\t\tissues.push({\n\t\t\t\t\t\tid: createIssueId(\"graceful-shutdown\", file),\n\t\t\t\t\t\tseverity: \"medium\" as Severity,\n\t\t\t\t\t\ttype: \"MISSING_PATTERN\",\n\t\t\t\t\t\tmessage: \"Server may not shut down gracefully (in-flight requests may be dropped)\",\n\t\t\t\t\t\tfile,\n\t\t\t\t\t\tfix: \"Implement graceful shutdown: stop accepting new connections, drain existing ones\",\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn issues;\n\t\t\t},\n\t\t},\n\t],\n};\n","/**\n * Astro Framework Configuration\n *\n * Pattern expectations and risk zones for Astro applications.\n *\n * @module knowledge/frameworks/astro\n */\n\nimport type { FrameworkConfig } from \"../types.js\";\n\nexport const astroConfig: FrameworkConfig = {\n\tid: \"astro\",\n\tname: \"Astro\",\n\tcategory: \"static\",\n\n\tindicators: [\n\t\t{ type: \"dependency\", pattern: \"astro\", weight: 0.95 },\n\t\t{ type: \"file\", pattern: \"astro.config.{js,ts,mjs}\", weight: 0.95 },\n\t\t{ type: \"file\", pattern: \"src/pages/**/*.astro\", weight: 0.9 },\n\t\t{ type: \"file\", pattern: \"src/layouts/*.astro\", weight: 0.85 },\n\t],\n\n\texpectedPatterns: [\n\t\t// Error Handling\n\t\t{\n\t\t\tid: \"astro-error-page\",\n\t\t\tname: \"Error Page\",\n\t\t\tdescription: \"Custom 404 and 500 error pages\",\n\t\t\tcategory: \"error-handling\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"file-exists\",\n\t\t\t\tpattern: \"src/pages/404.astro\",\n\t\t\t},\n\t\t\tdocs: \"https://docs.astro.build/en/core-concepts/astro-pages/#custom-404-error-page\",\n\t\t},\n\t\t{\n\t\t\tid: \"astro-error-boundary\",\n\t\t\tname: \"Island Error Boundaries\",\n\t\t\tdescription: \"Error handling for interactive islands\",\n\t\t\tcategory: \"error-handling\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"client:only|client:load|client:visible\",\n\t\t\t\tfiles: [\"src/**/*.astro\"],\n\t\t\t},\n\t\t},\n\n\t\t// Data Fetching\n\t\t{\n\t\t\tid: \"astro-content-collections\",\n\t\t\tname: \"Content Collections\",\n\t\t\tdescription: \"Type-safe content with collections\",\n\t\t\tcategory: \"data-fetching\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"file-exists\",\n\t\t\t\tpattern: \"src/content/config.ts\",\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"astro-data-fetching\",\n\t\t\tname: \"Data Fetching\",\n\t\t\tdescription: \"Server-side data fetching in frontmatter\",\n\t\t\tcategory: \"data-fetching\",\n\t\t\timportance: \"optional\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"await fetch|Astro\\\\.glob\",\n\t\t\t\tfiles: [\"src/**/*.astro\"],\n\t\t\t},\n\t\t},\n\n\t\t// Routing\n\t\t{\n\t\t\tid: \"astro-dynamic-routes\",\n\t\t\tname: \"Dynamic Routes\",\n\t\t\tdescription: \"Dynamic routing with getStaticPaths\",\n\t\t\tcategory: \"routing\",\n\t\t\timportance: \"optional\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"getStaticPaths\",\n\t\t\t\tfiles: [\"src/pages/**/*.astro\"],\n\t\t\t},\n\t\t},\n\n\t\t// Performance\n\t\t{\n\t\t\tid: \"astro-image-optimization\",\n\t\t\tname: \"Image Optimization\",\n\t\t\tdescription: \"Using astro:assets for optimized images\",\n\t\t\tcategory: \"performance\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"astro:assets|<Image\",\n\t\t\t\tfiles: [\"src/**/*.astro\"],\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"astro-view-transitions\",\n\t\t\tname: \"View Transitions\",\n\t\t\tdescription: \"SPA-like navigation with View Transitions\",\n\t\t\tcategory: \"performance\",\n\t\t\timportance: \"optional\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"ViewTransitions|view-transitions\",\n\t\t\t\tfiles: [\"src/**/*.astro\"],\n\t\t\t},\n\t\t},\n\n\t\t// Security\n\t\t{\n\t\t\tid: \"astro-csp\",\n\t\t\tname: \"Content Security Policy\",\n\t\t\tdescription: \"CSP headers configuration\",\n\t\t\tcategory: \"security\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"Content-Security-Policy\",\n\t\t\t\tfiles: [\"astro.config.*\", \"src/middleware.*\"],\n\t\t\t},\n\t\t},\n\n\t\t// Testing\n\t\t{\n\t\t\tid: \"astro-testing\",\n\t\t\tname: \"Testing Setup\",\n\t\t\tdescription: \"Playwright or other testing framework\",\n\t\t\tcategory: \"testing\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"@playwright/test|vitest\",\n\t\t\t},\n\t\t},\n\n\t\t// Configuration\n\t\t{\n\t\t\tid: \"astro-integrations\",\n\t\t\tname: \"Integrations\",\n\t\t\tdescription: \"Astro integrations for extended functionality\",\n\t\t\tcategory: \"configuration\",\n\t\t\timportance: \"optional\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"integrations:\",\n\t\t\t\tfiles: [\"astro.config.*\"],\n\t\t\t},\n\t\t},\n\n\t\t// State Management (for islands)\n\t\t{\n\t\t\tid: \"astro-islands-state\",\n\t\t\tname: \"Island State Management\",\n\t\t\tdescription: \"State sharing between islands\",\n\t\t\tcategory: \"state-management\",\n\t\t\timportance: \"optional\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"nanostores|@nanostores\",\n\t\t\t},\n\t\t},\n\t],\n\n\triskZones: [\n\t\t{\n\t\t\tid: \"api-endpoints\",\n\t\t\tname: \"API Endpoints\",\n\t\t\treason: \"Server-side logic in SSR mode\",\n\t\t\tpatterns: [\"src/pages/api/**\"],\n\t\t\tseverity: \"high\",\n\t\t\trequiredDocumentation: [\"Endpoint contracts\", \"Authentication\", \"Error handling\"],\n\t\t},\n\t\t{\n\t\t\tid: \"middleware\",\n\t\t\tname: \"Middleware\",\n\t\t\treason: \"Request processing, auth, redirects\",\n\t\t\tpatterns: [\"src/middleware.*\"],\n\t\t\tseverity: \"high\",\n\t\t\trequiredDocumentation: [\"Middleware logic\", \"Auth flow\", \"Redirects\"],\n\t\t},\n\t\t{\n\t\t\tid: \"content-config\",\n\t\t\tname: \"Content Configuration\",\n\t\t\treason: \"Schema definitions for content\",\n\t\t\tpatterns: [\"src/content/config.ts\"],\n\t\t\tseverity: \"medium\",\n\t\t\trequiredDocumentation: [\"Collection schemas\", \"Validation rules\"],\n\t\t},\n\t\t{\n\t\t\tid: \"islands\",\n\t\t\tname: \"Interactive Islands\",\n\t\t\treason: \"Client-side JavaScript components\",\n\t\t\tpatterns: [\"src/components/**/*.{tsx,jsx,vue,svelte}\"],\n\t\t\tseverity: \"medium\",\n\t\t\trequiredDocumentation: [\"Hydration strategy\", \"State management\"],\n\t\t},\n\t],\n\n\tcontextFiles: [\n\t\t{\n\t\t\tpath: \".llm-context/ARCHITECTURE.md\",\n\t\t\tpurpose: \"Site architecture and content structure\",\n\t\t\trequired: true,\n\t\t\texpectedSections: [\"Overview\", \"Directory Structure\", \"Content Collections\", \"Islands Architecture\"],\n\t\t},\n\t\t{\n\t\t\tpath: \".llm-context/PATTERNS.md\",\n\t\t\tpurpose: \"Astro patterns and conventions\",\n\t\t\trequired: true,\n\t\t\texpectedSections: [\"Component Patterns\", \"Data Fetching\", \"Island Hydration\"],\n\t\t},\n\t\t{\n\t\t\tpath: \".llm-context/CONSTRAINTS.md\",\n\t\t\tpurpose: \"Technical constraints\",\n\t\t\trequired: true,\n\t\t\texpectedSections: [\"Performance Budgets\", \"Browser Support\", \"Build Configuration\"],\n\t\t},\n\t],\n\n\trecommendedStructure: {\n\t\troot: \".llm-context\",\n\t\tdirectories: [\"patterns\"],\n\t\tfiles: [\n\t\t\t{\n\t\t\t\tpath: \".llm-context/ARCHITECTURE.md\",\n\t\t\t\tpurpose: \"Astro architecture\",\n\t\t\t\trequired: true,\n\t\t\t\ttemplate: `# Architecture\n\n## Overview\n[Brief description of the site]\n\n## Directory Structure\n\\`\\`\\`\nsrc/\n pages/           # File-based routing\n layouts/         # Page layouts\n components/      # Astro + framework components\n content/         # Content collections\n styles/          # Global styles\n assets/          # Static assets\n\\`\\`\\`\n\n## Content Collections\n[Describe content structure]\n\n## Islands Architecture\n[Describe interactive components and hydration strategy]\n`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpath: \".llm-context/PATTERNS.md\",\n\t\t\t\tpurpose: \"Astro patterns\",\n\t\t\t\trequired: true,\n\t\t\t\ttemplate: `# Patterns\n\n## Component Patterns\n- .astro for static components\n- Framework components for interactivity\n- Slots for composition\n\n## Data Fetching\n- Content collections for typed content\n- fetch() in frontmatter for external data\n- getStaticPaths for dynamic routes\n\n## Island Hydration\n- client:load for immediate interactivity\n- client:visible for lazy loading\n- client:only for client-only components\n`,\n\t\t\t},\n\t\t],\n\t},\n};\n","/**\n * Express Framework Configuration\n *\n * Pattern expectations and risk zones for Express.js applications.\n *\n * @module knowledge/frameworks/express\n */\n\nimport type { FrameworkConfig } from \"../types.js\";\n\nexport const expressConfig: FrameworkConfig = {\n\tid: \"express\",\n\tname: \"Express\",\n\tcategory: \"backend\",\n\n\tindicators: [\n\t\t{ type: \"dependency\", pattern: \"express\", weight: 0.95 },\n\t\t{ type: \"file\", pattern: \"app.{js,ts}\", weight: 0.5 },\n\t],\n\n\texpectedPatterns: [\n\t\t// Error Handling\n\t\t{\n\t\t\tid: \"express-error-middleware\",\n\t\t\tname: \"Error Middleware\",\n\t\t\tdescription: \"Centralized error handling middleware\",\n\t\t\tcategory: \"error-handling\",\n\t\t\timportance: \"critical\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"err.*req.*res.*next|error.*request.*response.*next\",\n\t\t\t\tfiles: [\"**/*.{js,ts}\"],\n\t\t\t},\n\t\t\tdocs: \"https://expressjs.com/en/guide/error-handling.html\",\n\t\t},\n\t\t{\n\t\t\tid: \"express-async-errors\",\n\t\t\tname: \"Async Error Handling\",\n\t\t\tdescription: \"Proper async/await error handling with express-async-errors or wrapper\",\n\t\t\tcategory: \"error-handling\",\n\t\t\timportance: \"critical\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"express-async-errors|express-async-handler\",\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"express-not-found\",\n\t\t\tname: \"404 Handler\",\n\t\t\tdescription: \"Catch-all 404 handler for unmatched routes\",\n\t\t\tcategory: \"error-handling\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"404|Not Found\",\n\t\t\t\tfiles: [\"**/*.{js,ts}\"],\n\t\t\t},\n\t\t},\n\n\t\t// Security\n\t\t{\n\t\t\tid: \"express-helmet\",\n\t\t\tname: \"Helmet Security\",\n\t\t\tdescription: \"Security headers with Helmet\",\n\t\t\tcategory: \"security\",\n\t\t\timportance: \"critical\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"helmet\",\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"express-cors\",\n\t\t\tname: \"CORS Configuration\",\n\t\t\tdescription: \"Cross-origin resource sharing setup\",\n\t\t\tcategory: \"security\",\n\t\t\timportance: \"critical\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"cors\",\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"express-rate-limiting\",\n\t\t\tname: \"Rate Limiting\",\n\t\t\tdescription: \"Request rate limiting to prevent abuse\",\n\t\t\tcategory: \"security\",\n\t\t\timportance: \"critical\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"express-rate-limit|rate-limiter-flexible\",\n\t\t\t},\n\t\t},\n\n\t\t// Validation\n\t\t{\n\t\t\tid: \"express-input-validation\",\n\t\t\tname: \"Input Validation\",\n\t\t\tdescription: \"Request body/params validation\",\n\t\t\tcategory: \"validation\",\n\t\t\timportance: \"critical\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"express-validator|joi|zod|yup\",\n\t\t\t},\n\t\t},\n\n\t\t// Logging\n\t\t{\n\t\t\tid: \"express-request-logging\",\n\t\t\tname: \"Request Logging\",\n\t\t\tdescription: \"HTTP request logging middleware\",\n\t\t\tcategory: \"logging\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"morgan|pino-http|express-winston\",\n\t\t\t},\n\t\t},\n\n\t\t// Authentication\n\t\t{\n\t\t\tid: \"express-auth-middleware\",\n\t\t\tname: \"Auth Middleware\",\n\t\t\tdescription: \"Authentication middleware for protected routes\",\n\t\t\tcategory: \"authentication\",\n\t\t\timportance: \"critical\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"passport|jwt|authenticate|isAuthenticated\",\n\t\t\t\tfiles: [\"**/middleware/**/*.{js,ts}\", \"**/auth/**/*.{js,ts}\"],\n\t\t\t},\n\t\t},\n\n\t\t// Testing\n\t\t{\n\t\t\tid: \"express-testing\",\n\t\t\tname: \"API Testing\",\n\t\t\tdescription: \"Integration tests with supertest or similar\",\n\t\t\tcategory: \"testing\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"supertest\",\n\t\t\t},\n\t\t},\n\n\t\t// Performance\n\t\t{\n\t\t\tid: \"express-compression\",\n\t\t\tname: \"Response Compression\",\n\t\t\tdescription: \"Gzip/brotli compression middleware\",\n\t\t\tcategory: \"performance\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"compression\",\n\t\t\t},\n\t\t},\n\n\t\t// Configuration\n\t\t{\n\t\t\tid: \"express-env-config\",\n\t\t\tname: \"Environment Configuration\",\n\t\t\tdescription: \"Environment-based configuration management\",\n\t\t\tcategory: \"configuration\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"dotenv|config\",\n\t\t\t},\n\t\t},\n\t],\n\n\triskZones: [\n\t\t{\n\t\t\tid: \"route-handlers\",\n\t\t\tname: \"Route Handlers\",\n\t\t\treason: \"Business logic, data access, response formatting\",\n\t\t\tpatterns: [\"routes/**\", \"controllers/**\", \"**/router.*\"],\n\t\t\tseverity: \"high\",\n\t\t\trequiredDocumentation: [\"Endpoint contracts\", \"Request/response schemas\", \"Error responses\"],\n\t\t},\n\t\t{\n\t\t\tid: \"middleware\",\n\t\t\tname: \"Middleware Chain\",\n\t\t\treason: \"Request processing, auth, validation\",\n\t\t\tpatterns: [\"middleware/**\", \"**/middleware.*\"],\n\t\t\tseverity: \"critical\",\n\t\t\trequiredDocumentation: [\"Middleware order\", \"Auth flow\", \"Error propagation\"],\n\t\t},\n\t\t{\n\t\t\tid: \"database-layer\",\n\t\t\tname: \"Database Layer\",\n\t\t\treason: \"Data persistence, queries, transactions\",\n\t\t\tpatterns: [\"models/**\", \"db/**\", \"repositories/**\"],\n\t\t\tseverity: \"critical\",\n\t\t\trequiredDocumentation: [\"Schema definitions\", \"Query patterns\", \"Transaction handling\"],\n\t\t},\n\t\t{\n\t\t\tid: \"auth-module\",\n\t\t\tname: \"Authentication Module\",\n\t\t\treason: \"User identity, sessions, tokens\",\n\t\t\tpatterns: [\"auth/**\", \"**/passport.*\", \"**/jwt.*\"],\n\t\t\tseverity: \"critical\",\n\t\t\trequiredDocumentation: [\"Auth strategies\", \"Token lifecycle\", \"Session management\"],\n\t\t},\n\t],\n\n\tcontextFiles: [\n\t\t{\n\t\t\tpath: \".llm-context/ARCHITECTURE.md\",\n\t\t\tpurpose: \"API architecture and component relationships\",\n\t\t\trequired: true,\n\t\t\texpectedSections: [\"Overview\", \"Directory Structure\", \"Middleware Chain\", \"Route Structure\"],\n\t\t},\n\t\t{\n\t\t\tpath: \".llm-context/PATTERNS.md\",\n\t\t\tpurpose: \"Coding patterns for Express development\",\n\t\t\trequired: true,\n\t\t\texpectedSections: [\"Error Handling\", \"Validation\", \"Authentication\", \"Response Format\"],\n\t\t},\n\t\t{\n\t\t\tpath: \".llm-context/API.md\",\n\t\t\tpurpose: \"API endpoint documentation\",\n\t\t\trequired: true,\n\t\t\texpectedSections: [\"Endpoints\", \"Authentication\", \"Error Codes\", \"Rate Limits\"],\n\t\t},\n\t\t{\n\t\t\tpath: \".llm-context/CONSTRAINTS.md\",\n\t\t\tpurpose: \"Technical constraints and requirements\",\n\t\t\trequired: true,\n\t\t\texpectedSections: [\"Security Requirements\", \"Performance Targets\", \"Dependencies\"],\n\t\t},\n\t],\n\n\trecommendedStructure: {\n\t\troot: \".llm-context\",\n\t\tdirectories: [\"patterns\", \"constraints\"],\n\t\tfiles: [\n\t\t\t{\n\t\t\t\tpath: \".llm-context/ARCHITECTURE.md\",\n\t\t\t\tpurpose: \"API architecture\",\n\t\t\t\trequired: true,\n\t\t\t\ttemplate: `# Architecture\n\n## Overview\n[Brief description of the API]\n\n## Directory Structure\n\\`\\`\\`\nsrc/\n routes/          # Route definitions\n controllers/     # Request handlers\n middleware/      # Express middleware\n models/          # Data models\n services/        # Business logic\n utils/           # Utilities\n\\`\\`\\`\n\n## Middleware Chain\n1. Helmet (security headers)\n2. CORS\n3. Body parser\n4. Request logging\n5. Authentication\n6. Route handlers\n7. Error handler\n\n## Route Structure\n[Describe route organization]\n`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpath: \".llm-context/PATTERNS.md\",\n\t\t\t\tpurpose: \"Express patterns\",\n\t\t\t\trequired: true,\n\t\t\t\ttemplate: `# Patterns\n\n## Error Handling\n- All async handlers wrapped with asyncHandler\n- Centralized error middleware at end of chain\n- Structured error responses\n\n## Validation\n- Request validation using [library]\n- Schema-first approach\n\n## Authentication\n- [Describe auth approach]\n\n## Response Format\n\\`\\`\\`json\n{\n  \"success\": true,\n  \"data\": {},\n  \"meta\": {}\n}\n\\`\\`\\`\n`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpath: \".llm-context/API.md\",\n\t\t\t\tpurpose: \"API documentation\",\n\t\t\t\trequired: true,\n\t\t\t\ttemplate: `# API Documentation\n\n## Base URL\n\\`/api/v1\\`\n\n## Authentication\n[Describe auth mechanism]\n\n## Endpoints\n\n### GET /endpoint\n[Description]\n\n## Error Codes\n| Code | Description |\n|------|-------------|\n| 400  | Bad Request |\n| 401  | Unauthorized |\n| 404  | Not Found |\n| 500  | Internal Error |\n`,\n\t\t\t},\n\t\t],\n\t},\n};\n","/**\n * NestJS Framework Configuration\n *\n * Pattern expectations and risk zones for NestJS applications.\n *\n * @module knowledge/frameworks/nestjs\n */\n\nimport type { FrameworkConfig } from \"../types.js\";\n\nexport const nestjsConfig: FrameworkConfig = {\n\tid: \"nestjs\",\n\tname: \"NestJS\",\n\tcategory: \"backend\",\n\n\tindicators: [\n\t\t{ type: \"dependency\", pattern: \"@nestjs/core\", weight: 0.95 },\n\t\t{ type: \"dependency\", pattern: \"@nestjs/common\", weight: 0.9 },\n\t\t{ type: \"file\", pattern: \"nest-cli.json\", weight: 0.95 },\n\t\t{ type: \"file\", pattern: \"src/main.ts\", weight: 0.5 },\n\t],\n\n\texpectedPatterns: [\n\t\t// Error Handling\n\t\t{\n\t\t\tid: \"nestjs-exception-filter\",\n\t\t\tname: \"Exception Filters\",\n\t\t\tdescription: \"Global and local exception filters\",\n\t\t\tcategory: \"error-handling\",\n\t\t\timportance: \"critical\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"@Catch|ExceptionFilter|HttpException\",\n\t\t\t\tfiles: [\"src/**/*.ts\"],\n\t\t\t},\n\t\t\tdocs: \"https://docs.nestjs.com/exception-filters\",\n\t\t},\n\t\t{\n\t\t\tid: \"nestjs-http-exceptions\",\n\t\t\tname: \"HTTP Exceptions\",\n\t\t\tdescription: \"Proper use of built-in HTTP exceptions\",\n\t\t\tcategory: \"error-handling\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"throw new (Http|Bad|Unauthorized|Forbidden|NotFound)Exception\",\n\t\t\t\tfiles: [\"src/**/*.ts\"],\n\t\t\t},\n\t\t},\n\n\t\t// Validation\n\t\t{\n\t\t\tid: \"nestjs-validation-pipe\",\n\t\t\tname: \"Validation Pipe\",\n\t\t\tdescription: \"Global validation with class-validator\",\n\t\t\tcategory: \"validation\",\n\t\t\timportance: \"critical\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"class-validator\",\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"nestjs-dto-validation\",\n\t\t\tname: \"DTO Validation\",\n\t\t\tdescription: \"DTOs with validation decorators\",\n\t\t\tcategory: \"validation\",\n\t\t\timportance: \"critical\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"@IsString|@IsNumber|@IsEmail|@IsNotEmpty\",\n\t\t\t\tfiles: [\"src/**/*.dto.ts\", \"src/**/dto/*.ts\"],\n\t\t\t},\n\t\t},\n\n\t\t// Authentication\n\t\t{\n\t\t\tid: \"nestjs-guards\",\n\t\t\tname: \"Authentication Guards\",\n\t\t\tdescription: \"Route protection with Guards\",\n\t\t\tcategory: \"authentication\",\n\t\t\timportance: \"critical\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"@UseGuards|CanActivate|AuthGuard\",\n\t\t\t\tfiles: [\"src/**/*.ts\"],\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"nestjs-passport\",\n\t\t\tname: \"Passport Integration\",\n\t\t\tdescription: \"Passport strategies for auth\",\n\t\t\tcategory: \"authentication\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"@nestjs/passport\",\n\t\t\t},\n\t\t},\n\n\t\t// Security\n\t\t{\n\t\t\tid: \"nestjs-helmet\",\n\t\t\tname: \"Helmet Security\",\n\t\t\tdescription: \"Security headers with Helmet\",\n\t\t\tcategory: \"security\",\n\t\t\timportance: \"critical\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"helmet\",\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"nestjs-throttler\",\n\t\t\tname: \"Rate Limiting\",\n\t\t\tdescription: \"Rate limiting with @nestjs/throttler\",\n\t\t\tcategory: \"security\",\n\t\t\timportance: \"critical\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"@nestjs/throttler\",\n\t\t\t},\n\t\t},\n\n\t\t// Testing\n\t\t{\n\t\t\tid: \"nestjs-testing-module\",\n\t\t\tname: \"Testing Module\",\n\t\t\tdescription: \"NestJS testing utilities\",\n\t\t\tcategory: \"testing\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"@nestjs/testing\",\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"nestjs-e2e-tests\",\n\t\t\tname: \"E2E Tests\",\n\t\t\tdescription: \"End-to-end API tests\",\n\t\t\tcategory: \"testing\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"file-exists\",\n\t\t\t\tpattern: \"test/**/*.e2e-spec.ts\",\n\t\t\t},\n\t\t},\n\n\t\t// Logging\n\t\t{\n\t\t\tid: \"nestjs-logger\",\n\t\t\tname: \"Logger Service\",\n\t\t\tdescription: \"Structured logging with NestJS Logger\",\n\t\t\tcategory: \"logging\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"Logger|@nestjs/common.*Logger\",\n\t\t\t\tfiles: [\"src/**/*.ts\"],\n\t\t\t},\n\t\t},\n\n\t\t// Configuration\n\t\t{\n\t\t\tid: \"nestjs-config-module\",\n\t\t\tname: \"Config Module\",\n\t\t\tdescription: \"Environment configuration with @nestjs/config\",\n\t\t\tcategory: \"configuration\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"@nestjs/config\",\n\t\t\t},\n\t\t},\n\n\t\t// Performance\n\t\t{\n\t\t\tid: \"nestjs-caching\",\n\t\t\tname: \"Caching\",\n\t\t\tdescription: \"Cache manager integration\",\n\t\t\tcategory: \"performance\",\n\t\t\timportance: \"optional\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"@nestjs/cache-manager|cache-manager\",\n\t\t\t},\n\t\t},\n\t],\n\n\triskZones: [\n\t\t{\n\t\t\tid: \"controllers\",\n\t\t\tname: \"Controllers\",\n\t\t\treason: \"Request handling, input processing, response formatting\",\n\t\t\tpatterns: [\"src/**/*.controller.ts\"],\n\t\t\tseverity: \"high\",\n\t\t\trequiredDocumentation: [\"Endpoint documentation\", \"Request/response DTOs\", \"Error responses\"],\n\t\t},\n\t\t{\n\t\t\tid: \"services\",\n\t\t\tname: \"Services\",\n\t\t\treason: \"Business logic, data access, external integrations\",\n\t\t\tpatterns: [\"src/**/*.service.ts\"],\n\t\t\tseverity: \"high\",\n\t\t\trequiredDocumentation: [\"Service responsibilities\", \"Dependencies\", \"Error handling\"],\n\t\t},\n\t\t{\n\t\t\tid: \"guards\",\n\t\t\tname: \"Guards\",\n\t\t\treason: \"Authentication, authorization, access control\",\n\t\t\tpatterns: [\"src/**/*.guard.ts\", \"src/auth/**\"],\n\t\t\tseverity: \"critical\",\n\t\t\trequiredDocumentation: [\"Guard logic\", \"Protected routes\", \"Role requirements\"],\n\t\t},\n\t\t{\n\t\t\tid: \"entities\",\n\t\t\tname: \"Entities/Models\",\n\t\t\treason: \"Database schema, relationships\",\n\t\t\tpatterns: [\"src/**/*.entity.ts\", \"src/**/*.model.ts\"],\n\t\t\tseverity: \"critical\",\n\t\t\trequiredDocumentation: [\"Schema design\", \"Relationships\", \"Constraints\"],\n\t\t},\n\t\t{\n\t\t\tid: \"modules\",\n\t\t\tname: \"Module Definitions\",\n\t\t\treason: \"Dependency injection, module boundaries\",\n\t\t\tpatterns: [\"src/**/*.module.ts\"],\n\t\t\tseverity: \"medium\",\n\t\t\trequiredDocumentation: [\"Module responsibilities\", \"Exports\", \"Dependencies\"],\n\t\t},\n\t],\n\n\tcontextFiles: [\n\t\t{\n\t\t\tpath: \".llm-context/ARCHITECTURE.md\",\n\t\t\tpurpose: \"NestJS module architecture\",\n\t\t\trequired: true,\n\t\t\texpectedSections: [\"Overview\", \"Module Structure\", \"Dependency Injection\", \"Data Flow\"],\n\t\t},\n\t\t{\n\t\t\tpath: \".llm-context/PATTERNS.md\",\n\t\t\tpurpose: \"NestJS patterns and conventions\",\n\t\t\trequired: true,\n\t\t\texpectedSections: [\"Error Handling\", \"Validation\", \"Authentication\", \"Testing\"],\n\t\t},\n\t\t{\n\t\t\tpath: \".llm-context/API.md\",\n\t\t\tpurpose: \"API endpoint documentation\",\n\t\t\trequired: true,\n\t\t\texpectedSections: [\"Endpoints\", \"DTOs\", \"Error Codes\"],\n\t\t},\n\t\t{\n\t\t\tpath: \".llm-context/CONSTRAINTS.md\",\n\t\t\tpurpose: \"Technical constraints\",\n\t\t\trequired: true,\n\t\t\texpectedSections: [\"Security\", \"Performance\", \"Dependencies\"],\n\t\t},\n\t],\n\n\trecommendedStructure: {\n\t\troot: \".llm-context\",\n\t\tdirectories: [\"patterns\", \"modules\"],\n\t\tfiles: [\n\t\t\t{\n\t\t\t\tpath: \".llm-context/ARCHITECTURE.md\",\n\t\t\t\tpurpose: \"NestJS architecture\",\n\t\t\t\trequired: true,\n\t\t\t\ttemplate: `# Architecture\n\n## Overview\n[Brief description of the API]\n\n## Module Structure\n\\`\\`\\`\nsrc/\n app.module.ts        # Root module\n auth/                # Auth module\n    auth.module.ts\n    auth.controller.ts\n    auth.service.ts\n    guards/\n users/               # Users module\n common/              # Shared utilities\n    filters/\n    guards/\n    interceptors/\n    pipes/\n config/              # Configuration\n\\`\\`\\`\n\n## Dependency Injection\n[Describe DI patterns]\n\n## Data Flow\nRequest  Guards  Interceptors  Pipes  Controller  Service  Repository\n`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpath: \".llm-context/PATTERNS.md\",\n\t\t\t\tpurpose: \"NestJS patterns\",\n\t\t\t\trequired: true,\n\t\t\t\ttemplate: `# Patterns\n\n## Error Handling\n- Global exception filter for HTTP exceptions\n- Custom exceptions extend HttpException\n- Structured error responses\n\n## Validation\n- Global ValidationPipe with whitelist\n- DTOs with class-validator decorators\n- Transform enabled for type coercion\n\n## Authentication\n- JWT strategy with Passport\n- Guards on controllers/routes\n- Role-based access control\n\n## Testing\n- Unit tests for services\n- E2E tests for controllers\n- Test database for integration tests\n`,\n\t\t\t},\n\t\t],\n\t},\n};\n","/**\n * Next.js Framework Configuration\n *\n * Pattern expectations and risk zones for Next.js applications.\n *\n * @module knowledge/frameworks/nextjs\n */\n\nimport type { FrameworkConfig } from \"../types.js\";\n\nexport const nextjsConfig: FrameworkConfig = {\n\tid: \"nextjs\",\n\tname: \"Next.js\",\n\tcategory: \"fullstack\",\n\n\tindicators: [\n\t\t{ type: \"dependency\", pattern: \"next\", weight: 0.95 },\n\t\t{ type: \"file\", pattern: \"next.config.{js,mjs,ts}\", weight: 0.9 },\n\t\t{ type: \"file\", pattern: \"app/layout.{tsx,jsx,js,ts}\", weight: 0.85 },\n\t\t{ type: \"file\", pattern: \"pages/_app.{tsx,jsx,js,ts}\", weight: 0.8 },\n\t\t{ type: \"script\", pattern: \"next dev\", weight: 0.7 },\n\t],\n\n\texpectedPatterns: [\n\t\t// Error Handling\n\t\t{\n\t\t\tid: \"nextjs-error-boundary\",\n\t\t\tname: \"Error Boundary\",\n\t\t\tdescription: \"App-level error boundary using error.tsx\",\n\t\t\tcategory: \"error-handling\",\n\t\t\timportance: \"critical\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"file-exists\",\n\t\t\t\tpattern: \"app/error.tsx\",\n\t\t\t\tfiles: [\"app/**/error.tsx\"],\n\t\t\t},\n\t\t\tdocs: \"https://nextjs.org/docs/app/building-your-application/routing/error-handling\",\n\t\t},\n\t\t{\n\t\t\tid: \"nextjs-not-found\",\n\t\t\tname: \"Not Found Handler\",\n\t\t\tdescription: \"Custom 404 page using not-found.tsx\",\n\t\t\tcategory: \"error-handling\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"file-exists\",\n\t\t\t\tpattern: \"app/not-found.tsx\",\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"nextjs-global-error\",\n\t\t\tname: \"Global Error Handler\",\n\t\t\tdescription: \"Root error boundary in app/global-error.tsx\",\n\t\t\tcategory: \"error-handling\",\n\t\t\timportance: \"critical\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"file-exists\",\n\t\t\t\tpattern: \"app/global-error.tsx\",\n\t\t\t},\n\t\t},\n\n\t\t// Data Fetching\n\t\t{\n\t\t\tid: \"nextjs-server-actions\",\n\t\t\tname: \"Server Actions\",\n\t\t\tdescription: \"Form handling with 'use server' directive\",\n\t\t\tcategory: \"data-fetching\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: '\"use server\"',\n\t\t\t\tfiles: [\"app/**/*.{ts,tsx}\", \"actions/**/*.ts\"],\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"nextjs-loading-state\",\n\t\t\tname: \"Loading States\",\n\t\t\tdescription: \"Suspense-based loading with loading.tsx\",\n\t\t\tcategory: \"data-fetching\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"file-exists\",\n\t\t\t\tpattern: \"app/**/loading.tsx\",\n\t\t\t},\n\t\t},\n\n\t\t// Routing\n\t\t{\n\t\t\tid: \"nextjs-middleware\",\n\t\t\tname: \"Middleware\",\n\t\t\tdescription: \"Edge middleware for auth/redirects\",\n\t\t\tcategory: \"routing\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"file-exists\",\n\t\t\t\tpattern: \"middleware.ts\",\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"nextjs-parallel-routes\",\n\t\t\tname: \"Parallel Routes\",\n\t\t\tdescription: \"Simultaneous route rendering with @folder convention\",\n\t\t\tcategory: \"routing\",\n\t\t\timportance: \"optional\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"file-exists\",\n\t\t\t\tpattern: \"app/**/@*\",\n\t\t\t},\n\t\t},\n\n\t\t// Authentication\n\t\t{\n\t\t\tid: \"nextjs-auth-middleware\",\n\t\t\tname: \"Auth Middleware\",\n\t\t\tdescription: \"Protected routes via middleware\",\n\t\t\tcategory: \"authentication\",\n\t\t\timportance: \"critical\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"getToken|getSession|auth\\\\(\",\n\t\t\t\tfiles: [\"middleware.ts\"],\n\t\t\t},\n\t\t},\n\n\t\t// Validation\n\t\t{\n\t\t\tid: \"nextjs-zod-validation\",\n\t\t\tname: \"Zod Validation\",\n\t\t\tdescription: \"Schema validation with Zod\",\n\t\t\tcategory: \"validation\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"ast\",\n\t\t\t\tpattern: \"import.*zod|z\\\\.object\",\n\t\t\t\tfiles: [\"**/*.{ts,tsx}\"],\n\t\t\t},\n\t\t},\n\n\t\t// Security\n\t\t{\n\t\t\tid: \"nextjs-csp-headers\",\n\t\t\tname: \"CSP Headers\",\n\t\t\tdescription: \"Content Security Policy configuration\",\n\t\t\tcategory: \"security\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"Content-Security-Policy|contentSecurityPolicy\",\n\t\t\t\tfiles: [\"next.config.*\", \"middleware.ts\"],\n\t\t\t},\n\t\t},\n\n\t\t// Testing\n\t\t{\n\t\t\tid: \"nextjs-testing-setup\",\n\t\t\tname: \"Testing Setup\",\n\t\t\tdescription: \"Jest or Vitest configuration for Next.js\",\n\t\t\tcategory: \"testing\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"file-exists\",\n\t\t\t\tpattern: \"{jest,vitest}.config.{js,ts,mjs}\",\n\t\t\t},\n\t\t},\n\n\t\t// Performance\n\t\t{\n\t\t\tid: \"nextjs-image-optimization\",\n\t\t\tname: \"Image Optimization\",\n\t\t\tdescription: \"Using next/image for optimized images\",\n\t\t\tcategory: \"performance\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"import.*Image.*from ['\\\"]next/image['\\\"]\",\n\t\t\t\tfiles: [\"**/*.{tsx,jsx}\"],\n\t\t\t},\n\t\t},\n\n\t\t// Logging\n\t\t{\n\t\t\tid: \"nextjs-structured-logging\",\n\t\t\tname: \"Structured Logging\",\n\t\t\tdescription: \"Consistent logging with pino or similar\",\n\t\t\tcategory: \"logging\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"pino|winston|bunyan\",\n\t\t\t},\n\t\t},\n\t],\n\n\triskZones: [\n\t\t{\n\t\t\tid: \"api-routes\",\n\t\t\tname: \"API Routes\",\n\t\t\treason: \"Direct database access, authentication, authorization logic\",\n\t\t\tpatterns: [\"app/api/**\", \"pages/api/**\"],\n\t\t\tseverity: \"critical\",\n\t\t\trequiredDocumentation: [\n\t\t\t\t\"Authentication requirements\",\n\t\t\t\t\"Rate limiting configuration\",\n\t\t\t\t\"Input validation schemas\",\n\t\t\t\t\"Error response formats\",\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tid: \"middleware\",\n\t\t\tname: \"Middleware\",\n\t\t\treason: \"Request interception, auth checks, redirects\",\n\t\t\tpatterns: [\"middleware.ts\", \"middleware.js\"],\n\t\t\tseverity: \"critical\",\n\t\t\trequiredDocumentation: [\"Protected routes list\", \"Auth token handling\", \"Redirect logic\"],\n\t\t},\n\t\t{\n\t\t\tid: \"server-actions\",\n\t\t\tname: \"Server Actions\",\n\t\t\treason: \"Direct server mutations, data modifications\",\n\t\t\tpatterns: [\"app/**/actions.*\", \"actions/**\"],\n\t\t\tseverity: \"high\",\n\t\t\trequiredDocumentation: [\"Action permissions\", \"Validation requirements\", \"Error handling strategy\"],\n\t\t},\n\t\t{\n\t\t\tid: \"env-config\",\n\t\t\tname: \"Environment Configuration\",\n\t\t\treason: \"Secrets and environment-specific settings\",\n\t\t\tpatterns: [\".env*\", \"next.config.*\"],\n\t\t\tseverity: \"high\",\n\t\t\trequiredDocumentation: [\n\t\t\t\t\"Required environment variables\",\n\t\t\t\t\"Default values\",\n\t\t\t\t\"Production vs development differences\",\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tid: \"database-layer\",\n\t\t\tname: \"Database Layer\",\n\t\t\treason: \"Data persistence, migrations, schema\",\n\t\t\tpatterns: [\"prisma/**\", \"drizzle/**\", \"db/**\", \"lib/db*\"],\n\t\t\tseverity: \"critical\",\n\t\t\trequiredDocumentation: [\"Schema overview\", \"Migration strategy\", \"Connection pooling\", \"Query patterns\"],\n\t\t},\n\t],\n\n\tcontextFiles: [\n\t\t{\n\t\t\tpath: \".llm-context/ARCHITECTURE.md\",\n\t\t\tpurpose: \"High-level system architecture and component relationships\",\n\t\t\trequired: true,\n\t\t\texpectedSections: [\"Overview\", \"Directory Structure\", \"Data Flow\", \"Key Components\"],\n\t\t},\n\t\t{\n\t\t\tpath: \".llm-context/PATTERNS.md\",\n\t\t\tpurpose: \"Coding patterns and conventions\",\n\t\t\trequired: true,\n\t\t\texpectedSections: [\"Error Handling\", \"Data Fetching\", \"Authentication\", \"Validation\"],\n\t\t},\n\t\t{\n\t\t\tpath: \".llm-context/CONSTRAINTS.md\",\n\t\t\tpurpose: \"Technical constraints and non-negotiables\",\n\t\t\trequired: true,\n\t\t\texpectedSections: [\"Performance Budgets\", \"Security Requirements\", \"Dependencies\"],\n\t\t},\n\t\t{\n\t\t\tpath: \".llm-context/API.md\",\n\t\t\tpurpose: \"API routes documentation\",\n\t\t\trequired: false,\n\t\t\texpectedSections: [\"Endpoints\", \"Authentication\", \"Error Codes\"],\n\t\t},\n\t\t{\n\t\t\tpath: \".llm-context/DATABASE.md\",\n\t\t\tpurpose: \"Database schema and patterns\",\n\t\t\trequired: false,\n\t\t\texpectedSections: [\"Schema\", \"Relationships\", \"Migrations\"],\n\t\t},\n\t],\n\n\trecommendedStructure: {\n\t\troot: \".llm-context\",\n\t\tdirectories: [\"patterns\", \"constraints\", \"examples\"],\n\t\tfiles: [\n\t\t\t{\n\t\t\t\tpath: \".llm-context/ARCHITECTURE.md\",\n\t\t\t\tpurpose: \"System architecture documentation\",\n\t\t\t\trequired: true,\n\t\t\t\ttemplate: `# Architecture\n\n## Overview\n[Brief description of the application]\n\n## Directory Structure\n\\`\\`\\`\napp/\n (auth)/          # Auth-related routes\n (dashboard)/     # Dashboard routes\n api/             # API routes\n layout.tsx       # Root layout\n\\`\\`\\`\n\n## Data Flow\n[Describe how data flows through the application]\n\n## Key Components\n[List and describe major components]\n`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpath: \".llm-context/PATTERNS.md\",\n\t\t\t\tpurpose: \"Coding patterns and conventions\",\n\t\t\t\trequired: true,\n\t\t\t\ttemplate: `# Patterns\n\n## Error Handling\n[Describe error handling approach]\n\n## Data Fetching\n[Describe data fetching patterns]\n\n## Authentication\n[Describe auth patterns]\n\n## Validation\n[Describe validation approach]\n`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpath: \".llm-context/CONSTRAINTS.md\",\n\t\t\t\tpurpose: \"Technical constraints\",\n\t\t\t\trequired: true,\n\t\t\t\ttemplate: `# Constraints\n\n## Performance Budgets\n- FCP < 1.8s\n- LCP < 2.5s\n- Bundle < 500KB initial\n\n## Security Requirements\n- [List security requirements]\n\n## Dependencies\n- [List dependency constraints]\n`,\n\t\t\t},\n\t\t],\n\t},\n};\n","/**\n * React + Vite Framework Configuration\n *\n * Pattern expectations and risk zones for React applications using Vite.\n *\n * @module knowledge/frameworks/react-vite\n */\n\nimport type { FrameworkConfig } from \"../types.js\";\n\nexport const reactViteConfig: FrameworkConfig = {\n\tid: \"react-vite\",\n\tname: \"React (Vite)\",\n\tcategory: \"frontend\",\n\n\tindicators: [\n\t\t{ type: \"dependency\", pattern: \"vite\", weight: 0.5 },\n\t\t{ type: \"dependency\", pattern: \"react\", weight: 0.5 },\n\t\t{ type: \"dependency\", pattern: \"@vitejs/plugin-react\", weight: 0.9 },\n\t\t{ type: \"file\", pattern: \"vite.config.{js,ts,mjs}\", weight: 0.85 },\n\t\t{ type: \"file\", pattern: \"index.html\", weight: 0.3 },\n\t],\n\n\texpectedPatterns: [\n\t\t// Error Handling\n\t\t{\n\t\t\tid: \"react-error-boundary\",\n\t\t\tname: \"Error Boundary\",\n\t\t\tdescription: \"React Error Boundary for graceful error handling\",\n\t\t\tcategory: \"error-handling\",\n\t\t\timportance: \"critical\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"ast\",\n\t\t\t\tpattern: \"componentDidCatch|ErrorBoundary|react-error-boundary\",\n\t\t\t\tfiles: [\"src/**/*.{tsx,jsx}\"],\n\t\t\t},\n\t\t\tdocs: \"https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary\",\n\t\t},\n\t\t{\n\t\t\tid: \"react-suspense\",\n\t\t\tname: \"Suspense Boundaries\",\n\t\t\tdescription: \"Suspense for async component loading\",\n\t\t\tcategory: \"error-handling\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"<Suspense\",\n\t\t\t\tfiles: [\"src/**/*.{tsx,jsx}\"],\n\t\t\t},\n\t\t},\n\n\t\t// State Management\n\t\t{\n\t\t\tid: \"react-state-management\",\n\t\t\tname: \"State Management\",\n\t\t\tdescription: \"Consistent state management approach\",\n\t\t\tcategory: \"state-management\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"zustand|jotai|recoil|redux|@tanstack/react-query\",\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"react-query\",\n\t\t\tname: \"Server State Management\",\n\t\t\tdescription: \"TanStack Query for server state\",\n\t\t\tcategory: \"data-fetching\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"@tanstack/react-query\",\n\t\t\t},\n\t\t},\n\n\t\t// Routing\n\t\t{\n\t\t\tid: \"react-router\",\n\t\t\tname: \"Client Routing\",\n\t\t\tdescription: \"React Router for navigation\",\n\t\t\tcategory: \"routing\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"react-router-dom|@tanstack/react-router\",\n\t\t\t},\n\t\t},\n\n\t\t// Validation\n\t\t{\n\t\t\tid: \"react-form-validation\",\n\t\t\tname: \"Form Validation\",\n\t\t\tdescription: \"Form handling with validation\",\n\t\t\tcategory: \"validation\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"react-hook-form|formik\",\n\t\t\t},\n\t\t},\n\n\t\t// Testing\n\t\t{\n\t\t\tid: \"react-testing-library\",\n\t\t\tname: \"Testing Library\",\n\t\t\tdescription: \"React Testing Library setup\",\n\t\t\tcategory: \"testing\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"@testing-library/react\",\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"react-vitest\",\n\t\t\tname: \"Vitest Configuration\",\n\t\t\tdescription: \"Vitest for unit testing\",\n\t\t\tcategory: \"testing\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"dependency\",\n\t\t\t\tpattern: \"vitest\",\n\t\t\t},\n\t\t},\n\n\t\t// Performance\n\t\t{\n\t\t\tid: \"react-lazy-loading\",\n\t\t\tname: \"Lazy Loading\",\n\t\t\tdescription: \"Code splitting with React.lazy\",\n\t\t\tcategory: \"performance\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"React\\\\.lazy|lazy\\\\(\",\n\t\t\t\tfiles: [\"src/**/*.{tsx,jsx}\"],\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\tid: \"react-memo\",\n\t\t\tname: \"Memoization\",\n\t\t\tdescription: \"Performance optimization with memo/useMemo/useCallback\",\n\t\t\tcategory: \"performance\",\n\t\t\timportance: \"optional\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"React\\\\.memo|useMemo|useCallback\",\n\t\t\t\tfiles: [\"src/**/*.{tsx,jsx}\"],\n\t\t\t},\n\t\t},\n\n\t\t// Security\n\t\t{\n\t\t\tid: \"react-xss-prevention\",\n\t\t\tname: \"XSS Prevention\",\n\t\t\tdescription: \"Avoiding dangerouslySetInnerHTML or sanitizing\",\n\t\t\tcategory: \"security\",\n\t\t\timportance: \"critical\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"content-match\",\n\t\t\t\tpattern: \"dangerouslySetInnerHTML\",\n\t\t\t\tfiles: [\"src/**/*.{tsx,jsx}\"],\n\t\t\t},\n\t\t},\n\n\t\t// Configuration\n\t\t{\n\t\t\tid: \"vite-env-types\",\n\t\t\tname: \"Environment Types\",\n\t\t\tdescription: \"Typed environment variables\",\n\t\t\tcategory: \"configuration\",\n\t\t\timportance: \"recommended\",\n\t\t\tdetection: {\n\t\t\t\tmethod: \"file-exists\",\n\t\t\t\tpattern: \"src/vite-env.d.ts\",\n\t\t\t},\n\t\t},\n\t],\n\n\triskZones: [\n\t\t{\n\t\t\tid: \"api-calls\",\n\t\t\tname: \"API Integration\",\n\t\t\treason: \"Data fetching, error handling, auth headers\",\n\t\t\tpatterns: [\"src/api/**\", \"src/services/**\", \"src/lib/api*\"],\n\t\t\tseverity: \"high\",\n\t\t\trequiredDocumentation: [\"API client setup\", \"Error handling strategy\", \"Authentication flow\"],\n\t\t},\n\t\t{\n\t\t\tid: \"auth-context\",\n\t\t\tname: \"Authentication Context\",\n\t\t\treason: \"User state, tokens, permissions\",\n\t\t\tpatterns: [\"src/context/auth*\", \"src/providers/auth*\", \"src/hooks/useAuth*\"],\n\t\t\tseverity: \"critical\",\n\t\t\trequiredDocumentation: [\"Auth flow\", \"Token storage\", \"Protected routes\"],\n\t\t},\n\t\t{\n\t\t\tid: \"global-state\",\n\t\t\tname: \"Global State\",\n\t\t\treason: \"Shared application state\",\n\t\t\tpatterns: [\"src/store/**\", \"src/state/**\", \"src/atoms/**\"],\n\t\t\tseverity: \"high\",\n\t\t\trequiredDocumentation: [\"State structure\", \"Update patterns\", \"Persistence\"],\n\t\t},\n\t\t{\n\t\t\tid: \"env-config\",\n\t\t\tname: \"Environment Configuration\",\n\t\t\treason: \"API URLs, feature flags\",\n\t\t\tpatterns: [\".env*\", \"vite.config.*\"],\n\t\t\tseverity: \"medium\",\n\t\t\trequiredDocumentation: [\"Required variables\", \"Build-time vs runtime\"],\n\t\t},\n\t],\n\n\tcontextFiles: [\n\t\t{\n\t\t\tpath: \".llm-context/ARCHITECTURE.md\",\n\t\t\tpurpose: \"Component architecture and data flow\",\n\t\t\trequired: true,\n\t\t\texpectedSections: [\"Overview\", \"Directory Structure\", \"Component Hierarchy\", \"Data Flow\"],\n\t\t},\n\t\t{\n\t\t\tpath: \".llm-context/PATTERNS.md\",\n\t\t\tpurpose: \"React patterns and conventions\",\n\t\t\trequired: true,\n\t\t\texpectedSections: [\"Component Patterns\", \"Hook Patterns\", \"State Management\", \"Error Handling\"],\n\t\t},\n\t\t{\n\t\t\tpath: \".llm-context/CONSTRAINTS.md\",\n\t\t\tpurpose: \"Technical constraints\",\n\t\t\trequired: true,\n\t\t\texpectedSections: [\"Performance Budgets\", \"Browser Support\", \"Dependencies\"],\n\t\t},\n\t],\n\n\trecommendedStructure: {\n\t\troot: \".llm-context\",\n\t\tdirectories: [\"patterns\", \"constraints\"],\n\t\tfiles: [\n\t\t\t{\n\t\t\t\tpath: \".llm-context/ARCHITECTURE.md\",\n\t\t\t\tpurpose: \"React architecture\",\n\t\t\t\trequired: true,\n\t\t\t\ttemplate: `# Architecture\n\n## Overview\n[Brief description of the application]\n\n## Directory Structure\n\\`\\`\\`\nsrc/\n components/      # Reusable UI components\n pages/           # Route pages\n hooks/           # Custom hooks\n context/         # React context providers\n services/        # API services\n store/           # State management\n utils/           # Utilities\n\\`\\`\\`\n\n## Component Hierarchy\n[Describe component organization]\n\n## Data Flow\n[Describe data flow patterns]\n`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpath: \".llm-context/PATTERNS.md\",\n\t\t\t\tpurpose: \"React patterns\",\n\t\t\t\trequired: true,\n\t\t\t\ttemplate: `# Patterns\n\n## Component Patterns\n- Composition over inheritance\n- Container/Presentational split\n- Custom hooks for logic\n\n## Hook Patterns\n[Describe hook conventions]\n\n## State Management\n[Describe state approach]\n\n## Error Handling\n- Error boundaries for UI errors\n- Try-catch for async operations\n- User-friendly error messages\n`,\n\t\t\t},\n\t\t],\n\t},\n};\n","/**\n * Framework Registry\n *\n * Central registry for framework configurations with detection and lookup.\n *\n * @module knowledge/registry\n */\n\nimport { astroConfig } from \"./frameworks/astro.js\";\nimport { expressConfig } from \"./frameworks/express.js\";\nimport { nestjsConfig } from \"./frameworks/nestjs.js\";\nimport { nextjsConfig } from \"./frameworks/nextjs.js\";\nimport { reactViteConfig } from \"./frameworks/react-vite.js\";\nimport type { DetectedFramework, FrameworkConfig, FrameworkId } from \"./types.js\";\n\n// =============================================================================\n// FRAMEWORK REGISTRY\n// =============================================================================\n\n/**\n * All registered framework configurations\n */\nconst FRAMEWORK_CONFIGS: FrameworkConfig[] = [nextjsConfig, reactViteConfig, expressConfig, nestjsConfig, astroConfig];\n\n/**\n * Framework lookup by ID\n */\nconst FRAMEWORK_MAP = new Map<FrameworkId, FrameworkConfig>(FRAMEWORK_CONFIGS.map((config) => [config.id, config]));\n\n// =============================================================================\n// REGISTRY API\n// =============================================================================\n\n/**\n * Get all registered framework configurations\n */\nexport function getAllFrameworks(): FrameworkConfig[] {\n\treturn [...FRAMEWORK_CONFIGS];\n}\n\n/**\n * Get a framework configuration by ID\n */\nexport function getFramework(id: FrameworkId): FrameworkConfig | undefined {\n\treturn FRAMEWORK_MAP.get(id);\n}\n\n/**\n * Get frameworks by category\n */\nexport function getFrameworksByCategory(category: FrameworkConfig[\"category\"]): FrameworkConfig[] {\n\treturn FRAMEWORK_CONFIGS.filter((config) => config.category === category);\n}\n\n/**\n * Check if a framework ID is valid\n */\nexport function isValidFramework(id: string): id is FrameworkId {\n\treturn FRAMEWORK_MAP.has(id as FrameworkId);\n}\n\n// =============================================================================\n// FRAMEWORK DETECTION\n// =============================================================================\n\nexport interface FrameworkDetectionContext {\n\t/** Contents of package.json if it exists */\n\tpackageJson?: {\n\t\tdependencies?: Record<string, string>;\n\t\tdevDependencies?: Record<string, string>;\n\t\tscripts?: Record<string, string>;\n\t};\n\t/** List of file paths in the workspace (relative) */\n\tfilePaths: string[];\n\t/** Function to check file content for a pattern */\n\tcheckFileContent?: (pattern: string, files: string[]) => Promise<boolean>;\n}\n\n/**\n * Detect frameworks in a workspace\n *\n * Returns all detected frameworks sorted by confidence\n */\nexport async function detectFrameworks(context: FrameworkDetectionContext): Promise<DetectedFramework[]> {\n\tconst detectedFrameworks: DetectedFramework[] = [];\n\n\tfor (const config of FRAMEWORK_CONFIGS) {\n\t\tconst detection = await evaluateFramework(config, context);\n\n\t\tif (detection.confidence > 0.3) {\n\t\t\tdetectedFrameworks.push(detection);\n\t\t}\n\t}\n\n\t// Sort by confidence (highest first)\n\treturn detectedFrameworks.sort((a, b) => b.confidence - a.confidence);\n}\n\n/**\n * Detect the primary framework in a workspace\n *\n * Returns the framework with highest confidence, or unknown\n */\nexport async function detectPrimaryFramework(context: FrameworkDetectionContext): Promise<DetectedFramework> {\n\tconst frameworks = await detectFrameworks(context);\n\n\tif (frameworks.length === 0) {\n\t\treturn {\n\t\t\tid: \"unknown\",\n\t\t\tname: \"Unknown\",\n\t\t\tconfidence: 0,\n\t\t\tindicators: [],\n\t\t};\n\t}\n\n\treturn frameworks[0];\n}\n\n/**\n * Evaluate a single framework against the detection context\n */\nasync function evaluateFramework(\n\tconfig: FrameworkConfig,\n\tcontext: FrameworkDetectionContext,\n): Promise<DetectedFramework> {\n\tlet totalWeight = 0;\n\tlet matchedWeight = 0;\n\tconst matchedIndicators: string[] = [];\n\tlet detectedVersion: string | undefined;\n\n\tfor (const indicator of config.indicators) {\n\t\ttotalWeight += indicator.weight;\n\n\t\tconst matched = await checkIndicator(indicator, context);\n\n\t\tif (matched.match) {\n\t\t\tmatchedWeight += indicator.weight;\n\t\t\tmatchedIndicators.push(indicator.pattern);\n\n\t\t\tif (matched.version) {\n\t\t\t\tdetectedVersion = matched.version;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Calculate confidence as ratio of matched to total weight\n\tconst confidence = totalWeight > 0 ? matchedWeight / totalWeight : 0;\n\n\treturn {\n\t\tid: config.id,\n\t\tname: config.name,\n\t\tconfidence,\n\t\tversion: detectedVersion,\n\t\tindicators: matchedIndicators,\n\t};\n}\n\n/**\n * Check a single indicator\n */\nasync function checkIndicator(\n\tindicator: FrameworkConfig[\"indicators\"][0],\n\tcontext: FrameworkDetectionContext,\n): Promise<{ match: boolean; version?: string }> {\n\tswitch (indicator.type) {\n\t\tcase \"dependency\": {\n\t\t\tconst deps = {\n\t\t\t\t...context.packageJson?.dependencies,\n\t\t\t\t...context.packageJson?.devDependencies,\n\t\t\t};\n\t\t\tconst version = deps[indicator.pattern];\n\t\t\treturn {\n\t\t\t\tmatch: Boolean(version),\n\t\t\t\tversion: version?.replace(/^[\\^~]/, \"\"),\n\t\t\t};\n\t\t}\n\n\t\tcase \"file\": {\n\t\t\t// Convert glob pattern to regex for simple matching\n\t\t\tconst regex = new RegExp(\n\t\t\t\t`^${indicator.pattern\n\t\t\t\t\t.replace(/\\./g, \"\\\\.\")\n\t\t\t\t\t.replace(/\\{([^}]+)\\}/g, \"($1)\")\n\t\t\t\t\t.replace(/,/g, \"|\")\n\t\t\t\t\t.replace(/\\*\\*/g, \".*\")\n\t\t\t\t\t.replace(/\\*/g, \"[^/]*\")}$`,\n\t\t\t);\n\n\t\t\tconst match = context.filePaths.some((path) => regex.test(path));\n\t\t\treturn { match };\n\t\t}\n\n\t\tcase \"script\": {\n\t\t\tconst scripts = context.packageJson?.scripts || {};\n\t\t\tconst match = Object.values(scripts).some((script) => script.includes(indicator.pattern));\n\t\t\treturn { match };\n\t\t}\n\n\t\tcase \"config\": {\n\t\t\t// Config type would need file content checking\n\t\t\tif (context.checkFileContent) {\n\t\t\t\tconst match = await context.checkFileContent(indicator.pattern, [\"*.config.*\"]);\n\t\t\t\treturn { match };\n\t\t\t}\n\t\t\treturn { match: false };\n\t\t}\n\n\t\tdefault:\n\t\t\treturn { match: false };\n\t}\n}\n\n// =============================================================================\n// EXPORTS\n// =============================================================================\n\nexport { FRAMEWORK_CONFIGS };\n","/**\n * Gap Analyzer\n *\n * Analyzes gaps between expected patterns and detected patterns.\n * Provides recommendations for improving workspace quality.\n *\n * @module patterns/GapAnalyzer\n */\n\nimport type {\n\tExpectedPattern,\n\tFrameworkConfig,\n\tOnboardingRecommendation,\n\tPatternGap,\n\tWorkspaceProfile,\n} from \"../knowledge/types.js\";\nimport type { FoundPattern, PatternDetectionResult } from \"./types.js\";\n\n// =============================================================================\n// TYPES\n// =============================================================================\n\n/**\n * Configuration for the gap analyzer\n */\nexport interface GapAnalyzerConfig {\n\t/** Minimum coverage threshold for patterns (0-1) */\n\tcoverageThreshold?: number;\n\t/** Whether to include optional patterns in analysis */\n\tincludeOptional?: boolean;\n\t/** Framework configuration for expected patterns */\n\tframeworkConfig?: FrameworkConfig;\n}\n\n/**\n * Result from gap analysis\n */\nexport interface GapAnalysisResult {\n\t/** Gaps between expected and detected patterns */\n\tgaps: PatternGap[];\n\t/** Patterns that are well-implemented */\n\tstrengths: FoundPattern[];\n\t/** Anti-patterns detected */\n\tantiPatterns: FoundPattern[];\n\t/** Overall score (0-100) */\n\tscore: number;\n\t/** Recommendations for improvement */\n\trecommendations: OnboardingRecommendation[];\n\t/** Summary statistics */\n\tsummary: GapAnalysisSummary;\n}\n\n/**\n * Summary statistics for gap analysis\n */\nexport interface GapAnalysisSummary {\n\t/** Total expected patterns */\n\ttotalExpected: number;\n\t/** Patterns found */\n\tpatternsFound: number;\n\t/** Patterns missing */\n\tpatternsMissing: number;\n\t/** Anti-patterns found */\n\tantiPatternsFound: number;\n\t/** Critical gaps */\n\tcriticalGaps: number;\n\t/** Recommended gaps */\n\trecommendedGaps: number;\n\t/** Optional gaps */\n\toptionalGaps: number;\n}\n\n// =============================================================================\n// GAP ANALYZER\n// =============================================================================\n\n/**\n * Gap Analyzer - compares detected patterns against expectations\n *\n * @example\n * ```typescript\n * const analyzer = new GapAnalyzer({\n *   frameworkConfig: nextjsConfig,\n * });\n *\n * const result = await analyzer.analyze(detectionResult);\n * console.log(result.gaps);\n * ```\n */\nexport class GapAnalyzer {\n\tprivate readonly config: Required<GapAnalyzerConfig>;\n\n\tconstructor(config: GapAnalyzerConfig = {}) {\n\t\tthis.config = {\n\t\t\tcoverageThreshold: config.coverageThreshold ?? 0.3,\n\t\t\tincludeOptional: config.includeOptional ?? false,\n\t\t\tframeworkConfig: config.frameworkConfig as FrameworkConfig,\n\t\t};\n\t}\n\n\t/**\n\t * Analyze gaps between detected and expected patterns\n\t */\n\tanalyze(detectionResult: PatternDetectionResult, expectedPatterns?: ExpectedPattern[]): GapAnalysisResult {\n\t\t// Use framework patterns or provided patterns\n\t\tconst expected = expectedPatterns || this.config.frameworkConfig?.expectedPatterns || [];\n\n\t\t// Filter by importance if not including optional\n\t\tconst relevantExpected = this.config.includeOptional\n\t\t\t? expected\n\t\t\t: expected.filter((p) => p.importance !== \"optional\");\n\n\t\t// Identify gaps\n\t\tconst gaps = this.identifyGaps(detectionResult, relevantExpected);\n\n\t\t// Identify strengths\n\t\tconst strengths = detectionResult.foundPatterns.filter(\n\t\t\t(p) => p.isPositive && p.strength >= this.config.coverageThreshold,\n\t\t);\n\n\t\t// Identify anti-patterns\n\t\tconst antiPatterns = detectionResult.foundPatterns.filter((p) => !p.isPositive);\n\n\t\t// Calculate score\n\t\tconst score = this.calculateScore(relevantExpected, strengths, gaps, antiPatterns);\n\n\t\t// Generate recommendations\n\t\tconst recommendations = this.generateRecommendations(gaps, antiPatterns);\n\n\t\t// Create summary\n\t\tconst summary: GapAnalysisSummary = {\n\t\t\ttotalExpected: relevantExpected.length,\n\t\t\tpatternsFound: strengths.length,\n\t\t\tpatternsMissing: gaps.length,\n\t\t\tantiPatternsFound: antiPatterns.length,\n\t\t\tcriticalGaps: gaps.filter((g) => g.severity === \"critical\").length,\n\t\t\trecommendedGaps: gaps.filter((g) => g.severity === \"high\").length,\n\t\t\toptionalGaps: gaps.filter((g) => g.severity === \"medium\" || g.severity === \"low\").length,\n\t\t};\n\n\t\treturn {\n\t\t\tgaps,\n\t\t\tstrengths,\n\t\t\tantiPatterns,\n\t\t\tscore,\n\t\t\trecommendations,\n\t\t\tsummary,\n\t\t};\n\t}\n\n\t/**\n\t * Analyze a workspace profile for gaps\n\t */\n\tanalyzeWorkspace(profile: WorkspaceProfile, frameworkConfig?: FrameworkConfig): GapAnalysisResult {\n\t\tconst config = frameworkConfig || this.config.frameworkConfig;\n\n\t\tif (!config) {\n\t\t\treturn {\n\t\t\t\tgaps: [],\n\t\t\t\tstrengths: [],\n\t\t\t\tantiPatterns: [],\n\t\t\t\tscore: 0,\n\t\t\t\trecommendations: [],\n\t\t\t\tsummary: {\n\t\t\t\t\ttotalExpected: 0,\n\t\t\t\t\tpatternsFound: 0,\n\t\t\t\t\tpatternsMissing: 0,\n\t\t\t\t\tantiPatternsFound: 0,\n\t\t\t\t\tcriticalGaps: 0,\n\t\t\t\t\trecommendedGaps: 0,\n\t\t\t\t\toptionalGaps: 0,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\t// Convert workspace profile to detection result format\n\t\tconst detectionResult: PatternDetectionResult = {\n\t\t\tfoundPatterns: profile.detectedPatterns.map((p) => ({\n\t\t\t\tid: p.id,\n\t\t\t\tname: p.name,\n\t\t\t\tcategory: p.category,\n\t\t\t\tlocations: p.locations.map((loc) => ({\n\t\t\t\t\tfile: loc.file,\n\t\t\t\t\tline: loc.line ?? 0,\n\t\t\t\t\tcolumn: loc.column,\n\t\t\t\t\tsnippet: loc.snippet ?? \"\",\n\t\t\t\t\tconfidence: 1.0,\n\t\t\t\t})),\n\t\t\t\tstrength: p.strength,\n\t\t\t\tisPositive: true, // Assume positive unless we know otherwise\n\t\t\t})),\n\t\t\tmissingPatterns: [],\n\t\t\tscannedFiles: profile.structure.totalFiles,\n\t\t\tduration: 0,\n\t\t\terrors: [],\n\t\t};\n\n\t\treturn this.analyze(detectionResult, config.expectedPatterns);\n\t}\n\n\t// =========================================================================\n\t// PRIVATE METHODS\n\t// =========================================================================\n\n\tprivate identifyGaps(detection: PatternDetectionResult, expected: ExpectedPattern[]): PatternGap[] {\n\t\tconst gaps: PatternGap[] = [];\n\n\t\tfor (const pattern of expected) {\n\t\t\tconst found = detection.foundPatterns.find((p) => p.id === pattern.id);\n\n\t\t\tif (!found) {\n\t\t\t\t// Pattern completely missing\n\t\t\t\tgaps.push({\n\t\t\t\t\tpatternId: pattern.id,\n\t\t\t\t\tpatternName: pattern.name,\n\t\t\t\t\ttype: \"missing\",\n\t\t\t\t\tseverity: this.importanceToSeverity(pattern.importance),\n\t\t\t\t\tdescription: `Missing ${pattern.name}: ${pattern.description}`,\n\t\t\t\t\trecommendation: this.getRecommendation(pattern),\n\t\t\t\t\teffort: this.estimateEffort(pattern),\n\t\t\t\t\tautoFixable: false,\n\t\t\t\t});\n\t\t\t} else if (found.strength < this.config.coverageThreshold) {\n\t\t\t\t// Pattern present but weak\n\t\t\t\tgaps.push({\n\t\t\t\t\tpatternId: pattern.id,\n\t\t\t\t\tpatternName: pattern.name,\n\t\t\t\t\ttype: \"incomplete\",\n\t\t\t\t\tseverity: this.importanceToSeverity(pattern.importance),\n\t\t\t\t\tdescription: `Incomplete ${pattern.name}: Only ${Math.round(found.strength * 100)}% coverage`,\n\t\t\t\t\trecommendation: `Improve coverage of ${pattern.name}`,\n\t\t\t\t\teffort: \"small\",\n\t\t\t\t\taffectedFiles: found.locations.map((l) => l.file),\n\t\t\t\t\tautoFixable: false,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn gaps;\n\t}\n\n\tprivate importanceToSeverity(importance: ExpectedPattern[\"importance\"]): PatternGap[\"severity\"] {\n\t\tswitch (importance) {\n\t\t\tcase \"critical\":\n\t\t\t\treturn \"critical\";\n\t\t\tcase \"recommended\":\n\t\t\t\treturn \"high\";\n\t\t\tcase \"optional\":\n\t\t\t\treturn \"low\";\n\t\t}\n\t}\n\n\tprivate getRecommendation(pattern: ExpectedPattern): string {\n\t\tswitch (pattern.category) {\n\t\t\tcase \"error-handling\":\n\t\t\t\treturn `Add ${pattern.name} to handle errors gracefully`;\n\t\t\tcase \"security\":\n\t\t\t\treturn `Implement ${pattern.name} to improve security`;\n\t\t\tcase \"testing\":\n\t\t\t\treturn `Add ${pattern.name} for better test coverage`;\n\t\t\tcase \"performance\":\n\t\t\t\treturn `Optimize with ${pattern.name}`;\n\t\t\tdefault:\n\t\t\t\treturn `Implement ${pattern.name}`;\n\t\t}\n\t}\n\n\tprivate estimateEffort(pattern: ExpectedPattern): PatternGap[\"effort\"] {\n\t\t// Heuristic based on pattern type\n\t\tswitch (pattern.importance) {\n\t\t\tcase \"critical\":\n\t\t\t\treturn \"medium\";\n\t\t\tcase \"recommended\":\n\t\t\t\treturn \"small\";\n\t\t\tcase \"optional\":\n\t\t\t\treturn \"trivial\";\n\t\t}\n\t}\n\n\tprivate calculateScore(\n\t\texpected: ExpectedPattern[],\n\t\tstrengths: FoundPattern[],\n\t\tgaps: PatternGap[],\n\t\tantiPatterns: FoundPattern[],\n\t): number {\n\t\tif (expected.length === 0) {\n\t\t\treturn 100;\n\t\t}\n\n\t\t// Base score from pattern coverage\n\t\tconst coverageScore = (strengths.length / expected.length) * 100;\n\n\t\t// Penalty for critical gaps\n\t\tconst criticalPenalty = gaps.filter((g) => g.severity === \"critical\").length * 10;\n\n\t\t// Penalty for high gaps\n\t\tconst highPenalty = gaps.filter((g) => g.severity === \"high\").length * 5;\n\n\t\t// Penalty for anti-patterns\n\t\tconst antiPatternPenalty = antiPatterns.length * 8;\n\n\t\t// Calculate final score\n\t\tconst score = Math.max(0, Math.min(100, coverageScore - criticalPenalty - highPenalty - antiPatternPenalty));\n\n\t\treturn Math.round(score);\n\t}\n\n\tprivate generateRecommendations(gaps: PatternGap[], antiPatterns: FoundPattern[]): OnboardingRecommendation[] {\n\t\tconst recommendations: OnboardingRecommendation[] = [];\n\t\tlet priority = 1;\n\n\t\t// Critical gaps first\n\t\tfor (const gap of gaps.filter((g) => g.severity === \"critical\")) {\n\t\t\trecommendations.push({\n\t\t\t\tid: `gap-${gap.patternId}`,\n\t\t\t\tcategory: this.patternCategoryToRecommendationCategory(gap),\n\t\t\t\tpriority: priority++,\n\t\t\t\ttitle: `Add ${gap.patternName}`,\n\t\t\t\tdescription: gap.description,\n\t\t\t\tactions: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: \"add-pattern\",\n\t\t\t\t\t\ttarget: gap.patternId,\n\t\t\t\t\t\tdescription: gap.recommendation,\n\t\t\t\t\t\tautoApply: gap.autoFixable,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\testimatedTime: this.effortToTime(gap.effort),\n\t\t\t\thealthImpact: 15,\n\t\t\t});\n\t\t}\n\n\t\t// Anti-patterns\n\t\tfor (const antiPattern of antiPatterns) {\n\t\t\trecommendations.push({\n\t\t\t\tid: `fix-${antiPattern.id}`,\n\t\t\t\tcategory: \"pattern\",\n\t\t\t\tpriority: priority++,\n\t\t\t\ttitle: `Fix ${antiPattern.name}`,\n\t\t\t\tdescription: `Found ${antiPattern.locations.length} instances of ${antiPattern.name}`,\n\t\t\t\tactions: antiPattern.locations.slice(0, 5).map((loc) => ({\n\t\t\t\t\ttype: \"update-file\" as const,\n\t\t\t\t\ttarget: loc.file,\n\t\t\t\t\tdescription: `Fix at line ${loc.line}`,\n\t\t\t\t\tautoApply: false,\n\t\t\t\t})),\n\t\t\t\testimatedTime: `${antiPattern.locations.length * 5} minutes`,\n\t\t\t\thealthImpact: 10,\n\t\t\t});\n\t\t}\n\n\t\t// High gaps\n\t\tfor (const gap of gaps.filter((g) => g.severity === \"high\")) {\n\t\t\trecommendations.push({\n\t\t\t\tid: `gap-${gap.patternId}`,\n\t\t\t\tcategory: this.patternCategoryToRecommendationCategory(gap),\n\t\t\t\tpriority: priority++,\n\t\t\t\ttitle: `Add ${gap.patternName}`,\n\t\t\t\tdescription: gap.description,\n\t\t\t\tactions: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: \"add-pattern\",\n\t\t\t\t\t\ttarget: gap.patternId,\n\t\t\t\t\t\tdescription: gap.recommendation,\n\t\t\t\t\t\tautoApply: gap.autoFixable,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\testimatedTime: this.effortToTime(gap.effort),\n\t\t\t\thealthImpact: 8,\n\t\t\t});\n\t\t}\n\n\t\treturn recommendations;\n\t}\n\n\tprivate patternCategoryToRecommendationCategory(_gap: PatternGap): OnboardingRecommendation[\"category\"] {\n\t\t// This is a simplified mapping - in practice would need access to pattern category\n\t\treturn \"pattern\";\n\t}\n\n\tprivate effortToTime(effort: PatternGap[\"effort\"]): string {\n\t\tswitch (effort) {\n\t\t\tcase \"trivial\":\n\t\t\t\treturn \"5 minutes\";\n\t\t\tcase \"small\":\n\t\t\t\treturn \"15 minutes\";\n\t\t\tcase \"medium\":\n\t\t\t\treturn \"1 hour\";\n\t\t\tcase \"large\":\n\t\t\t\treturn \"4 hours\";\n\t\t}\n\t}\n}\n","/**\n * Error Handling Pattern Matchers\n *\n * Detects error handling patterns in the codebase.\n *\n * @module patterns/matchers/error-handling\n */\n\nimport type { PatternMatch, PatternMatcher } from \"../types.js\";\n\n/**\n * Create line-based match from regex match\n */\nfunction createMatch(content: string, filePath: string, regexMatch: RegExpExecArray, confidence = 0.9): PatternMatch {\n\tconst beforeMatch = content.slice(0, regexMatch.index);\n\tconst line = (beforeMatch.match(/\\n/g) || []).length + 1;\n\n\t// Get snippet (the matched line)\n\tconst lines = content.split(\"\\n\");\n\tconst snippet = lines[line - 1]?.trim() || regexMatch[0];\n\n\treturn {\n\t\tfile: filePath,\n\t\tline,\n\t\tsnippet: snippet.slice(0, 100),\n\t\tconfidence,\n\t};\n}\n\n/**\n * Matcher for React Error Boundaries\n */\nexport const errorBoundaryMatcher: PatternMatcher = {\n\tid: \"error-boundary\",\n\tname: \"Error Boundary\",\n\tcategory: \"error-handling\",\n\tfiles: [\"**/*.{tsx,jsx}\"],\n\tisPositive: true,\n\timportance: \"critical\",\n\tdescription: \"React Error Boundary for graceful error handling\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\t// Check for ErrorBoundary component usage\n\t\tconst patterns = [\n\t\t\t/class\\s+\\w+\\s+extends\\s+\\w*Error.*\\{[\\s\\S]*?componentDidCatch/g,\n\t\t\t/ErrorBoundary/g,\n\t\t\t/react-error-boundary/g,\n\t\t];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for try-catch blocks\n */\nexport const tryCatchMatcher: PatternMatcher = {\n\tid: \"try-catch\",\n\tname: \"Try-Catch Error Handling\",\n\tcategory: \"error-handling\",\n\tfiles: [\"**/*.{ts,tsx,js,jsx}\"],\n\tisPositive: true,\n\timportance: \"recommended\",\n\tdescription: \"Proper try-catch error handling for async operations\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\t// Look for try-catch blocks, especially with async\n\t\tconst pattern = /try\\s*\\{[\\s\\S]*?\\}\\s*catch\\s*\\(/g;\n\n\t\tlet match: RegExpExecArray | null;\n\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\tmatches.push(createMatch(content, filePath, match, 0.85));\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for Express error middleware\n */\nexport const expressErrorMiddlewareMatcher: PatternMatcher = {\n\tid: \"express-error-middleware\",\n\tname: \"Express Error Middleware\",\n\tcategory: \"error-handling\",\n\tfiles: [\"**/*.{ts,js}\"],\n\tisPositive: true,\n\timportance: \"critical\",\n\tdescription: \"Centralized error handling middleware for Express\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\t// Express error middleware signature: (err, req, res, next)\n\t\tconst patterns = [\n\t\t\t/\\(\\s*err\\s*,\\s*req\\s*,\\s*res\\s*,\\s*next\\s*\\)/g,\n\t\t\t/\\(\\s*error\\s*:\\s*\\w+\\s*,\\s*req\\s*:\\s*\\w+\\s*,\\s*res\\s*:\\s*\\w+\\s*,\\s*next\\s*:\\s*\\w+\\s*\\)/g,\n\t\t\t/errorHandler|ErrorHandler/g,\n\t\t];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for NestJS exception filters\n */\nexport const nestjsExceptionFilterMatcher: PatternMatcher = {\n\tid: \"nestjs-exception-filter\",\n\tname: \"NestJS Exception Filter\",\n\tcategory: \"error-handling\",\n\tfiles: [\"**/*.ts\"],\n\tisPositive: true,\n\timportance: \"critical\",\n\tdescription: \"NestJS exception filters for error handling\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [/@Catch\\s*\\(/g, /ExceptionFilter/g, /HttpException/g];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for unhandled promise rejections (anti-pattern)\n */\nexport const unhandledPromiseMatcher: PatternMatcher = {\n\tid: \"unhandled-promise\",\n\tname: \"Unhandled Promise\",\n\tcategory: \"error-handling\",\n\tfiles: [\"**/*.{ts,tsx,js,jsx}\"],\n\tisPositive: false, // This is an anti-pattern\n\timportance: \"critical\",\n\tdescription: \"Promises without .catch() or try-catch (potential unhandled rejection)\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\t// Look for .then() without .catch()\n\t\t// This is a simplified heuristic\n\t\tconst thenPattern = /\\.then\\s*\\([^)]+\\)(?!\\s*\\.catch)/g;\n\n\t\tlet match: RegExpExecArray | null;\n\t\twhile ((match = thenPattern.exec(content)) !== null) {\n\t\t\t// Check if there's a .catch on the same line or next\n\t\t\tconst afterMatch = content.slice(match.index);\n\t\t\tif (!afterMatch.slice(0, 200).includes(\".catch\")) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match, 0.6));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for global error handlers\n */\nexport const globalErrorHandlerMatcher: PatternMatcher = {\n\tid: \"global-error-handler\",\n\tname: \"Global Error Handler\",\n\tcategory: \"error-handling\",\n\tfiles: [\"**/*.{ts,tsx,js,jsx}\"],\n\tisPositive: true,\n\timportance: \"recommended\",\n\tdescription: \"Global error handler for uncaught exceptions\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [\n\t\t\t/process\\.on\\s*\\(\\s*['\"]uncaughtException['\"]/g,\n\t\t\t/process\\.on\\s*\\(\\s*['\"]unhandledRejection['\"]/g,\n\t\t\t/window\\.onerror/g,\n\t\t\t/window\\.addEventListener\\s*\\(\\s*['\"]error['\"]/g,\n\t\t];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * All error handling matchers\n */\nexport const errorHandlingMatchers: PatternMatcher[] = [\n\terrorBoundaryMatcher,\n\ttryCatchMatcher,\n\texpressErrorMiddlewareMatcher,\n\tnestjsExceptionFilterMatcher,\n\tunhandledPromiseMatcher,\n\tglobalErrorHandlerMatcher,\n];\n","/**\n * Performance Pattern Matchers\n *\n * Detects performance patterns and anti-patterns in the codebase.\n *\n * @module patterns/matchers/performance\n */\n\nimport type { PatternMatch, PatternMatcher } from \"../types.js\";\n\n/**\n * Create line-based match from regex match\n */\nfunction createMatch(content: string, filePath: string, regexMatch: RegExpExecArray, confidence = 0.9): PatternMatch {\n\tconst beforeMatch = content.slice(0, regexMatch.index);\n\tconst line = (beforeMatch.match(/\\n/g) || []).length + 1;\n\tconst lines = content.split(\"\\n\");\n\tconst snippet = lines[line - 1]?.trim() || regexMatch[0];\n\n\treturn {\n\t\tfile: filePath,\n\t\tline,\n\t\tsnippet: snippet.slice(0, 100),\n\t\tconfidence,\n\t};\n}\n\n/**\n * Matcher for React memoization\n */\nexport const reactMemoMatcher: PatternMatcher = {\n\tid: \"react-memo\",\n\tname: \"React Memoization\",\n\tcategory: \"performance\",\n\tfiles: [\"**/*.{tsx,jsx}\"],\n\tisPositive: true,\n\timportance: \"optional\",\n\tdescription: \"Performance optimization with React.memo, useMemo, useCallback\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [/React\\.memo\\s*\\(/g, /memo\\s*\\(/g, /useMemo\\s*\\(/g, /useCallback\\s*\\(/g];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for lazy loading\n */\nexport const lazyLoadingMatcher: PatternMatcher = {\n\tid: \"lazy-loading\",\n\tname: \"Lazy Loading\",\n\tcategory: \"performance\",\n\tfiles: [\"**/*.{tsx,jsx,ts,js}\"],\n\tisPositive: true,\n\timportance: \"recommended\",\n\tdescription: \"Code splitting with lazy loading\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [\n\t\t\t/React\\.lazy\\s*\\(/g,\n\t\t\t/lazy\\s*\\(/g,\n\t\t\t/dynamic\\s*\\(\\s*\\(\\s*\\)\\s*=>/g,\n\t\t\t/import\\s*\\(\\s*['\"][^'\"]+['\"]\\s*\\)/g,\n\t\t];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for image optimization\n */\nexport const imageOptimizationMatcher: PatternMatcher = {\n\tid: \"image-optimization\",\n\tname: \"Image Optimization\",\n\tcategory: \"performance\",\n\tfiles: [\"**/*.{tsx,jsx}\"],\n\tisPositive: true,\n\timportance: \"recommended\",\n\tdescription: \"Optimized images with next/image or similar\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [\n\t\t\t/import.*Image.*from ['\"]next\\/image['\"]/g,\n\t\t\t/import.*Image.*from ['\"]@astro\\/assets['\"]/g,\n\t\t\t/<Image[^>]+/g,\n\t\t\t/loading\\s*=\\s*['\"]lazy['\"]/g,\n\t\t];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for bundle size issues (anti-pattern)\n */\nexport const largeBundleMatcher: PatternMatcher = {\n\tid: \"large-bundle-imports\",\n\tname: \"Large Bundle Imports\",\n\tcategory: \"performance\",\n\tfiles: [\"**/*.{tsx,jsx,ts,js}\"],\n\tisPositive: false,\n\timportance: \"recommended\",\n\tdescription: \"Imports that may cause large bundle sizes\",\n\tmatch: (content, filePath) => {\n\t\t// Skip config files\n\t\tif (filePath.includes(\"config\") || filePath.includes(\".config.\")) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [\n\t\t\t/import\\s+\\*\\s+as\\s+\\w+\\s+from\\s+['\"]lodash['\"]/g,\n\t\t\t/import\\s+\\{\\s*\\}\\s+from\\s+['\"]moment['\"]/g,\n\t\t\t/import\\s+moment\\s+from\\s+['\"]moment['\"]/g,\n\t\t\t/import\\s+\\*\\s+as\\s+\\w+\\s+from\\s+['\"]rxjs['\"]/g,\n\t\t];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match, 0.7));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for caching\n */\nexport const cachingMatcher: PatternMatcher = {\n\tid: \"caching\",\n\tname: \"Data Caching\",\n\tcategory: \"performance\",\n\tfiles: [\"**/*.{ts,js}\"],\n\tisPositive: true,\n\timportance: \"recommended\",\n\tdescription: \"Caching for improved performance\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [\n\t\t\t/cache-manager/g,\n\t\t\t/@nestjs\\/cache-manager/g,\n\t\t\t/redis/g,\n\t\t\t/lru-cache/g,\n\t\t\t/quick-lru/g,\n\t\t\t/unstable_cache/g,\n\t\t\t/revalidate\\s*:/g,\n\t\t];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for async state in loops (anti-pattern)\n */\nexport const asyncInLoopMatcher: PatternMatcher = {\n\tid: \"async-in-loop\",\n\tname: \"Async Operations in Loop\",\n\tcategory: \"performance\",\n\tfiles: [\"**/*.{ts,tsx,js,jsx}\"],\n\tisPositive: false,\n\timportance: \"recommended\",\n\tdescription: \"Sequential async operations that could be parallelized\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [/for\\s*\\([^)]+\\)\\s*\\{[^}]*await\\s+/g, /\\.forEach\\s*\\(\\s*async/g];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match, 0.6));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for response compression\n */\nexport const compressionMatcher: PatternMatcher = {\n\tid: \"compression\",\n\tname: \"Response Compression\",\n\tcategory: \"performance\",\n\tfiles: [\"**/*.{ts,js}\"],\n\tisPositive: true,\n\timportance: \"recommended\",\n\tdescription: \"Gzip/Brotli compression for responses\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [/compression/g, /brotli/g, /gzip/g, /Content-Encoding/g];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * All performance matchers\n */\nexport const performanceMatchers: PatternMatcher[] = [\n\treactMemoMatcher,\n\tlazyLoadingMatcher,\n\timageOptimizationMatcher,\n\tlargeBundleMatcher,\n\tcachingMatcher,\n\tasyncInLoopMatcher,\n\tcompressionMatcher,\n];\n","/**\n * Security Pattern Matchers\n *\n * Detects security patterns and anti-patterns in the codebase.\n *\n * @module patterns/matchers/security\n */\n\nimport type { PatternMatch, PatternMatcher } from \"../types.js\";\n\n/**\n * Create line-based match from regex match\n */\nfunction createMatch(content: string, filePath: string, regexMatch: RegExpExecArray, confidence = 0.9): PatternMatch {\n\tconst beforeMatch = content.slice(0, regexMatch.index);\n\tconst line = (beforeMatch.match(/\\n/g) || []).length + 1;\n\tconst lines = content.split(\"\\n\");\n\tconst snippet = lines[line - 1]?.trim() || regexMatch[0];\n\n\treturn {\n\t\tfile: filePath,\n\t\tline,\n\t\tsnippet: snippet.slice(0, 100),\n\t\tconfidence,\n\t};\n}\n\n/**\n * Matcher for Helmet security headers\n */\nexport const helmetMatcher: PatternMatcher = {\n\tid: \"helmet-security\",\n\tname: \"Helmet Security Headers\",\n\tcategory: \"security\",\n\tfiles: [\"**/*.{ts,js}\"],\n\tisPositive: true,\n\timportance: \"critical\",\n\tdescription: \"Security headers with Helmet middleware\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [/import.*helmet/g, /require\\s*\\(\\s*['\"]helmet['\"]\\s*\\)/g, /app\\.use\\s*\\(\\s*helmet\\s*\\(/g];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for CORS configuration\n */\nexport const corsMatcher: PatternMatcher = {\n\tid: \"cors-config\",\n\tname: \"CORS Configuration\",\n\tcategory: \"security\",\n\tfiles: [\"**/*.{ts,js}\"],\n\tisPositive: true,\n\timportance: \"critical\",\n\tdescription: \"Cross-origin resource sharing configuration\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [\n\t\t\t/import.*cors/g,\n\t\t\t/require\\s*\\(\\s*['\"]cors['\"]\\s*\\)/g,\n\t\t\t/app\\.use\\s*\\(\\s*cors\\s*\\(/g,\n\t\t\t/Access-Control-Allow-Origin/g,\n\t\t];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for rate limiting\n */\nexport const rateLimitMatcher: PatternMatcher = {\n\tid: \"rate-limiting\",\n\tname: \"Rate Limiting\",\n\tcategory: \"security\",\n\tfiles: [\"**/*.{ts,js}\"],\n\tisPositive: true,\n\timportance: \"critical\",\n\tdescription: \"Request rate limiting to prevent abuse\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [\n\t\t\t/express-rate-limit/g,\n\t\t\t/rate-limiter-flexible/g,\n\t\t\t/rateLimit/g,\n\t\t\t/@nestjs\\/throttler/g,\n\t\t\t/ThrottlerModule/g,\n\t\t];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for SQL injection vulnerabilities (anti-pattern)\n */\nexport const sqlInjectionMatcher: PatternMatcher = {\n\tid: \"sql-injection-risk\",\n\tname: \"SQL Injection Risk\",\n\tcategory: \"security\",\n\tfiles: [\"**/*.{ts,js}\"],\n\tisPositive: false,\n\timportance: \"critical\",\n\tdescription: \"Potential SQL injection vulnerability (string concatenation in queries)\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\t// Look for string concatenation in SQL queries\n\t\tconst patterns = [\n\t\t\t/query\\s*\\(\\s*[`'\"].*\\$\\{/g,\n\t\t\t/execute\\s*\\(\\s*[`'\"].*\\+/g,\n\t\t\t/SELECT.*\\+.*WHERE/gi,\n\t\t\t/INSERT.*\\+.*VALUES/gi,\n\t\t];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match, 0.7));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for XSS vulnerabilities (anti-pattern)\n */\nexport const xssMatcher: PatternMatcher = {\n\tid: \"xss-risk\",\n\tname: \"XSS Risk\",\n\tcategory: \"security\",\n\tfiles: [\"**/*.{tsx,jsx}\"],\n\tisPositive: false,\n\timportance: \"critical\",\n\tdescription: \"Potential XSS vulnerability (dangerouslySetInnerHTML usage)\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst pattern = /dangerouslySetInnerHTML/g;\n\n\t\tlet match: RegExpExecArray | null;\n\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\tmatches.push(createMatch(content, filePath, match, 0.8));\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for hardcoded secrets (anti-pattern)\n */\nexport const hardcodedSecretsMatcher: PatternMatcher = {\n\tid: \"hardcoded-secrets\",\n\tname: \"Hardcoded Secrets\",\n\tcategory: \"security\",\n\tfiles: [\"**/*.{ts,tsx,js,jsx}\"],\n\tisPositive: false,\n\timportance: \"critical\",\n\tdescription: \"Potential hardcoded secrets or API keys\",\n\tmatch: (content, filePath) => {\n\t\t// Skip test files and fixtures\n\t\tif (filePath.includes(\"test\") || filePath.includes(\"fixture\") || filePath.includes(\"mock\")) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [\n\t\t\t/(api_key|apiKey|API_KEY)\\s*[:=]\\s*['\"][^'\"]{20,}['\"]/gi,\n\t\t\t/(secret|SECRET)\\s*[:=]\\s*['\"][^'\"]{16,}['\"]/gi,\n\t\t\t/(password|PASSWORD)\\s*[:=]\\s*['\"][^'\"]{8,}['\"]/gi,\n\t\t\t/sk-[a-zA-Z0-9]{24,}/g, // OpenAI keys\n\t\t\t/ghp_[a-zA-Z0-9]{36}/g, // GitHub tokens\n\t\t];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match, 0.75));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for input validation\n */\nexport const inputValidationMatcher: PatternMatcher = {\n\tid: \"input-validation\",\n\tname: \"Input Validation\",\n\tcategory: \"security\",\n\tfiles: [\"**/*.{ts,js}\"],\n\tisPositive: true,\n\timportance: \"critical\",\n\tdescription: \"Request input validation with Zod, Yup, or similar\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [\n\t\t\t/z\\.(object|string|number|array)/g,\n\t\t\t/yup\\.(object|string|number|array)/g,\n\t\t\t/@IsString|@IsNumber|@IsEmail/g,\n\t\t\t/Joi\\.(object|string|number|array)/g,\n\t\t\t/express-validator/g,\n\t\t];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for authentication guards\n */\nexport const authGuardMatcher: PatternMatcher = {\n\tid: \"auth-guard\",\n\tname: \"Authentication Guard\",\n\tcategory: \"security\",\n\tfiles: [\"**/*.{ts,tsx,js,jsx}\"],\n\tisPositive: true,\n\timportance: \"critical\",\n\tdescription: \"Authentication middleware or guards for protected routes\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [\n\t\t\t/@UseGuards/g,\n\t\t\t/AuthGuard/g,\n\t\t\t/isAuthenticated/g,\n\t\t\t/requireAuth/g,\n\t\t\t/withAuth/g,\n\t\t\t/useAuth/g,\n\t\t\t/getServerSession/g,\n\t\t\t/getToken/g,\n\t\t];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * All security matchers\n */\nexport const securityMatchers: PatternMatcher[] = [\n\thelmetMatcher,\n\tcorsMatcher,\n\trateLimitMatcher,\n\tsqlInjectionMatcher,\n\txssMatcher,\n\thardcodedSecretsMatcher,\n\tinputValidationMatcher,\n\tauthGuardMatcher,\n];\n","/**\n * Testing Pattern Matchers\n *\n * Detects testing patterns and anti-patterns in the codebase.\n *\n * @module patterns/matchers/testing\n */\n\nimport type { PatternMatch, PatternMatcher } from \"../types.js\";\n\n/**\n * Create line-based match from regex match\n */\nfunction createMatch(content: string, filePath: string, regexMatch: RegExpExecArray, confidence = 0.9): PatternMatch {\n\tconst beforeMatch = content.slice(0, regexMatch.index);\n\tconst line = (beforeMatch.match(/\\n/g) || []).length + 1;\n\tconst lines = content.split(\"\\n\");\n\tconst snippet = lines[line - 1]?.trim() || regexMatch[0];\n\n\treturn {\n\t\tfile: filePath,\n\t\tline,\n\t\tsnippet: snippet.slice(0, 100),\n\t\tconfidence,\n\t};\n}\n\n/**\n * Matcher for unit test files\n */\nexport const unitTestMatcher: PatternMatcher = {\n\tid: \"unit-tests\",\n\tname: \"Unit Tests\",\n\tcategory: \"testing\",\n\tfiles: [\"**/*.{test,spec}.{ts,tsx,js,jsx}\", \"**/__tests__/**/*.{ts,tsx,js,jsx}\"],\n\tisPositive: true,\n\timportance: \"recommended\",\n\tdescription: \"Unit test files with test assertions\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [/describe\\s*\\(/g, /it\\s*\\(/g, /test\\s*\\(/g, /expect\\s*\\(/g];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for vague assertions (anti-pattern)\n */\nexport const vagueAssertionMatcher: PatternMatcher = {\n\tid: \"vague-assertions\",\n\tname: \"Vague Assertions\",\n\tcategory: \"testing\",\n\tfiles: [\"**/*.{test,spec}.{ts,tsx,js,jsx}\", \"**/__tests__/**/*.{ts,tsx,js,jsx}\"],\n\tisPositive: false,\n\timportance: \"recommended\",\n\tdescription: \"Vague test assertions that don't provide meaningful validation\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [\n\t\t\t/\\.toBeTruthy\\s*\\(\\s*\\)/g,\n\t\t\t/\\.toBeFalsy\\s*\\(\\s*\\)/g,\n\t\t\t/\\.toBeDefined\\s*\\(\\s*\\)/g,\n\t\t\t/\\.not\\.toBeUndefined\\s*\\(\\s*\\)/g,\n\t\t\t/expect\\s*\\(\\s*true\\s*\\)/g,\n\t\t];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match, 0.8));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for integration tests\n */\nexport const integrationTestMatcher: PatternMatcher = {\n\tid: \"integration-tests\",\n\tname: \"Integration Tests\",\n\tcategory: \"testing\",\n\tfiles: [\"**/*.{test,spec}.{ts,tsx,js,jsx}\", \"**/e2e/**/*.{ts,tsx,js,jsx}\"],\n\tisPositive: true,\n\timportance: \"recommended\",\n\tdescription: \"Integration tests with API or database interactions\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [\n\t\t\t/supertest/g,\n\t\t\t/request\\s*\\(\\s*app\\s*\\)/g,\n\t\t\t/createTestClient/g,\n\t\t\t/TestingModule/g,\n\t\t\t/@nestjs\\/testing/g,\n\t\t];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for React Testing Library usage\n */\nexport const reactTestingLibraryMatcher: PatternMatcher = {\n\tid: \"react-testing-library\",\n\tname: \"React Testing Library\",\n\tcategory: \"testing\",\n\tfiles: [\"**/*.{test,spec}.{tsx,jsx}\", \"**/__tests__/**/*.{tsx,jsx}\"],\n\tisPositive: true,\n\timportance: \"recommended\",\n\tdescription: \"React component testing with Testing Library\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [\n\t\t\t/@testing-library\\/react/g,\n\t\t\t/render\\s*\\(/g,\n\t\t\t/screen\\./g,\n\t\t\t/userEvent\\./g,\n\t\t\t/fireEvent\\./g,\n\t\t\t/waitFor\\s*\\(/g,\n\t\t];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for E2E tests\n */\nexport const e2eTestMatcher: PatternMatcher = {\n\tid: \"e2e-tests\",\n\tname: \"E2E Tests\",\n\tcategory: \"testing\",\n\tfiles: [\"**/e2e/**/*.{ts,js}\", \"**/*.e2e-spec.{ts,js}\", \"**/playwright/**/*.{ts,js}\"],\n\tisPositive: true,\n\timportance: \"recommended\",\n\tdescription: \"End-to-end tests with Playwright or Cypress\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [/@playwright\\/test/g, /cypress/g, /page\\.(goto|click|fill)/g, /cy\\.(visit|get|click)/g];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for mocking\n */\nexport const mockingMatcher: PatternMatcher = {\n\tid: \"mocking\",\n\tname: \"Test Mocking\",\n\tcategory: \"testing\",\n\tfiles: [\"**/*.{test,spec}.{ts,tsx,js,jsx}\", \"**/__tests__/**/*.{ts,tsx,js,jsx}\"],\n\tisPositive: true,\n\timportance: \"optional\",\n\tdescription: \"Mocking dependencies in tests\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [\n\t\t\t/vi\\.mock\\s*\\(/g,\n\t\t\t/jest\\.mock\\s*\\(/g,\n\t\t\t/vi\\.spyOn\\s*\\(/g,\n\t\t\t/jest\\.spyOn\\s*\\(/g,\n\t\t\t/mockResolvedValue/g,\n\t\t\t/mockReturnValue/g,\n\t\t\t/msw/g,\n\t\t];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * Matcher for test coverage configuration\n */\nexport const coverageConfigMatcher: PatternMatcher = {\n\tid: \"coverage-config\",\n\tname: \"Test Coverage Configuration\",\n\tcategory: \"testing\",\n\tfiles: [\"**/vitest.config.{ts,js,mjs}\", \"**/jest.config.{ts,js,mjs}\", \"package.json\"],\n\tisPositive: true,\n\timportance: \"recommended\",\n\tdescription: \"Test coverage thresholds and configuration\",\n\tmatch: (content, filePath) => {\n\t\tconst matches: PatternMatch[] = [];\n\n\t\tconst patterns = [/coverage/g, /coverageThreshold/g, /@vitest\\/coverage/g, /collectCoverage/g];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tlet match: RegExpExecArray | null;\n\t\t\twhile ((match = pattern.exec(content)) !== null) {\n\t\t\t\tmatches.push(createMatch(content, filePath, match));\n\t\t\t}\n\t\t}\n\n\t\treturn matches;\n\t},\n};\n\n/**\n * All testing matchers\n */\nexport const testingMatchers: PatternMatcher[] = [\n\tunitTestMatcher,\n\tvagueAssertionMatcher,\n\tintegrationTestMatcher,\n\treactTestingLibraryMatcher,\n\te2eTestMatcher,\n\tmockingMatcher,\n\tcoverageConfigMatcher,\n];\n","/**\n * Pattern Matchers Index\n *\n * Exports all built-in pattern matchers.\n *\n * @module patterns/matchers\n */\n\nimport type { PatternMatcher } from \"../types.js\";\nimport { errorHandlingMatchers } from \"./error-handling.js\";\nimport { performanceMatchers } from \"./performance.js\";\nimport { securityMatchers } from \"./security.js\";\nimport { testingMatchers } from \"./testing.js\";\n\n/**\n * Create all built-in matchers\n */\nexport function createBuiltInMatchers(): PatternMatcher[] {\n\treturn [...errorHandlingMatchers, ...securityMatchers, ...testingMatchers, ...performanceMatchers];\n}\n\n// Re-export individual matcher groups\nexport { errorHandlingMatchers } from \"./error-handling.js\";\nexport { performanceMatchers } from \"./performance.js\";\nexport { securityMatchers } from \"./security.js\";\nexport { testingMatchers } from \"./testing.js\";\n","/**\n * Pattern Detector\n *\n * Detects coding patterns in a workspace using regex and AST analysis.\n *\n * @module patterns/PatternDetector\n */\n\nimport { readFile, stat } from \"node:fs/promises\";\nimport { join, relative } from \"node:path\";\nimport fastGlob from \"fast-glob\";\nimport { createBuiltInMatchers } from \"./matchers/index.js\";\nimport type {\n\tDetectionError,\n\tFoundPattern,\n\tMissingPattern,\n\tPatternDetectionResult,\n\tPatternDetectorConfig,\n\tPatternMatch,\n\tPatternMatcher,\n} from \"./types.js\";\n\n// =============================================================================\n// PATTERN DETECTOR\n// =============================================================================\n\n/**\n * Pattern Detector - analyzes codebases for coding patterns\n *\n * Supports both regex-based and AST-based pattern detection.\n *\n * @example\n * ```typescript\n * const detector = new PatternDetector({\n *   workspaceRoot: \"/path/to/project\",\n *   useAst: true,\n * });\n *\n * const result = await detector.detect();\n * console.log(result.foundPatterns);\n * ```\n */\nexport class PatternDetector {\n\tprivate readonly config: Required<PatternDetectorConfig>;\n\tprivate readonly matchers: PatternMatcher[];\n\n\tconstructor(config: PatternDetectorConfig) {\n\t\tthis.config = {\n\t\t\tworkspaceRoot: config.workspaceRoot,\n\t\t\tinclude: config.include ?? [\"**/*.{ts,tsx,js,jsx}\"],\n\t\t\texclude: config.exclude ?? [\n\t\t\t\t\"**/node_modules/**\",\n\t\t\t\t\"**/dist/**\",\n\t\t\t\t\"**/build/**\",\n\t\t\t\t\"**/.git/**\",\n\t\t\t\t\"**/*.min.js\",\n\t\t\t\t\"**/*.d.ts\",\n\t\t\t],\n\t\t\tmaxFiles: config.maxFiles ?? 1000,\n\t\t\tuseAst: config.useAst ?? false,\n\t\t\tfileTimeout: config.fileTimeout ?? 5000,\n\t\t};\n\n\t\tthis.matchers = createBuiltInMatchers();\n\t}\n\n\t/**\n\t * Add a custom pattern matcher\n\t */\n\taddMatcher(matcher: PatternMatcher): void {\n\t\tthis.matchers.push(matcher);\n\t}\n\n\t/**\n\t * Detect patterns in the workspace\n\t */\n\tasync detect(matcherIds?: string[]): Promise<PatternDetectionResult> {\n\t\tconst startTime = Date.now();\n\t\tconst errors: DetectionError[] = [];\n\n\t\t// Get files to scan\n\t\tconst files = await this.getFilesToScan();\n\n\t\t// Filter matchers if specific IDs provided\n\t\tconst matchersToRun = matcherIds ? this.matchers.filter((m) => matcherIds.includes(m.id)) : this.matchers;\n\n\t\t// Group files by pattern for efficient matching\n\t\tconst fileContents = new Map<string, string>();\n\n\t\t// Read all files\n\t\tfor (const file of files.slice(0, this.config.maxFiles)) {\n\t\t\ttry {\n\t\t\t\tconst content = await this.readFileWithTimeout(file);\n\t\t\t\tfileContents.set(file, content);\n\t\t\t} catch (error) {\n\t\t\t\terrors.push({\n\t\t\t\t\tfile: relative(this.config.workspaceRoot, file),\n\t\t\t\t\tmessage: error instanceof Error ? error.message : String(error),\n\t\t\t\t\ttype: \"read\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Run matchers\n\t\tconst foundPatterns: FoundPattern[] = [];\n\t\tconst checkedPatterns = new Set<string>();\n\n\t\tfor (const matcher of matchersToRun) {\n\t\t\tcheckedPatterns.add(matcher.id);\n\n\t\t\ttry {\n\t\t\t\tconst matches = await this.runMatcher(matcher, fileContents);\n\n\t\t\t\tif (matches.length > 0) {\n\t\t\t\t\tfoundPatterns.push({\n\t\t\t\t\t\tid: matcher.id,\n\t\t\t\t\t\tname: matcher.name,\n\t\t\t\t\t\tcategory: matcher.category,\n\t\t\t\t\t\tlocations: matches,\n\t\t\t\t\t\tstrength: this.calculateStrength(matches, fileContents.size),\n\t\t\t\t\t\tisPositive: matcher.isPositive,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\terrors.push({\n\t\t\t\t\tfile: \"N/A\",\n\t\t\t\t\tmessage: `Matcher ${matcher.id} failed: ${error instanceof Error ? error.message : String(error)}`,\n\t\t\t\t\ttype: \"unknown\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Find missing patterns\n\t\tconst missingPatterns = this.findMissingPatterns(foundPatterns, matchersToRun);\n\n\t\treturn {\n\t\t\tfoundPatterns,\n\t\t\tmissingPatterns,\n\t\t\tscannedFiles: fileContents.size,\n\t\t\tduration: Date.now() - startTime,\n\t\t\terrors,\n\t\t};\n\t}\n\n\t/**\n\t * Detect patterns in a single file\n\t */\n\tasync detectInFile(filePath: string, matcherIds?: string[]): Promise<PatternDetectionResult> {\n\t\tconst startTime = Date.now();\n\t\tconst errors: DetectionError[] = [];\n\n\t\tconst matchersToRun = matcherIds ? this.matchers.filter((m) => matcherIds.includes(m.id)) : this.matchers;\n\n\t\tlet content: string;\n\t\ttry {\n\t\t\tcontent = await readFile(filePath, \"utf-8\");\n\t\t} catch (error) {\n\t\t\treturn {\n\t\t\t\tfoundPatterns: [],\n\t\t\t\tmissingPatterns: [],\n\t\t\t\tscannedFiles: 0,\n\t\t\t\tduration: Date.now() - startTime,\n\t\t\t\terrors: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfile: filePath,\n\t\t\t\t\t\tmessage: error instanceof Error ? error.message : String(error),\n\t\t\t\t\t\ttype: \"read\",\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t};\n\t\t}\n\n\t\tconst fileContents = new Map([[filePath, content]]);\n\t\tconst foundPatterns: FoundPattern[] = [];\n\n\t\tfor (const matcher of matchersToRun) {\n\t\t\t// Check if this matcher should run on this file\n\t\t\tif (!this.matcherAppliesToFile(matcher, filePath)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst matches = await this.runMatcher(matcher, fileContents);\n\n\t\t\t\tif (matches.length > 0) {\n\t\t\t\t\tfoundPatterns.push({\n\t\t\t\t\t\tid: matcher.id,\n\t\t\t\t\t\tname: matcher.name,\n\t\t\t\t\t\tcategory: matcher.category,\n\t\t\t\t\t\tlocations: matches,\n\t\t\t\t\t\tstrength: 1.0, // Single file, so strength is binary\n\t\t\t\t\t\tisPositive: matcher.isPositive,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\terrors.push({\n\t\t\t\t\tfile: filePath,\n\t\t\t\t\tmessage: `Matcher ${matcher.id} failed: ${error instanceof Error ? error.message : String(error)}`,\n\t\t\t\t\ttype: \"unknown\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tconst missingPatterns = this.findMissingPatterns(\n\t\t\tfoundPatterns,\n\t\t\tmatchersToRun.filter((m) => this.matcherAppliesToFile(m, filePath)),\n\t\t);\n\n\t\treturn {\n\t\t\tfoundPatterns,\n\t\t\tmissingPatterns,\n\t\t\tscannedFiles: 1,\n\t\t\tduration: Date.now() - startTime,\n\t\t\terrors,\n\t\t};\n\t}\n\n\t/**\n\t * Get all registered matchers\n\t */\n\tgetMatchers(): PatternMatcher[] {\n\t\treturn [...this.matchers];\n\t}\n\n\t/**\n\t * Get matcher by ID\n\t */\n\tgetMatcher(id: string): PatternMatcher | undefined {\n\t\treturn this.matchers.find((m) => m.id === id);\n\t}\n\n\t// =========================================================================\n\t// PRIVATE METHODS\n\t// =========================================================================\n\n\tprivate async getFilesToScan(): Promise<string[]> {\n\t\tconst patterns = this.config.include.map((p) => join(this.config.workspaceRoot, p));\n\n\t\tconst files = await fastGlob(patterns, {\n\t\t\tignore: this.config.exclude,\n\t\t\tabsolute: true,\n\t\t\tonlyFiles: true,\n\t\t});\n\n\t\treturn files;\n\t}\n\n\tprivate async readFileWithTimeout(filePath: string): Promise<string> {\n\t\tconst controller = new AbortController();\n\t\tconst timeout = setTimeout(() => controller.abort(), this.config.fileTimeout);\n\n\t\ttry {\n\t\t\t// Check file size first\n\t\t\tconst stats = await stat(filePath);\n\t\t\tif (stats.size > 1024 * 1024) {\n\t\t\t\t// Skip files > 1MB\n\t\t\t\tthrow new Error(\"File too large\");\n\t\t\t}\n\n\t\t\tconst content = await readFile(filePath, { encoding: \"utf-8\" });\n\t\t\treturn content;\n\t\t} finally {\n\t\t\tclearTimeout(timeout);\n\t\t}\n\t}\n\n\tprivate async runMatcher(matcher: PatternMatcher, fileContents: Map<string, string>): Promise<PatternMatch[]> {\n\t\tconst allMatches: PatternMatch[] = [];\n\n\t\tfor (const [filePath, content] of fileContents) {\n\t\t\t// Check if this matcher applies to this file\n\t\t\tif (!this.matcherAppliesToFile(matcher, filePath)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Run the matcher\n\t\t\tconst matches = await matcher.match(content, filePath);\n\t\t\tallMatches.push(...matches);\n\t\t}\n\n\t\treturn allMatches;\n\t}\n\n\tprivate matcherAppliesToFile(matcher: PatternMatcher, filePath: string): boolean {\n\t\tconst relativePath = relative(this.config.workspaceRoot, filePath);\n\n\t\treturn matcher.files.some((pattern) => {\n\t\t\tconst regex = this.globToRegex(pattern);\n\t\t\treturn regex.test(relativePath);\n\t\t});\n\t}\n\n\tprivate globToRegex(pattern: string): RegExp {\n\t\tconst escaped = pattern\n\t\t\t.replace(/\\./g, \"\\\\.\")\n\t\t\t.replace(/\\{([^}]+)\\}/g, \"($1)\")\n\t\t\t.replace(/,/g, \"|\")\n\t\t\t.replace(/\\*\\*/g, \".*\")\n\t\t\t.replace(/\\*/g, \"[^/]*\");\n\n\t\treturn new RegExp(`^${escaped}$`);\n\t}\n\n\tprivate calculateStrength(matches: PatternMatch[], totalFiles: number): number {\n\t\tif (totalFiles === 0) {\n\t\t\treturn 0;\n\t\t}\n\n\t\t// Unique files with matches\n\t\tconst uniqueFiles = new Set(matches.map((m) => m.file)).size;\n\n\t\t// Base strength on coverage and confidence\n\t\tconst coverage = Math.min(uniqueFiles / totalFiles, 1);\n\t\tconst avgConfidence = matches.reduce((sum, m) => sum + m.confidence, 0) / matches.length;\n\n\t\t// Weighted combination\n\t\treturn coverage * 0.6 + avgConfidence * 0.4;\n\t}\n\n\tprivate findMissingPatterns(found: FoundPattern[], matchers: PatternMatcher[]): MissingPattern[] {\n\t\tconst foundIds = new Set(found.map((f) => f.id));\n\n\t\treturn matchers\n\t\t\t.filter((m) => !foundIds.has(m.id) && m.isPositive)\n\t\t\t.map((m) => ({\n\t\t\t\tid: m.id,\n\t\t\t\tname: m.name,\n\t\t\t\tcategory: m.category,\n\t\t\t\timportance: m.importance,\n\t\t\t\treason: m.description,\n\t\t\t}));\n\t}\n}\n","/**\n * Workspace Profiler\n *\n * Comprehensive workspace fingerprinting for framework detection,\n * language analysis, and context documentation discovery.\n *\n * @module fingerprint/WorkspaceProfiler\n */\n\nimport { access, constants, readFile, stat } from \"node:fs/promises\";\nimport { extname, join } from \"node:path\";\nimport fastGlob from \"fast-glob\";\nimport { detectPrimaryFramework, type FrameworkDetectionContext, getFramework } from \"../knowledge/registry.js\";\nimport type {\n\tDetectedFramework,\n\tDetectedLanguage,\n\tDetectedPattern,\n\tExistingContext,\n\tExistingContextFile,\n\tPackageManagerInfo,\n\tProjectStructure,\n\tWorkspaceProfile,\n} from \"../knowledge/types.js\";\nimport { GapAnalyzer } from \"../patterns/GapAnalyzer.js\";\nimport { PatternDetector } from \"../patterns/PatternDetector.js\";\n\n// =============================================================================\n// TYPES\n// =============================================================================\n\n/**\n * Configuration for workspace profiling\n */\nexport interface WorkspaceProfilerConfig {\n\t/** Workspace root directory */\n\tworkspaceRoot: string;\n\t/** Whether to run pattern detection (slower but more complete) */\n\tdetectPatterns?: boolean;\n\t/** Maximum files to scan for language detection */\n\tmaxFilesForLanguageDetection?: number;\n\t/** Directories to skip */\n\tskipDirectories?: string[];\n\t/** Whether to include hidden files */\n\tincludeHidden?: boolean;\n}\n\n// =============================================================================\n// WORKSPACE PROFILER\n// =============================================================================\n\n/**\n * Workspace Profiler - comprehensive workspace analysis\n *\n * @example\n * ```typescript\n * const profiler = new WorkspaceProfiler({\n *   workspaceRoot: \"/path/to/project\",\n *   detectPatterns: true,\n * });\n *\n * const profile = await profiler.analyze();\n * console.log(profile.framework);\n * console.log(profile.gaps);\n * ```\n */\nexport class WorkspaceProfiler {\n\tprivate readonly config: Required<WorkspaceProfilerConfig>;\n\n\tconstructor(config: WorkspaceProfilerConfig) {\n\t\tthis.config = {\n\t\t\tworkspaceRoot: config.workspaceRoot,\n\t\t\tdetectPatterns: config.detectPatterns ?? true,\n\t\t\tmaxFilesForLanguageDetection: config.maxFilesForLanguageDetection ?? 5000,\n\t\t\tskipDirectories: config.skipDirectories ?? [\n\t\t\t\t\"node_modules\",\n\t\t\t\t\".git\",\n\t\t\t\t\"dist\",\n\t\t\t\t\"build\",\n\t\t\t\t\".next\",\n\t\t\t\t\".nuxt\",\n\t\t\t\t\"coverage\",\n\t\t\t\t\".cache\",\n\t\t\t],\n\t\t\tincludeHidden: config.includeHidden ?? false,\n\t\t};\n\t}\n\n\t/**\n\t * Analyze the workspace and create a complete profile\n\t */\n\tasync analyze(): Promise<WorkspaceProfile> {\n\t\t// Run analyses in parallel where possible\n\t\tconst [packageJson, filePaths, packageManager, existingContext] = await Promise.all([\n\t\t\tthis.readPackageJson(),\n\t\t\tthis.getFilePaths(),\n\t\t\tthis.detectPackageManager(),\n\t\t\tthis.analyzeExistingContext(),\n\t\t]);\n\n\t\t// Detect framework\n\t\tconst framework = await this.detectFramework(packageJson, filePaths);\n\n\t\t// Analyze languages\n\t\tconst languages = await this.analyzeLanguages(filePaths);\n\n\t\t// Analyze project structure\n\t\tconst structure = await this.analyzeStructure(filePaths);\n\n\t\t// Detect patterns (if enabled)\n\t\tlet detectedPatterns: DetectedPattern[] = [];\n\t\tif (this.config.detectPatterns) {\n\t\t\tdetectedPatterns = await this.detectPatterns();\n\t\t}\n\n\t\t// Get framework config for gap analysis\n\t\tconst frameworkConfig = getFramework(framework.id);\n\n\t\t// Analyze gaps\n\t\tconst gaps = frameworkConfig\n\t\t\t? new GapAnalyzer({ frameworkConfig }).analyzeWorkspace({\n\t\t\t\t\troot: this.config.workspaceRoot,\n\t\t\t\t\tframework,\n\t\t\t\t\tlanguages,\n\t\t\t\t\tpackageManager,\n\t\t\t\t\tstructure,\n\t\t\t\t\texistingContext,\n\t\t\t\t\tdetectedPatterns,\n\t\t\t\t\tgaps: [],\n\t\t\t\t\thealthScore: 0,\n\t\t\t\t\tcreatedAt: new Date().toISOString(),\n\t\t\t\t}).gaps\n\t\t\t: [];\n\n\t\t// Calculate health score\n\t\tconst healthScore = this.calculateHealthScore(existingContext, detectedPatterns, gaps, framework);\n\n\t\treturn {\n\t\t\troot: this.config.workspaceRoot,\n\t\t\tframework,\n\t\t\tlanguages,\n\t\t\tpackageManager,\n\t\t\tstructure,\n\t\t\texistingContext,\n\t\t\tdetectedPatterns,\n\t\t\tgaps,\n\t\t\thealthScore,\n\t\t\tcreatedAt: new Date().toISOString(),\n\t\t};\n\t}\n\n\t/**\n\t * Quick scan for framework and basic info only\n\t */\n\tasync quickScan(): Promise<Pick<WorkspaceProfile, \"framework\" | \"packageManager\" | \"languages\">> {\n\t\tconst [packageJson, filePaths, packageManager] = await Promise.all([\n\t\t\tthis.readPackageJson(),\n\t\t\tthis.getFilePaths(),\n\t\t\tthis.detectPackageManager(),\n\t\t]);\n\n\t\tconst framework = await this.detectFramework(packageJson, filePaths);\n\t\tconst languages = await this.analyzeLanguages(filePaths);\n\n\t\treturn {\n\t\t\tframework,\n\t\t\tpackageManager,\n\t\t\tlanguages,\n\t\t};\n\t}\n\n\t// =========================================================================\n\t// PRIVATE METHODS\n\t// =========================================================================\n\n\tprivate async readPackageJson(): Promise<Record<string, unknown> | null> {\n\t\tconst packageJsonPath = join(this.config.workspaceRoot, \"package.json\");\n\n\t\ttry {\n\t\t\tconst content = await readFile(packageJsonPath, \"utf-8\");\n\t\t\treturn JSON.parse(content);\n\t\t} catch {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tprivate async getFilePaths(): Promise<string[]> {\n\t\tconst ignorePatterns = this.config.skipDirectories.map((dir) => `**/${dir}/**`);\n\n\t\tconst files = await fastGlob(\"**/*\", {\n\t\t\tcwd: this.config.workspaceRoot,\n\t\t\tignore: ignorePatterns,\n\t\t\tonlyFiles: true,\n\t\t\tdot: this.config.includeHidden,\n\t\t});\n\n\t\treturn files.slice(0, this.config.maxFilesForLanguageDetection);\n\t}\n\n\tprivate async detectFramework(\n\t\tpackageJson: Record<string, unknown> | null,\n\t\tfilePaths: string[],\n\t): Promise<DetectedFramework> {\n\t\tconst context: FrameworkDetectionContext = {\n\t\t\tpackageJson: packageJson as FrameworkDetectionContext[\"packageJson\"],\n\t\t\tfilePaths,\n\t\t\tcheckFileContent: async (pattern, files) => {\n\t\t\t\t// Simplified file content check\n\t\t\t\tfor (const file of filePaths) {\n\t\t\t\t\tif (files.some((f) => file.match(new RegExp(f.replace(\"*\", \".*\"))))) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst content = await readFile(join(this.config.workspaceRoot, file), \"utf-8\");\n\t\t\t\t\t\t\tif (content.includes(pattern)) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t// Skip unreadable files\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t};\n\n\t\treturn detectPrimaryFramework(context);\n\t}\n\n\tprivate async detectPackageManager(): Promise<PackageManagerInfo> {\n\t\tconst checks: Array<{\n\t\t\tfile: string;\n\t\t\tname: PackageManagerInfo[\"name\"];\n\t\t}> = [\n\t\t\t{ file: \"pnpm-lock.yaml\", name: \"pnpm\" },\n\t\t\t{ file: \"yarn.lock\", name: \"yarn\" },\n\t\t\t{ file: \"bun.lockb\", name: \"bun\" },\n\t\t\t{ file: \"package-lock.json\", name: \"npm\" },\n\t\t];\n\n\t\tfor (const { file, name } of checks) {\n\t\t\ttry {\n\t\t\t\tawait access(join(this.config.workspaceRoot, file), constants.F_OK);\n\t\t\t\treturn {\n\t\t\t\t\tname,\n\t\t\t\t\tlockfile: file,\n\t\t\t\t};\n\t\t\t} catch {\n\t\t\t\t// Continue checking\n\t\t\t}\n\t\t}\n\n\t\treturn { name: \"unknown\" };\n\t}\n\n\tprivate async analyzeLanguages(filePaths: string[]): Promise<DetectedLanguage[]> {\n\t\tconst languageMap: Record<string, { extensions: Set<string>; count: number }> = {};\n\n\t\t// Extension to language mapping\n\t\tconst extensionToLanguage: Record<string, string> = {\n\t\t\t\".ts\": \"TypeScript\",\n\t\t\t\".tsx\": \"TypeScript\",\n\t\t\t\".js\": \"JavaScript\",\n\t\t\t\".jsx\": \"JavaScript\",\n\t\t\t\".mjs\": \"JavaScript\",\n\t\t\t\".cjs\": \"JavaScript\",\n\t\t\t\".py\": \"Python\",\n\t\t\t\".rb\": \"Ruby\",\n\t\t\t\".go\": \"Go\",\n\t\t\t\".rs\": \"Rust\",\n\t\t\t\".java\": \"Java\",\n\t\t\t\".kt\": \"Kotlin\",\n\t\t\t\".swift\": \"Swift\",\n\t\t\t\".php\": \"PHP\",\n\t\t\t\".cs\": \"C#\",\n\t\t\t\".cpp\": \"C++\",\n\t\t\t\".c\": \"C\",\n\t\t\t\".vue\": \"Vue\",\n\t\t\t\".svelte\": \"Svelte\",\n\t\t\t\".astro\": \"Astro\",\n\t\t\t\".md\": \"Markdown\",\n\t\t\t\".mdx\": \"MDX\",\n\t\t\t\".css\": \"CSS\",\n\t\t\t\".scss\": \"SCSS\",\n\t\t\t\".less\": \"LESS\",\n\t\t\t\".html\": \"HTML\",\n\t\t\t\".json\": \"JSON\",\n\t\t\t\".yaml\": \"YAML\",\n\t\t\t\".yml\": \"YAML\",\n\t\t};\n\n\t\tfor (const file of filePaths) {\n\t\t\tconst ext = extname(file).toLowerCase();\n\t\t\tconst language = extensionToLanguage[ext];\n\n\t\t\tif (language) {\n\t\t\t\tif (!languageMap[language]) {\n\t\t\t\t\tlanguageMap[language] = { extensions: new Set(), count: 0 };\n\t\t\t\t}\n\t\t\t\tlanguageMap[language].extensions.add(ext);\n\t\t\t\tlanguageMap[language].count++;\n\t\t\t}\n\t\t}\n\n\t\tconst totalFiles = filePaths.length;\n\t\tconst languages: DetectedLanguage[] = Object.entries(languageMap)\n\t\t\t.map(([name, data]) => ({\n\t\t\t\tname,\n\t\t\t\tpercentage: Math.round((data.count / totalFiles) * 100),\n\t\t\t\tfileCount: data.count,\n\t\t\t\textensions: Array.from(data.extensions),\n\t\t\t}))\n\t\t\t.sort((a, b) => b.fileCount - a.fileCount);\n\n\t\treturn languages;\n\t}\n\n\tprivate async analyzeStructure(filePaths: string[]): Promise<ProjectStructure> {\n\t\tconst sourceDirectories = new Set<string>();\n\t\tconst testDirectories = new Set<string>();\n\t\tconst configFiles: string[] = [];\n\n\t\t// Check for monorepo indicators\n\t\tlet isMonorepo = false;\n\t\tlet monorepoTool: ProjectStructure[\"monorepoTool\"];\n\n\t\t// Check monorepo files\n\t\tconst monorepoChecks: Array<{\n\t\t\tfile: string;\n\t\t\ttool: ProjectStructure[\"monorepoTool\"];\n\t\t}> = [\n\t\t\t{ file: \"turbo.json\", tool: \"turborepo\" },\n\t\t\t{ file: \"nx.json\", tool: \"nx\" },\n\t\t\t{ file: \"lerna.json\", tool: \"lerna\" },\n\t\t\t{ file: \"pnpm-workspace.yaml\", tool: \"pnpm-workspaces\" },\n\t\t];\n\n\t\tfor (const { file, tool } of monorepoChecks) {\n\t\t\ttry {\n\t\t\t\tawait access(join(this.config.workspaceRoot, file), constants.F_OK);\n\t\t\t\tisMonorepo = true;\n\t\t\t\tmonorepoTool = tool;\n\t\t\t\tbreak;\n\t\t\t} catch {\n\t\t\t\t// Continue\n\t\t\t}\n\t\t}\n\n\t\t// Analyze file paths\n\t\tfor (const file of filePaths) {\n\t\t\tconst parts = file.split(\"/\");\n\t\t\tconst firstDir = parts[0];\n\n\t\t\t// Source directories\n\t\t\tif ([\"src\", \"lib\", \"app\", \"apps\", \"packages\", \"components\"].includes(firstDir)) {\n\t\t\t\tsourceDirectories.add(firstDir);\n\t\t\t}\n\n\t\t\t// Test directories\n\t\t\tif ([\"test\", \"tests\", \"__tests__\", \"e2e\", \"spec\"].includes(firstDir)) {\n\t\t\t\ttestDirectories.add(firstDir);\n\t\t\t}\n\n\t\t\t// Config files at root\n\t\t\tif (parts.length === 1 && (file.includes(\"config\") || file.includes(\"rc\") || file.startsWith(\".\"))) {\n\t\t\t\tconfigFiles.push(file);\n\t\t\t}\n\t\t}\n\n\t\t// Estimate lines of code (rough heuristic)\n\t\tconst codeExtensions = [\".ts\", \".tsx\", \".js\", \".jsx\", \".py\", \".go\", \".rs\"];\n\t\tconst codeFiles = filePaths.filter((f) => codeExtensions.includes(extname(f).toLowerCase()));\n\t\tconst totalLinesEstimate = codeFiles.length * 100; // Rough estimate\n\n\t\treturn {\n\t\t\tisMonorepo,\n\t\t\tmonorepoTool,\n\t\t\tsourceDirectories: Array.from(sourceDirectories),\n\t\t\ttestDirectories: Array.from(testDirectories),\n\t\t\tconfigFiles: configFiles.slice(0, 20), // Limit config files\n\t\t\ttotalFiles: filePaths.length,\n\t\t\ttotalLinesEstimate,\n\t\t};\n\t}\n\n\tprivate async analyzeExistingContext(): Promise<ExistingContext> {\n\t\tconst contextDirs = [\".llm-context\", \".ai-context\", \"ai_dev_utils\", \"docs/llm\"];\n\t\tlet contextPath: string | undefined;\n\t\tlet hasContextDirectory = false;\n\n\t\t// Find context directory\n\t\tfor (const dir of contextDirs) {\n\t\t\ttry {\n\t\t\t\tawait access(join(this.config.workspaceRoot, dir), constants.F_OK);\n\t\t\t\thasContextDirectory = true;\n\t\t\t\tcontextPath = dir;\n\t\t\t\tbreak;\n\t\t\t} catch {\n\t\t\t\t// Continue\n\t\t\t}\n\t\t}\n\n\t\tif (!hasContextDirectory || !contextPath) {\n\t\t\treturn {\n\t\t\t\thasContextDirectory: false,\n\t\t\t\tfiles: [],\n\t\t\t\tqualityScore: 0,\n\t\t\t};\n\t\t}\n\n\t\t// Analyze context files\n\t\tconst contextFiles: ExistingContextFile[] = [];\n\t\tconst fullContextPath = join(this.config.workspaceRoot, contextPath);\n\n\t\ttry {\n\t\t\tconst files = await fastGlob(\"**/*.md\", {\n\t\t\t\tcwd: fullContextPath,\n\t\t\t\tonlyFiles: true,\n\t\t\t});\n\n\t\t\tfor (const file of files) {\n\t\t\t\tconst filePath = join(fullContextPath, file);\n\n\t\t\t\ttry {\n\t\t\t\t\tconst [stats, content] = await Promise.all([stat(filePath), readFile(filePath, \"utf-8\")]);\n\n\t\t\t\t\tconst sections = this.extractSections(content);\n\t\t\t\t\tconst quality = this.assessFileQuality(content, sections);\n\n\t\t\t\t\tcontextFiles.push({\n\t\t\t\t\t\tpath: join(contextPath, file),\n\t\t\t\t\t\tsize: stats.size,\n\t\t\t\t\t\tlastModified: stats.mtime.toISOString(),\n\t\t\t\t\t\tsections,\n\t\t\t\t\t\tquality,\n\t\t\t\t\t});\n\t\t\t\t} catch {\n\t\t\t\t\t// Skip unreadable files\n\t\t\t\t}\n\t\t\t}\n\t\t} catch {\n\t\t\t// Context directory not readable\n\t\t}\n\n\t\t// Calculate overall quality score\n\t\tconst qualityScore = this.calculateContextQuality(contextFiles);\n\n\t\treturn {\n\t\t\thasContextDirectory,\n\t\t\tcontextPath,\n\t\t\tfiles: contextFiles,\n\t\t\tqualityScore,\n\t\t};\n\t}\n\n\tprivate extractSections(content: string): string[] {\n\t\tconst headingPattern = /^#{1,3}\\s+(.+)$/gm;\n\t\tconst sections: string[] = [];\n\n\t\tlet match: RegExpExecArray | null;\n\t\twhile ((match = headingPattern.exec(content)) !== null) {\n\t\t\tsections.push(match[1].trim());\n\t\t}\n\n\t\treturn sections;\n\t}\n\n\tprivate assessFileQuality(content: string, sections: string[]): ExistingContextFile[\"quality\"] {\n\t\tif (content.trim().length === 0) {\n\t\t\treturn \"empty\";\n\t\t}\n\n\t\tif (content.length < 100 || sections.length < 2) {\n\t\t\treturn \"needs-improvement\";\n\t\t}\n\n\t\t// Check for placeholder content\n\t\tconst placeholderPatterns = [/TODO/i, /FIXME/i, /\\[.*\\]/, /<.*>/];\n\n\t\tconst hasPlaceholders = placeholderPatterns.some((p) => p.test(content));\n\n\t\tif (hasPlaceholders && content.length < 500) {\n\t\t\treturn \"needs-improvement\";\n\t\t}\n\n\t\t// Check age (if possible to determine from content)\n\t\t// For now, assume good if it has content and sections\n\t\treturn \"good\";\n\t}\n\n\tprivate calculateContextQuality(files: ExistingContextFile[]): number {\n\t\tif (files.length === 0) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tconst qualityScores: Record<ExistingContextFile[\"quality\"], number> = {\n\t\t\tgood: 100,\n\t\t\t\"needs-improvement\": 50,\n\t\t\toutdated: 30,\n\t\t\tempty: 0,\n\t\t};\n\n\t\tconst total = files.reduce((sum, file) => sum + qualityScores[file.quality], 0);\n\n\t\treturn Math.round(total / files.length);\n\t}\n\n\tprivate async detectPatterns(): Promise<DetectedPattern[]> {\n\t\tconst detector = new PatternDetector({\n\t\t\tworkspaceRoot: this.config.workspaceRoot,\n\t\t\tuseAst: false, // Use regex for speed\n\t\t\tmaxFiles: 500,\n\t\t});\n\n\t\tconst result = await detector.detect();\n\n\t\t// Convert to DetectedPattern format\n\t\treturn result.foundPatterns\n\t\t\t.filter((p) => p.isPositive)\n\t\t\t.map((p) => ({\n\t\t\t\tid: p.id,\n\t\t\t\tname: p.name,\n\t\t\t\tcategory: p.category,\n\t\t\t\tlocations: p.locations,\n\t\t\t\tstrength: p.strength,\n\t\t\t}));\n\t}\n\n\tprivate calculateHealthScore(\n\t\tcontext: ExistingContext,\n\t\tpatterns: DetectedPattern[],\n\t\tgaps: WorkspaceProfile[\"gaps\"],\n\t\tframework: DetectedFramework,\n\t): number {\n\t\tlet score = 50; // Base score\n\n\t\t// Context documentation (up to +20)\n\t\tif (context.hasContextDirectory) {\n\t\t\tscore += 10;\n\t\t\tscore += Math.min(10, context.qualityScore / 10);\n\t\t}\n\n\t\t// Pattern coverage (up to +20)\n\t\tconst patternScore = patterns.length * 2;\n\t\tscore += Math.min(20, patternScore);\n\n\t\t// Gap penalties\n\t\tconst criticalGaps = gaps.filter((g) => g.severity === \"critical\").length;\n\t\tconst highGaps = gaps.filter((g) => g.severity === \"high\").length;\n\t\tscore -= criticalGaps * 10;\n\t\tscore -= highGaps * 5;\n\n\t\t// Framework detection bonus\n\t\tif (framework.confidence > 0.8) {\n\t\t\tscore += 5;\n\t\t}\n\n\t\treturn Math.max(0, Math.min(100, Math.round(score)));\n\t}\n}\n","/**\n * Learning Types\n *\n * Types for the learning engine, feedback loop, and violation tracking.\n */\n\n/**\n * Logged AI interaction for analysis\n */\nexport interface Interaction {\n\tid: string;\n\ttimestamp: string;\n\tquery: string;\n\tcontextUsed: string[];\n\ttoolsCalled: string[];\n\toutput: string;\n\tvalidationPassed?: boolean;\n\tconfidence?: number;\n\thumanFeedback?: HumanFeedback;\n}\n\n/**\n * Human feedback on an interaction\n */\nexport interface HumanFeedback {\n\tcorrect: boolean;\n\tconfidence: number;\n\tcorrections?: string[];\n\ttimeSpent?: number;\n\ttimestamp: string;\n}\n\n/**\n * Input for recording feedback (without timestamp)\n */\nexport type FeedbackInput = Omit<HumanFeedback, \"timestamp\">;\n\n/**\n * Perfect interaction added to golden dataset\n */\nexport interface GoldenExample {\n\tid: string;\n\tqueryType: QueryType;\n\tquery: string;\n\toutput: string;\n\tcontextUsed: string[];\n\taddedAt: string;\n}\n\n/**\n * Query types for classification\n */\nexport type QueryType =\n\t| \"authentication\"\n\t| \"testing\"\n\t| \"api\"\n\t| \"database\"\n\t| \"ui\"\n\t| \"vscode\"\n\t| \"mcp\"\n\t| \"performance\"\n\t| \"architecture\"\n\t| \"general\";\n\n/**\n * Keywords for query classification\n */\nexport const QUERY_TYPE_KEYWORDS: Record<QueryType, string[]> = {\n\tauthentication: [\"auth\", \"login\", \"session\", \"token\", \"api-key\", \"verify\"],\n\ttesting: [\"test\", \"vitest\", \"coverage\", \"mock\", \"spec\", \"assertion\"],\n\tapi: [\"endpoint\", \"route\", \"handler\", \"request\", \"response\", \"http\"],\n\tdatabase: [\"db\", \"query\", \"sql\", \"drizzle\", \"migration\", \"schema\"],\n\tui: [\"component\", \"react\", \"css\", \"style\", \"layout\", \"render\"],\n\tvscode: [\"extension\", \"command\", \"webview\", \"activation\", \"disposable\"],\n\tmcp: [\"mcp\", \"tool\", \"server\", \"protocol\", \"context\"],\n\tperformance: [\"perf\", \"slow\", \"timeout\", \"budget\", \"latency\", \"optimize\"],\n\tarchitecture: [\"layer\", \"pattern\", \"structure\", \"boundary\", \"module\"],\n\tgeneral: [],\n};\n\n/**\n * Learning engine statistics\n */\nexport interface LearningStats {\n\ttotalInteractions: number;\n\tfeedbackReceived: number;\n\tcorrectRate: number;\n\tgoldenExamples: number;\n\tqueryTypeBreakdown: Record<QueryType, number>;\n}\n\n/**\n * Recorded violation for tracking\n */\nexport interface Violation {\n\tid: string;\n\ttype: string;\n\tfile: string;\n\tcontext?: string;\n\twhatHappened: string;\n\twhyItHappened: string;\n\tprevention: string;\n\twrongExample?: string;\n\tcorrectExample?: string;\n\tdetectionRule?: string;\n\ttimestamp: string;\n\tcount: number;\n\tpromotedAt?: string | null;\n\tautomatedAt?: string | null;\n}\n\n/**\n * Input for reporting a violation\n */\nexport interface ViolationInput {\n\ttype: string;\n\tfile: string;\n\tmessage: string;\n\treason: string;\n\tprevention: string;\n\twrongExample?: string;\n\tcorrectExample?: string;\n}\n\n/**\n * Status after reporting a violation\n */\nexport interface ViolationStatus {\n\tid: string;\n\tcount: number;\n\tshouldPromote: boolean;\n\tshouldAutomate: boolean;\n}\n\n/**\n * Summary of all violations\n */\nexport interface ViolationsSummary {\n\ttotal: number;\n\tbyType: Array<{\n\t\ttype: string;\n\t\tcount: number;\n\t\tstatus: \"tracking\" | \"ready_for_promotion\" | \"ready_for_automation\" | \"promoted\" | \"automated\";\n\t}>;\n\treadyForPromotion: string[];\n\treadyForAutomation: string[];\n}\n\n/**\n * Thresholds for violation promotion\n */\nexport const PROMOTION_THRESHOLDS = {\n\tPROMOTE_TO_PATTERN: 3,\n\tADD_AUTOMATION: 5,\n} as const;\n\n/**\n * Learning tier classification for tiered storage architecture\n * - hot: Always loaded (~10-15 entries, critical patterns)\n * - warm: Loaded based on intent/domain match (~20-30 per domain)\n * - cold: Query-only, never auto-loaded (archived learnings)\n */\nexport type LearningTier = \"hot\" | \"warm\" | \"cold\";\n\n/**\n * Learning priority for tier promotion\n */\nexport type LearningPriority = \"critical\" | \"high\" | \"medium\" | \"low\";\n\n/**\n * Recorded learning from a session\n */\nexport interface Learning {\n\tid: string;\n\ttype: LearningType;\n\ttrigger: string | string[];\n\tcontext?: string;\n\tproblem?: string;\n\tsolution: string;\n\taction: string;\n\trelated?: string[];\n\tsource: string;\n\ttimestamp: string;\n\n\t// Tiering metadata (optional for backward compatibility)\n\t/** Tier classification for loading strategy */\n\ttier?: LearningTier;\n\t/** Domain category (e.g., 'testing', 'vscode', 'architecture') */\n\tdomain?: string;\n\t/** Priority for tier promotion decisions */\n\tpriority?: LearningPriority;\n\t/** Keywords for improved matching */\n\tkeywords?: string[];\n\n\t// Usage tracking for auto-promotion/demotion\n\t/** Times this learning was surfaced to LLM */\n\taccessCount?: number;\n\t/** Last time this learning was accessed */\n\tlastAccessed?: string;\n\t/** Relevance score (0-1, decreases over time) */\n\trelevanceScore?: number;\n\t/** Date when learning was applied/marked complete */\n\tappliedDate?: string;\n}\n\n/**\n * Types of learnings\n */\nexport type LearningType =\n\t| \"pattern\"\n\t| \"pitfall\"\n\t| \"architecture\"\n\t| \"performance\"\n\t| \"efficiency\"\n\t| \"discovery\"\n\t| \"workflow\";\n\n/**\n * Input for recording a learning\n */\nexport interface LearningInput {\n\ttype: LearningType;\n\ttrigger: string;\n\taction: string;\n\tsource: string;\n}\n","/**\n * Learning Engine\n *\n * Feedback loop for continuous learning:\n * - Interaction logging for analysis\n * - Human feedback recording\n * - Golden dataset building (5+ perfect examples  context promotion)\n * - Query classification for pattern matching\n *\n * Accuracy Impact:\n * - Day 1: 60% accuracy\n * - Month 2: 95% accuracy (via continuous learning)\n */\n\nimport * as path from \"node:path\";\nimport { appendJsonl, generateId, loadJsonl, writeJsonl } from \"../storage/JsonlStore.js\";\nimport type { ResolvedConfig } from \"../types/config.js\";\nimport type {\n\tFeedbackInput,\n\tGoldenExample,\n\tInteraction,\n\tLearning,\n\tLearningInput,\n\tLearningStats,\n\tQueryType,\n} from \"../types/learning.js\";\nimport { QUERY_TYPE_KEYWORDS } from \"../types/learning.js\";\n\n/**\n * Learning Engine for feedback loop and golden dataset\n */\nexport class LearningEngine {\n\tprivate interactionsPath: string;\n\tprivate goldenPath: string;\n\tprivate learningsPath: string;\n\n\tconstructor(config: ResolvedConfig) {\n\t\tthis.interactionsPath = path.join(config.rootDir, config.learningsDir, \"interactions.jsonl\");\n\t\tthis.goldenPath = path.join(config.rootDir, config.learningsDir, \"golden.jsonl\");\n\t\tthis.learningsPath = path.join(config.rootDir, config.learningsDir, \"learnings.jsonl\");\n\t}\n\n\t/**\n\t * Log an interaction for analysis\n\t */\n\tasync logInteraction(data: {\n\t\tquery: string;\n\t\tcontextUsed: string[];\n\t\ttoolsCalled: string[];\n\t\toutput: string;\n\t\tvalidationPassed?: boolean;\n\t\tconfidence?: number;\n\t}): Promise<Interaction> {\n\t\tconst interaction: Interaction = {\n\t\t\tid: generateId(\"INT\"),\n\t\t\ttimestamp: new Date().toISOString(),\n\t\t\t...data,\n\t\t};\n\n\t\tappendJsonl(this.interactionsPath, interaction);\n\n\t\treturn interaction;\n\t}\n\n\t/**\n\t * Record human feedback on an interaction\n\t */\n\tasync recordFeedback(\n\t\tinteractionId: string,\n\t\tfeedback: FeedbackInput,\n\t): Promise<{ updated: boolean; addedToGolden: boolean }> {\n\t\tconst interactions = loadJsonl<Interaction>(this.interactionsPath);\n\t\tconst interaction = interactions.find((i) => i.id === interactionId);\n\n\t\tif (!interaction) {\n\t\t\treturn { updated: false, addedToGolden: false };\n\t\t}\n\n\t\t// Add feedback with timestamp\n\t\tinteraction.humanFeedback = {\n\t\t\t...feedback,\n\t\t\ttimestamp: new Date().toISOString(),\n\t\t};\n\n\t\t// Rewrite file with updated interaction\n\t\tawait writeJsonl(this.interactionsPath, interactions);\n\n\t\t// If correct with high confidence, add to golden dataset\n\t\tlet addedToGolden = false;\n\t\tif (feedback.correct && feedback.confidence >= 0.9) {\n\t\t\tawait this.addToGoldenDataset(interaction);\n\t\t\taddedToGolden = true;\n\t\t}\n\n\t\treturn { updated: true, addedToGolden };\n\t}\n\n\t/**\n\t * Add a perfect interaction to golden dataset\n\t */\n\tprivate async addToGoldenDataset(interaction: Interaction): Promise<void> {\n\t\tconst queryType = this.classifyQueryType(interaction.query);\n\n\t\tconst goldenExample: GoldenExample = {\n\t\t\tid: interaction.id,\n\t\t\tqueryType,\n\t\t\tquery: interaction.query,\n\t\t\toutput: interaction.output,\n\t\t\tcontextUsed: interaction.contextUsed,\n\t\t\taddedAt: new Date().toISOString(),\n\t\t};\n\n\t\tappendJsonl(this.goldenPath, goldenExample);\n\n\t\t// Check if we have enough examples to promote to context\n\t\tawait this.checkGoldenPromotion(queryType);\n\t}\n\n\t/**\n\t * Check if query type has enough golden examples to promote\n\t * Returns true if promotion threshold (5+) is reached\n\t */\n\tprivate async checkGoldenPromotion(queryType: QueryType): Promise<boolean> {\n\t\tconst golden = loadJsonl<GoldenExample>(this.goldenPath);\n\t\tconst forType = golden.filter((g) => g.queryType === queryType);\n\n\t\treturn forType.length >= 5;\n\t}\n\n\t/**\n\t * Classify query into category for pattern matching\n\t */\n\tclassifyQueryType(query: string): QueryType {\n\t\tconst q = query.toLowerCase();\n\n\t\tfor (const [type, keywords] of Object.entries(QUERY_TYPE_KEYWORDS) as [QueryType, string[]][]) {\n\t\t\tif (type === \"general\") {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (keywords.some((kw) => q.includes(kw))) {\n\t\t\t\treturn type;\n\t\t\t}\n\t\t}\n\n\t\treturn \"general\";\n\t}\n\n\t/**\n\t * Get golden examples for a query type\n\t */\n\tgetGoldenExamples(queryType: QueryType, limit = 3): GoldenExample[] {\n\t\tconst golden = loadJsonl<GoldenExample>(this.goldenPath);\n\t\treturn golden.filter((g) => g.queryType === queryType).slice(-limit);\n\t}\n\n\t/**\n\t * Query learnings by keywords\n\t */\n\tquery(keywords: string[]): Learning[] {\n\t\tconst learnings = loadJsonl<Learning>(this.learningsPath);\n\t\tconst lowerKeywords = keywords.map((k) => k.toLowerCase());\n\n\t\treturn learnings.filter((learning) => {\n\t\t\tconst triggers = Array.isArray(learning.trigger) ? learning.trigger : [learning.trigger];\n\t\t\tconst allText = [...triggers, learning.action, learning.solution || \"\"].join(\" \").toLowerCase();\n\n\t\t\treturn lowerKeywords.some((kw) => allText.includes(kw));\n\t\t});\n\t}\n\n\t/**\n\t * Record a new learning\n\t */\n\tasync record(input: LearningInput): Promise<{ id: string }> {\n\t\tconst learning: Learning = {\n\t\t\tid: generateId(\"L\"),\n\t\t\ttype: input.type,\n\t\t\ttrigger: input.trigger,\n\t\t\taction: input.action,\n\t\t\tsolution: input.action,\n\t\t\tsource: input.source,\n\t\t\ttimestamp: new Date().toISOString(),\n\t\t};\n\n\t\tappendJsonl(this.learningsPath, learning);\n\n\t\treturn { id: learning.id };\n\t}\n\n\t/**\n\t * Get learning statistics\n\t */\n\tgetStats(): LearningStats {\n\t\tconst interactions = loadJsonl<Interaction>(this.interactionsPath);\n\t\tconst golden = loadJsonl<GoldenExample>(this.goldenPath);\n\n\t\tconst withFeedback = interactions.filter((i) => i.humanFeedback);\n\t\tconst correct = withFeedback.filter((i) => i.humanFeedback?.correct);\n\n\t\t// Query type breakdown\n\t\tconst queryTypeBreakdown: Record<QueryType, number> = {} as Record<QueryType, number>;\n\t\tfor (const i of interactions) {\n\t\t\tconst type = this.classifyQueryType(i.query);\n\t\t\tqueryTypeBreakdown[type] = (queryTypeBreakdown[type] || 0) + 1;\n\t\t}\n\n\t\treturn {\n\t\t\ttotalInteractions: interactions.length,\n\t\t\tfeedbackReceived: withFeedback.length,\n\t\t\tcorrectRate: withFeedback.length > 0 ? correct.length / withFeedback.length : 0,\n\t\t\tgoldenExamples: golden.length,\n\t\t\tqueryTypeBreakdown,\n\t\t};\n\t}\n\n\t/**\n\t * Get recent interactions for review\n\t */\n\tgetRecentInteractions(limit = 10): Interaction[] {\n\t\tconst interactions = loadJsonl<Interaction>(this.interactionsPath);\n\t\treturn interactions.slice(-limit);\n\t}\n\n\t/**\n\t * Get interactions needing feedback\n\t */\n\tgetPendingFeedback(limit = 5): Interaction[] {\n\t\tconst interactions = loadJsonl<Interaction>(this.interactionsPath);\n\t\treturn interactions.filter((i) => !i.humanFeedback).slice(-limit);\n\t}\n}\n","/**\n * Violation Tracker\n *\n * Tracks violations and auto-promotes patterns:\n * - 1x seen  Store in violations.jsonl\n * - 3x seen  Promote to codebase-patterns.md\n * - 5x seen  Mark for automated detection\n */\n\nimport * as path from \"node:path\";\nimport { appendJsonlAsync, generateId, loadJsonl, writeJsonl } from \"../storage/JsonlStore.js\";\nimport type { ResolvedConfig } from \"../types/config.js\";\nimport type { Violation, ViolationInput, ViolationStatus, ViolationsSummary } from \"../types/learning.js\";\nimport { PROMOTION_THRESHOLDS } from \"../types/learning.js\";\n\n/**\n * Violation Tracker with auto-promotion\n */\nexport class ViolationTracker {\n\tprivate violationsPath: string;\n\n\tconstructor(config: ResolvedConfig) {\n\t\tthis.violationsPath = path.join(config.rootDir, config.violationsFile);\n\t}\n\n\t/**\n\t * Report a violation and update count\n\t */\n\tasync report(input: ViolationInput): Promise<ViolationStatus> {\n\t\tconst violations = loadJsonl<Violation>(this.violationsPath);\n\n\t\t// Check if violation type already exists\n\t\tconst existing = violations.find((v) => v.type === input.type);\n\n\t\tif (existing) {\n\t\t\t// Increment count\n\t\t\texisting.count += 1;\n\t\t\texisting.timestamp = new Date().toISOString();\n\n\t\t\t// Check promotion thresholds\n\t\t\tlet shouldPromote = false;\n\t\t\tlet shouldAutomate = false;\n\n\t\t\tif (existing.count >= PROMOTION_THRESHOLDS.ADD_AUTOMATION && !existing.automatedAt) {\n\t\t\t\tshouldAutomate = true;\n\t\t\t\texisting.automatedAt = new Date().toISOString();\n\t\t\t} else if (existing.count >= PROMOTION_THRESHOLDS.PROMOTE_TO_PATTERN && !existing.promotedAt) {\n\t\t\t\tshouldPromote = true;\n\t\t\t\texisting.promotedAt = new Date().toISOString();\n\t\t\t}\n\n\t\t\t// Save updated violations\n\t\t\tawait writeJsonl(this.violationsPath, violations);\n\n\t\t\treturn {\n\t\t\t\tid: existing.id,\n\t\t\t\tcount: existing.count,\n\t\t\t\tshouldPromote,\n\t\t\t\tshouldAutomate,\n\t\t\t};\n\t\t}\n\n\t\t// Create new violation\n\t\tconst violation: Violation = {\n\t\t\tid: generateId(\"V\"),\n\t\t\ttype: input.type,\n\t\t\tfile: input.file,\n\t\t\twhatHappened: input.message,\n\t\t\twhyItHappened: input.reason,\n\t\t\tprevention: input.prevention,\n\t\t\twrongExample: input.wrongExample,\n\t\t\tcorrectExample: input.correctExample,\n\t\t\ttimestamp: new Date().toISOString(),\n\t\t\tcount: 1,\n\t\t\tpromotedAt: null,\n\t\t\tautomatedAt: null,\n\t\t};\n\n\t\tawait appendJsonlAsync(this.violationsPath, violation);\n\n\t\treturn {\n\t\t\tid: violation.id,\n\t\t\tcount: 1,\n\t\t\tshouldPromote: false,\n\t\t\tshouldAutomate: false,\n\t\t};\n\t}\n\n\t/**\n\t * Get summary of all violations\n\t */\n\tgetSummary(): ViolationsSummary {\n\t\tconst violations = loadJsonl<Violation>(this.violationsPath);\n\n\t\tconst byType = violations.map((v) => ({\n\t\t\ttype: v.type,\n\t\t\tcount: v.count,\n\t\t\tstatus: this.getViolationStatus(v),\n\t\t}));\n\n\t\tconst readyForPromotion = violations\n\t\t\t.filter((v) => v.count >= PROMOTION_THRESHOLDS.PROMOTE_TO_PATTERN && !v.promotedAt)\n\t\t\t.map((v) => v.type);\n\n\t\tconst readyForAutomation = violations\n\t\t\t.filter((v) => v.count >= PROMOTION_THRESHOLDS.ADD_AUTOMATION && !v.automatedAt)\n\t\t\t.map((v) => v.type);\n\n\t\treturn {\n\t\t\ttotal: violations.length,\n\t\t\tbyType,\n\t\t\treadyForPromotion,\n\t\t\treadyForAutomation,\n\t\t};\n\t}\n\n\t/**\n\t * Get violation status based on count and flags\n\t */\n\tprivate getViolationStatus(\n\t\tviolation: Violation,\n\t): \"tracking\" | \"ready_for_promotion\" | \"ready_for_automation\" | \"promoted\" | \"automated\" {\n\t\tif (violation.automatedAt) {\n\t\t\treturn \"automated\";\n\t\t}\n\t\tif (violation.promotedAt) {\n\t\t\treturn \"promoted\";\n\t\t}\n\t\tif (violation.count >= PROMOTION_THRESHOLDS.ADD_AUTOMATION) {\n\t\t\treturn \"ready_for_automation\";\n\t\t}\n\t\tif (violation.count >= PROMOTION_THRESHOLDS.PROMOTE_TO_PATTERN) {\n\t\t\treturn \"ready_for_promotion\";\n\t\t}\n\t\treturn \"tracking\";\n\t}\n\n\t/**\n\t * Get violations by type\n\t */\n\tgetByType(type: string): Violation | undefined {\n\t\tconst violations = loadJsonl<Violation>(this.violationsPath);\n\t\treturn violations.find((v) => v.type === type);\n\t}\n\n\t/**\n\t * Get recent violations\n\t */\n\tgetRecent(limit = 10): Violation[] {\n\t\tconst violations = loadJsonl<Violation>(this.violationsPath);\n\t\treturn violations.slice(-limit);\n\t}\n\n\t/**\n\t * Get violations for a specific file\n\t */\n\tgetByFile(file: string): Violation[] {\n\t\tconst violations = loadJsonl<Violation>(this.violationsPath);\n\t\treturn violations.filter((v) => v.file.includes(file));\n\t}\n}\n","/**\n * Session Context Types\n *\n * Session-level intelligence for tracking LLM behavior, detecting loops,\n * and escalating risk based on patterns.\n *\n * Based on research:\n * - arXiv:2511.10650 - Unsupervised Cycle Detection in Agentic Applications\n * - Pedowitz Safety Playbook - AI Agent Loop Prevention\n * - LangChain Context Engineering patterns\n */\n\n/**\n * Tool call record for history tracking\n */\nexport interface ToolCall {\n\t/** Unique idempotency key */\n\tid: string;\n\t/** Tool name (e.g., 'check_patterns', 'validate_code') */\n\tname: string;\n\t/** Tool arguments */\n\targs: Record<string, unknown>;\n\t/** Timestamp */\n\ttimestamp: number;\n\t/** Result (success/error) */\n\tresult?: {\n\t\tsuccess: boolean;\n\t\toutput?: unknown;\n\t\terror?: string;\n\t};\n\t/** Semantic embedding of args (for cycle detection) */\n\tembedding?: number[];\n}\n\n/**\n * File modification record\n */\nexport interface FileModification {\n\t/** File path */\n\tpath: string;\n\t/** Modification timestamp */\n\ttimestamp: number;\n\t/** Type of modification */\n\ttype: \"create\" | \"update\" | \"delete\";\n\t/** Lines changed (for velocity tracking) */\n\tlinesChanged?: number;\n}\n\n/**\n * Loop detection state\n * Detects both structural (same tool) and semantic (similar args) cycles\n */\nexport interface LoopDetectionState {\n\t/** Sequential tool call pattern (last 5 calls) */\n\tsequence: string[];\n\t/** Idempotency key cache (prevent duplicate operations) */\n\tdedupKeys: Set<string>;\n\t/** Consecutive same-tool calls */\n\tconsecutiveSameTool: Map<string, number>;\n\t/** Semantic similarity cache (detect near-duplicate calls) */\n\tsemanticCache: Map<string, number[]>;\n\t/** Circuit breaker states */\n\tcircuitBreakers: Map<string, CircuitBreaker>;\n}\n\n/**\n * Circuit breaker for tool calls\n * Trips after N failures, requires cooldown before retry\n */\nexport interface CircuitBreaker {\n\t/** Tool name */\n\ttool: string;\n\t/** Current state */\n\tstate: \"closed\" | \"open\" | \"half-open\";\n\t/** Failure count */\n\tfailures: number;\n\t/** Failure threshold (default: 3) */\n\tthreshold: number;\n\t/** Last failure timestamp */\n\tlastFailure: number;\n\t/** Cooldown period in ms (default: 60000 = 1min) */\n\tcooldownMs: number;\n}\n\n/**\n * Session risk level\n * Escalates based on behavior patterns\n */\nexport type SessionRiskLevel = \"low\" | \"medium\" | \"high\" | \"critical\";\n\n/**\n * Session state for a single LLM conversation\n * Tracks all context needed for behavioral intelligence\n */\nexport interface SessionState {\n\t/** Unique session ID */\n\tsessionId: string;\n\t/** Session start time */\n\tstartedAt: number;\n\t/** Last activity timestamp */\n\tlastActivity: number;\n\t/** Total turn count */\n\tturnCount: number;\n\n\t/** Tool call history */\n\ttoolCalls: ToolCall[];\n\n\t/** File modifications this session */\n\tfileModifications: FileModification[];\n\n\t/** Files modified multiple times (velocity tracking) */\n\tconsecutiveModifications: Map<string, number>;\n\n\t/** Loop detection state */\n\tloopDetection: LoopDetectionState;\n\n\t/** Current risk level */\n\triskLevel: SessionRiskLevel;\n\n\t/** Risk escalation reasons */\n\triskReasons: string[];\n\n\t/** Session metadata */\n\tmetadata: {\n\t\tworkspaceId?: string;\n\t\tuserId?: string;\n\t\ttags?: string[];\n\t};\n}\n\n/**\n * Loop detection result\n */\nexport interface LoopDetectionResult {\n\t/** Is a loop detected? */\n\tdetected: boolean;\n\t/** Loop type */\n\ttype?: \"structural\" | \"semantic\" | \"both\";\n\t/** Confidence score (0-1) */\n\tconfidence: number;\n\t/** Evidence */\n\tevidence: string[];\n\t/** Recommended action */\n\taction: \"continue\" | \"warn\" | \"halt\";\n}\n\n/**\n * Session limits configuration\n */\nexport interface SessionLimits {\n\t/** Max tool calls per session */\n\tmaxToolCalls: number;\n\t/** Max consecutive same-tool calls */\n\tmaxConsecutiveSameTool: number;\n\t/** Max file modifications per session */\n\tmaxFileModifications: number;\n\t/** Max consecutive modifications to same file */\n\tmaxConsecutiveSameFile: number;\n\t/** Session timeout (ms) */\n\tsessionTimeoutMs: number;\n\t/** Turn limit (max back-and-forth exchanges) */\n\tmaxTurns: number;\n\t/** Circuit breaker failure threshold */\n\tcircuitBreakerThreshold: number;\n\t/** Circuit breaker cooldown (ms) */\n\tcircuitBreakerCooldownMs: number;\n}\n\n/**\n * Default session limits (safety-first)\n */\nexport const DEFAULT_SESSION_LIMITS: SessionLimits = {\n\tmaxToolCalls: 100,\n\tmaxConsecutiveSameTool: 3,\n\tmaxFileModifications: 50,\n\tmaxConsecutiveSameFile: 5,\n\tsessionTimeoutMs: 3600000, // 1 hour\n\tmaxTurns: 50,\n\tcircuitBreakerThreshold: 3,\n\tcircuitBreakerCooldownMs: 60000, // 1 minute\n};\n\n/**\n * Session analytics for reporting\n */\nexport interface SessionAnalytics {\n\t/** Session ID */\n\tsessionId: string;\n\t/** Duration (ms) */\n\tduration: number;\n\t/** Total tool calls */\n\ttotalToolCalls: number;\n\t/** Unique tools used */\n\tuniqueTools: string[];\n\t/** Most called tool */\n\tmostCalledTool: { name: string; count: number } | null;\n\t/** Files touched */\n\tfilesTouched: string[];\n\t/** Peak risk level */\n\tpeakRiskLevel: SessionRiskLevel;\n\t/** Loops detected */\n\tloopsDetected: number;\n\t/** Circuit breaker trips */\n\tcircuitBreakerTrips: number;\n\t/** Session outcome */\n\toutcome: \"completed\" | \"timeout\" | \"halted\" | \"error\";\n}\n","/**\n * Loop Detector\n *\n * Hybrid loop detection combining structural and semantic analysis.\n *\n * Based on arXiv:2511.10650 research:\n * - Structural: Call stack temporal patterns (F1: 0.08 alone)\n * - Semantic: Cosine similarity of tool args (F1: 0.28 alone)\n * - Hybrid: Combined approach (F1: 0.72, precision: 0.62, recall: 0.86)\n *\n * Thresholds calibrated from research findings.\n */\n\nimport type { LoopDetectionResult, SessionState } from \"../types/session.js\";\n\n/**\n * Loop Detector\n *\n * Detects infinite loops in LLM agent behavior using:\n * 1. Structural analysis - same tool called repeatedly\n * 2. Semantic analysis - similar args (redundant content generation)\n */\nexport class LoopDetector {\n\t// Thresholds from research (arXiv:2511.10650)\n\tprivate readonly STRUCTURAL_THRESHOLD = 3; // 3+ consecutive same tool = loop\n\tprivate readonly SEMANTIC_THRESHOLD = 0.9; // 90% similarity = redundant\n\tprivate readonly CONFIDENCE_THRESHOLD_HALT = 0.8; // Halt at 80%+ confidence\n\tprivate readonly CONFIDENCE_THRESHOLD_WARN = 0.5; // Warn at 50%+ confidence\n\n\t/**\n\t * Detect loops in session\n\t */\n\tdetect(session: SessionState): LoopDetectionResult {\n\t\t// Defensive check (L6256620335)\n\t\tif (!session || !session.loopDetection) {\n\t\t\treturn {\n\t\t\t\tdetected: false,\n\t\t\t\tconfidence: 0,\n\t\t\t\tevidence: [],\n\t\t\t\taction: \"continue\",\n\t\t\t};\n\t\t}\n\n\t\t// Run both detection methods\n\t\tconst structuralResult = this.detectStructuralLoop(session);\n\t\tconst semanticResult = this.detectSemanticLoop(session);\n\n\t\t// Combine results\n\t\tconst detected = structuralResult.detected || semanticResult.detected;\n\t\tconst type =\n\t\t\tstructuralResult.detected && semanticResult.detected\n\t\t\t\t? \"both\"\n\t\t\t\t: structuralResult.detected\n\t\t\t\t\t? \"structural\"\n\t\t\t\t\t: semanticResult.detected\n\t\t\t\t\t\t? \"semantic\"\n\t\t\t\t\t\t: undefined;\n\n\t\t// Combine evidence\n\t\tconst evidence = [...structuralResult.evidence, ...semanticResult.evidence];\n\n\t\t// Confidence = max of both methods (research shows hybrid is best)\n\t\tconst confidence = Math.max(structuralResult.confidence, semanticResult.confidence);\n\n\t\t// Determine action\n\t\tlet action: LoopDetectionResult[\"action\"];\n\t\tif (confidence >= this.CONFIDENCE_THRESHOLD_HALT) {\n\t\t\taction = \"halt\";\n\t\t} else if (confidence >= this.CONFIDENCE_THRESHOLD_WARN) {\n\t\t\taction = \"warn\";\n\t\t} else {\n\t\t\taction = \"continue\";\n\t\t}\n\n\t\treturn {\n\t\t\tdetected,\n\t\t\ttype,\n\t\t\tconfidence,\n\t\t\tevidence,\n\t\t\taction,\n\t\t};\n\t}\n\n\t/**\n\t * Structural loop detection\n\t * Detects: same tool called 3+ times in sequence\n\t */\n\tprivate detectStructuralLoop(session: SessionState): {\n\t\tdetected: boolean;\n\t\tconfidence: number;\n\t\tevidence: string[];\n\t} {\n\t\tconst evidence: string[] = [];\n\t\tlet maxConsecutive = 0;\n\t\tlet maxTool = \"\";\n\n\t\t// Check consecutive same-tool calls\n\t\tfor (const [tool, count] of session.loopDetection.consecutiveSameTool.entries()) {\n\t\t\tif (count > maxConsecutive) {\n\t\t\t\tmaxConsecutive = count;\n\t\t\t\tmaxTool = tool;\n\t\t\t}\n\t\t}\n\n\t\t// Check sequence pattern (last 5 calls)\n\t\tconst sequence = session.loopDetection.sequence;\n\t\tif (sequence.length >= 3) {\n\t\t\t// Pattern: A-B-A-B (alternating)\n\t\t\tconst isAlternating =\n\t\t\t\tsequence.length >= 4 &&\n\t\t\t\tsequence[sequence.length - 1] === sequence[sequence.length - 3] &&\n\t\t\t\tsequence[sequence.length - 2] === sequence[sequence.length - 4];\n\n\t\t\tif (isAlternating) {\n\t\t\t\tevidence.push(`Alternating pattern detected: ${sequence.slice(-4).join(\"  \")}`);\n\t\t\t}\n\t\t}\n\n\t\tconst detected = maxConsecutive >= this.STRUCTURAL_THRESHOLD;\n\n\t\tif (detected) {\n\t\t\tevidence.push(`Tool '${maxTool}' called ${maxConsecutive} times consecutively`);\n\t\t}\n\n\t\t// Confidence based on consecutive count\n\t\t// Research shows: 3+ consecutive = high confidence structural loop\n\t\tconst confidence = detected ? Math.min(0.6 + (maxConsecutive - this.STRUCTURAL_THRESHOLD) * 0.1, 1.0) : 0;\n\n\t\treturn { detected, confidence, evidence };\n\t}\n\n\t/**\n\t * Semantic loop detection\n\t * Detects: similar args (cosine similarity > 90%)\n\t */\n\tprivate detectSemanticLoop(session: SessionState): {\n\t\tdetected: boolean;\n\t\tconfidence: number;\n\t\tevidence: string[];\n\t} {\n\t\tconst evidence: string[] = [];\n\n\t\t// Need at least 2 tool calls to compare\n\t\tif (session.toolCalls.length < 2) {\n\t\t\treturn { detected: false, confidence: 0, evidence: [] };\n\t\t}\n\n\t\t// Get last 5 tool calls for comparison\n\t\tconst recentCalls = session.toolCalls.slice(-5);\n\n\t\tlet maxSimilarity = 0;\n\t\tconst similarityPairs: Array<[number, number]> = [];\n\n\t\t// Compare each pair\n\t\tfor (let i = 0; i < recentCalls.length - 1; i++) {\n\t\t\tfor (let j = i + 1; j < recentCalls.length; j++) {\n\t\t\t\tconst call1 = recentCalls[i];\n\t\t\t\tconst call2 = recentCalls[j];\n\n\t\t\t\t// Only compare same tool\n\t\t\t\tif (call1.name !== call2.name) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst similarity = this.calculateArgsSimilarity(call1.args, call2.args);\n\n\t\t\t\tif (similarity > maxSimilarity) {\n\t\t\t\t\tmaxSimilarity = similarity;\n\t\t\t\t}\n\n\t\t\t\tif (similarity >= this.SEMANTIC_THRESHOLD) {\n\t\t\t\t\tsimilarityPairs.push([i, j]);\n\t\t\t\t\tevidence.push(\n\t\t\t\t\t\t`Tool '${call1.name}' calls ${i} and ${j} are ${(similarity * 100).toFixed(1)}% similar`,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst detected = maxSimilarity >= this.SEMANTIC_THRESHOLD;\n\n\t\t// Confidence based on similarity score\n\t\t// Research shows: >90% similarity = high confidence semantic loop\n\t\tconst confidence = detected ? Math.min(0.5 + (maxSimilarity - this.SEMANTIC_THRESHOLD) * 2, 1.0) : 0;\n\n\t\treturn { detected, confidence, evidence };\n\t}\n\n\t/**\n\t * Calculate similarity between tool arguments\n\t * Uses simple string-based similarity (could be enhanced with embeddings)\n\t */\n\tprivate calculateArgsSimilarity(args1: Record<string, unknown>, args2: Record<string, unknown>): number {\n\t\t// Convert args to comparable strings\n\t\tconst str1 = JSON.stringify(args1, Object.keys(args1).sort());\n\t\tconst str2 = JSON.stringify(args2, Object.keys(args2).sort());\n\n\t\t// Exact match\n\t\tif (str1 === str2) {\n\t\t\treturn 1.0;\n\t\t}\n\n\t\t// Jaccard similarity (simple but effective)\n\t\tconst tokens1 = new Set(str1.split(/\\W+/));\n\t\tconst tokens2 = new Set(str2.split(/\\W+/));\n\n\t\tconst intersection = new Set([...tokens1].filter((x) => tokens2.has(x)));\n\t\tconst union = new Set([...tokens1, ...tokens2]);\n\n\t\treturn intersection.size / union.size;\n\t}\n}\n","/**\n * Session Manager\n *\n * Tracks LLM session context: tool calls, file modifications, loop detection, risk escalation.\n *\n * Based on research:\n * - arXiv:2511.10650 - Hybrid loop detection (F1: 0.72)\n * - Pedowitz Safety Playbook - Circuit breakers + idempotency\n * - LangChain Context Engineering - Session state management\n */\n\nimport { existsSync } from \"node:fs\";\nimport { mkdir } from \"node:fs/promises\";\nimport { dirname } from \"node:path\";\nimport { readFile, writeFile } from \"atomically\";\nimport { z } from \"zod\";\nimport type {\n\tCircuitBreaker,\n\tFileModification,\n\tLoopDetectionResult,\n\tSessionAnalytics,\n\tSessionLimits,\n\tSessionRiskLevel,\n\tSessionState,\n\tToolCall,\n} from \"../types/session.js\";\nimport { DEFAULT_SESSION_LIMITS } from \"../types/session.js\";\nimport { logger } from \"../utils/logger.js\";\nimport { LoopDetector } from \"./LoopDetector.js\";\n\n/**\n * Runtime validation schemas (Zod best practice)\n */\nconst ToolCallSchema = z.object({\n\tid: z.string().min(1, \"Tool call ID required\"),\n\tname: z.string().min(1, \"Tool name required\"),\n\targs: z.record(z.unknown()),\n\ttimestamp: z.number().positive(\"Timestamp must be positive\"),\n\tresult: z\n\t\t.object({\n\t\t\tsuccess: z.boolean(),\n\t\t\toutput: z.unknown().optional(),\n\t\t\terror: z.string().optional(),\n\t\t})\n\t\t.optional(),\n\tembedding: z.array(z.number()).optional(),\n});\n\nconst FileModificationSchema = z.object({\n\tpath: z.string().min(1, \"File path required\"),\n\ttimestamp: z.number().positive(\"Timestamp must be positive\"),\n\ttype: z.enum([\"create\", \"update\", \"delete\"]),\n\tlinesChanged: z.number().nonnegative().optional(),\n});\n\n/**\n * Session Manager\n *\n * Manages multiple concurrent LLM sessions with:\n * - Tool call tracking with idempotency\n * - File modification velocity\n * - Loop detection (structural + semantic)\n * - Risk escalation\n * - Circuit breakers\n */\nexport class SessionManager {\n\tprivate sessions = new Map<string, SessionState>();\n\tprivate limits: SessionLimits;\n\tprivate loopDetector: LoopDetector;\n\tprivate persistencePath?: string;\n\tprivate autosaveEnabled: boolean;\n\n\tconstructor(limits: Partial<SessionLimits> = {}, options?: { persistencePath?: string; autosave?: boolean }) {\n\t\tthis.limits = { ...DEFAULT_SESSION_LIMITS, ...limits };\n\t\tthis.loopDetector = new LoopDetector();\n\t\tthis.persistencePath = options?.persistencePath;\n\t\tthis.autosaveEnabled = options?.autosave ?? false;\n\n\t\t// Auto-load sessions on startup if persistence enabled\n\t\tif (this.persistencePath) {\n\t\t\tthis.loadSessions().catch((error) => {\n\t\t\t\tlogger.error(\"Failed to load sessions on startup\", {\n\t\t\t\t\terror: error instanceof Error ? error.message : String(error),\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Start a new session\n\t */\n\tstartSession(\n\t\tsessionId: string,\n\t\tmetadata?: {\n\t\t\tworkspaceId?: string;\n\t\t\tuserId?: string;\n\t\t\ttags?: string[];\n\t\t},\n\t): void {\n\t\t// Defensive check (L6256620335)\n\t\tif (!sessionId) {\n\t\t\tthrow new Error(\"SessionManager.startSession: sessionId is required\");\n\t\t}\n\n\t\t// Prevent duplicate sessions\n\t\tif (this.sessions.has(sessionId)) {\n\t\t\tlogger.warn(\"Session already exists\", { sessionId, action: \"rejected\" });\n\t\t\tthrow new Error(`SessionManager.startSession: Session ${sessionId} already exists`);\n\t\t}\n\n\t\tconst now = Date.now();\n\n\t\tlogger.info(\"Session started\", {\n\t\t\tsessionId,\n\t\t\tworkspaceId: metadata?.workspaceId,\n\t\t\tuserId: metadata?.userId,\n\t\t\ttimestamp: now,\n\t\t});\n\n\t\tthis.sessions.set(sessionId, {\n\t\t\tsessionId,\n\t\t\tstartedAt: now,\n\t\t\tlastActivity: now,\n\t\t\tturnCount: 0,\n\t\t\ttoolCalls: [],\n\t\t\tfileModifications: [],\n\t\t\tconsecutiveModifications: new Map(),\n\t\t\tloopDetection: {\n\t\t\t\tsequence: [],\n\t\t\t\tdedupKeys: new Set(),\n\t\t\t\tconsecutiveSameTool: new Map(),\n\t\t\t\tsemanticCache: new Map(),\n\t\t\t\tcircuitBreakers: new Map(),\n\t\t\t},\n\t\t\triskLevel: \"low\",\n\t\t\triskReasons: [],\n\t\t\tmetadata: metadata ?? {},\n\t\t});\n\n\t\t// Autosave if enabled\n\t\tvoid this.autoSave();\n\t}\n\n\t/**\n\t * Record a tool call\n\t * Returns true if call is allowed, false if blocked (circuit breaker/loop)\n\t */\n\trecordToolCall(sessionId: string, call: ToolCall): boolean {\n\t\tconst session = this.getSession(sessionId);\n\t\tif (!session) {\n\t\t\tthrow new Error(`SessionManager.recordToolCall: Session ${sessionId} not found`);\n\t\t}\n\n\t\t// Input validation (Zod runtime check)\n\t\ttry {\n\t\t\tToolCallSchema.parse(call);\n\t\t} catch (error) {\n\t\t\tif (error instanceof z.ZodError) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`SessionManager.recordToolCall: Invalid tool call - ${error.errors.map((e) => `${e.path.join(\".\")}: ${e.message}`).join(\", \")}`,\n\t\t\t\t);\n\t\t\t}\n\t\t\tthrow error;\n\t\t}\n\n\t\t// Check idempotency (dedupe)\n\t\tif (session.loopDetection.dedupKeys.has(call.id)) {\n\t\t\treturn false; // Duplicate operation\n\t\t}\n\n\t\t// Check circuit breaker\n\t\tconst breaker = this.getOrCreateCircuitBreaker(session, call.name);\n\t\tif (breaker.state === \"open\") {\n\t\t\t// Check if cooldown expired\n\t\t\tconst cooldownExpired = Date.now() - breaker.lastFailure > breaker.cooldownMs;\n\t\t\tif (!cooldownExpired) {\n\t\t\t\tlogger.warn(\"Circuit breaker tripped\", {\n\t\t\t\t\tsessionId,\n\t\t\t\t\ttool: call.name,\n\t\t\t\t\tstate: breaker.state,\n\t\t\t\t\tfailures: breaker.failures,\n\t\t\t\t\tcooldownRemaining: breaker.cooldownMs - (Date.now() - breaker.lastFailure),\n\t\t\t\t});\n\t\t\t\treturn false; // Circuit breaker tripped\n\t\t\t}\n\t\t\t// Move to half-open for retry\n\t\t\tbreaker.state = \"half-open\";\n\t\t\tlogger.info(\"Circuit breaker half-open\", {\n\t\t\t\tsessionId,\n\t\t\t\ttool: call.name,\n\t\t\t\tstate: breaker.state,\n\t\t\t});\n\t\t}\n\n\t\t// Check consecutive same-tool limit\n\t\tconst consecutive = (session.loopDetection.consecutiveSameTool.get(call.name) ?? 0) + 1;\n\t\tif (consecutive > this.limits.maxConsecutiveSameTool) {\n\t\t\treturn false; // Too many consecutive calls\n\t\t}\n\n\t\t// Record call\n\t\tsession.toolCalls.push(call);\n\t\tsession.loopDetection.dedupKeys.add(call.id);\n\t\tsession.loopDetection.consecutiveSameTool.set(call.name, consecutive);\n\t\tsession.loopDetection.sequence.push(call.name);\n\n\t\t// Keep sequence limited to last 5\n\t\tif (session.loopDetection.sequence.length > 5) {\n\t\t\tsession.loopDetection.sequence.shift();\n\t\t}\n\n\t\t// Update turn count\n\t\tsession.turnCount++;\n\t\tsession.lastActivity = Date.now();\n\n\t\t// Update circuit breaker on result\n\t\tif (call.result) {\n\t\t\tif (call.result.success) {\n\t\t\t\tbreaker.failures = 0;\n\t\t\t\tif (breaker.state === \"half-open\") {\n\t\t\t\t\tbreaker.state = \"closed\";\n\t\t\t\t\tlogger.info(\"Circuit breaker closed (recovered)\", {\n\t\t\t\t\t\tsessionId,\n\t\t\t\t\t\ttool: call.name,\n\t\t\t\t\t\tstate: breaker.state,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbreaker.failures++;\n\t\t\t\tbreaker.lastFailure = Date.now();\n\t\t\t\tif (breaker.failures >= breaker.threshold) {\n\t\t\t\t\tbreaker.state = \"open\";\n\t\t\t\t\tlogger.error(\"Circuit breaker opened\", {\n\t\t\t\t\t\tsessionId,\n\t\t\t\t\t\ttool: call.name,\n\t\t\t\t\t\tstate: breaker.state,\n\t\t\t\t\t\tfailures: breaker.failures,\n\t\t\t\t\t\tthreshold: breaker.threshold,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Cleanup: Remove old tool counters to prevent memory leak (WeakMap pattern)\n\t\t// Only keep last 10 tools to prevent unbounded growth\n\t\tif (session.loopDetection.consecutiveSameTool.size > 10) {\n\t\t\tconst toolNames = Array.from(session.loopDetection.consecutiveSameTool.keys());\n\t\t\t// Remove oldest entries (first in map)\n\t\t\tfor (let i = 0; i < toolNames.length - 10; i++) {\n\t\t\t\tsession.loopDetection.consecutiveSameTool.delete(toolNames[i]);\n\t\t\t}\n\t\t}\n\n\t\t// Recalculate risk\n\t\tthis.updateRiskLevel(session);\n\n\t\t// Autosave if enabled\n\t\tvoid this.autoSave();\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Record a file modification\n\t */\n\trecordFileModification(sessionId: string, mod: FileModification): void {\n\t\tconst session = this.getSession(sessionId);\n\t\tif (!session) {\n\t\t\tthrow new Error(`SessionManager.recordFileModification: Session ${sessionId} not found`);\n\t\t}\n\n\t\t// Input validation (Zod runtime check)\n\t\ttry {\n\t\t\tFileModificationSchema.parse(mod);\n\t\t} catch (error) {\n\t\t\tif (error instanceof z.ZodError) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`SessionManager.recordFileModification: Invalid modification - ${error.errors.map((e) => `${e.path.join(\".\")}: ${e.message}`).join(\", \")}`,\n\t\t\t\t);\n\t\t\t}\n\t\t\tthrow error;\n\t\t}\n\n\t\tsession.fileModifications.push(mod);\n\n\t\t// Track consecutive modifications\n\t\tconst consecutiveCount = (session.consecutiveModifications.get(mod.path) ?? 0) + 1;\n\t\tsession.consecutiveModifications.set(mod.path, consecutiveCount);\n\n\t\tsession.lastActivity = Date.now();\n\n\t\t// Recalculate risk\n\t\tthis.updateRiskLevel(session);\n\n\t\t// Autosave if enabled\n\t\tvoid this.autoSave();\n\t}\n\n\t/**\n\t * Detect loops in session\n\t */\n\tdetectLoop(sessionId: string): LoopDetectionResult {\n\t\tconst session = this.getSession(sessionId);\n\t\tif (!session) {\n\t\t\treturn {\n\t\t\t\tdetected: false,\n\t\t\t\tconfidence: 0,\n\t\t\t\tevidence: [],\n\t\t\t\taction: \"continue\",\n\t\t\t};\n\t\t}\n\n\t\treturn this.loopDetector.detect(session);\n\t}\n\n\t/**\n\t * Calculate and update session risk level\n\t */\n\tprivate updateRiskLevel(session: SessionState): void {\n\t\tconst reasons: string[] = [];\n\t\tlet riskScore = 0;\n\n\t\t// Factor 1: Tool call velocity\n\t\tconst toolCallRate = session.toolCalls.length / Math.max((Date.now() - session.startedAt) / 60000, 1); // calls per minute\n\t\tif (toolCallRate > 10) {\n\t\t\triskScore += 30;\n\t\t\treasons.push(`High tool call rate: ${toolCallRate.toFixed(1)}/min`);\n\t\t} else if (toolCallRate > 5) {\n\t\t\triskScore += 15;\n\t\t\treasons.push(`Moderate tool call rate: ${toolCallRate.toFixed(1)}/min`);\n\t\t}\n\n\t\t// Factor 2: File modification velocity\n\t\tconst fileModCount = session.fileModifications.length;\n\t\tif (fileModCount > this.limits.maxFileModifications * 0.8) {\n\t\t\triskScore += 20;\n\t\t\treasons.push(`High file modification count: ${fileModCount}`);\n\t\t}\n\n\t\t// Factor 3: Consecutive modifications to same file\n\t\tfor (const [file, count] of session.consecutiveModifications.entries()) {\n\t\t\tif (count > this.limits.maxConsecutiveSameFile * 0.8) {\n\t\t\t\triskScore += 25;\n\t\t\t\treasons.push(`File modified ${count} times: ${file}`);\n\t\t\t}\n\t\t}\n\n\t\t// Factor 4: Loop detection\n\t\tconst loopResult = this.loopDetector.detect(session);\n\t\tif (loopResult.detected) {\n\t\t\triskScore += 40;\n\t\t\treasons.push(`Loop detected: ${loopResult.type}`);\n\t\t}\n\n\t\t// Factor 5: Circuit breaker trips\n\t\tconst circuitBreakerTrips = Array.from(session.loopDetection.circuitBreakers.values()).filter(\n\t\t\t(cb) => cb.state === \"open\",\n\t\t).length;\n\t\tif (circuitBreakerTrips > 0) {\n\t\t\triskScore += 20 * circuitBreakerTrips;\n\t\t\treasons.push(`${circuitBreakerTrips} circuit breaker(s) tripped`);\n\t\t}\n\n\t\t// Bound risk score to 0-100 range\n\t\triskScore = Math.min(Math.max(riskScore, 0), 100);\n\n\t\t// Calculate risk level\n\t\tlet riskLevel: SessionRiskLevel;\n\t\tif (riskScore >= 80) {\n\t\t\triskLevel = \"critical\";\n\t\t} else if (riskScore >= 50) {\n\t\t\triskLevel = \"high\";\n\t\t} else if (riskScore >= 25) {\n\t\t\triskLevel = \"medium\";\n\t\t} else {\n\t\t\triskLevel = \"low\";\n\t\t}\n\n\t\t// Log risk escalation\n\t\tif (riskLevel !== session.riskLevel && riskLevel !== \"low\") {\n\t\t\tlogger.warn(\"Risk level escalated\", {\n\t\t\t\tsessionId: session.sessionId,\n\t\t\t\tpreviousLevel: session.riskLevel,\n\t\t\t\tnewLevel: riskLevel,\n\t\t\t\triskScore,\n\t\t\t\treasons,\n\t\t\t});\n\t\t}\n\n\t\tsession.riskLevel = riskLevel;\n\t\tsession.riskReasons = reasons;\n\t}\n\n\t/**\n\t * Get session analytics\n\t */\n\tgetAnalytics(sessionId: string): SessionAnalytics | null {\n\t\tconst session = this.sessions.get(sessionId);\n\t\tif (!session) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Count tool usage\n\t\tconst toolCounts = new Map<string, number>();\n\t\tfor (const call of session.toolCalls) {\n\t\t\ttoolCounts.set(call.name, (toolCounts.get(call.name) ?? 0) + 1);\n\t\t}\n\n\t\tconst uniqueTools = Array.from(toolCounts.keys());\n\t\tconst mostCalledTool: { name: string; count: number } | null =\n\t\t\tuniqueTools.length > 0\n\t\t\t\t? Array.from(toolCounts.entries()).reduce<{ name: string; count: number }>(\n\t\t\t\t\t\t(max, [name, count]) => (count > max.count ? { name, count } : max),\n\t\t\t\t\t\t{ name: \"\", count: 0 },\n\t\t\t\t\t)\n\t\t\t\t: null;\n\n\t\t// Unique files\n\t\tconst filesTouched = Array.from(new Set(session.fileModifications.map((m) => m.path)));\n\n\t\t// Count loops (detect once, not per tool call)\n\t\tconst currentLoopResult = this.loopDetector.detect(session);\n\t\tconst loopsDetected = currentLoopResult.detected ? 1 : 0;\n\n\t\t// Count circuit breaker trips\n\t\tconst circuitBreakerTrips = Array.from(session.loopDetection.circuitBreakers.values()).filter(\n\t\t\t(cb) => cb.state === \"open\",\n\t\t).length;\n\n\t\t// Determine outcome\n\t\tconst now = Date.now();\n\t\tconst duration = now - session.startedAt;\n\t\tconst timedOut = duration > this.limits.sessionTimeoutMs;\n\t\tconst halted = session.riskLevel === \"critical\";\n\n\t\tlet outcome: SessionAnalytics[\"outcome\"];\n\t\tif (halted) {\n\t\t\toutcome = \"halted\";\n\t\t} else if (timedOut) {\n\t\t\toutcome = \"timeout\";\n\t\t} else {\n\t\t\toutcome = \"completed\";\n\t\t}\n\n\t\treturn {\n\t\t\tsessionId: session.sessionId,\n\t\t\tduration,\n\t\t\ttotalToolCalls: session.toolCalls.length,\n\t\t\tuniqueTools,\n\t\t\tmostCalledTool,\n\t\t\tfilesTouched,\n\t\t\tpeakRiskLevel: session.riskLevel,\n\t\t\tloopsDetected,\n\t\t\tcircuitBreakerTrips,\n\t\t\toutcome,\n\t\t};\n\t}\n\n\t/**\n\t * End a session and clean up\n\t */\n\tendSession(sessionId: string): SessionAnalytics | null {\n\t\tconst analytics = this.getAnalytics(sessionId);\n\t\tthis.sessions.delete(sessionId);\n\t\treturn analytics;\n\t}\n\n\t/**\n\t * Get session state (for debugging)\n\t */\n\tgetSessionState(sessionId: string): SessionState | null {\n\t\treturn this.sessions.get(sessionId) ?? null;\n\t}\n\n\t/**\n\t * Get file modifications for a session\n\t * @param sessionId - Session to query\n\t * @param since - Optional timestamp filter (return modifications >= since)\n\t * @returns File modifications array (empty if session not found)\n\t */\n\tgetFileModifications(sessionId: string, since?: number): FileModification[] {\n\t\tconst session = this.getSession(sessionId);\n\t\tif (!session) {\n\t\t\treturn [];\n\t\t}\n\n\t\tif (since !== undefined && since > 0) {\n\t\t\treturn session.fileModifications.filter((m) => m.timestamp >= since);\n\t\t}\n\n\t\treturn [...session.fileModifications];\n\t}\n\n\t/**\n\t * Prune stale sessions (older than timeout)\n\t */\n\tpruneStale(): number {\n\t\tconst now = Date.now();\n\t\tlet pruned = 0;\n\n\t\tfor (const [sessionId, session] of this.sessions.entries()) {\n\t\t\tconst age = now - session.lastActivity;\n\t\t\tif (age > this.limits.sessionTimeoutMs) {\n\t\t\t\tthis.sessions.delete(sessionId);\n\t\t\t\tpruned++;\n\t\t\t}\n\t\t}\n\n\t\treturn pruned;\n\t}\n\n\t/**\n\t * Get or create circuit breaker for tool\n\t */\n\tprivate getOrCreateCircuitBreaker(session: SessionState, toolName: string): CircuitBreaker {\n\t\tlet breaker = session.loopDetection.circuitBreakers.get(toolName);\n\n\t\tif (!breaker) {\n\t\t\tbreaker = {\n\t\t\t\ttool: toolName,\n\t\t\t\tstate: \"closed\",\n\t\t\t\tfailures: 0,\n\t\t\t\tthreshold: this.limits.circuitBreakerThreshold,\n\t\t\t\tlastFailure: 0,\n\t\t\t\tcooldownMs: this.limits.circuitBreakerCooldownMs,\n\t\t\t};\n\t\t\tsession.loopDetection.circuitBreakers.set(toolName, breaker);\n\t\t}\n\n\t\treturn breaker;\n\t}\n\n\t/**\n\t * Get session (null-safe)\n\t */\n\tprivate getSession(sessionId: string): SessionState | null {\n\t\treturn this.sessions.get(sessionId) ?? null;\n\t}\n\n\t/**\n\t * Get active session count\n\t */\n\tgetActiveSessionCount(): number {\n\t\treturn this.sessions.size;\n\t}\n\n\t// =========================================================================\n\t// PERSISTENCE (JSONL + Atomic Writes)\n\t// =========================================================================\n\n\t/**\n\t * Save all sessions to disk (atomic writes)\n\t * Based on web research best practices (GitHub jsonl-db, Claude Skills)\n\t */\n\tasync saveSessions(): Promise<void> {\n\t\tif (!this.persistencePath) {\n\t\t\tlogger.warn(\"saveSessions called but no persistencePath configured\");\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\t// Ensure directory exists\n\t\t\tconst dir = dirname(this.persistencePath);\n\t\t\tif (!existsSync(dir)) {\n\t\t\t\tawait mkdir(dir, { recursive: true });\n\t\t\t}\n\n\t\t\t// Convert sessions to serializable format (Maps  Objects)\n\t\t\tconst serializable = Array.from(this.sessions.entries()).map(([_id, session]) => ({\n\t\t\t\t...session,\n\t\t\t\tconsecutiveModifications: Object.fromEntries(session.consecutiveModifications),\n\t\t\t\tloopDetection: {\n\t\t\t\t\tsequence: session.loopDetection.sequence,\n\t\t\t\t\tdedupKeys: Array.from(session.loopDetection.dedupKeys),\n\t\t\t\t\tconsecutiveSameTool: Object.fromEntries(session.loopDetection.consecutiveSameTool),\n\t\t\t\t\tsemanticCache: Object.fromEntries(session.loopDetection.semanticCache),\n\t\t\t\t\tcircuitBreakers: Object.fromEntries(session.loopDetection.circuitBreakers),\n\t\t\t\t},\n\t\t\t}));\n\n\t\t\t// Atomic write (temp file  rename)\n\t\t\tconst jsonl = serializable.map((s) => JSON.stringify(s)).join(\"\\n\");\n\t\t\tawait writeFile(this.persistencePath, jsonl);\n\n\t\t\tlogger.debug(\"Sessions saved\", {\n\t\t\t\tcount: this.sessions.size,\n\t\t\t\tpath: this.persistencePath,\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tlogger.error(\"Failed to save sessions\", {\n\t\t\t\terror: error instanceof Error ? error.message : String(error),\n\t\t\t\tpath: this.persistencePath,\n\t\t\t});\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\t/**\n\t * Load sessions from disk\n\t */\n\tasync loadSessions(): Promise<void> {\n\t\tif (!this.persistencePath) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!existsSync(this.persistencePath)) {\n\t\t\tlogger.debug(\"No sessions file found, starting fresh\", {\n\t\t\t\tpath: this.persistencePath,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst content = await readFile(this.persistencePath, \"utf-8\");\n\t\t\tconst lines = content.split(\"\\n\").filter((line) => line.trim());\n\n\t\t\tlet loaded = 0;\n\t\t\tfor (const line of lines) {\n\t\t\t\ttry {\n\t\t\t\t\tconst data = JSON.parse(line);\n\n\t\t\t\t\t// Reconstruct Maps from Objects\n\t\t\t\t\tconst session: SessionState = {\n\t\t\t\t\t\t...data,\n\t\t\t\t\t\tconsecutiveModifications: new Map(Object.entries(data.consecutiveModifications || {})),\n\t\t\t\t\t\tloopDetection: {\n\t\t\t\t\t\t\tsequence: data.loopDetection.sequence || [],\n\t\t\t\t\t\t\tdedupKeys: new Set(data.loopDetection.dedupKeys || []),\n\t\t\t\t\t\t\tconsecutiveSameTool: new Map(Object.entries(data.loopDetection.consecutiveSameTool || {})),\n\t\t\t\t\t\t\tsemanticCache: new Map(Object.entries(data.loopDetection.semanticCache || {})),\n\t\t\t\t\t\t\tcircuitBreakers: new Map(Object.entries(data.loopDetection.circuitBreakers || {})),\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.sessions.set(session.sessionId, session);\n\t\t\t\t\tloaded++;\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlogger.warn(\"Failed to parse session line, skipping\", {\n\t\t\t\t\t\terror: error instanceof Error ? error.message : String(error),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlogger.info(\"Sessions loaded\", {\n\t\t\t\tcount: loaded,\n\t\t\t\tpath: this.persistencePath,\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tlogger.error(\"Failed to load sessions\", {\n\t\t\t\terror: error instanceof Error ? error.message : String(error),\n\t\t\t\tpath: this.persistencePath,\n\t\t\t});\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\t/**\n\t * Auto-save session after modifications (if enabled)\n\t */\n\tprivate async autoSave(): Promise<void> {\n\t\tif (this.autosaveEnabled && this.persistencePath) {\n\t\t\tawait this.saveSessions().catch((error) => {\n\t\t\t\tlogger.error(\"Autosave failed\", {\n\t\t\t\t\terror: error instanceof Error ? error.message : String(error),\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n}\n","/**\n * Config Store\n *\n * Loads and caches configuration from context files.\n * Provides static context for Anthropic prompt caching.\n */\n\nimport * as fs from \"node:fs\";\nimport * as path from \"node:path\";\nimport type { CacheableContext, ResolvedConfig } from \"../types/config.js\";\n\n/**\n * Config Store for loading architecture, constraints, and patterns\n */\nexport class ConfigStore {\n\tprivate config: ResolvedConfig;\n\tprivate cache: {\n\t\tarchitecture?: string;\n\t\tconstraints?: string;\n\t\tpatterns?: string;\n\t\ttimestamp?: string;\n\t} = {};\n\n\tconstructor(config: ResolvedConfig) {\n\t\tthis.config = config;\n\t}\n\n\t/**\n\t * Get the root directory for intelligence data\n\t */\n\tget rootDir(): string {\n\t\treturn this.config.rootDir;\n\t}\n\n\t/**\n\t * Resolve a path relative to rootDir\n\t */\n\tresolvePath(relativePath: string): string {\n\t\treturn path.join(this.config.rootDir, relativePath);\n\t}\n\n\t/**\n\t * Load architecture documentation\n\t */\n\tloadArchitecture(): string {\n\t\tif (this.cache.architecture) {\n\t\t\treturn this.cache.architecture;\n\t\t}\n\n\t\tconst archPath = this.resolvePath(\"ARCHITECTURE.md\");\n\t\tif (fs.existsSync(archPath)) {\n\t\t\tthis.cache.architecture = fs.readFileSync(archPath, \"utf-8\");\n\t\t} else {\n\t\t\tthis.cache.architecture = \"\";\n\t\t}\n\t\treturn this.cache.architecture;\n\t}\n\n\t/**\n\t * Load constraints/rules\n\t */\n\tloadConstraints(): string {\n\t\tif (this.cache.constraints) {\n\t\t\treturn this.cache.constraints;\n\t\t}\n\n\t\tconst constraintsPath = this.resolvePath(this.config.constraintsFile);\n\t\tif (fs.existsSync(constraintsPath)) {\n\t\t\tthis.cache.constraints = fs.readFileSync(constraintsPath, \"utf-8\");\n\t\t} else {\n\t\t\tthis.cache.constraints = \"\";\n\t\t}\n\t\treturn this.cache.constraints;\n\t}\n\n\t/**\n\t * Load codebase patterns\n\t */\n\tloadPatterns(): string {\n\t\tif (this.cache.patterns) {\n\t\t\treturn this.cache.patterns;\n\t\t}\n\n\t\tconst patternsPath = this.resolvePath(path.join(this.config.patternsDir, \"codebase-patterns.md\"));\n\t\tif (fs.existsSync(patternsPath)) {\n\t\t\tthis.cache.patterns = fs.readFileSync(patternsPath, \"utf-8\");\n\t\t} else {\n\t\t\tthis.cache.patterns = \"\";\n\t\t}\n\t\treturn this.cache.patterns;\n\t}\n\n\t/**\n\t * Load any context file by name\n\t */\n\tloadContextFile(filename: string): string {\n\t\tconst filePath = this.resolvePath(filename);\n\t\tif (fs.existsSync(filePath)) {\n\t\t\treturn fs.readFileSync(filePath, \"utf-8\");\n\t\t}\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Get static context suitable for prompt caching\n\t * Content changes rarely - cache for 5+ minutes\n\t */\n\tgetStaticContext(): CacheableContext {\n\t\treturn {\n\t\t\tarchitecture: this.loadArchitecture(),\n\t\t\tconstraints: this.loadConstraints(),\n\t\t\tpatterns: this.loadPatterns(),\n\t\t\ttimestamp: new Date().toISOString(),\n\t\t};\n\t}\n\n\t/**\n\t * Clear the cache (for testing or after file changes)\n\t */\n\tclearCache(): void {\n\t\tthis.cache = {};\n\t}\n\n\t/**\n\t * Check if a context file exists\n\t */\n\tcontextFileExists(filename: string): boolean {\n\t\treturn fs.existsSync(this.resolvePath(filename));\n\t}\n\n\t/**\n\t * List all context files that exist\n\t */\n\tlistAvailableContextFiles(): string[] {\n\t\treturn this.config.contextFiles.filter((f) => this.contextFileExists(f));\n\t}\n}\n","/**\n * Intelligence Package Configuration\n *\n * Defines the configuration interface for the Intelligence facade.\n * Same algorithms, different data sources based on config.\n */\n\nimport type { ValidationIssue } from \"@snapback/contracts\";\nimport { z } from \"zod\";\n\n/**\n * Issue detected during validation\n * Re-exported from contracts for backward compatibility\n */\nexport type Issue = ValidationIssue;\n\n/**\n * Validation layer interface for extensibility\n */\nexport interface ValidationLayer {\n\tname: string;\n\tvalidate(code: string, filePath: string): Promise<{ issues: Issue[] }>;\n}\n\n/**\n * Custom constraint for validation\n */\nexport interface Constraint {\n\tid: string;\n\tname: string;\n\tdescription: string;\n\tcheck: (code: string, filePath: string) => Issue[];\n}\n\n/**\n * Configuration schema for Intelligence\n */\nexport const IntelligenceConfigSchema = z.object({\n\t/**\n\t * Root directory for all intelligence data\n\t * Internal: 'ai_dev_utils'\n\t * Product: workspace root or .snapback/\n\t */\n\trootDir: z.string(),\n\n\t/**\n\t * Directory containing pattern definitions\n\t * @default 'patterns'\n\t */\n\tpatternsDir: z.string().optional().default(\"patterns\"),\n\n\t/**\n\t * Directory for learnings and feedback\n\t * @default 'feedback'\n\t */\n\tlearningsDir: z.string().optional().default(\"feedback\"),\n\n\t/**\n\t * File containing constraints/rules\n\t * @default 'CONSTRAINTS.md'\n\t */\n\tconstraintsFile: z.string().optional().default(\"CONSTRAINTS.md\"),\n\n\t/**\n\t * JSONL file for violation tracking\n\t * @default 'violations.jsonl'\n\t */\n\tviolationsFile: z.string().optional().default(\"patterns/violations.jsonl\"),\n\n\t/**\n\t * SQLite database for embeddings\n\t * @default 'embeddings.db'\n\t */\n\tembeddingsDb: z.string().optional().default(\"embeddings.db\"),\n\n\t/**\n\t * Files to index for semantic search\n\t */\n\tcontextFiles: z\n\t\t.array(z.string())\n\t\t.optional()\n\t\t.default([\"ARCHITECTURE.md\", \"CONSTRAINTS.md\", \"ROUTER.md\", \"patterns/codebase-patterns.md\"]),\n\n\t/**\n\t * Enable semantic search with embeddings\n\t * Requires @huggingface/transformers\n\t * @default false\n\t */\n\tenableSemanticSearch: z.boolean().optional().default(false),\n\n\t/**\n\t * Enable enhanced validation layers (Biome + TypeScript compiler + dynamic confidence)\n\t * Requires pnpm build to have completed successfully\n\t * @default false\n\t */\n\tenhancedValidation: z.boolean().optional().default(false),\n\n\t/**\n\t * Enable learning loop (violation tracking, feedback)\n\t * @default true\n\t */\n\tenableLearningLoop: z.boolean().optional().default(true),\n\n\t/**\n\t * Auto-promote patterns at 3x violations\n\t * @default true\n\t */\n\tenableAutoPromotion: z.boolean().optional().default(true),\n\n\t/**\n\t * Session limits configuration (Phase 1)\n\t */\n\tsessionLimits: z\n\t\t.object({\n\t\t\tmaxToolCalls: z.number().optional(),\n\t\t\tmaxConsecutiveSameTool: z.number().optional(),\n\t\t\tmaxFileModifications: z.number().optional(),\n\t\t\tmaxConsecutiveSameFile: z.number().optional(),\n\t\t\tsessionTimeoutMs: z.number().optional(),\n\t\t\tmaxTurns: z.number().optional(),\n\t\t\tcircuitBreakerThreshold: z.number().optional(),\n\t\t\tcircuitBreakerCooldownMs: z.number().optional(),\n\t\t})\n\t\t.optional(),\n\n\t/**\n\t * Session persistence configuration\n\t * Enables cross-surface session sharing (Extension, MCP, CLI)\n\t */\n\tsessionPersistence: z\n\t\t.object({\n\t\t\t/**\n\t\t\t * Path for session persistence (JSONL format)\n\t\t\t * @default '.snapback/session/sessions.jsonl'\n\t\t\t */\n\t\t\tpath: z.string().optional(),\n\t\t\t/**\n\t\t\t * Enable autosave on session changes\n\t\t\t * @default true\n\t\t\t */\n\t\t\tautosave: z.boolean().optional().default(true),\n\t\t})\n\t\t.optional(),\n\n\t/**\n\t * Advisory system configuration (Phase 2)\n\t */\n\tadvisoryConfig: z\n\t\t.object({\n\t\t\tenabled: z.boolean().optional(),\n\t\t\tmaxWarnings: z.number().optional(),\n\t\t\tmaxSuggestions: z.number().optional(),\n\t\t\tmaxRelatedFiles: z.number().optional(),\n\t\t\tincludeSessionContext: z.boolean().optional(),\n\t\t\tincludeFileHistory: z.boolean().optional(),\n\t\t})\n\t\t.optional(),\n});\n\nexport type IntelligenceConfig = z.input<typeof IntelligenceConfigSchema>;\nexport type ResolvedConfig = z.output<typeof IntelligenceConfigSchema>;\n\n/**\n * Cacheable context for Anthropic prompt caching\n */\nexport interface CacheableContext {\n\tarchitecture: string;\n\tconstraints: string;\n\tpatterns: string;\n\ttimestamp: string;\n}\n","/**\n * Validation Types\n *\n * Types for the 7-layer validation pipeline.\n */\n\nimport type { ValidationSeverity } from \"@snapback/contracts\";\nimport type { Issue } from \"./config.js\";\n\n/**\n * Result from a single validation layer\n */\nexport interface ValidationResult {\n\tlayer: string;\n\tpassed: boolean;\n\tissues: Issue[];\n\tduration: number;\n}\n\n/**\n * Overall pipeline result with confidence scoring\n */\nexport interface PipelineResult {\n\toverall: {\n\t\tpassed: boolean;\n\t\tconfidence: number;\n\t\ttotalIssues: number;\n\t};\n\tlayers: ValidationResult[];\n\trecommendation: ReviewRecommendation;\n\tfocusPoints: string[];\n}\n\n/**\n * Review recommendation based on confidence\n */\nexport type ReviewRecommendation = \"auto_merge\" | \"quick_review\" | \"full_review\";\n\n/**\n * Confidence thresholds for review routing\n */\nexport const CONFIDENCE_THRESHOLDS = {\n\tAUTO_MERGE: 0.95,\n\tQUICK_REVIEW: 0.7,\n\tFULL_REVIEW: 0.5,\n} as const;\n\n/**\n * Issue count thresholds for review routing\n */\nexport const ISSUE_THRESHOLDS = {\n\tQUICK_REVIEW: 2,\n\tFULL_REVIEW: 5,\n} as const;\n\n/**\n * Pattern match result from constraint checking\n */\nexport interface PatternMatch {\n\tpattern: string;\n\tfile: string;\n\tline?: number;\n\tseverity: ValidationSeverity;\n}\n\n// Re-export Issue for convenience\nexport type { Issue } from \"./config.js\";\n","/**\n * DynamicConfidenceCalculator\n *\n * Calculates confidence scores using weighted severity scoring.\n * Different layers have different weights based on their impact on code quality.\n *\n * Weight rationale:\n * - Security (0.30 critical): Security issues are most impactful\n * - Syntax (0.25 critical): Broken code is unusable\n * - Types (0.20 critical): Type errors cause runtime failures\n * - Architecture (0.15 critical): Layer violations create tech debt\n * - Tests (0.05 critical): Test issues don't break production\n * - Dependencies (0.03 critical): Usually minor impact\n * - Performance (0.02 critical): Often informational\n *\n * @module validation/DynamicConfidenceCalculator\n */\n\nimport type { Issue } from \"../types/config.js\";\nimport type { ValidationResult } from \"../types/validation.js\";\n\n/**\n * Weight configuration for each layer\n */\ninterface LayerWeight {\n\tcritical: number;\n\twarning: number;\n\tinfo: number;\n}\n\n/**\n * Default weights for validation layers\n */\nconst DEFAULT_WEIGHTS: Record<string, LayerWeight> = {\n\t// Core code quality\n\tsyntax: { critical: 0.25, warning: 0.05, info: 0.01 },\n\ttypes: { critical: 0.2, warning: 0.03, info: 0.01 },\n\t\"typescript-compiler\": { critical: 0.2, warning: 0.03, info: 0.01 },\n\n\t// Security is paramount\n\tsecurity: { critical: 0.3, warning: 0.1, info: 0.02 },\n\n\t// Architecture matters for maintainability\n\tarchitecture: { critical: 0.15, warning: 0.05, info: 0.01 },\n\n\t// Test issues are less critical to production\n\ttests: { critical: 0.05, warning: 0.02, info: 0.005 },\n\n\t// Dependencies and performance are informational\n\tdependencies: { critical: 0.03, warning: 0.01, info: 0.005 },\n\tperformance: { critical: 0.02, warning: 0.01, info: 0.005 },\n\n\t// Biome catches style/lint issues - moderate weight\n\tbiome: { critical: 0.1, warning: 0.03, info: 0.01 },\n};\n\n/**\n * Default weight for unknown layers\n */\nconst UNKNOWN_LAYER_WEIGHT: LayerWeight = {\n\tcritical: 0.05,\n\twarning: 0.02,\n\tinfo: 0.01,\n};\n\n/**\n * DynamicConfidenceCalculator\n *\n * Calculates confidence using weighted penalties instead of hardcoded thresholds.\n * This provides more nuanced scoring where security issues matter more than style.\n */\nexport class DynamicConfidenceCalculator {\n\tprivate weights: Record<string, LayerWeight>;\n\n\tconstructor(customWeights?: Record<string, LayerWeight>) {\n\t\tthis.weights = { ...DEFAULT_WEIGHTS, ...customWeights };\n\t}\n\n\t/**\n\t * Calculate confidence score from validation results\n\t *\n\t * @param layers - Validation results from each layer\n\t * @returns Confidence score between 0.10 and 0.95\n\t */\n\tcalculate(layers: ValidationResult[]): number {\n\t\tif (layers.length === 0) {\n\t\t\treturn 0.95; // No validation = assume good (edge case)\n\t\t}\n\n\t\tlet totalPenalty = 0;\n\n\t\tfor (const layer of layers) {\n\t\t\tconst layerWeight = this.weights[layer.layer] || UNKNOWN_LAYER_WEIGHT;\n\n\t\t\tfor (const issue of layer.issues) {\n\t\t\t\tconst severityWeight = this.getSeverityWeight(layerWeight, issue.severity);\n\t\t\t\ttotalPenalty += severityWeight;\n\t\t\t}\n\t\t}\n\n\t\t// Calculate confidence: start at 1.0, subtract penalties\n\t\tconst rawConfidence = 1 - totalPenalty;\n\n\t\t// Clamp to [0.10, 0.95]\n\t\treturn Math.max(0.1, Math.min(0.95, rawConfidence));\n\t}\n\n\t/**\n\t * Get weight for a severity level in a layer\n\t */\n\tprivate getSeverityWeight(layerWeight: LayerWeight, severity: Issue[\"severity\"]): number {\n\t\tswitch (severity) {\n\t\t\tcase \"critical\":\n\t\t\t\treturn layerWeight.critical;\n\t\t\tcase \"warning\":\n\t\t\t\treturn layerWeight.warning;\n\t\t\tcase \"info\":\n\t\t\t\treturn layerWeight.info;\n\t\t\tdefault:\n\t\t\t\treturn layerWeight.info;\n\t\t}\n\t}\n\n\t/**\n\t * Get weight for a specific layer\n\t */\n\tgetLayerWeight(layerName: string): LayerWeight {\n\t\treturn this.weights[layerName] || UNKNOWN_LAYER_WEIGHT;\n\t}\n\n\t/**\n\t * Update weights for a layer\n\t */\n\tsetLayerWeight(layerName: string, weight: LayerWeight): void {\n\t\tthis.weights[layerName] = weight;\n\t}\n\n\t/**\n\t * Get all configured weights\n\t */\n\tgetWeights(): Record<string, LayerWeight> {\n\t\treturn { ...this.weights };\n\t}\n}\n\n/**\n * Default instance for convenience\n */\nexport const defaultConfidenceCalculator = new DynamicConfidenceCalculator();\n","/**\n * Secret Detector - Identifies potential secrets in code\n * Uses pattern matching and entropy analysis\n */\n\nexport interface SecretPattern {\n\tname: string;\n\tpattern: RegExp;\n\tentropy?: number;\n\tseverity: \"low\" | \"medium\" | \"high\" | \"critical\";\n}\n\nexport interface SecretFinding {\n\ttype: string;\n\tline: number;\n\tcolumn: number;\n\tsnippet: string;\n\tseverity: \"low\" | \"medium\" | \"high\" | \"critical\";\n\tentropy?: number;\n\truleId: string;\n}\n\nexport interface SecretDetectionResult {\n\tfindings: SecretFinding[];\n\triskScore: number;\n}\n\n// Known secret patterns\nconst SECRET_PATTERNS: SecretPattern[] = [\n\t{\n\t\tname: \"AWS Access Key\",\n\t\tpattern: /AKIA[0-9A-Z]{16}/g,\n\t\tseverity: \"critical\",\n\t},\n\t{\n\t\tname: \"AWS Secret Key\",\n\t\tpattern: /aws_secret_access_key\\s*=\\s*[\"']?([A-Za-z0-9/+=]{40})[\"']?/gi,\n\t\tseverity: \"critical\",\n\t},\n\t{\n\t\tname: \"GitHub Token\",\n\t\tpattern: /gh[ps]_[a-zA-Z0-9]{36}/g,\n\t\tseverity: \"critical\",\n\t},\n\t{\n\t\tname: \"Stripe API Key\",\n\t\tpattern: /sk_(?:live|test)_[a-zA-Z0-9]{24}/g,\n\t\tseverity: \"critical\",\n\t},\n\t{\n\t\tname: \"Generic API Key\",\n\t\tpattern: /[\"']?api[_-]?key[\"']?\\s*[=:]\\s*[\"']([a-zA-Z0-9_-]{20,})[\"']/gi,\n\t\tseverity: \"high\",\n\t},\n\t{\n\t\tname: \"Private Key Header\",\n\t\tpattern: /-----BEGIN (?:RSA |DSA |EC |OPENSSH )?PRIVATE KEY-----/g,\n\t\tseverity: \"critical\",\n\t},\n\t{\n\t\tname: \"Bearer Token\",\n\t\tpattern: /Bearer\\s+[a-zA-Z0-9\\-._~+/]+=*/gi,\n\t\tseverity: \"high\",\n\t},\n\t{\n\t\tname: \"Password Assignment\",\n\t\tpattern: /password\\s*[=:]\\s*[\"']([^\"']{8,})[\"']/gi,\n\t\tseverity: \"medium\",\n\t},\n\t{\n\t\tname: \"OAuth Token\",\n\t\tpattern: /oauth[_-]?token\\s*[=:]\\s*[\"']([a-zA-Z0-9_-]{20,})[\"']/gi,\n\t\tseverity: \"high\",\n\t},\n];\n\nexport class SecretDetector {\n\t/**\n\t * Detect secrets in file content\n\t */\n\tdetect(content: string, filePath: string): SecretDetectionResult {\n\t\tconst findings: SecretFinding[] = [];\n\n\t\t// Skip test files to reduce false positives\n\t\tif (this.isTestFile(filePath)) {\n\t\t\treturn { findings: [], riskScore: 0 };\n\t\t}\n\n\t\t// Split content into lines for accurate reporting\n\t\tconst lines = content.split(\"\\n\");\n\n\t\t// Remove multi-line comments first\n\t\tconst cleanedLines = this.removeMultiLineComments(lines);\n\n\t\t// Check each pattern\n\t\tfor (const pattern of SECRET_PATTERNS) {\n\t\t\tfor (let lineNum = 0; lineNum < cleanedLines.length; lineNum++) {\n\t\t\t\tconst line = cleanedLines[lineNum];\n\t\t\t\tconst originalLine = lines[lineNum]; // Keep for snippet\n\t\t\t\tconst matches = line.matchAll(pattern.pattern);\n\n\t\t\t\tfor (const match of matches) {\n\t\t\t\t\t// Skip if it's in a single-line comment\n\t\t\t\t\tif (this.isInSingleLineComment(originalLine, match.index || 0)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst snippet = match[0].substring(0, 50); // First 50 chars\n\t\t\t\t\tconst entropy = this.calculateEntropy(match[1] || match[0]);\n\n\t\t\t\t\tfindings.push({\n\t\t\t\t\t\ttype: pattern.name,\n\t\t\t\t\t\tline: lineNum + 1,\n\t\t\t\t\t\tcolumn: (match.index || 0) + 1,\n\t\t\t\t\t\tsnippet,\n\t\t\t\t\t\tseverity: pattern.severity,\n\t\t\t\t\t\tentropy,\n\t\t\t\t\t\truleId: `secret-detection/${pattern.name.toLowerCase().replace(/\\s+/g, \"-\")}`,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Check for high-entropy strings (potential secrets)\n\t\tthis.detectHighEntropyStrings(cleanedLines, lines, findings);\n\n\t\t// Calculate risk score (0-10)\n\t\tconst riskScore = this.calculateRiskScore(findings);\n\n\t\treturn { findings, riskScore };\n\t}\n\n\t/**\n\t * Calculate Shannon entropy of a string\n\t */\n\tprivate calculateEntropy(str: string): number {\n\t\tif (str.length === 0) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tconst freq: Record<string, number> = {};\n\t\tfor (const char of str) {\n\t\t\tfreq[char] = (freq[char] || 0) + 1;\n\t\t}\n\n\t\tlet entropy = 0;\n\t\tconst len = str.length;\n\t\tfor (const char in freq) {\n\t\t\tconst p = freq[char] / len;\n\t\t\tentropy -= p * Math.log2(p);\n\t\t}\n\n\t\treturn entropy;\n\t}\n\n\t/**\n\t * Detect high-entropy strings that might be secrets\n\t */\n\tprivate detectHighEntropyStrings(\n\t\tcleanedLines: string[],\n\t\t_originalLines: string[],\n\t\tfindings: SecretFinding[],\n\t): void {\n\t\tconst stringPattern = /[\"']([a-zA-Z0-9+/=_-]{20,})[\"']/g;\n\n\t\tfor (let lineNum = 0; lineNum < cleanedLines.length; lineNum++) {\n\t\t\tconst line = cleanedLines[lineNum];\n\t\t\tconst matches = line.matchAll(stringPattern);\n\n\t\t\tfor (const match of matches) {\n\t\t\t\tconst str = match[1];\n\t\t\t\tconst entropy = this.calculateEntropy(str);\n\n\t\t\t\t// High entropy threshold: 4.5 (randomness indicator)\n\t\t\t\tif (entropy > 4.5 && str.length >= 20) {\n\t\t\t\t\tfindings.push({\n\t\t\t\t\t\ttype: \"High-Entropy String\",\n\t\t\t\t\t\tline: lineNum + 1,\n\t\t\t\t\t\tcolumn: (match.index || 0) + 1,\n\t\t\t\t\t\tsnippet: str.substring(0, 50),\n\t\t\t\t\t\tseverity: \"medium\",\n\t\t\t\t\t\tentropy,\n\t\t\t\t\t\truleId: \"secret-detection/high-entropy-string\",\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Check if file is a test file\n\t */\n\tprivate isTestFile(filePath: string): boolean {\n\t\tconst testPatterns = [\n\t\t\t/\\.test\\.[jt]sx?$/,\n\t\t\t/\\.spec\\.[jt]sx?$/,\n\t\t\t/__tests__\\//,\n\t\t\t/\\/test\\//,\n\t\t\t/\\/tests\\//,\n\t\t\t/\\.fixture\\.[jt]sx?$/,\n\t\t];\n\n\t\treturn testPatterns.some((pattern) => pattern.test(filePath));\n\t}\n\n\t/**\n\t * Remove multi-line comments from lines\n\t */\n\tprivate removeMultiLineComments(lines: string[]): string[] {\n\t\tconst result: string[] = [];\n\t\tlet inComment = false;\n\n\t\tfor (const line of lines) {\n\t\t\tlet cleanedLine = line;\n\n\t\t\tif (inComment) {\n\t\t\t\t// Check if comment ends on this line\n\t\t\t\tconst endIndex = line.indexOf(\"*/\");\n\t\t\t\tif (endIndex !== -1) {\n\t\t\t\t\tcleanedLine = line.substring(endIndex + 2);\n\t\t\t\t\tinComment = false;\n\t\t\t\t} else {\n\t\t\t\t\t// Entire line is in comment\n\t\t\t\t\tcleanedLine = \"\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Check for comment start\n\t\t\tconst startIndex = cleanedLine.indexOf(\"/*\");\n\t\t\tif (startIndex !== -1) {\n\t\t\t\tconst endIndex = cleanedLine.indexOf(\"*/\", startIndex);\n\t\t\t\tif (endIndex !== -1) {\n\t\t\t\t\t// Single-line /* */ comment\n\t\t\t\t\tcleanedLine = cleanedLine.substring(0, startIndex) + cleanedLine.substring(endIndex + 2);\n\t\t\t\t} else {\n\t\t\t\t\t// Multi-line comment starts\n\t\t\t\t\tcleanedLine = cleanedLine.substring(0, startIndex);\n\t\t\t\t\tinComment = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.push(cleanedLine);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Check if position is in a single-line comment\n\t */\n\tprivate isInSingleLineComment(line: string, position: number): boolean {\n\t\tconst beforePosition = line.substring(0, position);\n\t\t// Check for // comments\n\t\tif (beforePosition.includes(\"//\")) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Calculate overall risk score (0-10)\n\t */\n\tprivate calculateRiskScore(findings: SecretFinding[]): number {\n\t\tif (findings.length === 0) {\n\t\t\treturn 0;\n\t\t}\n\n\t\t// Weight by severity\n\t\tconst severityWeights = {\n\t\t\tcritical: 10,\n\t\t\thigh: 7,\n\t\t\tmedium: 4,\n\t\t\tlow: 2,\n\t\t};\n\n\t\tlet totalScore = 0;\n\t\tfor (const finding of findings) {\n\t\t\ttotalScore += severityWeights[finding.severity];\n\t\t\t// Add entropy bonus for high-entropy findings\n\t\t\tif (finding.entropy && finding.entropy > 5) {\n\t\t\t\ttotalScore += 1;\n\t\t\t}\n\t\t}\n\n\t\t// Cap at 10\n\t\treturn Math.min(10, totalScore);\n\t}\n}\n","/**\n * BiomeLayer - Programmatic Biome Integration\n *\n * Runs Biome linter on code and returns structured issues.\n * Leverages the project's existing Biome configuration.\n *\n * This layer catches:\n * - Unused imports (noUnusedImports)\n * - Unused variables (noUnusedVariables)\n * - Style issues (noNonNullAssertion, etc.)\n * - A11y issues (noSvgWithoutTitle, etc.)\n *\n * @module validation/layers/BiomeLayer\n */\n\nimport { spawn } from \"node:child_process\";\nimport { mkdtemp, rm, writeFile } from \"node:fs/promises\";\nimport { tmpdir } from \"node:os\";\nimport { join } from \"node:path\";\nimport type { Issue, ValidationLayer } from \"../../types/config.js\";\n\ninterface BiomeDiagnostic {\n\tcategory?: string;\n\tseverity?: string;\n\tmessage?: string;\n\tdescription?: string;\n\tpath?: string;\n\tlocation?: {\n\t\tpath?: { file?: string };\n\t\tspan?: { start?: number; end?: number };\n\t};\n}\n\ninterface BiomeOutput {\n\tdiagnostics?: BiomeDiagnostic[];\n}\n\n/**\n * BiomeLayer - Validates code using Biome linter\n */\nexport class BiomeLayer implements ValidationLayer {\n\tname = \"biome\";\n\n\tconstructor(private workspaceRoot: string) {}\n\n\tasync validate(code: string, filePath: string): Promise<{ issues: Issue[] }> {\n\t\tconst issues: Issue[] = [];\n\n\t\t// Handle empty code\n\t\tif (!code || code.trim() === \"\") {\n\t\t\treturn { issues };\n\t\t}\n\n\t\ttry {\n\t\t\tconst result = await this.runBiome(code, filePath);\n\t\t\treturn { issues: result };\n\t\t} catch {\n\t\t\t// Biome not available or failed - return empty issues\n\t\t\t// Don't fail validation just because biome isn't available\n\t\t\treturn { issues };\n\t\t}\n\t}\n\n\t/**\n\t * Run Biome on the provided code\n\t */\n\tprivate async runBiome(code: string, filePath: string): Promise<Issue[]> {\n\t\t// Create a temp file with the code\n\t\tconst tempDir = await mkdtemp(join(tmpdir(), \"biome-validation-\"));\n\t\tconst tempFile = join(tempDir, filePath.replace(/^.*[\\\\/]/, \"\"));\n\n\t\ttry {\n\t\t\tawait writeFile(tempFile, code, \"utf8\");\n\n\t\t\tconst result = await this.execBiome(tempFile);\n\t\t\treturn this.parseBiomeOutput(result, code);\n\t\t} finally {\n\t\t\t// Cleanup temp directory\n\t\t\tawait rm(tempDir, { recursive: true, force: true }).catch(() => {});\n\t\t}\n\t}\n\n\t/**\n\t * Execute biome check command\n\t */\n\tprivate execBiome(filePath: string): Promise<string> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet stdout = \"\";\n\t\t\tlet stderr = \"\";\n\n\t\t\tconst proc = spawn(\"npx\", [\"biome\", \"check\", \"--reporter=json\", filePath], {\n\t\t\t\tcwd: this.workspaceRoot,\n\t\t\t\tshell: true,\n\t\t\t\tstdio: [\"pipe\", \"pipe\", \"pipe\"],\n\t\t\t});\n\n\t\t\tconst timeout = setTimeout(() => {\n\t\t\t\tproc.kill(\"SIGTERM\");\n\t\t\t\treject(new Error(\"Biome check timed out\"));\n\t\t\t}, 15000);\n\n\t\t\tproc.stdout?.on(\"data\", (data) => {\n\t\t\t\tstdout += data.toString();\n\t\t\t});\n\n\t\t\tproc.stderr?.on(\"data\", (data) => {\n\t\t\t\tstderr += data.toString();\n\t\t\t});\n\n\t\t\tproc.on(\"close\", (_code) => {\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\t// Biome returns non-zero when there are issues, that's expected\n\t\t\t\tresolve(stdout || stderr);\n\t\t\t});\n\n\t\t\tproc.on(\"error\", (err) => {\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\treject(err);\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Parse Biome JSON output into Issue array\n\t */\n\tprivate parseBiomeOutput(output: string, code: string): Issue[] {\n\t\tconst issues: Issue[] = [];\n\n\t\tif (!output) {\n\t\t\treturn issues;\n\t\t}\n\n\t\ttry {\n\t\t\t// Try to parse as JSON\n\t\t\tconst parsed = JSON.parse(output) as BiomeOutput;\n\n\t\t\tif (parsed.diagnostics && Array.isArray(parsed.diagnostics)) {\n\t\t\t\tfor (const diag of parsed.diagnostics) {\n\t\t\t\t\tissues.push(this.diagnosticToIssue(diag, code));\n\t\t\t\t}\n\t\t\t}\n\t\t} catch {\n\t\t\t// Try to extract diagnostics from non-JSON output\n\t\t\t// Biome sometimes outputs line-by-line diagnostics\n\t\t\tconst lines = output.split(\"\\n\").filter((l) => l.trim());\n\t\t\tfor (const line of lines) {\n\t\t\t\tif (line.includes(\"error\") || line.includes(\"warning\")) {\n\t\t\t\t\tissues.push({\n\t\t\t\t\t\tseverity: line.includes(\"error\") ? \"critical\" : \"warning\",\n\t\t\t\t\t\ttype: \"BIOME_ISSUE\",\n\t\t\t\t\t\tmessage: line.trim().slice(0, 200),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn issues;\n\t}\n\n\t/**\n\t * Convert Biome diagnostic to Issue format\n\t */\n\tprivate diagnosticToIssue(diag: BiomeDiagnostic, code: string): Issue {\n\t\tconst severity = this.mapSeverity(diag.severity);\n\t\tconst type = diag.category || \"BIOME_ISSUE\";\n\t\tconst message = diag.message || diag.description || \"Unknown issue\";\n\n\t\t// Try to find line number from span\n\t\tlet line: number | undefined;\n\t\tif (diag.location?.span?.start !== undefined) {\n\t\t\tconst offset = diag.location.span.start;\n\t\t\tconst beforeOffset = code.slice(0, offset);\n\t\t\tline = (beforeOffset.match(/\\n/g) || []).length + 1;\n\t\t}\n\n\t\treturn {\n\t\t\tseverity,\n\t\t\ttype: this.normalizeType(type),\n\t\t\tmessage: message.slice(0, 300),\n\t\t\tline,\n\t\t\tfix: this.getSuggestedFix(type),\n\t\t};\n\t}\n\n\t/**\n\t * Map Biome severity to Issue severity\n\t */\n\tprivate mapSeverity(severity?: string): \"critical\" | \"warning\" | \"info\" {\n\t\tswitch (severity?.toLowerCase()) {\n\t\t\tcase \"error\":\n\t\t\t\treturn \"critical\";\n\t\t\tcase \"warning\":\n\t\t\t\treturn \"warning\";\n\t\t\tdefault:\n\t\t\t\treturn \"info\";\n\t\t}\n\t}\n\n\t/**\n\t * Normalize Biome rule name to type\n\t */\n\tprivate normalizeType(category: string): string {\n\t\t// Extract rule name from category like \"lint/correctness/noUnusedVariables\"\n\t\tconst parts = category.split(\"/\");\n\t\treturn parts[parts.length - 1] || category;\n\t}\n\n\t/**\n\t * Get suggested fix for common issues\n\t */\n\tprivate getSuggestedFix(type: string): string | undefined {\n\t\tconst fixes: Record<string, string> = {\n\t\t\tnoUnusedImports: \"Remove the unused import\",\n\t\t\tnoUnusedVariables: \"Remove or use the variable\",\n\t\t\tnoNonNullAssertion: \"Use proper null check instead of !\",\n\t\t\tnoExplicitAny: \"Use a specific type instead of any\",\n\t\t\tuseBlockStatements: \"Add braces around the statement\",\n\t\t\tnoConsole: \"Use a logger instead of console\",\n\t\t};\n\t\treturn fixes[type];\n\t}\n}\n","/**\n * TypeScriptCompilerLayer - Real TypeScript Compiler Integration\n *\n * Runs the actual TypeScript compiler (tsc) on code to detect type errors.\n * This is more accurate than regex-based type checking.\n *\n * This layer catches:\n * - Type mismatches\n * - Missing properties\n * - Incorrect function signatures\n * - Generic type errors\n *\n * @module validation/layers/TypeScriptCompilerLayer\n */\n\nimport { spawn } from \"node:child_process\";\nimport { mkdtemp, rm, writeFile } from \"node:fs/promises\";\nimport { tmpdir } from \"node:os\";\nimport { join } from \"node:path\";\nimport type { Issue, ValidationLayer } from \"../../types/config.js\";\n\n/**\n * TypeScriptCompilerLayer - Validates code using tsc\n */\nexport class TypeScriptCompilerLayer implements ValidationLayer {\n\tname = \"typescript-compiler\";\n\n\tconstructor(private workspaceRoot: string) {}\n\n\tasync validate(code: string, filePath: string): Promise<{ issues: Issue[] }> {\n\t\t// Handle empty code\n\t\tif (!code || code.trim() === \"\") {\n\t\t\treturn { issues: [] };\n\t\t}\n\n\t\ttry {\n\t\t\tconst result = await this.runTsc(code, filePath);\n\t\t\treturn { issues: result };\n\t\t} catch {\n\t\t\t// tsc not available or failed - return empty issues\n\t\t\treturn { issues: [] };\n\t\t}\n\t}\n\n\t/**\n\t * Run TypeScript compiler on the provided code\n\t */\n\tprivate async runTsc(code: string, filePath: string): Promise<Issue[]> {\n\t\t// Create a temp file with the code\n\t\tconst tempDir = await mkdtemp(join(tmpdir(), \"tsc-validation-\"));\n\t\tconst fileName = filePath.replace(/^.*[\\\\/]/, \"\") || \"temp.ts\";\n\t\tconst tempFile = join(tempDir, fileName);\n\n\t\ttry {\n\t\t\tawait writeFile(tempFile, code, \"utf8\");\n\n\t\t\tconst result = await this.execTsc(tempFile);\n\t\t\treturn this.parseTscOutput(result, code);\n\t\t} finally {\n\t\t\t// Cleanup temp directory\n\t\t\tawait rm(tempDir, { recursive: true, force: true }).catch(() => {});\n\t\t}\n\t}\n\n\t/**\n\t * Execute tsc command\n\t */\n\tprivate execTsc(filePath: string): Promise<string> {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet stdout = \"\";\n\t\t\tlet stderr = \"\";\n\n\t\t\t// Use noEmit to just check types without generating output\n\t\t\tconst proc = spawn(\"npx\", [\"tsc\", \"--noEmit\", \"--pretty\", \"false\", \"--skipLibCheck\", filePath], {\n\t\t\t\tcwd: this.workspaceRoot,\n\t\t\t\tshell: true,\n\t\t\t\tstdio: [\"pipe\", \"pipe\", \"pipe\"],\n\t\t\t});\n\n\t\t\tconst timeout = setTimeout(() => {\n\t\t\t\tproc.kill(\"SIGTERM\");\n\t\t\t\treject(new Error(\"TypeScript check timed out\"));\n\t\t\t}, 15000);\n\n\t\t\tproc.stdout?.on(\"data\", (data) => {\n\t\t\t\tstdout += data.toString();\n\t\t\t});\n\n\t\t\tproc.stderr?.on(\"data\", (data) => {\n\t\t\t\tstderr += data.toString();\n\t\t\t});\n\n\t\t\tproc.on(\"close\", (_code) => {\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\t// tsc returns non-zero when there are errors, that's expected\n\t\t\t\tresolve(stdout + stderr);\n\t\t\t});\n\n\t\t\tproc.on(\"error\", (err) => {\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\treject(err);\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Parse tsc output into Issue array\n\t */\n\tprivate parseTscOutput(output: string, _code: string): Issue[] {\n\t\tconst issues: Issue[] = [];\n\n\t\tif (!output) {\n\t\t\treturn issues;\n\t\t}\n\n\t\tconst lines = output.split(\"\\n\");\n\n\t\tfor (const line of lines) {\n\t\t\t// Match tsc error format: file.ts(line,col): error TS1234: message\n\t\t\tconst match = line.match(/^(.+?)\\((\\d+),(\\d+)\\):\\s*(error|warning)\\s+(TS\\d+):\\s*(.+)$/);\n\n\t\t\tif (match) {\n\t\t\t\tconst [, , lineNum, , severity, tsCode, message] = match;\n\t\t\t\tissues.push({\n\t\t\t\t\tseverity: severity === \"error\" ? \"critical\" : \"warning\",\n\t\t\t\t\ttype: tsCode,\n\t\t\t\t\tmessage: message.trim(),\n\t\t\t\t\tline: Number.parseInt(lineNum, 10),\n\t\t\t\t\tfix: this.getSuggestedFix(tsCode),\n\t\t\t\t});\n\t\t\t} else if (line.includes(\"error TS\")) {\n\t\t\t\t// Fallback for other error formats\n\t\t\t\tconst codeMatch = line.match(/TS(\\d+)/);\n\t\t\t\tissues.push({\n\t\t\t\t\tseverity: \"critical\",\n\t\t\t\t\ttype: codeMatch ? `TS${codeMatch[1]}` : \"TS_ERROR\",\n\t\t\t\t\tmessage: line.trim().slice(0, 200),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn issues;\n\t}\n\n\t/**\n\t * Get suggested fix for common TypeScript errors\n\t */\n\tprivate getSuggestedFix(tsCode: string): string | undefined {\n\t\tconst fixes: Record<string, string> = {\n\t\t\tTS2322: \"Check type compatibility between the assigned value and variable type\",\n\t\t\tTS2339: \"Property does not exist - add it to the type or interface\",\n\t\t\tTS2345: \"Argument type mismatch - ensure function is called with correct types\",\n\t\t\tTS2304: \"Cannot find name - check import or variable declaration\",\n\t\t\tTS2531: \"Object is possibly null - add null check\",\n\t\t\tTS2532: \"Object is possibly undefined - add undefined check\",\n\t\t\tTS7006: \"Parameter implicitly has any type - add type annotation\",\n\t\t\tTS2307: \"Cannot find module - check import path or install package\",\n\t\t\tTS2341: \"Property is private - use public accessor or friend pattern\",\n\t\t\tTS2551: \"Property does not exist - did you mean a similar property?\",\n\t\t\tTS2769: \"No overload matches this call - check function signature\",\n\t\t};\n\t\treturn fixes[tsCode];\n\t}\n}\n","/**\n * Validation Layers\n *\n * Individual validation layers that run in parallel.\n * Each layer checks for a specific category of issues.\n *\n * Enhanced layers (BiomeLayer, TypeScriptCompilerLayer) are exported at bottom.\n *\n * SecurityLayer++: Integrated SecretDetector + unsafe function patterns\n * PerformanceLayer++: O(n), memory leaks, ReDoS detection\n *\n * @see https://docs.github.com/en/code-security/secret-scanning/introduction/supported-secret-scanning-patterns\n */\n\nimport { SecretDetector, type SecretFinding } from \"../../policy/detectors/SecretDetector.js\";\nimport type { Issue, ValidationLayer } from \"../../types/config.js\";\n\n/**\n * Helper to find line number for an issue\n */\nfunction findLine(code: string, search: string): number {\n\tif (!code) {\n\t\treturn 0;\n\t}\n\tconst lines = code.split(\"\\n\");\n\treturn lines.findIndex((l) => l.includes(search)) + 1;\n}\n\n/**\n * Check if file is a test file (for false positive prevention)\n */\nfunction isTestFile(filePath: string): boolean {\n\tif (!filePath) {\n\t\treturn false;\n\t}\n\treturn (\n\t\tfilePath.includes(\".test.\") ||\n\t\tfilePath.includes(\".spec.\") ||\n\t\tfilePath.includes(\"__tests__\") ||\n\t\tfilePath.includes(\"/test/\") ||\n\t\tfilePath.includes(\"/tests/\")\n\t);\n}\n\n/**\n * Layer 1: Syntax Validation\n * Checks for basic syntax issues\n */\nexport class SyntaxLayer implements ValidationLayer {\n\tname = \"syntax\";\n\n\tasync validate(code: string, _filePath: string): Promise<{ issues: Issue[] }> {\n\t\tconst issues: Issue[] = [];\n\n\t\t// Defensive null check\n\t\tif (!code) {\n\t\t\treturn { issues };\n\t\t}\n\n\t\t// Check for unclosed brackets/parens\n\t\tconst openBrackets = (code.match(/\\{/g) || []).length;\n\t\tconst closeBrackets = (code.match(/\\}/g) || []).length;\n\t\tif (openBrackets !== closeBrackets) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"critical\",\n\t\t\t\ttype: \"SYNTAX_ERROR\",\n\t\t\t\tmessage: `Mismatched braces: ${openBrackets} open, ${closeBrackets} close`,\n\t\t\t\tfix: \"Balance opening and closing braces\",\n\t\t\t});\n\t\t}\n\n\t\tconst openParens = (code.match(/\\(/g) || []).length;\n\t\tconst closeParens = (code.match(/\\)/g) || []).length;\n\t\tif (openParens !== closeParens) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"critical\",\n\t\t\t\ttype: \"SYNTAX_ERROR\",\n\t\t\t\tmessage: `Mismatched parentheses: ${openParens} open, ${closeParens} close`,\n\t\t\t\tfix: \"Balance opening and closing parentheses\",\n\t\t\t});\n\t\t}\n\n\t\t// Check for common syntax mistakes\n\t\tif (code.includes(\";;\")) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"warning\",\n\t\t\t\ttype: \"SYNTAX_WARNING\",\n\t\t\t\tmessage: \"Double semicolon detected\",\n\t\t\t\tline: findLine(code, \";;\"),\n\t\t\t\tfix: \"Remove extra semicolon\",\n\t\t\t});\n\t\t}\n\n\t\treturn { issues };\n\t}\n}\n\n/**\n * Layer 2: Type Safety Checks\n * Checks for TypeScript type safety issues\n */\nexport class TypeLayer implements ValidationLayer {\n\tname = \"types\";\n\n\tasync validate(code: string, _filePath: string): Promise<{ issues: Issue[] }> {\n\t\tconst issues: Issue[] = [];\n\n\t\t// Defensive null check\n\t\tif (!code) {\n\t\t\treturn { issues };\n\t\t}\n\n\t\t// Check for `any` type usage\n\t\tconst anyMatches = code.match(/:\\s*any\\b/g) || [];\n\t\tif (anyMatches.length > 0) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"warning\",\n\t\t\t\ttype: \"TYPE_SAFETY_BYPASS\",\n\t\t\t\tmessage: `Found ${anyMatches.length} uses of 'any' type`,\n\t\t\t\tfix: \"Use specific types or generics instead of 'any'\",\n\t\t\t});\n\t\t}\n\n\t\t// Check for @ts-expect-error without explanation\n\t\tif (code.includes(\"@ts-ignore\") && !code.includes(\"@ts-ignore -\")) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"warning\",\n\t\t\t\ttype: \"TS_IGNORE_NO_REASON\",\n\t\t\t\tmessage: \"@ts-ignore used without explanation\",\n\t\t\t\tline: findLine(code, \"@ts-ignore\"),\n\t\t\t\tfix: \"Add reason: // @ts-ignore - <reason>\",\n\t\t\t});\n\t\t}\n\n\t\t// Check for non-null assertions\n\t\tconst nonNullMatches = code.match(/\\w+!/g) || [];\n\t\tif (nonNullMatches.length > 3) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"info\",\n\t\t\t\ttype: \"EXCESSIVE_NON_NULL\",\n\t\t\t\tmessage: `Found ${nonNullMatches.length} non-null assertions (!)`,\n\t\t\t\tfix: \"Consider proper null checks instead\",\n\t\t\t});\n\t\t}\n\n\t\treturn { issues };\n\t}\n}\n\n/**\n * Layer 3: Test Coverage Checks\n * Validates test file patterns per C-003 and C-004\n */\nexport class TestLayer implements ValidationLayer {\n\tname = \"tests\";\n\n\tasync validate(code: string, filePath: string): Promise<{ issues: Issue[] }> {\n\t\tconst issues: Issue[] = [];\n\n\t\t// Defensive null checks\n\t\tif (!code || !filePath) {\n\t\t\treturn { issues };\n\t\t}\n\n\t\t// Only check test files\n\t\tif (!filePath.includes(\".test.\") && !filePath.includes(\"/test/\")) {\n\t\t\treturn { issues };\n\t\t}\n\n\t\t// Check for vague assertions (from CONSTRAINTS.md C-003)\n\t\tconst vaguePatterns = [\".toBeTruthy()\", \".toBeDefined()\", \".toBeFalsy()\"];\n\t\tfor (const pattern of vaguePatterns) {\n\t\t\tif (code.includes(pattern)) {\n\t\t\t\tissues.push({\n\t\t\t\t\tseverity: \"warning\",\n\t\t\t\t\ttype: \"VAGUE_ASSERTION\",\n\t\t\t\t\tmessage: `Found vague assertion: ${pattern}`,\n\t\t\t\t\tline: findLine(code, pattern),\n\t\t\t\t\tfix: \"Use specific assertions: .toEqual(), .toBe(), .toMatchObject()\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Check for 4-path coverage (C-004)\n\t\tconst hasHappyPath = code.includes(\"should\") && (code.includes(\"success\") || code.includes(\"correct\"));\n\t\tconst hasSadPath = code.includes(\"fail\") || code.includes(\"error\") || code.includes(\"invalid\");\n\t\tconst hasEdgeCase = code.includes(\"edge\") || code.includes(\"empty\") || code.includes(\"null\");\n\t\tconst hasErrorCase = code.includes(\"throw\") || code.includes(\"reject\");\n\n\t\tconst paths = [hasHappyPath, hasSadPath, hasEdgeCase, hasErrorCase].filter(Boolean).length;\n\t\tif (paths < 3) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"info\",\n\t\t\t\ttype: \"INCOMPLETE_COVERAGE\",\n\t\t\t\tmessage: `Only ${paths}/4 test paths covered (happy, sad, edge, error)`,\n\t\t\t\tfix: \"Add tests for missing paths\",\n\t\t\t});\n\t\t}\n\n\t\treturn { issues };\n\t}\n}\n\n/**\n * Layer 4: Architecture Validation\n * Checks for layer boundary and pattern violations per C-001, C-002\n */\nexport class ArchitectureLayer implements ValidationLayer {\n\tname = \"architecture\";\n\n\tasync validate(code: string, filePath: string): Promise<{ issues: Issue[] }> {\n\t\tconst issues: Issue[] = [];\n\n\t\t// Defensive null checks\n\t\tif (!code || !filePath) {\n\t\t\treturn { issues };\n\t\t}\n\n\t\t// C-001: Layer Boundary Enforcement\n\t\tif (\n\t\t\t(filePath.includes(\"apps/vscode/\") || filePath.includes(\"apps/web/\") || filePath.includes(\"apps/cli/\")) &&\n\t\t\tcode.includes(\"@snapback/infrastructure\")\n\t\t) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"critical\",\n\t\t\t\ttype: \"LAYER_BOUNDARY_VIOLATION\",\n\t\t\t\tmessage: \"Presentation layer cannot import @snapback/infrastructure\",\n\t\t\t\tline: findLine(code, \"@snapback/infrastructure\"),\n\t\t\t\tfix: \"Use @snapback/core instead\",\n\t\t\t});\n\t\t}\n\n\t\t// C-002: Service Layer for Business Logic\n\t\tif (filePath.includes(\"procedures/\") && (code.includes(\"db.query\") || code.includes(\"db.select\"))) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"critical\",\n\t\t\t\ttype: \"SERVICE_BYPASS\",\n\t\t\t\tmessage: \"Direct database access in procedure file\",\n\t\t\t\tline: findLine(code, \"db.\"),\n\t\t\t\tfix: \"Move business logic to apps/api/src/services/\",\n\t\t\t});\n\t\t}\n\n\t\t// Check for relative imports across package boundaries\n\t\tif (code.includes(\"from '../../../packages/\") || code.includes(\"from '../../packages/\")) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"warning\",\n\t\t\t\ttype: \"WRONG_IMPORT_PATTERN\",\n\t\t\t\tmessage: \"Relative imports across package boundaries\",\n\t\t\t\tline: findLine(code, \"../packages/\"),\n\t\t\t\tfix: \"Use @snapback/* package imports\",\n\t\t\t});\n\t\t}\n\n\t\treturn { issues };\n\t}\n}\n\n/**\n * Layer 5: Security Validation (Enhanced SecurityLayer++)\n *\n * Checks for security issues per C-006 with enhanced detection:\n * - SecretDetector integration (AWS, GitHub, Stripe, JWT, DB strings, private keys)\n * - Unsafe function detection (eval, exec, innerHTML, dangerouslySetInnerHTML)\n * - Privacy-first telemetry enforcement\n *\n * @see https://docs.github.com/en/code-security/secret-scanning/introduction/supported-secret-scanning-patterns\n */\nexport class SecurityLayer implements ValidationLayer {\n\tname = \"security\";\n\tprivate secretDetector = new SecretDetector();\n\n\t// Additional secret patterns not in SecretDetector\n\tprivate static readonly ADDITIONAL_SECRET_PATTERNS = [\n\t\t// GitHub Fine-Grained Token (github_pat_) - format: github_pat_{chars}_{rest}\n\t\t{\n\t\t\tname: \"GitHub Fine-Grained Token\",\n\t\t\tpattern: /github_pat_[A-Za-z0-9]+_[A-Za-z0-9_]{20,}/g,\n\t\t\tseverity: \"critical\" as const,\n\t\t},\n\t\t// JWT tokens\n\t\t{\n\t\t\tname: \"JWT Token\",\n\t\t\tpattern: /eyJ[A-Za-z0-9-_=]+\\.eyJ[A-Za-z0-9-_=]+\\.[A-Za-z0-9-_.+/=]*/g,\n\t\t\tseverity: \"critical\" as const,\n\t\t},\n\t\t// Database connection strings\n\t\t{\n\t\t\tname: \"PostgreSQL Connection String\",\n\t\t\tpattern: /postgres(?:ql)?:\\/\\/[^:]+:[^@]+@[^/]+/gi,\n\t\t\tseverity: \"critical\" as const,\n\t\t},\n\t\t{\n\t\t\tname: \"MongoDB Connection String\",\n\t\t\tpattern: /mongodb(?:\\+srv)?:\\/\\/[^:]+:[^@]+@[^/]+/gi,\n\t\t\tseverity: \"critical\" as const,\n\t\t},\n\t\t// EC Private Key (in addition to RSA)\n\t\t{\n\t\t\tname: \"EC Private Key\",\n\t\t\tpattern: /-----BEGIN EC PRIVATE KEY-----/g,\n\t\t\tseverity: \"critical\" as const,\n\t\t},\n\t\t// Stripe restricted key\n\t\t{\n\t\t\tname: \"Stripe Restricted Key\",\n\t\t\tpattern: /rk_(?:live|test)_[a-zA-Z0-9]{24}/g,\n\t\t\tseverity: \"critical\" as const,\n\t\t},\n\t];\n\n\t// Unsafe function patterns\n\tprivate static readonly UNSAFE_FUNCTION_PATTERNS = [\n\t\t{\n\t\t\tpattern: /child_process\\.exec\\s*\\(/,\n\t\t\ttype: \"COMMAND_INJECTION\",\n\t\t\tseverity: \"critical\" as const,\n\t\t\tmessage: \"child_process.exec() enables shell command injection\",\n\t\t\tfix: \"Use execFile() or spawn() with arguments array instead\",\n\t\t},\n\t\t{\n\t\t\tpattern: /\\bexec\\s*\\(\\s*`/,\n\t\t\ttype: \"COMMAND_INJECTION\",\n\t\t\tseverity: \"critical\" as const,\n\t\t\tmessage: \"exec() with template literal enables command injection\",\n\t\t\tfix: \"Use execFile() with arguments array\",\n\t\t},\n\t\t{\n\t\t\tpattern: /\\.innerHTML\\s*=/,\n\t\t\ttype: \"XSS_RISK\",\n\t\t\tseverity: \"warning\" as const,\n\t\t\tmessage: \"innerHTML assignment enables XSS attacks\",\n\t\t\tfix: \"Use textContent, createTextNode(), or sanitize with DOMPurify\",\n\t\t},\n\t\t{\n\t\t\tpattern: /dangerouslySetInnerHTML/,\n\t\t\ttype: \"XSS_RISK\",\n\t\t\tseverity: \"warning\" as const,\n\t\t\tmessage: \"dangerouslySetInnerHTML is a React XSS vector\",\n\t\t\tfix: \"Sanitize content with DOMPurify before rendering\",\n\t\t},\n\t\t{\n\t\t\tpattern: /spawn\\s*\\(\\s*['\"](?:sh|bash|cmd)['\"]/,\n\t\t\ttype: \"SHELL_INJECTION\",\n\t\t\tseverity: \"critical\" as const,\n\t\t\tmessage: \"Shell spawning enables command injection\",\n\t\t\tfix: \"Use direct program spawn: spawn('program', [args])\",\n\t\t},\n\t\t{\n\t\t\tpattern: /spawn\\s*\\([^)]+,\\s*\\[[^\\]]*\\]\\s*,\\s*\\{[^}]*shell\\s*:\\s*true/,\n\t\t\ttype: \"SHELL_INJECTION\",\n\t\t\tseverity: \"critical\" as const,\n\t\t\tmessage: \"spawn with shell:true enables command injection\",\n\t\t\tfix: \"Remove shell:true option and use arguments array\",\n\t\t},\n\t];\n\n\tasync validate(code: string, filePath: string): Promise<{ issues: Issue[] }> {\n\t\tconst issues: Issue[] = [];\n\n\t\t// Defensive null check\n\t\tif (!code) {\n\t\t\treturn { issues };\n\t\t}\n\n\t\t// 1. Run SecretDetector integration (skips test files automatically)\n\t\tthis.checkSecrets(code, filePath, issues);\n\n\t\t// 2. Check unsafe functions (applies to all files)\n\t\tthis.checkUnsafeFunctions(code, filePath, issues);\n\n\t\t// 3. C-006: Privacy-First Telemetry\n\t\tthis.checkPrivacyViolations(code, issues);\n\n\t\t// 4. Check for eval usage (existing)\n\t\tthis.checkEvalUsage(code, issues);\n\n\t\treturn { issues };\n\t}\n\n\t/**\n\t * Integrate SecretDetector + additional patterns\n\t */\n\tprivate checkSecrets(code: string, filePath: string, issues: Issue[]): void {\n\t\t// SecretDetector already skips test files\n\t\tconst secretResult = this.secretDetector.detect(code, filePath);\n\n\t\t// Convert SecretDetector findings to Issue format\n\t\tfor (const finding of secretResult.findings) {\n\t\t\tissues.push(this.adaptSecretFinding(finding));\n\t\t}\n\n\t\t// Skip additional pattern checks for test files\n\t\tif (isTestFile(filePath)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Check additional patterns not in SecretDetector\n\t\tfor (const pattern of SecurityLayer.ADDITIONAL_SECRET_PATTERNS) {\n\t\t\tconst matches = code.matchAll(pattern.pattern);\n\t\t\tfor (const match of matches) {\n\t\t\t\tissues.push({\n\t\t\t\t\tseverity: pattern.severity,\n\t\t\t\t\ttype: `SECRET_${pattern.name.toUpperCase().replace(/\\s+/g, \"_\")}`,\n\t\t\t\t\tmessage: `${pattern.name} detected: ${match[0].substring(0, 20)}...`,\n\t\t\t\t\tline: this.findLineForMatch(code, match.index || 0),\n\t\t\t\t\tfix: \"Use environment variables for secrets\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Check for unsafe function calls\n\t */\n\tprivate checkUnsafeFunctions(code: string, _filePath: string, issues: Issue[]): void {\n\t\tfor (const unsafe of SecurityLayer.UNSAFE_FUNCTION_PATTERNS) {\n\t\t\tif (unsafe.pattern.test(code)) {\n\t\t\t\t// Reset lastIndex for global patterns\n\t\t\t\tunsafe.pattern.lastIndex = 0;\n\t\t\t\tconst match = unsafe.pattern.exec(code);\n\t\t\t\tissues.push({\n\t\t\t\t\tseverity: unsafe.severity,\n\t\t\t\t\ttype: unsafe.type,\n\t\t\t\t\tmessage: unsafe.message,\n\t\t\t\t\tline: match ? this.findLineForMatch(code, match.index) : undefined,\n\t\t\t\t\tfix: unsafe.fix,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * C-006: Privacy-First Telemetry\n\t */\n\tprivate checkPrivacyViolations(code: string, issues: Issue[]): void {\n\t\tif (code.includes(\"posthog\") && (code.includes(\"fileContent\") || code.includes(\"sourceCode\"))) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"critical\",\n\t\t\t\ttype: \"PRIVACY_VIOLATION\",\n\t\t\t\tmessage: \"File content must never be sent to external services\",\n\t\t\t\tfix: \"Only send metadata: file paths, timestamps, counts, hashes\",\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Check for eval usage\n\t */\n\tprivate checkEvalUsage(code: string, issues: Issue[]): void {\n\t\tif (code.includes(\"eval(\") || code.includes(\"new Function(\")) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"critical\",\n\t\t\t\ttype: \"UNSAFE_EVAL\",\n\t\t\t\tmessage: \"eval() or new Function() detected - security risk\",\n\t\t\t\tline: findLine(code, \"eval(\") || findLine(code, \"new Function(\"),\n\t\t\t\tfix: \"Avoid eval - use safer alternatives\",\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Convert SecretDetector finding to Issue format\n\t */\n\tprivate adaptSecretFinding(finding: SecretFinding): Issue {\n\t\treturn {\n\t\t\tseverity: finding.severity === \"critical\" || finding.severity === \"high\" ? \"critical\" : \"warning\",\n\t\t\ttype: `SECRET_${finding.type.toUpperCase().replace(/[\\s-]+/g, \"_\")}`,\n\t\t\tmessage: `${finding.type}: ${finding.snippet}...`,\n\t\t\tline: finding.line,\n\t\t\tfix: \"Use environment variables for secrets\",\n\t\t};\n\t}\n\n\t/**\n\t * Find line number for a match index\n\t */\n\tprivate findLineForMatch(code: string, index: number): number {\n\t\tconst beforeMatch = code.substring(0, index);\n\t\treturn (beforeMatch.match(/\\n/g) || []).length + 1;\n\t}\n}\n\n/**\n * Layer 6: Dependency Validation\n * Checks for dependency issues\n */\nexport class DependencyLayer implements ValidationLayer {\n\tname = \"dependencies\";\n\n\tasync validate(code: string, _filePath: string): Promise<{ issues: Issue[] }> {\n\t\tconst issues: Issue[] = [];\n\n\t\t// Defensive null check\n\t\tif (!code) {\n\t\t\treturn { issues };\n\t\t}\n\n\t\t// Check for deprecated packages\n\t\tconst deprecatedImports = [\"moment\", \"request\", \"node-fetch@2\"];\n\t\tfor (const pkg of deprecatedImports) {\n\t\t\tif (code.includes(`from \"${pkg}\"`) || code.includes(`from '${pkg}'`)) {\n\t\t\t\tissues.push({\n\t\t\t\t\tseverity: \"warning\",\n\t\t\t\t\ttype: \"DEPRECATED_DEPENDENCY\",\n\t\t\t\t\tmessage: `Deprecated package: ${pkg}`,\n\t\t\t\t\tline: findLine(code, pkg),\n\t\t\t\t\tfix: \"Use modern alternatives (dayjs, fetch, node-fetch@3)\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn { issues };\n\t}\n}\n\n/**\n * Layer 7: Performance Validation (Enhanced PerformanceLayer++)\n *\n * Checks for performance issues per C-007 with enhanced detection:\n * - O(n) nested loop detection\n * - Memory leak patterns (addEventListener without cleanup)\n * - ReDoS vulnerability detection\n * - N+1 query patterns\n */\nexport class PerformanceLayer implements ValidationLayer {\n\tname = \"performance\";\n\n\t// ReDoS patterns - regex with nested quantifiers\n\tprivate static readonly REDOS_PATTERNS = [\n\t\t// (a+)+ pattern - catastrophic backtracking\n\t\t/\\/[^/]*\\([^)]*[+*]\\)[^/]*[+*][^/]*\\//,\n\t\t// Nested groups with quantifiers\n\t\t/\\/[^/]*\\(\\?:[^)]*[+*]\\)[^/]*[+*][^/]*\\//,\n\t\t// Multiple adjacent quantifiers on groups\n\t\t/\\/[^/]*\\([^)]+\\)[+*]{2,}[^/]*\\//,\n\t];\n\n\tasync validate(code: string, filePath: string): Promise<{ issues: Issue[] }> {\n\t\tconst issues: Issue[] = [];\n\n\t\t// Defensive null checks\n\t\tif (!code || !filePath) {\n\t\t\treturn { issues };\n\t\t}\n\n\t\t// C-007: Console.log in Production\n\t\tthis.checkConsoleLog(code, filePath, issues);\n\n\t\t// Check for synchronous file operations\n\t\tthis.checkSyncFileIO(code, filePath, issues);\n\n\t\t// Check for await in loops (potential N+1)\n\t\tthis.checkAwaitInLoop(code, issues);\n\n\t\t// NEW: Check for O(n) nested loops\n\t\tthis.checkNestedLoops(code, issues);\n\n\t\t// NEW: Check for memory leaks (addEventListener without cleanup)\n\t\tthis.checkMemoryLeaks(code, issues);\n\n\t\t// NEW: Check for ReDoS vulnerabilities\n\t\tthis.checkReDoS(code, issues);\n\n\t\t// NEW: Check for shell injection via spawn\n\t\tthis.checkSpawnShellOption(code, issues);\n\n\t\treturn { issues };\n\t}\n\n\t/**\n\t * C-007: Console.log in Production\n\t */\n\tprivate checkConsoleLog(code: string, filePath: string, issues: Issue[]): void {\n\t\tif (\n\t\t\t!filePath.includes(\".test.\") &&\n\t\t\t!filePath.includes(\"/test/\") &&\n\t\t\t!filePath.includes(\"scripts/\") &&\n\t\t\tcode.includes(\"console.log\")\n\t\t) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"warning\",\n\t\t\t\ttype: \"NO_CONSOLE\",\n\t\t\t\tmessage: \"console.log in production code\",\n\t\t\t\tline: findLine(code, \"console.log\"),\n\t\t\t\tfix: \"Use logger from @snapback/core\",\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Check for synchronous file operations\n\t */\n\tprivate checkSyncFileIO(code: string, filePath: string, issues: Issue[]): void {\n\t\tif (code.includes(\"fs.readFileSync\") || code.includes(\"fs.writeFileSync\")) {\n\t\t\tif (!filePath.includes(\"scripts/\") && !filePath.includes(\".test.\")) {\n\t\t\t\tissues.push({\n\t\t\t\t\tseverity: \"info\",\n\t\t\t\t\ttype: \"SYNC_FILE_IO\",\n\t\t\t\t\tmessage: \"Synchronous file operation may block event loop\",\n\t\t\t\t\tline: findLine(code, \"Sync(\"),\n\t\t\t\t\tfix: \"Use async file operations or defer to background\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Check for await in loops (potential N+1)\n\t */\n\tprivate checkAwaitInLoop(code: string, issues: Issue[]): void {\n\t\tif (code.includes(\"for\") && code.includes(\"await \")) {\n\t\t\tconst forAwaitPattern = /for\\s*\\([^)]+\\)\\s*\\{[^}]*await\\s+/s;\n\t\t\tif (forAwaitPattern.test(code)) {\n\t\t\t\tissues.push({\n\t\t\t\t\tseverity: \"info\",\n\t\t\t\t\ttype: \"AWAIT_IN_LOOP\",\n\t\t\t\t\tmessage: \"Await in loop may cause N+1 performance issue\",\n\t\t\t\t\tfix: \"Consider Promise.all() for parallel execution\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Check for O(n) nested loops\n\t */\n\tprivate checkNestedLoops(code: string, issues: Issue[]): void {\n\t\t// Pattern 1: for inside for\n\t\tconst nestedForPattern = /for\\s*\\([^)]*\\)\\s*\\{[^{}]*for\\s*\\([^)]*\\)\\s*\\{/s;\n\t\tif (nestedForPattern.test(code)) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"warning\",\n\t\t\t\ttype: \"O_N2_ALGORITHM\",\n\t\t\t\tmessage: \"Nested for loops detected - potential O(n) complexity\",\n\t\t\t\tfix: \"Consider using Map/Set for O(1) lookups or merge algorithm\",\n\t\t\t});\n\t\t}\n\n\t\t// Pattern 2: forEach inside for/forEach\n\t\tconst forWithForEachPattern = /for\\s*\\([^)]*\\)\\s*\\{[^{}]*\\.forEach\\s*\\(/s;\n\t\tif (forWithForEachPattern.test(code)) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"warning\",\n\t\t\t\ttype: \"O_N2_ALGORITHM\",\n\t\t\t\tmessage: \"forEach inside for loop - potential O(n) complexity\",\n\t\t\t\tfix: \"Consider using Map/Set for O(1) lookups\",\n\t\t\t});\n\t\t}\n\n\t\t// Pattern 3: Nested forEach\n\t\tconst nestedForEachPattern = /\\.forEach\\s*\\([^)]*\\)\\s*\\{[^{}]*\\.forEach\\s*\\(/s;\n\t\tif (nestedForEachPattern.test(code)) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"warning\",\n\t\t\t\ttype: \"O_N2_ALGORITHM\",\n\t\t\t\tmessage: \"Nested forEach detected - potential O(n) complexity\",\n\t\t\t\tfix: \"Consider using Map/Set for O(1) lookups\",\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Check for memory leaks - addEventListener without cleanup\n\t */\n\tprivate checkMemoryLeaks(code: string, issues: Issue[]): void {\n\t\t// Check if addEventListener is used\n\t\tif (code.includes(\"addEventListener\")) {\n\t\t\t// Check if removeEventListener is also present\n\t\t\tif (!code.includes(\"removeEventListener\")) {\n\t\t\t\tissues.push({\n\t\t\t\t\tseverity: \"warning\",\n\t\t\t\t\ttype: \"MEMORY_LEAK\",\n\t\t\t\t\tmessage: \"addEventListener without corresponding removeEventListener - potential memory leak\",\n\t\t\t\t\tline: findLine(code, \"addEventListener\"),\n\t\t\t\t\tfix: \"Add cleanup: useEffect(() => { ...; return () => element.removeEventListener(...) })\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Check for ReDoS vulnerabilities\n\t */\n\tprivate checkReDoS(code: string, issues: Issue[]): void {\n\t\tfor (const pattern of PerformanceLayer.REDOS_PATTERNS) {\n\t\t\tif (pattern.test(code)) {\n\t\t\t\tissues.push({\n\t\t\t\t\tseverity: \"critical\",\n\t\t\t\t\ttype: \"REDOS\",\n\t\t\t\t\tmessage: \"Regex with nested quantifiers - ReDoS vulnerability (catastrophic backtracking)\",\n\t\t\t\t\tfix: \"Simplify regex or use safe-regex library to validate patterns\",\n\t\t\t\t});\n\t\t\t\tbreak; // One ReDoS warning is enough\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Check for spawn with shell option\n\t */\n\tprivate checkSpawnShellOption(code: string, issues: Issue[]): void {\n\t\t// spawn with shell: true\n\t\tconst spawnShellPattern = /spawn\\s*\\([^)]+,\\s*\\[[^\\]]*\\]\\s*,\\s*\\{[^}]*shell\\s*:\\s*true/;\n\t\tif (spawnShellPattern.test(code)) {\n\t\t\tissues.push({\n\t\t\t\tseverity: \"warning\",\n\t\t\t\ttype: \"SPAWN_SHELL\",\n\t\t\t\tmessage: \"spawn with shell:true may cause performance issues and security risks\",\n\t\t\t\tline: findLine(code, \"shell: true\"),\n\t\t\t\tfix: \"Remove shell:true and use arguments array directly\",\n\t\t\t});\n\t\t}\n\t}\n}\n\n// =============================================================================\n// Enhanced Layers - External tool integration\n// =============================================================================\n\nexport { BiomeLayer } from \"./BiomeLayer.js\";\nexport { TypeScriptCompilerLayer } from \"./TypeScriptCompilerLayer.js\";\n","/**\n * Validation Pipeline\n *\n * Runs 7+ validation layers in parallel for fast code validation.\n * Returns confidence score and review recommendation.\n *\n * Enhanced mode adds:\n * - BiomeLayer: Real Biome linter integration\n * - TypeScriptCompilerLayer: Real tsc type checking\n * - DynamicConfidenceCalculator: Weighted confidence scoring\n *\n * Performance:\n * - Without pipeline: 24 min (manual review)\n * - With pipeline: <1 sec (automated)\n *\n * @module ValidationPipeline\n */\n\nimport type { Issue, ValidationLayer } from \"../types/config.js\";\nimport type { PipelineResult, ReviewRecommendation, ValidationResult } from \"../types/validation.js\";\nimport { CONFIDENCE_THRESHOLDS, ISSUE_THRESHOLDS } from \"../types/validation.js\";\nimport { DynamicConfidenceCalculator } from \"./DynamicConfidenceCalculator.js\";\n\n// =============================================================================\n// RESULT TYPE (inline to avoid circular deps)\n// =============================================================================\n\ntype Result<T, E = Error> = { success: true; value: T } | { success: false; error: E };\n\nfunction ok<T>(value: T): Result<T, never> {\n\treturn { success: true, value };\n}\n\nfunction err<E>(error: E): Result<never, E> {\n\treturn { success: false, error };\n}\n\n// =============================================================================\n// PIPELINE OPTIONS\n// =============================================================================\n\nexport interface PipelineOptions {\n\t/**\n\t * Enable enhanced mode with BiomeLayer and TypeScriptCompilerLayer.\n\t * Requires workspaceRoot when enabled.\n\t * @default false\n\t */\n\tenhanced?: boolean;\n\n\t/**\n\t * Workspace root for enhanced layers (Biome, TypeScript).\n\t * Required when enhanced mode is enabled.\n\t */\n\tworkspaceRoot?: string;\n\n\t/**\n\t * Use dynamic confidence scoring instead of hardcoded thresholds.\n\t * @default false (for backward compatibility)\n\t */\n\tuseDynamicConfidence?: boolean;\n\n\t/**\n\t * Custom validation layers to add\n\t */\n\tcustomLayers?: ValidationLayer[];\n}\n\n// =============================================================================\n// VALIDATION ERRORS\n// =============================================================================\n\n/** Base validation error */\nexport class ValidationError extends Error {\n\tconstructor(\n\t\tmessage: string,\n\t\tpublic readonly code: string,\n\t\tpublic readonly layer?: string,\n\t\tpublic readonly issues?: Issue[],\n\t) {\n\t\tsuper(message);\n\t\tthis.name = \"ValidationError\";\n\t}\n}\n\n/** Critical issues found - requires immediate attention */\nexport class CriticalValidationError extends ValidationError {\n\tconstructor(\n\t\tmessage: string,\n\t\tpublic readonly criticalIssues: Issue[],\n\t) {\n\t\tsuper(message, \"CRITICAL_ISSUES\", undefined, criticalIssues);\n\t\tthis.name = \"CriticalValidationError\";\n\t}\n}\n\nimport {\n\tArchitectureLayer,\n\tBiomeLayer,\n\tDependencyLayer,\n\tPerformanceLayer,\n\tSecurityLayer,\n\tSyntaxLayer,\n\tTestLayer,\n\tTypeLayer,\n\tTypeScriptCompilerLayer,\n} from \"./layers/index.js\";\n\n/**\n * Validation Pipeline\n *\n * Runs all validation layers in parallel and aggregates results\n * with confidence-based review routing.\n *\n * @example Basic usage (backward compatible)\n * ```typescript\n * const pipeline = new ValidationPipeline();\n * const result = await pipeline.validate(code, filePath);\n * ```\n *\n * @example Enhanced mode with real tooling\n * ```typescript\n * const pipeline = new ValidationPipeline({\n *   enhanced: true,\n *   workspaceRoot: '/path/to/project',\n *   useDynamicConfidence: true,\n * });\n * const result = await pipeline.validate(code, filePath);\n * ```\n */\nexport class ValidationPipeline {\n\tprivate layers: ValidationLayer[] = [];\n\tprivate confidenceCalculator: DynamicConfidenceCalculator | null = null;\n\tprivate useDynamicConfidence: boolean;\n\n\tconstructor(options?: ValidationLayer[] | PipelineOptions) {\n\t\t// Handle backward compatibility: array of layers or options object\n\t\tconst opts: PipelineOptions = Array.isArray(options) ? { customLayers: options } : options || {};\n\n\t\tthis.useDynamicConfidence = opts.useDynamicConfidence ?? false;\n\n\t\t// Initialize confidence calculator if using dynamic mode\n\t\tif (this.useDynamicConfidence) {\n\t\t\tthis.confidenceCalculator = new DynamicConfidenceCalculator();\n\t\t}\n\n\t\t// Register default validation layers\n\t\tthis.layers = [\n\t\t\tnew SyntaxLayer(),\n\t\t\tnew TypeLayer(),\n\t\t\tnew TestLayer(),\n\t\t\tnew ArchitectureLayer(),\n\t\t\tnew SecurityLayer(),\n\t\t\tnew DependencyLayer(),\n\t\t\tnew PerformanceLayer(),\n\t\t];\n\n\t\t// Add enhanced layers if enabled\n\t\tif (opts.enhanced && opts.workspaceRoot) {\n\t\t\tthis.layers.push(new BiomeLayer(opts.workspaceRoot));\n\t\t\tthis.layers.push(new TypeScriptCompilerLayer(opts.workspaceRoot));\n\t\t}\n\n\t\t// Add custom layers if provided\n\t\tif (opts.customLayers) {\n\t\t\tthis.layers.push(...opts.customLayers);\n\t\t}\n\t}\n\n\t/**\n\t * Validate code through all layers\n\t */\n\tasync validate(code: string, filePath: string): Promise<PipelineResult> {\n\t\t// Run all layers in parallel (they're all fast)\n\t\tconst layerResults = await Promise.all(\n\t\t\tthis.layers.map(async (layer) => {\n\t\t\t\tconst start = Date.now();\n\t\t\t\tconst result = await layer.validate(code, filePath);\n\t\t\t\treturn {\n\t\t\t\t\tlayer: layer.name,\n\t\t\t\t\tpassed: result.issues.length === 0,\n\t\t\t\t\tissues: result.issues,\n\t\t\t\t\tduration: Date.now() - start,\n\t\t\t\t};\n\t\t\t}),\n\t\t);\n\n\t\t// Calculate totals\n\t\tconst totalIssues = layerResults.reduce((sum, r) => sum + r.issues.length, 0);\n\t\tconst criticalIssues = layerResults.flatMap((r) => r.issues).filter((i) => i.severity === \"critical\");\n\t\t// Pass layerResults for dynamic confidence calculation\n\t\tconst confidence = this.calculateConfidence(totalIssues, criticalIssues.length, layerResults);\n\t\tconst recommendation = this.getRecommendation(confidence, criticalIssues);\n\n\t\treturn {\n\t\t\toverall: {\n\t\t\t\tpassed: criticalIssues.length === 0,\n\t\t\t\tconfidence,\n\t\t\t\ttotalIssues,\n\t\t\t},\n\t\t\tlayers: layerResults,\n\t\t\trecommendation,\n\t\t\tfocusPoints: criticalIssues.map((i) => i.message),\n\t\t};\n\t}\n\n\t/**\n\t * Quick check - returns true if code passes all critical checks\n\t */\n\tasync quickCheck(code: string, filePath: string): Promise<boolean> {\n\t\tconst result = await this.validate(code, filePath);\n\t\treturn result.overall.passed;\n\t}\n\n\t/**\n\t * Result-based validation - returns Result<PipelineResult, CriticalValidationError>\n\t *\n\t * This is the recommended API for new code. Use validateSafe() when you want\n\t * to handle validation failures without exceptions.\n\t *\n\t * @example\n\t * ```typescript\n\t * const result = await pipeline.validateSafe(code, filePath);\n\t * if (!result.success) {\n\t *   console.error('Critical issues:', result.error.criticalIssues);\n\t *   return;\n\t * }\n\t * console.log('Confidence:', result.value.overall.confidence);\n\t * ```\n\t */\n\tasync validateSafe(\n\t\tcode: string,\n\t\tfilePath: string,\n\t\toptions?: { failFast?: boolean },\n\t): Promise<Result<PipelineResult, CriticalValidationError>> {\n\t\tconst result = await this.validate(code, filePath);\n\n\t\t// If failFast is enabled and there are critical issues, return error\n\t\tif (options?.failFast) {\n\t\t\tconst criticalIssues = ValidationPipeline.getIssuesBySeverity(result, \"critical\");\n\t\t\tif (criticalIssues.length > 0) {\n\t\t\t\treturn err(\n\t\t\t\t\tnew CriticalValidationError(\n\t\t\t\t\t\t`Validation failed: ${criticalIssues.length} critical issues`,\n\t\t\t\t\t\tcriticalIssues,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// Return success with the pipeline result\n\t\treturn ok(result);\n\t}\n\n\t/**\n\t * Validate with fail-fast on critical issues\n\t *\n\t * Runs layers in sequence and stops immediately when a critical issue is found.\n\t * Use this for pre-commit hooks where early failure is desired.\n\t */\n\tasync validateFailFast(code: string, filePath: string): Promise<Result<PipelineResult, CriticalValidationError>> {\n\t\tconst layerResults: Array<{\n\t\t\tlayer: string;\n\t\t\tpassed: boolean;\n\t\t\tissues: Issue[];\n\t\t\tduration: number;\n\t\t}> = [];\n\n\t\t// Run layers sequentially for fail-fast behavior\n\t\tfor (const layer of this.layers) {\n\t\t\tconst start = Date.now();\n\t\t\tconst result = await layer.validate(code, filePath);\n\t\t\tconst layerResult = {\n\t\t\t\tlayer: layer.name,\n\t\t\t\tpassed: result.issues.length === 0,\n\t\t\t\tissues: result.issues,\n\t\t\t\tduration: Date.now() - start,\n\t\t\t};\n\t\t\tlayerResults.push(layerResult);\n\n\t\t\t// Fail fast on critical issues\n\t\t\tconst criticalIssues = result.issues.filter((i) => i.severity === \"critical\");\n\t\t\tif (criticalIssues.length > 0) {\n\t\t\t\treturn err(\n\t\t\t\t\tnew CriticalValidationError(\n\t\t\t\t\t\t`Validation failed in ${layer.name}: ${criticalIssues.length} critical issues`,\n\t\t\t\t\t\tcriticalIssues,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// All layers passed - calculate full result\n\t\tconst totalIssues = layerResults.reduce((sum, r) => sum + r.issues.length, 0);\n\t\tconst confidence = this.calculateConfidence(totalIssues, 0, layerResults);\n\t\tconst recommendation = this.getRecommendation(confidence, []);\n\n\t\treturn ok({\n\t\t\toverall: {\n\t\t\t\tpassed: true,\n\t\t\t\tconfidence,\n\t\t\t\ttotalIssues,\n\t\t\t},\n\t\t\tlayers: layerResults,\n\t\t\trecommendation,\n\t\t\tfocusPoints: [],\n\t\t});\n\t}\n\n\t/**\n\t * Validate multiple files with aggregated results\n\t */\n\tasync validateFiles(\n\t\tfiles: Array<{ path: string; content: string }>,\n\t): Promise<Result<PipelineResult[], CriticalValidationError>> {\n\t\tconst results: PipelineResult[] = [];\n\t\tconst allCriticalIssues: Issue[] = [];\n\n\t\tfor (const file of files) {\n\t\t\tconst result = await this.validate(file.content, file.path);\n\t\t\tresults.push(result);\n\n\t\t\t// Collect critical issues\n\t\t\tconst criticalIssues = ValidationPipeline.getIssuesBySeverity(result, \"critical\");\n\t\t\tif (criticalIssues.length > 0) {\n\t\t\t\tallCriticalIssues.push(\n\t\t\t\t\t...criticalIssues.map((issue) => ({\n\t\t\t\t\t\t...issue,\n\t\t\t\t\t\tmessage: `[${file.path}] ${issue.message}`,\n\t\t\t\t\t})),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// Return error if any critical issues found\n\t\tif (allCriticalIssues.length > 0) {\n\t\t\treturn err(\n\t\t\t\tnew CriticalValidationError(\n\t\t\t\t\t`Validation failed: ${allCriticalIssues.length} critical issues across ${files.length} files`,\n\t\t\t\t\tallCriticalIssues,\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\treturn ok(results);\n\t}\n\n\t/**\n\t * Calculate confidence score based on issues\n\t *\n\t * When useDynamicConfidence is enabled, uses weighted scoring per layer.\n\t * Otherwise falls back to hardcoded thresholds for backward compatibility.\n\t */\n\tprivate calculateConfidence(\n\t\ttotalIssues: number,\n\t\tcriticalIssues: number,\n\t\tlayerResults?: ValidationResult[],\n\t): number {\n\t\t// Use dynamic calculator if available and layer results provided\n\t\tif (this.confidenceCalculator && layerResults) {\n\t\t\treturn this.confidenceCalculator.calculate(layerResults);\n\t\t}\n\n\t\t// Fallback: hardcoded thresholds (backward compatible)\n\t\tif (criticalIssues > 0) {\n\t\t\treturn 0.1;\n\t\t}\n\t\tif (totalIssues === 0) {\n\t\t\treturn CONFIDENCE_THRESHOLDS.AUTO_MERGE;\n\t\t}\n\t\tif (totalIssues <= ISSUE_THRESHOLDS.QUICK_REVIEW) {\n\t\t\treturn CONFIDENCE_THRESHOLDS.QUICK_REVIEW;\n\t\t}\n\t\tif (totalIssues <= ISSUE_THRESHOLDS.FULL_REVIEW) {\n\t\t\treturn CONFIDENCE_THRESHOLDS.FULL_REVIEW;\n\t\t}\n\t\treturn 0.2;\n\t}\n\n\t/**\n\t * Determine review recommendation based on confidence\n\t */\n\tprivate getRecommendation(confidence: number, criticalIssues: Issue[]): ReviewRecommendation {\n\t\tif (criticalIssues.length > 0) {\n\t\t\treturn \"full_review\";\n\t\t}\n\t\tif (confidence >= 0.85) {\n\t\t\treturn \"auto_merge\";\n\t\t}\n\t\tif (confidence >= CONFIDENCE_THRESHOLDS.FULL_REVIEW) {\n\t\t\treturn \"quick_review\";\n\t\t}\n\t\treturn \"full_review\";\n\t}\n\n\t/**\n\t * Get layer names\n\t */\n\tgetLayerNames(): string[] {\n\t\treturn this.layers.map((l) => l.name);\n\t}\n\n\t/**\n\t * Add a custom validation layer\n\t */\n\taddLayer(layer: ValidationLayer): void {\n\t\tthis.layers.push(layer);\n\t}\n\n\t/**\n\t * Get all issues from a result, flattened\n\t */\n\tstatic flattenIssues(result: PipelineResult): Issue[] {\n\t\treturn result.layers.flatMap((l) => l.issues);\n\t}\n\n\t/**\n\t * Get issues by severity\n\t */\n\tstatic getIssuesBySeverity(result: PipelineResult, severity: \"critical\" | \"warning\" | \"info\"): Issue[] {\n\t\treturn ValidationPipeline.flattenIssues(result).filter((i) => i.severity === severity);\n\t}\n}\n\n// Re-export types for convenience\nexport type { PipelineResult, ValidationResult, ReviewRecommendation };\n","/**\n * BehaviorTracker - Collects behavioral metadata during dev sessions\n *\n * Phase 2 enhancement: Tracks developer workflow patterns\n * - Session duration\n * - AI acceptance rate\n * - Code churn\n * - Test pass rate\n */\n\nimport type { BehavioralMetadata } from \"../types/vitals.js\";\n\ninterface EditEvent {\n\ttimestamp: number;\n\tlinesAdded: number;\n\tlinesDeleted: number;\n}\n\ninterface TestEvent {\n\ttimestamp: number;\n\tpassed: boolean;\n}\n\ninterface AISuggestionEvent {\n\ttimestamp: number;\n\taccepted: boolean;\n}\n\nexport class BehaviorTracker {\n\tprivate sessionStart: number;\n\tprivate edits: EditEvent[] = [];\n\tprivate tests: TestEvent[] = [];\n\tprivate aiSuggestions: AISuggestionEvent[] = [];\n\tprivate fileSaves = 0;\n\n\tconstructor(initialTime: number = Date.now()) {\n\t\tthis.sessionStart = initialTime;\n\t}\n\n\t/**\n\t * Record a file edit event\n\t */\n\trecordEdit(linesAdded: number, linesDeleted: number, timestamp: number = Date.now()): void {\n\t\tthis.edits.push({ timestamp, linesAdded, linesDeleted });\n\t}\n\n\t/**\n\t * Record a file save\n\t */\n\trecordFileSave(): void {\n\t\tthis.fileSaves++;\n\t}\n\n\t/**\n\t * Record a test execution result\n\t */\n\trecordTest(passed: boolean, timestamp: number = Date.now()): void {\n\t\tthis.tests.push({ timestamp, passed });\n\t}\n\n\t/**\n\t * Record an AI suggestion event\n\t */\n\trecordAISuggestion(accepted: boolean, timestamp: number = Date.now()): void {\n\t\tthis.aiSuggestions.push({ timestamp, accepted });\n\t}\n\n\t/**\n\t * Record a snapshot creation (resets session)\n\t */\n\trecordSnapshot(timestamp: number = Date.now()): void {\n\t\tthis.sessionStart = timestamp;\n\t\t// Don't clear metrics - preserve for analytics\n\t}\n\n\t/**\n\t * Get current behavioral metadata\n\t */\n\tgetMetadata(now: number = Date.now()): BehavioralMetadata {\n\t\tconst sessionDuration = now - this.sessionStart;\n\n\t\t// Calculate AI acceptance rate\n\t\tconst totalSuggestions = this.aiSuggestions.length;\n\t\tconst acceptedSuggestions = this.aiSuggestions.filter((s) => s.accepted).length;\n\t\tconst rejectedSuggestions = totalSuggestions - acceptedSuggestions;\n\t\tconst aiAcceptanceRate = totalSuggestions > 0 ? acceptedSuggestions / totalSuggestions : 0;\n\n\t\t// Calculate code churn rate (lines per minute)\n\t\tconst totalLinesChanged = this.edits.reduce((sum, e) => sum + e.linesAdded + e.linesDeleted, 0);\n\t\tconst sessionMinutes = sessionDuration / (60 * 1000);\n\t\tconst churnRate = sessionMinutes > 0 ? totalLinesChanged / sessionMinutes : 0;\n\n\t\t// Calculate test pass rate\n\t\tconst totalTests = this.tests.length;\n\t\tconst passedTests = this.tests.filter((t) => t.passed).length;\n\t\tconst testPassRate = totalTests > 0 ? passedTests / totalTests : 1.0; // Default to 100% if no tests\n\n\t\t// Calculate average time between edits\n\t\tlet avgTimeBetweenEdits = 0;\n\t\tif (this.edits.length > 1) {\n\t\t\tconst intervals: number[] = [];\n\t\t\tfor (let i = 1; i < this.edits.length; i++) {\n\t\t\t\tintervals.push(this.edits[i].timestamp - this.edits[i - 1].timestamp);\n\t\t\t}\n\t\t\tavgTimeBetweenEdits = intervals.reduce((sum, interval) => sum + interval, 0) / intervals.length;\n\t\t}\n\n\t\treturn {\n\t\t\tsessionDuration,\n\t\t\taiAcceptanceRate,\n\t\t\tchurnRate,\n\t\t\ttestPassRate,\n\t\t\tfileSaveCount: this.fileSaves,\n\t\t\taiSuggestionsShown: totalSuggestions,\n\t\t\taiSuggestionsAccepted: acceptedSuggestions,\n\t\t\taiSuggestionsRejected: rejectedSuggestions,\n\t\t\tavgTimeBetweenEdits,\n\t\t};\n\t}\n\n\t/**\n\t * Reset all tracking data\n\t */\n\treset(timestamp: number = Date.now()): void {\n\t\tthis.sessionStart = timestamp;\n\t\tthis.edits = [];\n\t\tthis.tests = [];\n\t\tthis.aiSuggestions = [];\n\t\tthis.fileSaves = 0;\n\t}\n\n\t/**\n\t * Get raw metrics for testing\n\t */\n\tgetRawCounts(): {\n\t\tedits: number;\n\t\ttests: number;\n\t\tsuggestions: number;\n\t\tsaves: number;\n\t} {\n\t\treturn {\n\t\t\tedits: this.edits.length,\n\t\t\ttests: this.tests.length,\n\t\t\tsuggestions: this.aiSuggestions.length,\n\t\t\tsaves: this.fileSaves,\n\t\t};\n\t}\n}\n","/**\n * @snapback/intelligence/vitals/constants\n *\n * Centralized threshold constants for vitals system.\n * Single source of truth - ALL consumers MUST import from here.\n *\n * UX Principles (from industry best practices):\n * - Visual hierarchy: critical > high > moderate > low\n * - Consistency: same thresholds across UI, MCP, CLI\n * - Frictionless: clear actionable boundaries\n *\n * @module vitals/constants\n */\n\n// =============================================================================\n// PRESSURE THRESHOLDS (0-100 scale)\n// =============================================================================\n\n/**\n * Pressure thresholds for snapshot recommendations.\n *\n * @example\n * ```typescript\n * import { PRESSURE_THRESHOLDS } from '@snapback/intelligence/vitals';\n *\n * if (pressure > PRESSURE_THRESHOLDS.critical) {\n *   // Immediate snapshot required\n * } else if (pressure > PRESSURE_THRESHOLDS.high) {\n *   // Snapshot strongly recommended\n * }\n * ```\n */\nexport const PRESSURE_THRESHOLDS = {\n\t/** Low pressure - no action needed */\n\tlow: 25,\n\t/** Moderate pressure - consider snapshotting soon */\n\tmoderate: 50,\n\t/** High pressure - snapshot recommended */\n\thigh: 75,\n\t/** Critical pressure - immediate snapshot required */\n\tcritical: 80,\n} as const;\n\nexport type PressureThresholdLevel = keyof typeof PRESSURE_THRESHOLDS;\n\n// =============================================================================\n// OXYGEN THRESHOLDS (0-100% coverage)\n// =============================================================================\n\n/**\n * Oxygen (snapshot coverage) thresholds.\n * Higher is better - 100% means all modified files have recent snapshots.\n */\nexport const OXYGEN_THRESHOLDS = {\n\t/** Critical - very low coverage, high risk */\n\tcritical: 30,\n\t/** Low - needs attention */\n\tlow: 50,\n\t/** Moderate - acceptable but could improve */\n\tmoderate: 70,\n\t/** Good - healthy coverage */\n\tgood: 85,\n} as const;\n\nexport type OxygenThresholdLevel = keyof typeof OXYGEN_THRESHOLDS;\n\n// =============================================================================\n// TEMPERATURE THRESHOLDS (0-100% AI activity)\n// =============================================================================\n\n/**\n * Temperature (AI activity) thresholds.\n * Based on percentage of AI-assisted changes in the window.\n */\nexport const TEMPERATURE_THRESHOLDS = {\n\t/** Cold - minimal AI activity */\n\tcold: 0,\n\t/** Warm - some AI activity detected */\n\twarm: 20,\n\t/** Hot - significant AI activity */\n\thot: 50,\n\t/** Burning - heavy AI activity, extra caution needed */\n\tburning: 80,\n} as const;\n\nexport type TemperatureThresholdLevel = keyof typeof TEMPERATURE_THRESHOLDS;\n\n// =============================================================================\n// PULSE THRESHOLDS (changes per minute)\n// =============================================================================\n\n/**\n * Pulse (change velocity) thresholds.\n * Measured in file changes per minute.\n */\nexport const PULSE_THRESHOLDS = {\n\t/** Resting - minimal activity */\n\tresting: 0,\n\t/** Elevated - moderate activity */\n\televated: 15,\n\t/** Racing - high activity */\n\tracing: 30,\n\t/** Critical - very high activity, potential automation */\n\tcritical: 50,\n} as const;\n\nexport type PulseThresholdLevel = keyof typeof PULSE_THRESHOLDS;\n\n// =============================================================================\n// TRAJECTORY THRESHOLDS (combined metrics)\n// =============================================================================\n\n/**\n * Trajectory state thresholds - used for combined analysis.\n * These define when to transition between trajectory states.\n */\nexport const TRAJECTORY_THRESHOLDS = {\n\t/** Pressure level that contributes to escalating trajectory */\n\tescalatingPressure: 60,\n\t/** Oxygen level below which contributes to escalating trajectory */\n\tescalatingOxygen: 70,\n\t/** Pressure level for critical trajectory */\n\tcriticalPressure: 80,\n\t/** Oxygen level below which contributes to critical trajectory */\n\tcriticalOxygen: 50,\n\t/** Pressure drop required to enter recovering state */\n\trecoveringPressureDrop: 10,\n\t/** Oxygen level required for recovering state */\n\trecoveringOxygen: 70,\n} as const;\n\n// =============================================================================\n// URGENCY SCORING\n// =============================================================================\n\n/**\n * Urgency score thresholds for snapshot recommendations.\n * Scores are calculated from combined vitals.\n */\nexport const URGENCY_THRESHOLDS = {\n\t/** No urgency - healthy state */\n\tnone: 0,\n\t/** Low urgency - optional action */\n\tlow: 20,\n\t/** Medium urgency - should act soon */\n\tmedium: 40,\n\t/** High urgency - should act now */\n\thigh: 60,\n\t/** Critical urgency - immediate action required */\n\tcritical: 80,\n} as const;\n\nexport type UrgencyThresholdLevel = keyof typeof URGENCY_THRESHOLDS;\n\n// =============================================================================\n// TIME-BASED THRESHOLDS\n// =============================================================================\n\n/**\n * Time-based thresholds for staleness and recommendations.\n */\nexport const TIME_THRESHOLDS = {\n\t/** Minutes until snapshot considered stale */\n\tstaleSnapshotMinutes: 30,\n\t/** Minutes of no snapshot before optional recommendation */\n\toptionalSnapshotMinutes: 60,\n\t/** Sliding window for pulse calculation (seconds) */\n\tpulseWindowSeconds: 60,\n\t/** Sliding window for temperature decay (seconds) */\n\ttemperatureWindowSeconds: 300,\n} as const;\n\n// =============================================================================\n// HELPER FUNCTIONS\n// =============================================================================\n\n/**\n * Get pressure level name from value.\n */\nexport function getPressureLevel(value: number): PressureThresholdLevel {\n\tif (value >= PRESSURE_THRESHOLDS.critical) {\n\t\treturn \"critical\";\n\t}\n\tif (value >= PRESSURE_THRESHOLDS.high) {\n\t\treturn \"high\";\n\t}\n\tif (value >= PRESSURE_THRESHOLDS.moderate) {\n\t\treturn \"moderate\";\n\t}\n\treturn \"low\";\n}\n\n/**\n * Get oxygen level name from value.\n */\nexport function getOxygenLevel(value: number): OxygenThresholdLevel {\n\tif (value >= OXYGEN_THRESHOLDS.good) {\n\t\treturn \"good\";\n\t}\n\tif (value >= OXYGEN_THRESHOLDS.moderate) {\n\t\treturn \"moderate\";\n\t}\n\tif (value >= OXYGEN_THRESHOLDS.low) {\n\t\treturn \"low\";\n\t}\n\treturn \"critical\";\n}\n\n/**\n * Calculate urgency score from vitals.\n * Returns 0-100 score based on combined metrics.\n */\nexport function calculateUrgencyScore(vitals: {\n\tpressure: number;\n\toxygen: number;\n\ttemperatureLevel: \"cold\" | \"warm\" | \"hot\" | \"burning\";\n}): number {\n\tlet score = 0;\n\n\t// Pressure contributes up to 40 points\n\tscore += Math.min((vitals.pressure / 100) * 40, 40);\n\n\t// Low oxygen contributes up to 25 points\n\tif (vitals.oxygen < OXYGEN_THRESHOLDS.low) {\n\t\tscore += Math.min(((OXYGEN_THRESHOLDS.low - vitals.oxygen) / OXYGEN_THRESHOLDS.low) * 25, 25);\n\t}\n\n\t// Temperature contributes up to 20 points\n\tconst tempScores = { cold: 0, warm: 5, hot: 15, burning: 20 };\n\tscore += tempScores[vitals.temperatureLevel];\n\n\t// Cap at 100\n\treturn Math.min(Math.round(score), 100);\n}\n\n/**\n * Get urgency level from score.\n */\nexport function getUrgencyLevel(score: number): UrgencyThresholdLevel {\n\tif (score >= URGENCY_THRESHOLDS.critical) {\n\t\treturn \"critical\";\n\t}\n\tif (score >= URGENCY_THRESHOLDS.high) {\n\t\treturn \"high\";\n\t}\n\tif (score >= URGENCY_THRESHOLDS.medium) {\n\t\treturn \"medium\";\n\t}\n\tif (score >= URGENCY_THRESHOLDS.low) {\n\t\treturn \"low\";\n\t}\n\treturn \"none\";\n}\n\n/**\n * Check if snapshot should be recommended based on vitals.\n */\nexport function shouldRecommendSnapshot(vitals: {\n\tpressure: number;\n\toxygen: number;\n\ttrajectory: \"stable\" | \"escalating\" | \"critical\" | \"recovering\";\n}): { should: boolean; urgency: UrgencyThresholdLevel; reason: string } {\n\t// Critical trajectory always recommends\n\tif (vitals.trajectory === \"critical\") {\n\t\treturn {\n\t\t\tshould: true,\n\t\t\turgency: \"critical\",\n\t\t\treason: \"Critical workspace state - immediate snapshot required\",\n\t\t};\n\t}\n\n\t// High pressure recommends\n\tif (vitals.pressure >= PRESSURE_THRESHOLDS.high) {\n\t\treturn {\n\t\t\tshould: true,\n\t\t\turgency: \"high\",\n\t\t\treason: `High pressure (${vitals.pressure}%) - snapshot recommended`,\n\t\t};\n\t}\n\n\t// Escalating with moderate pressure recommends\n\tif (vitals.trajectory === \"escalating\" && vitals.pressure >= PRESSURE_THRESHOLDS.moderate) {\n\t\treturn {\n\t\t\tshould: true,\n\t\t\turgency: \"medium\",\n\t\t\treason: \"Escalating trajectory - consider creating a snapshot\",\n\t\t};\n\t}\n\n\t// Low oxygen with moderate pressure recommends\n\tif (vitals.oxygen < OXYGEN_THRESHOLDS.low && vitals.pressure >= PRESSURE_THRESHOLDS.moderate) {\n\t\treturn {\n\t\t\tshould: true,\n\t\t\turgency: \"medium\",\n\t\t\treason: `Low snapshot coverage (${vitals.oxygen}%) with unsaved changes`,\n\t\t};\n\t}\n\n\treturn {\n\t\tshould: false,\n\t\turgency: \"none\",\n\t\treason: \"Workspace healthy - no snapshot needed\",\n\t};\n}\n","/**\n * PhaseDetector - Development Phase Detection via Git Branch Analysis\n *\n * Analyzes git branch names to detect the current development phase and\n * adjusts snapshot thresholds accordingly. Different phases have different\n * risk profiles:\n *\n * - Hotfix: High risk, frequent snapshots (10 min intervals, 50 line max)\n * - Feature: Medium risk, moderate snapshots (15-30 min intervals, 300 line max)\n * - Refactor: Lower risk, less frequent (45-75 min intervals, 400 line max)\n * - Exploratory: Lowest urgency, milestone-based snapshots\n *\n * @packageDocumentation\n */\n\n/**\n * Development phase types detected from branch names\n */\nexport type DevelopmentPhase = \"hotfix\" | \"feature\" | \"refactor\" | \"exploratory\" | \"release\" | \"unknown\";\n\n/**\n * Threshold multipliers for each development phase\n * Lower multiplier = more protective (lower thresholds)\n */\nexport interface PhaseThresholds {\n\t/** Multiplier for snapshot interval (lower = more frequent) */\n\tintervalMultiplier: number;\n\t/** Maximum lines before forcing a snapshot */\n\tmaxLinesBeforeSnapshot: number;\n\t/** Risk multiplier for pressure calculations */\n\triskMultiplier: number;\n\t/** Recommended snapshot interval in minutes */\n\trecommendedIntervalMinutes: number;\n\t/** AI-adjusted interval in minutes */\n\taiAdjustedIntervalMinutes: number;\n}\n\n/**\n * Phase detection result\n */\nexport interface PhaseDetectionResult {\n\t/** Detected development phase */\n\tphase: DevelopmentPhase;\n\t/** Confidence score (0-1) */\n\tconfidence: number;\n\t/** Branch name that was analyzed */\n\tbranchName: string;\n\t/** Matched pattern (if any) */\n\tmatchedPattern?: string;\n\t/** Recommended thresholds for this phase */\n\tthresholds: PhaseThresholds;\n}\n\n/**\n * Branch patterns for phase detection\n */\nconst PHASE_PATTERNS: Record<DevelopmentPhase, RegExp[]> = {\n\thotfix: [/^hotfix\\//i, /^fix\\//i, /^bugfix\\//i, /^patch\\//i, /^urgent\\//i, /^emergency\\//i, /^critical\\//i],\n\tfeature: [/^feature\\//i, /^feat\\//i, /^add\\//i, /^implement\\//i, /^new\\//i, /^enhancement\\//i],\n\trefactor: [/^refactor\\//i, /^cleanup\\//i, /^tech-debt\\//i, /^improvement\\//i, /^optimize\\//i, /^chore\\//i],\n\trelease: [/^release\\//i, /^release-/i, /^v\\d+\\.\\d+/i, /^version\\//i],\n\texploratory: [/^experiment\\//i, /^spike\\//i, /^poc\\//i, /^prototype\\//i, /^try\\//i, /^test\\//i, /^wip\\//i],\n\tunknown: [], // No patterns - fallback\n};\n\n/**\n * Default thresholds per development phase\n * Based on research: different phases have different risk profiles\n */\nconst PHASE_THRESHOLDS: Record<DevelopmentPhase, PhaseThresholds> = {\n\thotfix: {\n\t\tintervalMultiplier: 0.5, // Most protective\n\t\tmaxLinesBeforeSnapshot: 50,\n\t\triskMultiplier: 1.5, // Higher risk sensitivity\n\t\trecommendedIntervalMinutes: 15,\n\t\taiAdjustedIntervalMinutes: 10,\n\t},\n\tfeature: {\n\t\tintervalMultiplier: 1.0, // Standard\n\t\tmaxLinesBeforeSnapshot: 300,\n\t\triskMultiplier: 1.0,\n\t\trecommendedIntervalMinutes: 45,\n\t\taiAdjustedIntervalMinutes: 20,\n\t},\n\trefactor: {\n\t\tintervalMultiplier: 1.5, // Less protective\n\t\tmaxLinesBeforeSnapshot: 400,\n\t\triskMultiplier: 0.8,\n\t\trecommendedIntervalMinutes: 90,\n\t\taiAdjustedIntervalMinutes: 60,\n\t},\n\trelease: {\n\t\tintervalMultiplier: 0.7, // More protective for releases\n\t\tmaxLinesBeforeSnapshot: 100,\n\t\triskMultiplier: 1.3,\n\t\trecommendedIntervalMinutes: 20,\n\t\taiAdjustedIntervalMinutes: 15,\n\t},\n\texploratory: {\n\t\tintervalMultiplier: 2.0, // Least protective\n\t\tmaxLinesBeforeSnapshot: 1000, // No effective limit\n\t\triskMultiplier: 0.5,\n\t\trecommendedIntervalMinutes: 120, // Milestone-based\n\t\taiAdjustedIntervalMinutes: 90,\n\t},\n\tunknown: {\n\t\tintervalMultiplier: 1.0, // Default/standard\n\t\tmaxLinesBeforeSnapshot: 300,\n\t\triskMultiplier: 1.0,\n\t\trecommendedIntervalMinutes: 45,\n\t\taiAdjustedIntervalMinutes: 25,\n\t},\n};\n\n/**\n * PhaseDetector - Detects development phase from git branch names\n *\n * @example\n * ```typescript\n * const detector = new PhaseDetector();\n * const result = detector.detectPhase('feature/add-user-auth');\n * console.log(result.phase); // 'feature'\n * console.log(result.thresholds.recommendedIntervalMinutes); // 45\n * ```\n */\n/**\n * Manual override configuration\n */\nexport interface PhaseOverride {\n\t/** Overridden phase */\n\tphase: DevelopmentPhase;\n\t/** Workspace ID this override applies to */\n\tworkspaceId: string;\n\t/** Expiry timestamp (null = never expires) */\n\texpiresAt: number | null;\n\t/** Reason for override */\n\treason?: string;\n}\n\nexport class PhaseDetector {\n\tprivate cachedPhase: PhaseDetectionResult | null = null;\n\tprivate lastBranch: string | null = null;\n\t/** Manual phase overrides by workspace */\n\tprivate overrides: Map<string, PhaseOverride> = new Map();\n\n\t/**\n\t * Detect development phase from branch name\n\t * Respects manual overrides when set for the workspace\n\t *\n\t * @param branchName - Git branch name (e.g., \"feature/add-auth\")\n\t * @param workspaceId - Optional workspace ID for override lookup\n\t * @returns Phase detection result with thresholds\n\t */\n\tdetectPhase(branchName: string, workspaceId?: string): PhaseDetectionResult {\n\t\t// Check for manual override first\n\t\tif (workspaceId) {\n\t\t\tconst override = this.getOverride(workspaceId);\n\t\t\tif (override) {\n\t\t\t\treturn {\n\t\t\t\t\tphase: override.phase,\n\t\t\t\t\tconfidence: 1.0, // Manual override is 100% confident\n\t\t\t\t\tbranchName,\n\t\t\t\t\tmatchedPattern: `manual:${override.reason ?? \"user-override\"}`,\n\t\t\t\t\tthresholds: PHASE_THRESHOLDS[override.phase],\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// Use cache if branch hasn't changed\n\t\tif (this.lastBranch === branchName && this.cachedPhase) {\n\t\t\treturn this.cachedPhase;\n\t\t}\n\n\t\t// Check each phase pattern\n\t\tfor (const [phase, patterns] of Object.entries(PHASE_PATTERNS) as [DevelopmentPhase, RegExp[]][]) {\n\t\t\tfor (const pattern of patterns) {\n\t\t\t\tif (pattern.test(branchName)) {\n\t\t\t\t\tconst result: PhaseDetectionResult = {\n\t\t\t\t\t\tphase,\n\t\t\t\t\t\tconfidence: 0.9, // High confidence for pattern match\n\t\t\t\t\t\tbranchName,\n\t\t\t\t\t\tmatchedPattern: pattern.source,\n\t\t\t\t\t\tthresholds: PHASE_THRESHOLDS[phase],\n\t\t\t\t\t};\n\t\t\t\t\tthis.cachedPhase = result;\n\t\t\t\t\tthis.lastBranch = branchName;\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Fallback: try to infer from branch structure\n\t\tconst inferredPhase = this.inferPhaseFromStructure(branchName);\n\t\tconst result: PhaseDetectionResult = {\n\t\t\tphase: inferredPhase.phase,\n\t\t\tconfidence: inferredPhase.confidence,\n\t\t\tbranchName,\n\t\t\tthresholds: PHASE_THRESHOLDS[inferredPhase.phase],\n\t\t};\n\n\t\tthis.cachedPhase = result;\n\t\tthis.lastBranch = branchName;\n\t\treturn result;\n\t}\n\n\t/**\n\t * Infer phase from branch structure when no pattern matches\n\t */\n\tprivate inferPhaseFromStructure(branchName: string): { phase: DevelopmentPhase; confidence: number } {\n\t\t// Main/master branches are typically feature work\n\t\tif (branchName === \"main\" || branchName === \"master\" || branchName === \"develop\") {\n\t\t\treturn { phase: \"feature\", confidence: 0.6 };\n\t\t}\n\n\t\t// Branches with ticket numbers often indicate feature work\n\t\tif (/[A-Z]+-\\d+/.test(branchName)) {\n\t\t\treturn { phase: \"feature\", confidence: 0.5 };\n\t\t}\n\n\t\t// Branches with \"fix\" or \"bug\" in the name\n\t\tif (/fix|bug/i.test(branchName)) {\n\t\t\treturn { phase: \"hotfix\", confidence: 0.6 };\n\t\t}\n\n\t\t// Branches with version numbers\n\t\tif (/\\d+\\.\\d+/.test(branchName)) {\n\t\t\treturn { phase: \"release\", confidence: 0.5 };\n\t\t}\n\n\t\treturn { phase: \"unknown\", confidence: 0.3 };\n\t}\n\n\t/**\n\t * Get threshold multiplier for current phase\n\t * Used by ThresholdCalibrator to adjust vitals thresholds\n\t */\n\tgetThresholdMultiplier(branchName: string): number {\n\t\tconst detection = this.detectPhase(branchName);\n\t\treturn detection.thresholds.intervalMultiplier;\n\t}\n\n\t/**\n\t * Get risk multiplier for current phase\n\t * Used to adjust pressure calculations\n\t */\n\tgetRiskMultiplier(branchName: string): number {\n\t\tconst detection = this.detectPhase(branchName);\n\t\treturn detection.thresholds.riskMultiplier;\n\t}\n\n\t/**\n\t * Check if current phase requires more frequent snapshots\n\t */\n\trequiresFrequentSnapshots(branchName: string): boolean {\n\t\tconst detection = this.detectPhase(branchName);\n\t\treturn detection.phase === \"hotfix\" || detection.phase === \"release\";\n\t}\n\n\t/**\n\t * Get recommended snapshot interval based on phase\n\t * @param aiActive - Whether AI tools are currently active\n\t */\n\tgetRecommendedInterval(branchName: string, aiActive: boolean): number {\n\t\tconst detection = this.detectPhase(branchName);\n\t\treturn aiActive\n\t\t\t? detection.thresholds.aiAdjustedIntervalMinutes\n\t\t\t: detection.thresholds.recommendedIntervalMinutes;\n\t}\n\n\t/**\n\t * Check if lines changed exceeds phase threshold\n\t */\n\texceedsLineThreshold(branchName: string, linesChanged: number): boolean {\n\t\tconst detection = this.detectPhase(branchName);\n\t\treturn linesChanged >= detection.thresholds.maxLinesBeforeSnapshot;\n\t}\n\n\t/**\n\t * Clear cached detection (for testing or branch changes)\n\t */\n\tclearCache(): void {\n\t\tthis.cachedPhase = null;\n\t\tthis.lastBranch = null;\n\t}\n\n\t// =========================================================================\n\t// MANUAL PHASE OVERRIDE (workspace-scoped with expiry)\n\t// =========================================================================\n\n\t/**\n\t * Set manual phase override for a workspace\n\t * Useful when cross-branch work doesn't match branch name\n\t *\n\t * @param workspaceId - Workspace identifier\n\t * @param phase - Phase to force\n\t * @param expiryMinutes - Minutes until override expires (null = never)\n\t * @param reason - Optional reason for the override\n\t */\n\tsetOverride(\n\t\tworkspaceId: string,\n\t\tphase: DevelopmentPhase,\n\t\texpiryMinutes: number | null = 120, // Default 2 hours\n\t\treason?: string,\n\t): void {\n\t\tconst expiresAt = expiryMinutes !== null ? Date.now() + expiryMinutes * 60 * 1000 : null;\n\t\tthis.overrides.set(workspaceId, {\n\t\t\tphase,\n\t\t\tworkspaceId,\n\t\t\texpiresAt,\n\t\t\treason,\n\t\t});\n\t\t// Clear cache to force re-detection\n\t\tthis.clearCache();\n\t}\n\n\t/**\n\t * Remove manual phase override for a workspace\n\t */\n\tclearOverride(workspaceId: string): void {\n\t\tthis.overrides.delete(workspaceId);\n\t\tthis.clearCache();\n\t}\n\n\t/**\n\t * Get current override for a workspace (if valid)\n\t * Automatically clears expired overrides\n\t */\n\tgetOverride(workspaceId: string): PhaseOverride | null {\n\t\tconst override = this.overrides.get(workspaceId);\n\t\tif (!override) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Check expiry\n\t\tif (override.expiresAt !== null && Date.now() > override.expiresAt) {\n\t\t\tthis.overrides.delete(workspaceId);\n\t\t\treturn null;\n\t\t}\n\n\t\treturn override;\n\t}\n\n\t/**\n\t * Check if workspace has an active override\n\t */\n\thasOverride(workspaceId: string): boolean {\n\t\treturn this.getOverride(workspaceId) !== null;\n\t}\n\n\t/**\n\t * Get all active overrides (for debugging/UI)\n\t */\n\tgetAllOverrides(): PhaseOverride[] {\n\t\tconst now = Date.now();\n\t\tconst active: PhaseOverride[] = [];\n\n\t\tfor (const [id, override] of this.overrides) {\n\t\t\tif (override.expiresAt !== null && now > override.expiresAt) {\n\t\t\t\tthis.overrides.delete(id);\n\t\t\t} else {\n\t\t\t\tactive.push(override);\n\t\t\t}\n\t\t}\n\n\t\treturn active;\n\t}\n\n\t// =========================================================================\n\t// PERSISTENCE (Workspace State)\n\t// =========================================================================\n\n\t/**\n\t * Serialize overrides to JSON-safe format for workspace state persistence\n\t * Automatically removes expired overrides during serialization\n\t *\n\t * @returns Record of active workspace overrides\n\t */\n\tserializeOverrides(): Record<string, PhaseOverride> {\n\t\tconst now = Date.now();\n\t\tconst active: Record<string, PhaseOverride> = {};\n\n\t\tfor (const [id, override] of this.overrides) {\n\t\t\t// Skip expired overrides\n\t\t\tif (override.expiresAt !== null && now > override.expiresAt) {\n\t\t\t\tthis.overrides.delete(id);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tactive[id] = override;\n\t\t}\n\n\t\treturn active;\n\t}\n\n\t/**\n\t * Restore overrides from persisted workspace state\n\t * Validates structure and removes already-expired entries\n\t *\n\t * @param data Persisted overrides record\n\t */\n\tdeserializeOverrides(data: Record<string, PhaseOverride>): void {\n\t\tconst now = Date.now();\n\t\tthis.overrides.clear();\n\n\t\tfor (const [id, override] of Object.entries(data)) {\n\t\t\t// Validate structure\n\t\t\tif (!override.phase || !override.workspaceId) {\n\t\t\t\tcontinue; // Skip invalid entries\n\t\t\t}\n\n\t\t\t// Skip already-expired\n\t\t\tif (override.expiresAt !== null && now > override.expiresAt) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.overrides.set(id, override);\n\t\t}\n\t}\n\n\t/**\n\t * Get all available thresholds for reference\n\t */\n\tstatic getPhaseThresholds(): Record<DevelopmentPhase, PhaseThresholds> {\n\t\treturn { ...PHASE_THRESHOLDS };\n\t}\n\n\t/**\n\t * Get all available patterns for reference\n\t */\n\tstatic getPhasePatterns(): Record<DevelopmentPhase, string[]> {\n\t\tconst result: Record<DevelopmentPhase, string[]> = {} as any;\n\t\tfor (const [phase, patterns] of Object.entries(PHASE_PATTERNS)) {\n\t\t\tresult[phase as DevelopmentPhase] = patterns.map((p) => p.source);\n\t\t}\n\t\treturn result;\n\t}\n}\n","/**\n * @snapback/intelligence - Vitals Learning Types\n *\n * Type definitions for Phase 4: Learning & Calibration\n * - User behavior learning\n * - Per-workspace threshold calibration\n * - Trajectory prediction\n */\n\nimport type { Trajectory, Urgency, VitalsSnapshot } from \"./vitals.js\";\n\n// =============================================================================\n// USER BEHAVIOR LEARNING\n// =============================================================================\n\n/** Risk tolerance profile inferred from user behavior */\nexport type RiskProfile = \"conservative\" | \"balanced\" | \"aggressive\";\n\n/** Timing classification for snapshot events */\nexport type SnapshotTiming = \"early\" | \"aligned\" | \"late\" | \"missed\";\n\n/** A recorded observation of user snapshot behavior */\nexport interface SnapshotObservation {\n\t/** Unique observation ID */\n\tid: string;\n\t/** Workspace this observation belongs to */\n\tworkspaceId: string;\n\t/** Timestamp when observation was recorded */\n\ttimestamp: number;\n\t/** Vitals snapshot at time of observation */\n\tvitals: VitalsSnapshot;\n\t/** Whether user created a snapshot */\n\tuserCreatedSnapshot: boolean;\n\t/** Whether vitals recommended a snapshot at this moment */\n\tvitalsRecommended: boolean;\n\t/** Urgency level when observation was made */\n\turgencyAtTime: Urgency;\n\t/** Timing classification */\n\ttiming: SnapshotTiming;\n}\n\n/** User behavior statistics derived from observations */\nexport interface BehaviorStats {\n\t/** Total observations recorded */\n\ttotalObservations: number;\n\t/** Times user created snapshot when recommended */\n\talignedSnapshots: number;\n\t/** Times user created snapshot before recommendation (early) */\n\tearlySnapshots: number;\n\t/** Times user created snapshot after recommendation (late) */\n\tlateSnapshots: number;\n\t/** Times vitals recommended but user didn't snapshot */\n\tmissedRecommendations: number;\n\t/** Inferred risk profile */\n\triskProfile: RiskProfile;\n\t/** Average pressure when user snapshots */\n\tavgPressureAtSnapshot: number;\n\t/** Average oxygen when user snapshots */\n\tavgOxygenAtSnapshot: number;\n}\n\n// =============================================================================\n// THRESHOLD CALIBRATION\n// =============================================================================\n\n/** Calibration status */\nexport type CalibrationStatus = \"uncalibrated\" | \"learning\" | \"calibrated\" | \"locked\";\n\n/** Per-workspace threshold calibration profile */\nexport interface WorkspaceProfile {\n\t/** Workspace identifier */\n\tworkspaceId: string;\n\t/** Calibration status */\n\tstatus: CalibrationStatus;\n\t/** Number of observations used for calibration */\n\tobservationCount: number;\n\t/** Learned threshold adjustments (multipliers applied to defaults) */\n\tthresholdAdjustments: ThresholdAdjustments;\n\t/** Inferred risk tolerance (0-1 scale, 0=conservative, 1=aggressive) */\n\triskTolerance: number;\n\t/** Typical pulse level for this workspace */\n\ttypicalPulseLevel: number;\n\t/** Average snapshots per hour */\n\tsnapshotFrequency: number;\n\t/** Last calibration timestamp */\n\tlastCalibratedAt: number;\n\t/** Confidence in calibration (0-1) */\n\tconfidence: number;\n}\n\n/** Threshold adjustment multipliers */\nexport interface ThresholdAdjustments {\n\t/** Multiplier for pulse thresholds */\n\tpulseMultiplier: number;\n\t/** Multiplier for temperature thresholds */\n\ttemperatureMultiplier: number;\n\t/** Multiplier for pressure warning threshold */\n\tpressureMultiplier: number;\n\t/** Multiplier for oxygen warning threshold */\n\toxygenMultiplier: number;\n}\n\n/** Default (neutral) threshold adjustments */\nexport const DEFAULT_THRESHOLD_ADJUSTMENTS: ThresholdAdjustments = {\n\tpulseMultiplier: 1.0,\n\ttemperatureMultiplier: 1.0,\n\tpressureMultiplier: 1.0,\n\toxygenMultiplier: 1.0,\n};\n\n/** Calibration thresholds */\nexport const CALIBRATION_THRESHOLDS = {\n\t/** Minimum observations before starting calibration */\n\tMIN_OBSERVATIONS_TO_START: 5,\n\t/** Observations needed for full calibration */\n\tOBSERVATIONS_FOR_CALIBRATION: 20,\n\t/** Observations to lock calibration (stable) */\n\tOBSERVATIONS_TO_LOCK: 50,\n\t/** Confidence threshold to apply adjustments */\n\tCONFIDENCE_THRESHOLD: 0.7,\n} as const;\n\n// =============================================================================\n// TRAJECTORY PREDICTION\n// =============================================================================\n\n/** Predicted trajectory state */\nexport interface TrajectoryForecast {\n\t/** Current trajectory */\n\tcurrent: Trajectory;\n\t/** Predicted trajectory in 5 minutes */\n\tin5Minutes: Trajectory;\n\t/** Predicted trajectory in 10 minutes */\n\tin10Minutes: Trajectory;\n\t/** Confidence in predictions (0-1) */\n\tconfidence: number;\n\t/** Trend direction */\n\ttrend: \"improving\" | \"stable\" | \"worsening\";\n\t/** Time until next predicted state change (ms), null if stable */\n\ttimeToStateChange: number | null;\n}\n\n/** Prediction context used for forecasting */\nexport interface PredictionContext {\n\t/** Recent history (last N snapshots) */\n\trecentHistory: VitalsSnapshot[];\n\t/** Rate of pressure change (per minute) */\n\tpressureRate: number;\n\t/** Rate of oxygen change (per minute) */\n\toxygenRate: number;\n\t/** Temperature trend */\n\ttemperatureTrend: \"cooling\" | \"stable\" | \"heating\";\n\t/** Pulse trend */\n\tpulseTrend: \"slowing\" | \"stable\" | \"accelerating\";\n}\n\n// =============================================================================\n// PROACTIVE SUGGESTIONS\n// =============================================================================\n\n/** Urgency level for suggestions */\nexport type SuggestionUrgency = \"info\" | \"nudge\" | \"warning\" | \"urgent\";\n\n/** A proactive suggestion for the user */\nexport interface ProactiveSuggestion {\n\t/** Unique suggestion ID */\n\tid: string;\n\t/** Type of suggestion */\n\ttype: \"snapshot\" | \"pause\" | \"review\" | \"acknowledge\";\n\t/** Human-readable message */\n\tmessage: string;\n\t/** Urgency level */\n\turgency: SuggestionUrgency;\n\t/** Predicted time until critical (ms), null if not applicable */\n\ttimeUntilCritical: number | null;\n\t/** Whether user has dismissed this suggestion */\n\tdismissed: boolean;\n\t/** Timestamp when suggestion was generated */\n\tgeneratedAt: number;\n}\n\n// =============================================================================\n// STORAGE TYPES\n// =============================================================================\n\n/** Learning store for a workspace */\nexport interface VitalsLearningStore {\n\t/** Path to observations JSONL file */\n\tobservationsPath: string;\n\t/** Path to workspace profile JSON file */\n\tprofilePath: string;\n}\n\n// =============================================================================\n// EVENTS\n// =============================================================================\n\n/** Calibration event emitted when profile is updated */\nexport interface CalibrationEvent {\n\tworkspaceId: string;\n\tstatus: CalibrationStatus;\n\tprofile: WorkspaceProfile;\n}\n\n/** Suggestion event emitted when proactive suggestion is generated */\nexport interface SuggestionEvent {\n\tsuggestion: ProactiveSuggestion;\n\tforecast: TrajectoryForecast;\n}\n","/**\n * ThresholdCalibrator - Per-workspace threshold calibration\n *\n * Adjusts vitals thresholds based on observed user behavior patterns.\n * Conservative users get stricter thresholds, aggressive users get relaxed thresholds.\n *\n * @lifecycle uncalibrated  learning  calibrated  locked\n * @performance Budget: <10ms for updateFromBehavior(), <5ms for getAdjustedThresholds()\n */\n\nimport type { CalibrationStatus, ThresholdAdjustments, WorkspaceProfile } from \"../../types/vitals-learning.js\";\nimport { CALIBRATION_THRESHOLDS, DEFAULT_THRESHOLD_ADJUSTMENTS } from \"../../types/vitals-learning.js\";\nimport type { UserBehaviorLearner } from \"./UserBehaviorLearner.js\";\n\n/** Clamp value to range */\nfunction clamp(value: number, min: number, max: number): number {\n\treturn Math.max(min, Math.min(max, value));\n}\n\n/**\n * Calibrates per-workspace thresholds based on user behavior.\n */\nexport class ThresholdCalibrator {\n\tprivate readonly workspaceId: string;\n\tprivate readonly learner: UserBehaviorLearner;\n\n\tprivate profile: WorkspaceProfile;\n\n\tconstructor(workspaceId: string, learner: UserBehaviorLearner) {\n\t\tthis.workspaceId = workspaceId;\n\t\tthis.learner = learner;\n\n\t\t// Initialize with uncalibrated profile\n\t\tthis.profile = this.createInitialProfile();\n\t}\n\n\t/**\n\t * Create initial uncalibrated profile.\n\t */\n\tprivate createInitialProfile(): WorkspaceProfile {\n\t\treturn {\n\t\t\tworkspaceId: this.workspaceId,\n\t\t\tstatus: \"uncalibrated\",\n\t\t\tobservationCount: 0,\n\t\t\tthresholdAdjustments: { ...DEFAULT_THRESHOLD_ADJUSTMENTS },\n\t\t\triskTolerance: 0.5, // Neutral\n\t\t\ttypicalPulseLevel: 0,\n\t\t\tsnapshotFrequency: 0,\n\t\t\tlastCalibratedAt: 0,\n\t\t\tconfidence: 0,\n\t\t};\n\t}\n\n\t/**\n\t * Update calibration from behavior learner's observations.\n\t */\n\tupdateFromBehavior(): void {\n\t\tconst stats = this.learner.getStats();\n\t\tconst observations = this.learner.getObservations();\n\n\t\tthis.profile.observationCount = stats.totalObservations;\n\n\t\t// Update status based on observation count\n\t\tthis.profile.status = this.calculateStatus(stats.totalObservations);\n\n\t\t// Calculate risk tolerance (0 = conservative, 1 = aggressive)\n\t\tthis.profile.riskTolerance = this.calculateRiskTolerance(stats);\n\n\t\t// Calculate confidence\n\t\tthis.profile.confidence = this.calculateConfidence(stats);\n\n\t\t// Calculate typical pulse level\n\t\tthis.profile.typicalPulseLevel = this.calculateTypicalPulseLevel(observations);\n\n\t\t// Update threshold adjustments if we have enough data\n\t\tif (this.profile.status !== \"uncalibrated\") {\n\t\t\tthis.profile.thresholdAdjustments = this.calculateAdjustments(stats);\n\t\t\tthis.profile.lastCalibratedAt = Date.now();\n\t\t}\n\t}\n\n\t/**\n\t * Calculate calibration status from observation count.\n\t */\n\tprivate calculateStatus(count: number): CalibrationStatus {\n\t\tif (count >= CALIBRATION_THRESHOLDS.OBSERVATIONS_TO_LOCK) {\n\t\t\treturn \"locked\";\n\t\t}\n\t\tif (count >= CALIBRATION_THRESHOLDS.OBSERVATIONS_FOR_CALIBRATION) {\n\t\t\treturn \"calibrated\";\n\t\t}\n\t\tif (count >= CALIBRATION_THRESHOLDS.MIN_OBSERVATIONS_TO_START) {\n\t\t\treturn \"learning\";\n\t\t}\n\t\treturn \"uncalibrated\";\n\t}\n\n\t/**\n\t * Calculate risk tolerance from behavior stats.\n\t * 0 = conservative (early snapshots), 0.5 = balanced, 1 = aggressive (missed/late)\n\t */\n\tprivate calculateRiskTolerance(stats: {\n\t\ttotalObservations: number;\n\t\tearlySnapshots: number;\n\t\tlateSnapshots: number;\n\t\tmissedRecommendations: number;\n\t}): number {\n\t\tif (stats.totalObservations === 0) {\n\t\t\treturn 0.5;\n\t\t}\n\n\t\t// Early  conservative (0), Late/Missed  aggressive (1)\n\t\tconst earlyRatio = stats.earlySnapshots / stats.totalObservations;\n\t\tconst aggressiveRatio = (stats.lateSnapshots + stats.missedRecommendations) / stats.totalObservations;\n\n\t\t// Scale: 0 (all early)  0.5 (balanced)  1 (all missed/late)\n\t\tif (earlyRatio > aggressiveRatio) {\n\t\t\t// Conservative bias\n\t\t\treturn 0.5 - earlyRatio * 0.5;\n\t\t}\n\t\tif (aggressiveRatio > earlyRatio) {\n\t\t\t// Aggressive bias\n\t\t\treturn 0.5 + aggressiveRatio * 0.5;\n\t\t}\n\t\treturn 0.5; // Balanced\n\t}\n\n\t/**\n\t * Calculate confidence in calibration.\n\t */\n\tprivate calculateConfidence(stats: {\n\t\ttotalObservations: number;\n\t\tearlySnapshots: number;\n\t\talignedSnapshots: number;\n\t\tlateSnapshots: number;\n\t\tmissedRecommendations: number;\n\t\triskProfile: string;\n\t}): number {\n\t\tif (stats.totalObservations === 0) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tconst count = stats.totalObservations;\n\n\t\t// Base confidence from observation count\n\t\tconst countConfidence = Math.min(count / CALIBRATION_THRESHOLDS.OBSERVATIONS_FOR_CALIBRATION, 1.0);\n\n\t\t// Consistency confidence - how dominant is the primary behavior?\n\t\tconst behaviors = [\n\t\t\tstats.earlySnapshots,\n\t\t\tstats.alignedSnapshots,\n\t\t\tstats.lateSnapshots,\n\t\t\tstats.missedRecommendations,\n\t\t];\n\t\tconst maxBehavior = Math.max(...behaviors);\n\t\tconst consistency = count > 0 ? maxBehavior / count : 0;\n\n\t\t// Entropy penalty: penalize when multiple behaviors are present\n\t\t// A truly consistent user should have >60% in one category\n\t\tconst entropyPenalty = consistency < 0.6 ? 0.15 : 0;\n\n\t\t// Combined confidence (weight count more initially, consistency more later)\n\t\tconst confidence = countConfidence * 0.6 + consistency * 0.4 - entropyPenalty;\n\n\t\treturn clamp(confidence, 0, 1);\n\t}\n\n\t/**\n\t * Calculate typical pulse level from observations.\n\t */\n\tprivate calculateTypicalPulseLevel(\n\t\tobservations: Array<{ vitals: { pulse: { changesPerMinute: number } } }>,\n\t): number {\n\t\tif (observations.length === 0) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tconst total = observations.reduce((sum, obs) => sum + obs.vitals.pulse.changesPerMinute, 0);\n\t\treturn total / observations.length;\n\t}\n\n\t/**\n\t * Calculate threshold adjustments based on risk profile.\n\t */\n\tprivate calculateAdjustments(stats: { riskProfile: string }): ThresholdAdjustments {\n\t\t// Base multiplier from risk profile\n\t\tlet baseMultiplier: number;\n\n\t\tswitch (stats.riskProfile) {\n\t\t\tcase \"conservative\":\n\t\t\t\t// Lower thresholds = more sensitive/protective\n\t\t\t\tbaseMultiplier = 0.7;\n\t\t\t\tbreak;\n\t\t\tcase \"aggressive\":\n\t\t\t\t// Higher thresholds = less nagging\n\t\t\t\tbaseMultiplier = 1.3;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbaseMultiplier = 1.0;\n\t\t}\n\n\t\t// Clamp to safe range\n\t\tconst clampedMultiplier = clamp(baseMultiplier, 0.5, 2.0);\n\n\t\treturn {\n\t\t\tpulseMultiplier: clampedMultiplier,\n\t\t\ttemperatureMultiplier: clampedMultiplier,\n\t\t\tpressureMultiplier: clampedMultiplier,\n\t\t\toxygenMultiplier: clampedMultiplier,\n\t\t};\n\t}\n\n\t/**\n\t * Get the current workspace profile.\n\t */\n\tgetProfile(): WorkspaceProfile {\n\t\treturn { ...this.profile };\n\t}\n\n\t/**\n\t * Get adjusted thresholds for use in vitals calculations.\n\t * Returns defaults if uncalibrated.\n\t */\n\tgetAdjustedThresholds(): ThresholdAdjustments {\n\t\tif (this.profile.status === \"uncalibrated\") {\n\t\t\treturn { ...DEFAULT_THRESHOLD_ADJUSTMENTS };\n\t\t}\n\t\treturn { ...this.profile.thresholdAdjustments };\n\t}\n\n\t/**\n\t * Reset calibration to initial state.\n\t */\n\treset(): void {\n\t\tthis.profile = this.createInitialProfile();\n\t\tthis.learner.reset();\n\t}\n}\n","/**\n * TrajectoryPredictor - Forecasts trajectory changes\n *\n * Analyzes vitals history to predict future states and time to critical.\n * Uses simple linear regression on pressure/oxygen rates.\n *\n * @performance Budget: <10ms for predict()\n */\n\nimport type { Trajectory, VitalsSnapshot } from \"../../types/vitals.js\";\nimport type { PredictionContext, TrajectoryForecast } from \"../../types/vitals-learning.js\";\n\n/** Clamp value to range */\nfunction clamp(value: number, min: number, max: number): number {\n\treturn Math.max(min, Math.min(max, value));\n}\n\n/**\n * Predicts trajectory changes based on vitals history.\n */\nexport class TrajectoryPredictor {\n\t// biome-ignore lint/correctness/noUnusedPrivateClassMembers: stored for context/debugging\n\tprivate readonly workspaceId: string;\n\tprivate history: VitalsSnapshot[] = [];\n\tprivate readonly maxHistory = 100;\n\n\tconstructor(workspaceId: string) {\n\t\tthis.workspaceId = workspaceId;\n\t}\n\n\t/**\n\t * Record vitals snapshots for prediction.\n\t */\n\trecordSnapshots(snapshots: VitalsSnapshot[]): void {\n\t\tthis.history.push(...snapshots);\n\n\t\t// Limit history size\n\t\tif (this.history.length > this.maxHistory) {\n\t\t\tthis.history = this.history.slice(-this.maxHistory);\n\t\t}\n\t}\n\n\t/**\n\t * Predict trajectory changes.\n\t */\n\tpredict(): TrajectoryForecast {\n\t\tif (this.history.length === 0) {\n\t\t\treturn this.createDefaultForecast();\n\t\t}\n\n\t\tconst context = this.calculateContext();\n\t\tconst current = this.getCurrentTrajectory();\n\t\tconst trend = this.calculateTrend(context);\n\t\tconst confidence = this.calculateConfidence();\n\n\t\t// Predict future trajectories\n\t\tconst in5Minutes = this.predictTrajectoryAt(context, 5);\n\t\tconst in10Minutes = this.predictTrajectoryAt(context, 10);\n\n\t\t// Calculate time to state change\n\t\tconst timeToStateChange = this.calculateTimeToStateChange(context, current);\n\n\t\treturn {\n\t\t\tcurrent,\n\t\t\tin5Minutes,\n\t\t\tin10Minutes,\n\t\t\tconfidence,\n\t\t\ttrend,\n\t\t\ttimeToStateChange,\n\t\t};\n\t}\n\n\t/**\n\t * Get prediction context.\n\t */\n\tgetContext(): PredictionContext {\n\t\treturn this.calculateContext();\n\t}\n\n\t/**\n\t * Reset history.\n\t */\n\treset(): void {\n\t\tthis.history = [];\n\t}\n\n\t/**\n\t * Create default forecast when no data.\n\t */\n\tprivate createDefaultForecast(): TrajectoryForecast {\n\t\treturn {\n\t\t\tcurrent: \"stable\",\n\t\t\tin5Minutes: \"stable\",\n\t\t\tin10Minutes: \"stable\",\n\t\t\tconfidence: 0,\n\t\t\ttrend: \"stable\",\n\t\t\ttimeToStateChange: null,\n\t\t};\n\t}\n\n\t/**\n\t * Get current trajectory from most recent snapshot.\n\t */\n\tprivate getCurrentTrajectory(): Trajectory {\n\t\tif (this.history.length === 0) {\n\t\t\treturn \"stable\";\n\t\t}\n\t\treturn this.history[this.history.length - 1].trajectory;\n\t}\n\n\t/**\n\t * Calculate prediction context from history.\n\t */\n\tprivate calculateContext(): PredictionContext {\n\t\tconst recentHistory = this.history.slice(-10); // Last 10 snapshots\n\n\t\tif (recentHistory.length < 2) {\n\t\t\treturn {\n\t\t\t\trecentHistory,\n\t\t\t\tpressureRate: 0,\n\t\t\t\toxygenRate: 0,\n\t\t\t\ttemperatureTrend: \"stable\",\n\t\t\t\tpulseTrend: \"stable\",\n\t\t\t};\n\t\t}\n\n\t\t// Calculate rates (per minute)\n\t\tconst pressureRate = this.calculateRate(recentHistory, (s) => s.pressure.value);\n\t\tconst oxygenRate = this.calculateRate(recentHistory, (s) => s.oxygen.value);\n\n\t\t// Calculate trends\n\t\tconst temperatureTrend = this.calculateTemperatureTrend(recentHistory);\n\t\tconst pulseTrend = this.calculatePulseTrend(recentHistory);\n\n\t\treturn {\n\t\t\trecentHistory,\n\t\t\tpressureRate,\n\t\t\toxygenRate,\n\t\t\ttemperatureTrend,\n\t\t\tpulseTrend,\n\t\t};\n\t}\n\n\t/**\n\t * Calculate rate of change per minute.\n\t */\n\tprivate calculateRate(snapshots: VitalsSnapshot[], getValue: (s: VitalsSnapshot) => number): number {\n\t\tif (snapshots.length < 2) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tconst first = snapshots[0];\n\t\tconst last = snapshots[snapshots.length - 1];\n\n\t\tconst valueDelta = getValue(last) - getValue(first);\n\t\tconst timeDeltaMinutes = (last.timestamp - first.timestamp) / 60000;\n\n\t\tif (timeDeltaMinutes === 0) {\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn valueDelta / timeDeltaMinutes;\n\t}\n\n\t/**\n\t * Calculate temperature trend.\n\t */\n\tprivate calculateTemperatureTrend(snapshots: VitalsSnapshot[]): \"cooling\" | \"stable\" | \"heating\" {\n\t\tif (snapshots.length < 2) {\n\t\t\treturn \"stable\";\n\t\t}\n\n\t\tconst first = snapshots[0].temperature.aiPercentage;\n\t\tconst last = snapshots[snapshots.length - 1].temperature.aiPercentage;\n\t\tconst delta = last - first;\n\n\t\tif (delta > 5) {\n\t\t\treturn \"heating\";\n\t\t}\n\t\tif (delta < -5) {\n\t\t\treturn \"cooling\";\n\t\t}\n\t\treturn \"stable\";\n\t}\n\n\t/**\n\t * Calculate pulse trend.\n\t */\n\tprivate calculatePulseTrend(snapshots: VitalsSnapshot[]): \"slowing\" | \"stable\" | \"accelerating\" {\n\t\tif (snapshots.length < 2) {\n\t\t\treturn \"stable\";\n\t\t}\n\n\t\tconst first = snapshots[0].pulse.changesPerMinute;\n\t\tconst last = snapshots[snapshots.length - 1].pulse.changesPerMinute;\n\t\tconst delta = last - first;\n\n\t\tif (delta > 5) {\n\t\t\treturn \"accelerating\";\n\t\t}\n\t\tif (delta < -5) {\n\t\t\treturn \"slowing\";\n\t\t}\n\t\treturn \"stable\";\n\t}\n\n\t/**\n\t * Calculate overall trend from context.\n\t */\n\tprivate calculateTrend(context: PredictionContext): \"improving\" | \"stable\" | \"worsening\" {\n\t\t// Calculate recent pressure rate (last 3 snapshots) for better plateau detection\n\t\tconst recent = context.recentHistory.slice(-3);\n\t\tconst recentRate = this.calculateRate(recent, (s) => s.pressure.value);\n\n\t\t// Check if pressure is stable (rate near zero)\n\t\tif (Math.abs(recentRate) < 1) {\n\t\t\treturn \"stable\";\n\t\t}\n\n\t\tif (recentRate > 0) {\n\t\t\treturn \"worsening\";\n\t\t}\n\t\tif (recentRate < 0) {\n\t\t\treturn \"improving\";\n\t\t}\n\n\t\treturn \"stable\";\n\t}\n\n\t/**\n\t * Calculate confidence in predictions.\n\t */\n\tprivate calculateConfidence(): number {\n\t\tconst count = this.history.length;\n\n\t\tif (count === 0) {\n\t\t\treturn 0;\n\t\t}\n\t\tif (count === 1) {\n\t\t\treturn 0.2;\n\t\t}\n\t\tif (count < 3) {\n\t\t\treturn 0.4;\n\t\t}\n\t\tif (count < 5) {\n\t\t\treturn 0.6;\n\t\t}\n\t\tif (count < 10) {\n\t\t\treturn 0.75;\n\t\t}\n\n\t\treturn 0.9;\n\t}\n\n\t/**\n\t * Predict trajectory at a future time (in minutes).\n\t */\n\tprivate predictTrajectoryAt(context: PredictionContext, minutesAhead: number): Trajectory {\n\t\tif (this.history.length === 0) {\n\t\t\treturn \"stable\";\n\t\t}\n\n\t\tconst current = this.history[this.history.length - 1];\n\t\tconst currentPressure = current.pressure.value;\n\n\t\t// Project pressure based on rate\n\t\tconst projectedPressure = clamp(currentPressure + context.pressureRate * minutesAhead, 0, 100);\n\n\t\t// Convert to trajectory\n\t\tif (projectedPressure > 80) {\n\t\t\treturn \"critical\";\n\t\t}\n\t\tif (projectedPressure > 60) {\n\t\t\treturn \"escalating\";\n\t\t}\n\t\treturn \"stable\";\n\t}\n\n\t/**\n\t * Calculate time until trajectory state change.\n\t * Returns null if stable or already critical.\n\t */\n\tprivate calculateTimeToStateChange(context: PredictionContext, current: Trajectory): number | null {\n\t\tif (current === \"critical\") {\n\t\t\treturn null;\n\t\t}\n\t\tif (context.pressureRate <= 0) {\n\t\t\treturn null; // Improving or stable\n\t\t}\n\n\t\tconst currentPressure = this.history.length > 0 ? this.history[this.history.length - 1].pressure.value : 0;\n\n\t\t// Calculate time to reach next threshold\n\t\tlet targetPressure: number;\n\n\t\tif (current === \"stable\") {\n\t\t\ttargetPressure = 60; // Threshold to escalating\n\t\t} else {\n\t\t\ttargetPressure = 80; // Threshold to critical\n\t\t}\n\n\t\tif (currentPressure >= targetPressure) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst pressureDelta = targetPressure - currentPressure;\n\t\tconst timeMinutes = pressureDelta / context.pressureRate;\n\n\t\t// Convert to milliseconds\n\t\treturn Math.round(timeMinutes * 60000);\n\t}\n}\n","/**\n * UserBehaviorLearner - Tracks user snapshot patterns\n *\n * Records observations of when users create snapshots relative to vitals recommendations.\n * Infers user's risk tolerance profile and provides statistics for threshold calibration.\n *\n * @performance Budget: <5ms for recordObservation(), <10ms for getStats()\n */\n\nimport type { Urgency, VitalsSnapshot } from \"../../types/vitals.js\";\nimport type { BehaviorStats, RiskProfile, SnapshotObservation, SnapshotTiming } from \"../../types/vitals-learning.js\";\n\n/** Input for recording an observation */\nexport interface ObservationInput {\n\tvitals: VitalsSnapshot;\n\tuserCreatedSnapshot: boolean;\n\tvitalsRecommended: boolean;\n}\n\n/** Generate unique ID */\nfunction generateId(): string {\n\treturn `obs-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n}\n\n/**\n * Learns from user snapshot behavior to calibrate thresholds.\n */\nexport class UserBehaviorLearner {\n\tprivate readonly workspaceId: string;\n\tprivate observations: SnapshotObservation[] = [];\n\tprivate readonly maxHistory = 100;\n\n\tconstructor(workspaceId: string) {\n\t\tthis.workspaceId = workspaceId;\n\t}\n\n\t/**\n\t * Record an observation of user behavior.\n\t */\n\trecordObservation(input: ObservationInput): SnapshotObservation {\n\t\tconst timing = this.classifyTiming(input);\n\t\tconst urgency = this.calculateUrgency(input.vitals);\n\n\t\tconst observation: SnapshotObservation = {\n\t\t\tid: generateId(),\n\t\t\tworkspaceId: this.workspaceId,\n\t\t\ttimestamp: Date.now(),\n\t\t\tvitals: input.vitals,\n\t\t\tuserCreatedSnapshot: input.userCreatedSnapshot,\n\t\t\tvitalsRecommended: input.vitalsRecommended,\n\t\t\turgencyAtTime: urgency,\n\t\t\ttiming,\n\t\t};\n\n\t\tthis.observations.push(observation);\n\n\t\t// Bound history\n\t\tif (this.observations.length > this.maxHistory) {\n\t\t\tthis.observations.shift();\n\t\t}\n\n\t\treturn observation;\n\t}\n\n\t/**\n\t * Classify the timing of the observation.\n\t */\n\tprivate classifyTiming(input: ObservationInput): SnapshotTiming {\n\t\tif (!input.userCreatedSnapshot && input.vitalsRecommended) {\n\t\t\treturn \"missed\";\n\t\t}\n\n\t\tif (input.userCreatedSnapshot && !input.vitalsRecommended) {\n\t\t\treturn \"early\";\n\t\t}\n\n\t\tif (input.userCreatedSnapshot && input.vitalsRecommended) {\n\t\t\t// Check if user was late (critical trajectory or very high pressure)\n\t\t\tif (input.vitals.trajectory === \"critical\" || input.vitals.pressure.value > 80) {\n\t\t\t\treturn \"late\";\n\t\t\t}\n\t\t\treturn \"aligned\";\n\t\t}\n\n\t\t// No snapshot, no recommendation = not tracked as significant\n\t\treturn \"aligned\";\n\t}\n\n\t/**\n\t * Calculate urgency from vitals.\n\t */\n\tprivate calculateUrgency(vitals: VitalsSnapshot): Urgency {\n\t\tif (vitals.trajectory === \"critical\") {\n\t\t\treturn \"critical\";\n\t\t}\n\t\tif (vitals.pressure.value > 80) {\n\t\t\treturn \"high\";\n\t\t}\n\t\tif (vitals.pressure.value > 60 || vitals.trajectory === \"escalating\") {\n\t\t\treturn \"medium\";\n\t\t}\n\t\tif (vitals.pressure.value > 40) {\n\t\t\treturn \"low\";\n\t\t}\n\t\treturn \"none\";\n\t}\n\n\t/**\n\t * Get behavior statistics.\n\t */\n\tgetStats(): BehaviorStats {\n\t\tconst total = this.observations.length;\n\n\t\tif (total === 0) {\n\t\t\treturn {\n\t\t\t\ttotalObservations: 0,\n\t\t\t\talignedSnapshots: 0,\n\t\t\t\tearlySnapshots: 0,\n\t\t\t\tlateSnapshots: 0,\n\t\t\t\tmissedRecommendations: 0,\n\t\t\t\triskProfile: \"balanced\",\n\t\t\t\tavgPressureAtSnapshot: 0,\n\t\t\t\tavgOxygenAtSnapshot: 0,\n\t\t\t};\n\t\t}\n\n\t\tconst aligned = this.observations.filter((o) => o.timing === \"aligned\" && o.userCreatedSnapshot).length;\n\t\tconst early = this.observations.filter((o) => o.timing === \"early\").length;\n\t\tconst late = this.observations.filter((o) => o.timing === \"late\").length;\n\t\tconst missed = this.observations.filter((o) => o.timing === \"missed\").length;\n\n\t\t// Calculate averages for snapshots only\n\t\tconst snapshotObs = this.observations.filter((o) => o.userCreatedSnapshot);\n\t\tconst avgPressure =\n\t\t\tsnapshotObs.length > 0\n\t\t\t\t? snapshotObs.reduce((sum, o) => sum + o.vitals.pressure.value, 0) / snapshotObs.length\n\t\t\t\t: 0;\n\t\tconst avgOxygen =\n\t\t\tsnapshotObs.length > 0\n\t\t\t\t? snapshotObs.reduce((sum, o) => sum + o.vitals.oxygen.value, 0) / snapshotObs.length\n\t\t\t\t: 0;\n\n\t\t// Infer risk profile\n\t\tconst riskProfile = this.inferRiskProfile(early, aligned, late, missed, total);\n\n\t\treturn {\n\t\t\ttotalObservations: total,\n\t\t\talignedSnapshots: aligned,\n\t\t\tearlySnapshots: early,\n\t\t\tlateSnapshots: late,\n\t\t\tmissedRecommendations: missed,\n\t\t\triskProfile,\n\t\t\tavgPressureAtSnapshot: Math.round(avgPressure),\n\t\t\tavgOxygenAtSnapshot: Math.round(avgOxygen),\n\t\t};\n\t}\n\n\t/**\n\t * Infer risk profile from observation patterns.\n\t */\n\tprivate inferRiskProfile(\n\t\tearly: number,\n\t\t_aligned: number,\n\t\tlate: number,\n\t\tmissed: number,\n\t\ttotal: number,\n\t): RiskProfile {\n\t\tif (total < 3) {\n\t\t\treturn \"balanced\"; // Not enough data\n\t\t}\n\n\t\tconst earlyRatio = early / total;\n\t\tconst missedRatio = missed / total;\n\t\tconst lateRatio = late / total;\n\n\t\t// Conservative: Early snapshots dominate (>50%)\n\t\tif (earlyRatio > 0.5) {\n\t\t\treturn \"conservative\";\n\t\t}\n\n\t\t// Aggressive: Missed + late dominate (>50%)\n\t\tif (missedRatio + lateRatio > 0.5) {\n\t\t\treturn \"aggressive\";\n\t\t}\n\n\t\t// Balanced: Mixed behavior\n\t\treturn \"balanced\";\n\t}\n\n\t/**\n\t * Get all observations.\n\t */\n\tgetObservations(): SnapshotObservation[] {\n\t\treturn [...this.observations];\n\t}\n\n\t/**\n\t * Reset all observations.\n\t */\n\treset(): void {\n\t\tthis.observations = [];\n\t}\n}\n","/**\n * OxygenSensor - Snapshot coverage tracking\n *\n * Measures how well-protected the workspace is based on:\n * - What percentage of modified files have snapshots\n * - How recent those snapshots are (stale = low oxygen)\n * - Critical file coverage weighted 2x\n *\n * @performance Budget: <1ms per operation\n */\n\nimport type { OxygenConfig } from \"../types/vitals.js\";\n\n/** Default oxygen configuration */\nexport const DEFAULT_OXYGEN_CONFIG: OxygenConfig = {\n\tstaleMinutes: 30, // Snapshots older than 30 min are stale\n\tcriticalWeight: 2, // Critical files count 2x\n};\n\n/** Oxygen state with metrics */\nexport interface OxygenState {\n\tvalue: number; // 0-100\n\tcoveragePercentage: number;\n\tstaleSnapshots: number;\n}\n\n/** Patterns for critical files */\nconst CRITICAL_FILE_PATTERNS: RegExp[] = [\n\t/package\\.json$/,\n\t/\\.env($|\\.)/,\n\t/tsconfig\\.json$/,\n\t/pnpm-lock\\.yaml$/,\n\t/\\.lock$/,\n\t/migrations?\\//,\n\t/schema\\.(sql|prisma|graphql)$/,\n];\n\n/**\n * Tracks snapshot coverage of modified files.\n *\n * Oxygen represents how \"protected\" the current work is.\n * Higher oxygen = more snapshots covering active files.\n */\nexport class OxygenSensor {\n\t/** Map of file path to snapshot timestamp */\n\tprivate snapshots: Map<string, number> = new Map();\n\t/** Set of files that have been modified */\n\tprivate modifiedFiles: Set<string> = new Set();\n\tprivate readonly config: OxygenConfig;\n\n\tconstructor(config: Partial<OxygenConfig> = {}) {\n\t\tthis.config = { ...DEFAULT_OXYGEN_CONFIG, ...config };\n\t}\n\n\t/**\n\t * Record a file modification.\n\t * @param filePath Path of the modified file\n\t */\n\trecordModification(filePath: string): void {\n\t\tthis.modifiedFiles.add(filePath);\n\t}\n\n\t/**\n\t * Record a snapshot creation for a file.\n\t * @param filePath Path of the snapshotted file\n\t * @param timestamp Optional: snapshot time for testing\n\t */\n\trecordSnapshot(filePath: string, timestamp: number = Date.now()): void {\n\t\tthis.snapshots.set(filePath, timestamp);\n\t\t// File is no longer \"modified without snapshot\"\n\t\tthis.modifiedFiles.delete(filePath);\n\t}\n\n\t/**\n\t * Record multiple snapshots at once (e.g., workspace-wide snapshot).\n\t * @param filePaths Paths of snapshotted files\n\t * @param timestamp Optional: snapshot time for testing\n\t */\n\trecordBulkSnapshot(filePaths: string[], timestamp: number = Date.now()): void {\n\t\tfor (const filePath of filePaths) {\n\t\t\tthis.recordSnapshot(filePath, timestamp);\n\t\t}\n\t}\n\n\t/**\n\t * Get current oxygen level and metrics.\n\t * @param now Optional: current time for testing\n\t */\n\tgetLevel(now: number = Date.now()): OxygenState {\n\t\tconst staleThreshold = now - this.config.staleMinutes * 60 * 1000;\n\n\t\tlet covered = 0;\n\t\tlet total = 0;\n\t\tlet stale = 0;\n\n\t\t// Calculate coverage based on modified files\n\t\tfor (const file of this.modifiedFiles) {\n\t\t\tconst isCritical = this.isCriticalFile(file);\n\t\t\tconst weight = isCritical ? this.config.criticalWeight : 1;\n\t\t\ttotal += weight;\n\n\t\t\tconst snapshotTime = this.snapshots.get(file);\n\t\t\tif (snapshotTime) {\n\t\t\t\tif (snapshotTime > staleThreshold) {\n\t\t\t\t\tcovered += weight;\n\t\t\t\t} else {\n\t\t\t\t\tstale++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Note: Files with snapshots that aren't in modifiedFiles are fully protected\n\t\t// and don't need to be counted - they're already safe\n\n\t\t// If no modified files, oxygen is 100%\n\t\tconst coveragePercentage = total > 0 ? (covered / total) * 100 : 100;\n\n\t\treturn {\n\t\t\tvalue: Math.round(coveragePercentage),\n\t\t\tcoveragePercentage: Math.round(coveragePercentage),\n\t\t\tstaleSnapshots: stale,\n\t\t};\n\t}\n\n\t/**\n\t * Get list of modified files without snapshots.\n\t */\n\tgetUncoveredFiles(): string[] {\n\t\treturn Array.from(this.modifiedFiles).filter((file) => !this.snapshots.has(file));\n\t}\n\n\t/**\n\t * Get count of tracked files.\n\t */\n\tgetCounts(): { modified: number; snapshots: number } {\n\t\treturn {\n\t\t\tmodified: this.modifiedFiles.size,\n\t\t\tsnapshots: this.snapshots.size,\n\t\t};\n\t}\n\n\t/**\n\t * Clear all tracking data.\n\t */\n\treset(): void {\n\t\tthis.snapshots.clear();\n\t\tthis.modifiedFiles.clear();\n\t}\n\n\t/**\n\t * Check if a file path matches critical file patterns.\n\t */\n\tprivate isCriticalFile(filePath: string): boolean {\n\t\treturn CRITICAL_FILE_PATTERNS.some((pattern) => pattern.test(filePath));\n\t}\n}\n","/**\n * PressureGauge - Risk accumulation tracking\n *\n * Measures the buildup of risk over time when changes are made without snapshots.\n * Pressure increases with:\n * - Time since last snapshot\n * - Number of unsnapshot'd changes\n * - Critical file modifications (2x multiplier)\n *\n * Pressure decreases when:\n * - A snapshot is created (50% decay)\n *\n * @performance Budget: <1ms per operation\n */\n\nimport type { PressureConfig } from \"../types/vitals.js\";\n\n/** Default pressure configuration */\nexport const DEFAULT_PRESSURE_CONFIG: PressureConfig = {\n\tbaseRate: 5, // 5% pressure per minute\n\tcriticalMultiplier: 2, // 2x for critical files\n\tdecayOnSnapshot: 50, // Release 50% on snapshot\n\tmaxPressure: 100,\n};\n\n/** Pressure state result */\nexport interface PressureState {\n\tvalue: number; // 0-100\n\tunsnapshotedChanges: number;\n\ttimeSinceLastSnapshot: number; // minutes\n\tcriticalFilesTouched: string[];\n}\n\n/**\n * Structured snapshot recommendation based on pressure analysis\n * 2026 best practice: Actionable, context-aware recommendations\n */\nexport interface PressureRecommendation {\n\t/** Should a snapshot be created now? */\n\tshouldSnapshot: boolean;\n\t/** Urgency level (0-100) */\n\turgency: number;\n\t/** Primary reason for recommendation */\n\treason: string;\n\t/** Detailed context for the recommendation */\n\tcontext: {\n\t\t/** Current pressure value */\n\t\tpressure: number;\n\t\t/** Number of unsnapshot'd changes */\n\t\tchanges: number;\n\t\t/** Minutes since last snapshot */\n\t\tminutesSinceSnapshot: number;\n\t\t/** Critical files affected */\n\t\tcriticalFiles: string[];\n\t};\n\t/** Suggested action for the user */\n\taction: \"snapshot_now\" | \"snapshot_soon\" | \"monitor\" | \"none\";\n\t/** Educational message explaining why this matters */\n\teducational?: string;\n}\n\n/** Patterns for critical files that warrant extra protection */\nconst CRITICAL_FILE_PATTERNS: RegExp[] = [\n\t/package\\.json$/,\n\t/\\.env($|\\.)/,\n\t/tsconfig\\.json$/,\n\t/pnpm-lock\\.yaml$/,\n\t/\\.lock$/,\n\t/migrations?\\//,\n\t/schema\\.(sql|prisma|graphql)$/,\n\t/docker-compose\\.ya?ml$/,\n\t/Dockerfile$/,\n];\n\n/**\n * Tracks risk pressure accumulation.\n *\n * Pressure builds continuously:\n * - Base rate per minute of elapsed time\n * - Per-change rate (higher for critical files)\n *\n * Pressure releases on snapshot creation.\n */\nexport class PressureGauge {\n\tprivate changeBasedPressure = 0;\n\tprivate unsnapshotedChanges = 0;\n\tprivate lastSnapshotTime: number;\n\tprivate criticalFilesTouched: Set<string> = new Set();\n\tprivate readonly config: PressureConfig;\n\n\tconstructor(config: Partial<PressureConfig> = {}, initialTime: number = Date.now()) {\n\t\tthis.config = { ...DEFAULT_PRESSURE_CONFIG, ...config };\n\t\tthis.lastSnapshotTime = initialTime;\n\t}\n\n\t/**\n\t * Record a file change, accumulating pressure.\n\t * @param filePath Path of the modified file\n\t */\n\trecordChange(filePath: string): void {\n\t\tthis.unsnapshotedChanges++;\n\n\t\tconst isCritical = this.isCriticalFile(filePath);\n\t\tif (isCritical) {\n\t\t\tthis.criticalFilesTouched.add(filePath);\n\t\t}\n\n\t\t// Accumulate pressure per change\n\t\t// Each change adds baseRate/10 (so 10 changes = 1 minute worth of pressure)\n\t\tconst multiplier = isCritical ? this.config.criticalMultiplier : 1;\n\t\tconst increment = (this.config.baseRate * multiplier) / 10;\n\t\tthis.changeBasedPressure = Math.min(this.config.maxPressure, this.changeBasedPressure + increment);\n\t}\n\n\t/**\n\t * Record a snapshot, releasing pressure.\n\t * @param now Optional timestamp for testing\n\t */\n\trecordSnapshot(now: number = Date.now()): void {\n\t\t// Decay pressure by configured percentage\n\t\tthis.changeBasedPressure = Math.max(0, this.changeBasedPressure * (1 - this.config.decayOnSnapshot / 100));\n\t\tthis.unsnapshotedChanges = 0;\n\t\tthis.criticalFilesTouched.clear();\n\t\tthis.lastSnapshotTime = now;\n\t}\n\n\t/**\n\t * Get current pressure state.\n\t * @param now Optional timestamp for testing\n\t */\n\tgetState(now: number = Date.now()): PressureState {\n\t\tconst minutesSinceSnapshot = Math.max(0, (now - this.lastSnapshotTime) / 60000);\n\n\t\t// Time-based pressure ONLY accumulates when there are unsnapshot changes\n\t\t// This prevents false alarms when workspace is idle\n\t\tconst timePressure = this.unsnapshotedChanges > 0 ? minutesSinceSnapshot * this.config.baseRate : 0;\n\n\t\t// Total pressure is change-based + time-based, capped at max\n\t\tconst totalPressure = Math.min(this.config.maxPressure, this.changeBasedPressure + timePressure);\n\n\t\treturn {\n\t\t\tvalue: Math.round(totalPressure),\n\t\t\tunsnapshotedChanges: this.unsnapshotedChanges,\n\t\t\ttimeSinceLastSnapshot: Math.round(minutesSinceSnapshot),\n\t\t\tcriticalFilesTouched: Array.from(this.criticalFilesTouched),\n\t\t};\n\t}\n\n\t/**\n\t * Reset the gauge to initial state.\n\t * @param now Optional timestamp for testing\n\t */\n\treset(now: number = Date.now()): void {\n\t\tthis.changeBasedPressure = 0;\n\t\tthis.unsnapshotedChanges = 0;\n\t\tthis.criticalFilesTouched.clear();\n\t\tthis.lastSnapshotTime = now;\n\t}\n\n\t/**\n\t * Check if a file path matches critical file patterns.\n\t */\n\tprivate isCriticalFile(filePath: string): boolean {\n\t\treturn CRITICAL_FILE_PATTERNS.some((pattern) => pattern.test(filePath));\n\t}\n\n\t// =========================================================================\n\t// RECOMMENDATIONS API (2026 industry standard)\n\t// =========================================================================\n\n\t/**\n\t * Get structured snapshot recommendation based on current pressure state\n\t *\n\t * 2026 Best Practice: Recommendations should be:\n\t * - Actionable (clear next step)\n\t * - Context-aware (includes relevant data)\n\t * - Educational (explains why it matters)\n\t *\n\t * @param now Optional timestamp for testing\n\t * @returns Structured recommendation with action and context\n\t */\n\tgetRecommendation(now: number = Date.now()): PressureRecommendation {\n\t\tconst state = this.getState(now);\n\t\tconst { value, unsnapshotedChanges, timeSinceLastSnapshot, criticalFilesTouched } = state;\n\n\t\t// Determine urgency and action based on thresholds\n\t\tlet shouldSnapshot = false;\n\t\tlet urgency = 0;\n\t\tlet reason = \"\";\n\t\tlet action: PressureRecommendation[\"action\"] = \"none\";\n\t\tlet educational: string | undefined;\n\n\t\t// Critical pressure (>=80): Immediate action needed\n\t\tif (value >= 80) {\n\t\t\tshouldSnapshot = true;\n\t\t\turgency = 100;\n\t\t\treason = `Critical pressure (${value}%) - immediate snapshot recommended`;\n\t\t\taction = \"snapshot_now\";\n\t\t\teducational =\n\t\t\t\t\"High pressure indicates significant unsnapshot'd work. Creating a snapshot now protects against potential loss.\";\n\t\t}\n\t\t// High pressure (>=60): Snapshot soon\n\t\telse if (value >= 60) {\n\t\t\tshouldSnapshot = true;\n\t\t\turgency = 75;\n\t\t\treason = `High pressure (${value}%) - snapshot recommended`;\n\t\t\taction = \"snapshot_soon\";\n\t\t\teducational = \"Risk is accumulating. A snapshot within the next few minutes will keep your work protected.\";\n\t\t}\n\t\t// Moderate pressure (>=40): Monitor closely\n\t\telse if (value >= 40) {\n\t\t\tshouldSnapshot = false;\n\t\t\turgency = 50;\n\t\t\treason = `Moderate pressure (${value}%) - monitoring recommended`;\n\t\t\taction = \"monitor\";\n\t\t\teducational =\n\t\t\t\t\"Your session is progressing normally. Consider a snapshot if you're about to start risky changes.\";\n\t\t}\n\t\t// Low pressure (<40): No action needed\n\t\telse {\n\t\t\tshouldSnapshot = false;\n\t\t\turgency = value;\n\t\t\treason = \"Session health is good - no action needed\";\n\t\t\taction = \"none\";\n\t\t}\n\n\t\t// Boost urgency if critical files are touched\n\t\tif (criticalFilesTouched.length > 0 && value >= 30) {\n\t\t\turgency = Math.min(100, urgency + 20);\n\t\t\treason = `${reason} (critical files modified)`;\n\t\t\tif (action === \"monitor\") {\n\t\t\t\taction = \"snapshot_soon\";\n\t\t\t\tshouldSnapshot = true;\n\t\t\t}\n\t\t\teducational = `Critical files (${criticalFilesTouched.slice(0, 2).join(\", \")}) have been modified. These files typically require more protection.`;\n\t\t}\n\n\t\treturn {\n\t\t\tshouldSnapshot,\n\t\t\turgency,\n\t\t\treason,\n\t\t\tcontext: {\n\t\t\t\tpressure: value,\n\t\t\t\tchanges: unsnapshotedChanges,\n\t\t\t\tminutesSinceSnapshot: timeSinceLastSnapshot,\n\t\t\t\tcriticalFiles: criticalFilesTouched,\n\t\t\t},\n\t\t\taction,\n\t\t\teducational,\n\t\t};\n\t}\n\n\t/**\n\t * Get multiple recommendations for different scenarios\n\t * Useful for UI components that need to show options\n\t */\n\tgetRecommendations(now: number = Date.now()): PressureRecommendation[] {\n\t\tconst primary = this.getRecommendation(now);\n\t\tconst recommendations = [primary];\n\n\t\t// If monitoring is recommended, also suggest proactive snapshot\n\t\tif (primary.action === \"monitor\" && primary.context.changes > 5) {\n\t\t\trecommendations.push({\n\t\t\t\tshouldSnapshot: true,\n\t\t\t\turgency: 30,\n\t\t\t\treason: \"Proactive snapshot opportunity\",\n\t\t\t\tcontext: primary.context,\n\t\t\t\taction: \"snapshot_soon\",\n\t\t\t\teducational: \"You have unsnapshot'd work. A proactive snapshot now ensures you have a recovery point.\",\n\t\t\t});\n\t\t}\n\n\t\treturn recommendations;\n\t}\n}\n","/**\n * PulseTracker - Change velocity monitoring\n *\n * Tracks the rate of file changes to determine workspace \"pulse\" level.\n * Uses a sliding window to calculate changes per minute.\n *\n * @performance Budget: <1ms per operation (called on every file save)\n */\n\nimport type { PulseConfig, PulseLevel } from \"../types/vitals.js\";\n\n/** Default pulse configuration */\nexport const DEFAULT_PULSE_CONFIG: PulseConfig = {\n\televated: 15, // changes/min\n\tracing: 30,\n\tcritical: 50,\n\twindowSeconds: 60,\n};\n\n/** Pulse level result with metrics */\nexport interface PulseState {\n\tlevel: PulseLevel;\n\tchangesPerMinute: number;\n}\n\n/**\n * Tracks change velocity over a sliding time window.\n *\n * Uses timestamps array with O(n) pruning on read.\n * For performance, pruning happens lazily during getLevel().\n */\nexport class PulseTracker {\n\tprivate changes: number[] = [];\n\tprivate readonly config: PulseConfig;\n\n\tconstructor(config: Partial<PulseConfig> = {}) {\n\t\tthis.config = { ...DEFAULT_PULSE_CONFIG, ...config };\n\t}\n\n\t/**\n\t * Record a file change event.\n\t * @performance O(1) - just pushes timestamp\n\t */\n\trecordChange(timestamp: number = Date.now()): void {\n\t\tthis.changes.push(timestamp);\n\t}\n\n\t/**\n\t * Get current pulse level and changes per minute.\n\t * @performance O(n) where n = changes in window\n\t */\n\tgetLevel(now: number = Date.now()): PulseState {\n\t\tthis.pruneOld(now);\n\n\t\tconst changesPerMinute =\n\t\t\tthis.config.windowSeconds > 0 ? (this.changes.length / this.config.windowSeconds) * 60 : 0;\n\n\t\treturn {\n\t\t\tlevel: this.classifyLevel(changesPerMinute),\n\t\t\tchangesPerMinute: Math.round(changesPerMinute),\n\t\t};\n\t}\n\n\t/**\n\t * Get raw change count in current window (for testing).\n\t */\n\tgetChangeCount(now: number = Date.now()): number {\n\t\tthis.pruneOld(now);\n\t\treturn this.changes.length;\n\t}\n\n\t/**\n\t * Clear all recorded changes.\n\t */\n\treset(): void {\n\t\tthis.changes = [];\n\t}\n\n\t/**\n\t * Remove events outside the sliding window.\n\t */\n\tprivate pruneOld(now: number): void {\n\t\tconst cutoff = now - this.config.windowSeconds * 1000;\n\t\t// Filter in place for memory efficiency\n\t\tthis.changes = this.changes.filter((t) => t > cutoff);\n\t}\n\n\t/**\n\t * Classify changes/min into a pulse level.\n\t */\n\tprivate classifyLevel(changesPerMinute: number): PulseLevel {\n\t\tif (changesPerMinute >= this.config.critical) {\n\t\t\treturn \"critical\";\n\t\t}\n\t\tif (changesPerMinute >= this.config.racing) {\n\t\t\treturn \"racing\";\n\t\t}\n\t\tif (changesPerMinute >= this.config.elevated) {\n\t\t\treturn \"elevated\";\n\t\t}\n\t\treturn \"resting\";\n\t}\n}\n","/**\n * TemperatureMonitor - AI activity level tracking\n *\n * Monitors the ratio of AI vs human activity to determine \"temperature\".\n * Higher AI activity = hotter temperature = more need for protection.\n *\n * Uses a decay window to cool down over time when AI activity stops.\n *\n * @performance Budget: <1ms per operation\n */\n\nimport type { TemperatureConfig, TempLevel } from \"../types/vitals.js\";\n\n/** Default temperature configuration */\nexport const DEFAULT_TEMPERATURE_CONFIG: TemperatureConfig = {\n\twarm: 20, // 20% AI activity\n\thot: 50, // 50% AI activity\n\tburning: 80, // 80% AI activity\n\tdecaySeconds: 300, // 5 minutes to cool down\n};\n\n/** Temperature state with metrics */\nexport interface TemperatureState {\n\tlevel: TempLevel;\n\taiPercentage: number;\n\tdetectedTool?: string;\n}\n\ninterface AIEvent {\n\ttimestamp: number;\n\ttool?: string;\n}\n\n/**\n * Monitors AI vs human activity within a decay window.\n *\n * Temperature rises with AI activity and cools over time.\n */\nexport class TemperatureMonitor {\n\tprivate aiEvents: AIEvent[] = [];\n\tprivate humanEvents: number[] = [];\n\tprivate readonly config: TemperatureConfig;\n\n\tconstructor(config: Partial<TemperatureConfig> = {}) {\n\t\tthis.config = { ...DEFAULT_TEMPERATURE_CONFIG, ...config };\n\t}\n\n\t/**\n\t * Record AI-assisted activity.\n\t * @param tool Optional: which AI tool (e.g., \"Cursor\", \"Copilot\", \"Claude\")\n\t * @param timestamp Optional: event time for testing\n\t */\n\trecordAIActivity(tool?: string, timestamp: number = Date.now()): void {\n\t\tthis.aiEvents.push({ timestamp, tool });\n\t}\n\n\t/**\n\t * Record human (non-AI) activity.\n\t * @param timestamp Optional: event time for testing\n\t */\n\trecordHumanActivity(timestamp: number = Date.now()): void {\n\t\tthis.humanEvents.push(timestamp);\n\t}\n\n\t/**\n\t * Get current temperature level and metrics.\n\t * @param now Optional: current time for testing\n\t */\n\tgetLevel(now: number = Date.now()): TemperatureState {\n\t\tthis.pruneOld(now);\n\n\t\tconst total = this.aiEvents.length + this.humanEvents.length;\n\t\tconst aiPercentage = total > 0 ? (this.aiEvents.length / total) * 100 : 0;\n\n\t\t// Most recent AI tool\n\t\tconst detectedTool = this.aiEvents.length > 0 ? this.aiEvents[this.aiEvents.length - 1].tool : undefined;\n\n\t\treturn {\n\t\t\tlevel: this.classifyLevel(aiPercentage),\n\t\t\taiPercentage: Math.round(aiPercentage),\n\t\t\tdetectedTool,\n\t\t};\n\t}\n\n\t/**\n\t * Get counts for testing.\n\t */\n\tgetCounts(now: number = Date.now()): { ai: number; human: number } {\n\t\tthis.pruneOld(now);\n\t\treturn {\n\t\t\tai: this.aiEvents.length,\n\t\t\thuman: this.humanEvents.length,\n\t\t};\n\t}\n\n\t/**\n\t * Clear all recorded activity.\n\t */\n\treset(): void {\n\t\tthis.aiEvents = [];\n\t\tthis.humanEvents = [];\n\t}\n\n\t/**\n\t * Remove events outside the decay window.\n\t */\n\tprivate pruneOld(now: number): void {\n\t\tconst cutoff = now - this.config.decaySeconds * 1000;\n\t\tthis.aiEvents = this.aiEvents.filter((e) => e.timestamp > cutoff);\n\t\tthis.humanEvents = this.humanEvents.filter((t) => t > cutoff);\n\t}\n\n\t/**\n\t * Classify AI percentage into a temperature level.\n\t */\n\tprivate classifyLevel(aiPercentage: number): TempLevel {\n\t\tif (aiPercentage >= this.config.burning) {\n\t\t\treturn \"burning\";\n\t\t}\n\t\tif (aiPercentage >= this.config.hot) {\n\t\t\treturn \"hot\";\n\t\t}\n\t\tif (aiPercentage >= this.config.warm) {\n\t\t\treturn \"warm\";\n\t\t}\n\t\treturn \"cold\";\n\t}\n}\n","/**\n * WorkspaceVitals - Core vitals orchestrator\n *\n * Combines all four vital signs into a unified workspace health monitor:\n * - Pulse: Change velocity\n * - Temperature: AI activity level\n * - Pressure: Risk accumulation\n * - Oxygen: Snapshot coverage\n *\n * Phase 4 additions:\n * - User behavior learning\n * - Per-workspace threshold calibration\n * - Trajectory prediction\n *\n * Provides decision support for when to create snapshots and guides AI agents.\n *\n * @performance Budget: <10ms for current() snapshot\n */\n\nimport { EventEmitter } from \"node:events\";\nimport type {\n\tAgentGuidance,\n\tAIDetectionEvent,\n\tSnapshotDecision,\n\tSnapshotEvent,\n\tTrajectory,\n\tVitalsConfig,\n\tVitalsFileChangeEvent,\n\tVitalsSnapshot,\n} from \"../types/vitals.js\";\nimport type { ThresholdAdjustments, TrajectoryForecast } from \"../types/vitals-learning.js\";\nimport { BehaviorTracker } from \"./BehaviorTracker.js\";\nimport { OXYGEN_THRESHOLDS, PRESSURE_THRESHOLDS, TRAJECTORY_THRESHOLDS } from \"./constants.js\";\nimport { PhaseDetector } from \"./learning/PhaseDetector.js\";\nimport { ThresholdCalibrator } from \"./learning/ThresholdCalibrator.js\";\nimport { TrajectoryPredictor } from \"./learning/TrajectoryPredictor.js\";\nimport { UserBehaviorLearner } from \"./learning/UserBehaviorLearner.js\";\nimport { DEFAULT_OXYGEN_CONFIG, OxygenSensor } from \"./OxygenSensor.js\";\nimport { DEFAULT_PRESSURE_CONFIG, PressureGauge } from \"./PressureGauge.js\";\nimport { DEFAULT_PULSE_CONFIG, PulseTracker } from \"./PulseTracker.js\";\nimport { DEFAULT_TEMPERATURE_CONFIG, TemperatureMonitor } from \"./TemperatureMonitor.js\";\n\n/** Default vitals configuration */\nexport const DEFAULT_VITALS_CONFIG: VitalsConfig = {\n\tpulse: DEFAULT_PULSE_CONFIG,\n\ttemperature: DEFAULT_TEMPERATURE_CONFIG,\n\tpressure: DEFAULT_PRESSURE_CONFIG,\n\toxygen: DEFAULT_OXYGEN_CONFIG,\n};\n\n/**\n * Unified workspace vitals monitor.\n *\n * Singleton per workspace ID to maintain consistent state.\n * Emits events: 'update', 'warning', 'critical'\n */\nexport class WorkspaceVitals extends EventEmitter {\n\tprivate static instances: Map<string, WorkspaceVitals> = new Map();\n\n\tprivate readonly pulse: PulseTracker;\n\tprivate readonly temperature: TemperatureMonitor;\n\tprivate readonly pressure: PressureGauge;\n\tprivate readonly oxygen: OxygenSensor;\n\tprivate readonly config: VitalsConfig;\n\tprivate history: VitalsSnapshot[] = [];\n\tprivate readonly maxHistory = 100;\n\n\t// Phase 4: Learning components\n\t// biome-ignore lint/correctness/noUnusedPrivateClassMembers: stored for context/debugging\n\tprivate readonly workspaceId: string;\n\tprivate readonly learner: UserBehaviorLearner;\n\tprivate readonly calibrator: ThresholdCalibrator;\n\tprivate readonly predictor: TrajectoryPredictor;\n\tprivate readonly phaseDetector: PhaseDetector;\n\tprivate currentBranch = \"main\";\n\n\t// Phase 2: Behavioral metadata tracking\n\tprivate readonly behaviorTracker: BehaviorTracker;\n\n\tprivate constructor(workspaceId: string, config: Partial<VitalsConfig> = {}, initialTime: number = Date.now()) {\n\t\tsuper();\n\t\tthis.workspaceId = workspaceId;\n\t\tthis.config = {\n\t\t\tpulse: { ...DEFAULT_VITALS_CONFIG.pulse, ...config.pulse },\n\t\t\ttemperature: { ...DEFAULT_VITALS_CONFIG.temperature, ...config.temperature },\n\t\t\tpressure: { ...DEFAULT_VITALS_CONFIG.pressure, ...config.pressure },\n\t\t\toxygen: { ...DEFAULT_VITALS_CONFIG.oxygen, ...config.oxygen },\n\t\t};\n\n\t\tthis.pulse = new PulseTracker(this.config.pulse);\n\t\tthis.temperature = new TemperatureMonitor(this.config.temperature);\n\t\tthis.pressure = new PressureGauge(this.config.pressure, initialTime);\n\t\tthis.oxygen = new OxygenSensor(this.config.oxygen);\n\n\t\t// Initialize learning components\n\t\tthis.learner = new UserBehaviorLearner(workspaceId);\n\t\tthis.calibrator = new ThresholdCalibrator(workspaceId, this.learner);\n\t\tthis.predictor = new TrajectoryPredictor(workspaceId);\n\t\tthis.phaseDetector = new PhaseDetector();\n\n\t\t// Initialize behavior tracking\n\t\tthis.behaviorTracker = new BehaviorTracker(initialTime);\n\t}\n\n\t/**\n\t * Get or create WorkspaceVitals for a workspace.\n\t * Singleton per workspaceId.\n\t */\n\tstatic for(workspaceId: string, config?: Partial<VitalsConfig>): WorkspaceVitals {\n\t\tlet instance = WorkspaceVitals.instances.get(workspaceId);\n\t\tif (!instance) {\n\t\t\tinstance = new WorkspaceVitals(workspaceId, config);\n\t\t\tWorkspaceVitals.instances.set(workspaceId, instance);\n\t\t}\n\t\treturn instance;\n\t}\n\n\t/**\n\t * Create a new instance (for testing - bypasses singleton).\n\t */\n\tstatic create(config?: Partial<VitalsConfig>, initialTime?: number): WorkspaceVitals {\n\t\treturn new WorkspaceVitals(`test-${Date.now()}`, config, initialTime);\n\t}\n\n\t/**\n\t * Clear all singleton instances (for testing).\n\t */\n\tstatic clearInstances(): void {\n\t\tWorkspaceVitals.instances.clear();\n\t}\n\n\t/**\n\t * Try to get an existing WorkspaceVitals instance.\n\t * Returns undefined if none exists for the workspace.\n\t */\n\tstatic tryGet(workspaceId: string): WorkspaceVitals | undefined {\n\t\treturn WorkspaceVitals.instances.get(workspaceId);\n\t}\n\n\t// =========================================================================\n\t// EVENT HANDLERS\n\t// =========================================================================\n\n\t/**\n\t * Handle a file change event.\n\t */\n\tonFileChange(event: VitalsFileChangeEvent, now: number = Date.now()): void {\n\t\tthis.pulse.recordChange(now);\n\t\tthis.pressure.recordChange(event.path);\n\t\tthis.oxygen.recordModification(event.path);\n\n\t\tif (event.isAI) {\n\t\t\tthis.temperature.recordAIActivity(event.tool, now);\n\t\t} else {\n\t\t\tthis.temperature.recordHumanActivity(now);\n\t\t}\n\n\t\tthis.checkAndEmit(now);\n\t}\n\n\t/**\n\t * Handle a snapshot creation event.\n\t */\n\tonSnapshot(event: SnapshotEvent, now: number = Date.now()): void {\n\t\tthis.pressure.recordSnapshot(now);\n\t\tthis.oxygen.recordSnapshot(event.filePath, now);\n\t\tthis.behaviorTracker.recordSnapshot(now);\n\t\tthis.checkAndEmit(now);\n\t}\n\n\t/**\n\t * Handle AI detection event.\n\t */\n\tonAIDetected(detection: AIDetectionEvent, now: number = Date.now()): void {\n\t\tif (detection.confidence > 0.6) {\n\t\t\tthis.temperature.recordAIActivity(detection.tool, now);\n\t\t}\n\t\tthis.checkAndEmit(now);\n\t}\n\n\t// =========================================================================\n\t// CURRENT STATE\n\t// =========================================================================\n\n\t/**\n\t * Get current vitals snapshot.\n\t * NOTE: This is a pure getter - does NOT mutate history.\n\t * Use recordHistorySnapshot() for explicit history recording.\n\t */\n\tcurrent(now: number = Date.now()): VitalsSnapshot {\n\t\tconst pulseData = this.pulse.getLevel(now);\n\t\tconst tempData = this.temperature.getLevel(now);\n\t\tconst pressureData = this.pressure.getState(now);\n\t\tconst oxygenData = this.oxygen.getLevel(now);\n\n\t\tconst snapshot: VitalsSnapshot = {\n\t\t\ttimestamp: now,\n\t\t\tpulse: pulseData,\n\t\t\ttemperature: tempData,\n\t\t\tpressure: pressureData,\n\t\t\toxygen: oxygenData,\n\t\t\ttrajectory: this.calculateTrajectory(pulseData, tempData, pressureData, oxygenData),\n\t\t\t// Include behavioral metadata\n\t\t\tbehavior: this.behaviorTracker.getMetadata(now),\n\t\t};\n\n\t\treturn snapshot;\n\t}\n\n\t/**\n\t * Explicitly record a history snapshot.\n\t * Call this on meaningful state changes (e.g., after onFileChange, onSnapshot).\n\t * History is bounded FIFO with maxHistory limit.\n\t */\n\trecordHistorySnapshot(now: number = Date.now()): void {\n\t\tconst snapshot = this.current(now);\n\n\t\t// Record history (bounded FIFO)\n\t\tthis.history.push(snapshot);\n\t\tif (this.history.length > this.maxHistory) {\n\t\t\tthis.history.shift();\n\t\t}\n\t}\n\n\t/**\n\t * Get historical snapshots.\n\t */\n\tgetHistory(): VitalsSnapshot[] {\n\t\treturn [...this.history];\n\t}\n\n\t/**\n\t * Get structured pressure recommendation for snapshot decisions.\n\t *\n\t * This provides actionable, context-aware recommendations based on\n\t * current pressure state. Use this to enhance AutoDecisionEngine\n\t * with educational messaging and urgency levels.\n\t *\n\t * @param now Optional timestamp for testing\n\t * @returns PressureRecommendation with action, urgency, and educational context\n\t */\n\tgetPressureRecommendation(now: number = Date.now()) {\n\t\treturn this.pressure.getRecommendation(now);\n\t}\n\n\t// =========================================================================\n\t// DECISION SUPPORT\n\t// =========================================================================\n\n\t/**\n\t * Determine if a snapshot should be created.\n\t * Uses centralized thresholds from constants.ts\n\t */\n\tshouldSnapshot(now: number = Date.now()): SnapshotDecision {\n\t\tconst vitals = this.current(now);\n\n\t\tif (vitals.trajectory === \"critical\") {\n\t\t\treturn {\n\t\t\t\tshould: true,\n\t\t\t\treason: \"Critical risk state - immediate snapshot recommended\",\n\t\t\t\turgency: \"critical\",\n\t\t\t};\n\t\t}\n\n\t\tif (vitals.pressure.value >= PRESSURE_THRESHOLDS.critical) {\n\t\t\treturn {\n\t\t\t\tshould: true,\n\t\t\t\treason: `High pressure (${vitals.pressure.value}%) - ${vitals.pressure.unsnapshotedChanges} unsaved changes`,\n\t\t\t\turgency: \"high\",\n\t\t\t};\n\t\t}\n\n\t\tif (vitals.pressure.criticalFilesTouched.length > 0 && vitals.oxygen.value < OXYGEN_THRESHOLDS.low) {\n\t\t\treturn {\n\t\t\t\tshould: true,\n\t\t\t\treason: `Critical files modified without snapshot: ${vitals.pressure.criticalFilesTouched.join(\", \")}`,\n\t\t\t\turgency: \"high\",\n\t\t\t};\n\t\t}\n\n\t\tif (vitals.temperature.level === \"burning\" && vitals.oxygen.value < OXYGEN_THRESHOLDS.moderate) {\n\t\t\treturn {\n\t\t\t\tshould: true,\n\t\t\t\treason: \"Heavy AI activity with low snapshot coverage\",\n\t\t\t\turgency: \"medium\",\n\t\t\t};\n\t\t}\n\n\t\tif (vitals.pressure.value >= PRESSURE_THRESHOLDS.moderate) {\n\t\t\treturn {\n\t\t\t\tshould: false,\n\t\t\t\treason: \"Consider snapshotting soon\",\n\t\t\t\turgency: \"low\",\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tshould: false,\n\t\t\treason: \"No immediate action needed\",\n\t\t\turgency: \"none\",\n\t\t};\n\t}\n\n\t/**\n\t * Get guidance for AI agents.\n\t */\n\tgetAgentGuidance(now: number = Date.now()): AgentGuidance {\n\t\tconst vitals = this.current(now);\n\t\tconst snapshotDecision = this.shouldSnapshot(now);\n\n\t\tconst blockedOps: string[] = [];\n\t\tif (vitals.trajectory === \"critical\") {\n\t\t\tblockedOps.push(\"delete\", \"refactor-large\", \"mass-rename\");\n\t\t}\n\n\t\tconst safeOps = [\"read\", \"analyze\", \"suggest\"];\n\t\tif (vitals.oxygen.value > 80 && vitals.pressure.value < 40) {\n\t\t\tsafeOps.push(\"write\", \"modify\", \"refactor-small\");\n\t\t}\n\n\t\treturn {\n\t\t\tshouldSnapshot: snapshotDecision.should,\n\t\t\tsnapshotReason: snapshotDecision.should ? snapshotDecision.reason : undefined,\n\t\t\triskyFiles: vitals.pressure.criticalFilesTouched,\n\t\t\tsafeOperations: safeOps,\n\t\t\tblockedOperations: blockedOps,\n\t\t\tsuggestion: this.getSuggestion(vitals),\n\t\t};\n\t}\n\n\t/**\n\t * Get threshold multiplier for dynamic risk adjustment.\n\t */\n\tgetThresholdMultiplier(now: number = Date.now()): number {\n\t\tconst vitals = this.current(now);\n\n\t\t// High temperature  more protective (lower threshold)\n\t\tconst tempMultiplier = {\n\t\t\tcold: 1.2,\n\t\t\twarm: 1.0,\n\t\t\thot: 0.8,\n\t\t\tburning: 0.6,\n\t\t}[vitals.temperature.level];\n\n\t\t// High oxygen  less protective (higher threshold)\n\t\tconst oxygenMultiplier = vitals.oxygen.value > 80 ? 1.2 : 1.0;\n\n\t\t// High pressure  more protective\n\t\tconst pressureMultiplier = vitals.pressure.value > 60 ? 0.8 : 1.0;\n\n\t\treturn tempMultiplier * oxygenMultiplier * pressureMultiplier;\n\t}\n\n\t// =========================================================================\n\t// PHASE 4: LEARNING & CALIBRATION\n\t// =========================================================================\n\n\t/**\n\t * Record user behavior for learning.\n\t * Call when user creates a snapshot to learn their patterns.\n\t */\n\trecordBehavior(userCreatedSnapshot: boolean, now: number = Date.now()): void {\n\t\tconst vitals = this.current(now);\n\t\tconst decision = this.shouldSnapshot(now);\n\n\t\t// Record observation\n\t\tthis.learner.recordObservation({\n\t\t\tvitals,\n\t\t\tuserCreatedSnapshot,\n\t\t\tvitalsRecommended: decision.should,\n\t\t});\n\n\t\t// Update calibration\n\t\tthis.calibrator.updateFromBehavior();\n\n\t\t// Record for trajectory prediction\n\t\tthis.predictor.recordSnapshots([vitals]);\n\t}\n\n\t/**\n\t * Get calibrated threshold adjustments.\n\t * Returns per-workspace learned adjustments (multipliers).\n\t */\n\tgetCalibratedThresholds(): ThresholdAdjustments {\n\t\treturn this.calibrator.getAdjustedThresholds();\n\t}\n\n\t/**\n\t * Get trajectory forecast.\n\t * Predicts future trajectory based on recent history.\n\t */\n\tgetForecast(): TrajectoryForecast {\n\t\treturn this.predictor.predict();\n\t}\n\n\t/**\n\t * Get user behavior statistics.\n\t */\n\tgetBehaviorStats() {\n\t\treturn this.learner.getStats();\n\t}\n\n\t/**\n\t * Get workspace calibration profile.\n\t */\n\tgetCalibrationProfile() {\n\t\treturn this.calibrator.getProfile();\n\t}\n\n\t/**\n\t * Reset learning data for this workspace.\n\t */\n\tresetLearning(): void {\n\t\tthis.calibrator.reset();\n\t\tthis.predictor.reset();\n\t}\n\n\t// =========================================================================\n\t// PHASE 2: BEHAVIORAL METADATA TRACKING\n\t// =========================================================================\n\n\t/**\n\t * Record a file edit event for behavioral analytics.\n\t */\n\trecordEdit(linesAdded: number, linesDeleted: number, timestamp: number = Date.now()): void {\n\t\tthis.behaviorTracker.recordEdit(linesAdded, linesDeleted, timestamp);\n\t}\n\n\t/**\n\t * Record a file save event.\n\t */\n\trecordFileSave(): void {\n\t\tthis.behaviorTracker.recordFileSave();\n\t}\n\n\t/**\n\t * Record a test execution result.\n\t */\n\trecordTest(passed: boolean, timestamp: number = Date.now()): void {\n\t\tthis.behaviorTracker.recordTest(passed, timestamp);\n\t}\n\n\t/**\n\t * Record an AI suggestion event.\n\t * @param accepted Whether the user accepted the AI suggestion\n\t */\n\trecordAISuggestion(accepted: boolean, timestamp: number = Date.now()): void {\n\t\tthis.behaviorTracker.recordAISuggestion(accepted, timestamp);\n\t}\n\n\t/**\n\t * Get current behavioral metadata.\n\t */\n\tgetBehavioralMetadata(now: number = Date.now()) {\n\t\treturn this.behaviorTracker.getMetadata(now);\n\t}\n\n\t// =========================================================================\n\t// PHASE DETECTION (Development Phase-Aware Thresholds)\n\t// =========================================================================\n\n\t/**\n\t * Set the current git branch for phase-aware calculations.\n\t * PhaseDetector uses branch naming patterns to adjust thresholds.\n\t * - hotfix/*  More protective (0.7x intervals, 1.5x risk)\n\t * - feature/*  Standard thresholds\n\t * - release/*  More protective (0.75x intervals, 1.3x risk)\n\t */\n\tsetCurrentBranch(branchName: string): void {\n\t\tthis.currentBranch = branchName;\n\t\t// Clear cached phase detection\n\t\tthis.phaseDetector.clearCache();\n\t}\n\n\t/**\n\t * Get current branch name.\n\t */\n\tgetCurrentBranch(): string {\n\t\treturn this.currentBranch;\n\t}\n\n\t/**\n\t * Get phase-aware risk multiplier for pressure calculations.\n\t * Hotfix branches return higher multipliers (more protective).\n\t * Feature branches return standard multipliers.\n\t */\n\tgetPhaseRiskMultiplier(): number {\n\t\treturn this.phaseDetector.getRiskMultiplier(this.currentBranch);\n\t}\n\n\t/**\n\t * Get phase-aware threshold multiplier for intervals.\n\t * Hotfix branches return lower multipliers (more frequent checks).\n\t */\n\tgetPhaseThresholdMultiplier(): number {\n\t\treturn this.phaseDetector.getThresholdMultiplier(this.currentBranch);\n\t}\n\n\t/**\n\t * Get the detected development phase for current branch.\n\t */\n\tgetDetectedPhase(): ReturnType<typeof this.phaseDetector.detectPhase> {\n\t\treturn this.phaseDetector.detectPhase(this.currentBranch);\n\t}\n\n\t/**\n\t * Check if current phase requires more frequent snapshots.\n\t */\n\trequiresFrequentSnapshots(): boolean {\n\t\treturn this.phaseDetector.requiresFrequentSnapshots(this.currentBranch);\n\t}\n\n\t/**\n\t * Get combined threshold multiplier (calibrator + phase).\n\t * This is the primary method for adaptive thresholds.\n\t */\n\tgetCombinedThresholdMultiplier(now: number = Date.now()): number {\n\t\tconst baseMultiplier = this.getThresholdMultiplier(now);\n\t\tconst phaseMultiplier = this.getPhaseThresholdMultiplier();\n\t\treturn baseMultiplier * phaseMultiplier;\n\t}\n\n\t// =========================================================================\n\t// INTERNAL\n\t// =========================================================================\n\n\tprivate calculateTrajectory(\n\t\tpulse: VitalsSnapshot[\"pulse\"],\n\t\ttemp: VitalsSnapshot[\"temperature\"],\n\t\tpressure: VitalsSnapshot[\"pressure\"],\n\t\toxygen: VitalsSnapshot[\"oxygen\"],\n\t): Trajectory {\n\t\t// Critical: High pressure + Burning temp + Low oxygen\n\t\tif (\n\t\t\tpressure.value >= TRAJECTORY_THRESHOLDS.criticalPressure &&\n\t\t\ttemp.level === \"burning\" &&\n\t\t\toxygen.value < TRAJECTORY_THRESHOLDS.criticalOxygen\n\t\t) {\n\t\t\treturn \"critical\";\n\t\t}\n\n\t\t// Escalating: Rising pressure or heat without coverage\n\t\tif (\n\t\t\t(pressure.value >= TRAJECTORY_THRESHOLDS.escalatingPressure &&\n\t\t\t\toxygen.value < TRAJECTORY_THRESHOLDS.escalatingOxygen) ||\n\t\t\t(temp.level === \"hot\" && pulse.level === \"racing\")\n\t\t) {\n\t\t\treturn \"escalating\";\n\t\t}\n\n\t\t// Recovering: Decreasing pressure, good oxygen\n\t\tconst recentHistory = this.history.slice(-5);\n\t\tif (recentHistory.length >= 3) {\n\t\t\tconst latestPressure = recentHistory[recentHistory.length - 1]?.pressure.value ?? 0;\n\t\t\tconst earliestPressure = recentHistory[0]?.pressure.value ?? 0;\n\t\t\tconst pressureTrend = latestPressure - earliestPressure;\n\t\t\tif (\n\t\t\t\tpressureTrend < -TRAJECTORY_THRESHOLDS.recoveringPressureDrop &&\n\t\t\t\toxygen.value >= TRAJECTORY_THRESHOLDS.recoveringOxygen\n\t\t\t) {\n\t\t\t\treturn \"recovering\";\n\t\t\t}\n\t\t}\n\n\t\treturn \"stable\";\n\t}\n\n\tprivate getSuggestion(vitals: VitalsSnapshot): string {\n\t\tif (vitals.trajectory === \"critical\") {\n\t\t\treturn \"STOP: Create a checkpoint before making more changes\";\n\t\t}\n\t\tif (vitals.trajectory === \"escalating\") {\n\t\t\treturn \"Consider creating a snapshot - risk is accumulating\";\n\t\t}\n\t\tif (vitals.pressure.value >= PRESSURE_THRESHOLDS.critical) {\n\t\t\treturn \"High pressure - create a snapshot before continuing\";\n\t\t}\n\t\tif (vitals.pressure.value >= PRESSURE_THRESHOLDS.moderate) {\n\t\t\treturn \"Moderate pressure - consider creating a snapshot soon\";\n\t\t}\n\t\tif (vitals.temperature.level === \"burning\") {\n\t\t\treturn \"Heavy AI activity detected - extra caution recommended\";\n\t\t}\n\t\tif (vitals.oxygen.value < OXYGEN_THRESHOLDS.low) {\n\t\t\treturn \"Low snapshot coverage - protect your work\";\n\t\t}\n\t\treturn \"Proceed normally\";\n\t}\n\n\tprivate checkAndEmit(now: number): void {\n\t\tconst vitals = this.current(now);\n\t\tconst decision = this.shouldSnapshot(now);\n\n\t\tif (decision.urgency === \"critical\") {\n\t\t\tthis.emit(\"critical\", vitals);\n\t\t} else if (decision.urgency === \"high\") {\n\t\t\tthis.emit(\"warning\", vitals);\n\t\t}\n\n\t\tthis.emit(\"update\", vitals);\n\t}\n}\n","/**\n * Intelligence Facade\n *\n * Main entry point for @snapback/intelligence.\n * Provides unified access to all intelligence capabilities:\n * - Context retrieval (getContext, semanticSearch)\n * - Validation (checkPatterns, validateCode)\n * - Learning (reportViolation, queryLearnings, recordLearning)\n *\n * Same algorithms, different configs:\n * - Internal use: rootDir='ai_dev_utils'\n * - Product use: rootDir=workspace\n */\n\nimport {\n\ttype FileModification as ContractsFileModification,\n\tfromIntelligenceFileModification,\n} from \"@snapback/contracts\";\nimport { AdvisoryEngine } from \"./advisory/AdvisoryEngine.js\";\nimport { ContextEngine } from \"./context/ContextEngine.js\";\nimport { LearningEngine } from \"./learning/LearningEngine.js\";\nimport { ViolationTracker } from \"./learning/ViolationTracker.js\";\nimport { SessionManager } from \"./session/SessionManager.js\";\nimport { ConfigStore } from \"./storage/ConfigStore.js\";\nimport type { AdvisoryContext, AdvisoryTriggerContext, FileHistory } from \"./types/advisory.js\";\nimport type { CacheableContext, IntelligenceConfig, ResolvedConfig } from \"./types/config.js\";\nimport { IntelligenceConfigSchema } from \"./types/config.js\";\nimport type {\n\tContextInput,\n\tContextResult,\n\tFeedbackInput,\n\tInteraction,\n\tLearning,\n\tLearningInput,\n\tLearningStats,\n\tSearchResult,\n\tViolationInput,\n\tViolationStatus,\n\tViolationsSummary,\n} from \"./types/index.js\";\nimport type { AgentGuidance, SnapshotDecision, VitalsConfig, VitalsSnapshot } from \"./types/vitals.js\";\nimport type { ThresholdAdjustments, TrajectoryForecast, WorkspaceProfile } from \"./types/vitals-learning.js\";\nimport type { PipelineResult } from \"./validation/ValidationPipeline.js\";\nimport { ValidationPipeline } from \"./validation/ValidationPipeline.js\";\nimport { WorkspaceVitals } from \"./vitals/WorkspaceVitals.js\";\n\n/**\n * Intelligence - Unified AI-assisted development intelligence\n *\n * @example\n * ```typescript\n * const intel = new Intelligence({\n *   rootDir: 'ai_dev_utils',\n *   enableSemanticSearch: false,\n *   enableLearningLoop: true,\n * });\n *\n * // Get context before implementing\n * const context = await intel.getContext({\n *   task: \"Add authentication to MCP server\",\n *   keywords: [\"auth\", \"api-key\"],\n * });\n *\n * // Validate code before committing\n * const validation = await intel.checkPatterns(code, \"apps/mcp-server/src/auth.ts\");\n *\n * // Report violations for learning\n * await intel.reportViolation({\n *   type: \"layer-boundary-violation\",\n *   file: \"apps/vscode/src/auth.ts\",\n *   message: \"Imported infrastructure directly\",\n *   reason: \"Didn't check layer boundaries\",\n *   prevention: \"Use @snapback/core instead\",\n * });\n * ```\n */\nexport class Intelligence {\n\tprivate config: ResolvedConfig;\n\tprivate configStore: ConfigStore;\n\tprivate contextEngine: ContextEngine;\n\tprivate validationPipeline: ValidationPipeline;\n\tprivate learningEngine: LearningEngine;\n\tprivate violationTracker: ViolationTracker;\n\tprivate sessionManager: SessionManager;\n\tprivate advisoryEngine: AdvisoryEngine;\n\tprivate initialized = false;\n\n\tconstructor(config: IntelligenceConfig) {\n\t\tthis.config = this.resolveConfig(config);\n\t\tthis.configStore = new ConfigStore(this.config);\n\t\tthis.contextEngine = new ContextEngine(this.config, this.configStore);\n\n\t\t// Initialize ValidationPipeline with enhanced mode if requested\n\t\tthis.validationPipeline = new ValidationPipeline({\n\t\t\tenhanced: config.enhancedValidation ?? false,\n\t\t\tuseDynamicConfidence: config.enhancedValidation ?? false,\n\t\t\tworkspaceRoot: config.rootDir,\n\t\t});\n\n\t\tthis.learningEngine = new LearningEngine(this.config);\n\t\tthis.violationTracker = new ViolationTracker(this.config);\n\t\tthis.sessionManager = new SessionManager(config.sessionLimits, {\n\t\t\tpersistencePath: config.sessionPersistence?.path,\n\t\t\tautosave: config.sessionPersistence?.autosave ?? true,\n\t\t});\n\t\tthis.advisoryEngine = new AdvisoryEngine(config.advisoryConfig);\n\t}\n\n\t/**\n\t * Initialize async resources (embeddings, database)\n\t * Call once before using semantic features\n\t */\n\tasync initialize(): Promise<void> {\n\t\tif (this.initialized) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.config.enableSemanticSearch) {\n\t\t\tawait this.contextEngine.initialize();\n\t\t}\n\n\t\tthis.initialized = true;\n\t}\n\n\t// =========================================================================\n\t// CONTEXT RETRIEVAL\n\t// =========================================================================\n\n\t/**\n\t * Get relevant context for a task\n\t * Primary entry point - used before implementing anything\n\t */\n\tasync getContext(params: ContextInput): Promise<ContextResult> {\n\t\treturn this.contextEngine.getContext(params);\n\t}\n\n\t/**\n\t * Semantic search across indexed content\n\t * Requires initialization with enableSemanticSearch: true\n\t */\n\tasync semanticSearch(_query: string, _maxTokens?: number): Promise<SearchResult> {\n\t\tif (!this.config.enableSemanticSearch) {\n\t\t\tthrow new Error(\"Semantic search not enabled. Set enableSemanticSearch: true\");\n\t\t}\n\t\t// Semantic search implementation would go here\n\t\t// For now, return empty result\n\t\treturn {\n\t\t\tcontext: \"\",\n\t\t\ttokensUsed: 0,\n\t\t\tsectionsIncluded: 0,\n\t\t\tcompressionRatio: 0,\n\t\t};\n\t}\n\n\t// =========================================================================\n\t// VALIDATION\n\t// =========================================================================\n\n\t/**\n\t * Validate code against patterns and constraints\n\t * Used before committing\n\t */\n\tasync checkPatterns(code: string, filePath: string): Promise<PipelineResult> {\n\t\treturn this.validationPipeline.validate(code, filePath);\n\t}\n\n\t/**\n\t * Full 7-layer validation with confidence score\n\t * Alias for checkPatterns\n\t */\n\tasync validateCode(code: string, filePath: string): Promise<PipelineResult> {\n\t\treturn this.validationPipeline.validate(code, filePath);\n\t}\n\n\t/**\n\t * Quick check - returns true if code passes all critical checks\n\t */\n\tasync quickCheck(code: string, filePath: string): Promise<boolean> {\n\t\treturn this.validationPipeline.quickCheck(code, filePath);\n\t}\n\n\t// =========================================================================\n\t// LEARNING\n\t// =========================================================================\n\n\t/**\n\t * Report a violation for tracking\n\t * Auto-promotes at 3x, auto-marks for automation at 5x\n\t */\n\tasync reportViolation(violation: ViolationInput): Promise<ViolationStatus> {\n\t\treturn this.violationTracker.report(violation);\n\t}\n\n\t/**\n\t * Search learnings database\n\t */\n\tqueryLearnings(keywords: string[]): Learning[] {\n\t\treturn this.learningEngine.query(keywords);\n\t}\n\n\t/**\n\t * Record a new learning\n\t */\n\tasync recordLearning(learning: LearningInput): Promise<{ id: string }> {\n\t\treturn this.learningEngine.record(learning);\n\t}\n\n\t/**\n\t * Log an AI interaction for analysis\n\t */\n\tasync logInteraction(data: {\n\t\tquery: string;\n\t\tcontextUsed: string[];\n\t\ttoolsCalled: string[];\n\t\toutput: string;\n\t\tvalidationPassed?: boolean;\n\t\tconfidence?: number;\n\t}): Promise<Interaction> {\n\t\treturn this.learningEngine.logInteraction(data);\n\t}\n\n\t/**\n\t * Record human feedback on an interaction\n\t */\n\tasync recordFeedback(\n\t\tinteractionId: string,\n\t\tfeedback: FeedbackInput,\n\t): Promise<{ updated: boolean; addedToGolden: boolean }> {\n\t\treturn this.learningEngine.recordFeedback(interactionId, feedback);\n\t}\n\n\t/**\n\t * Get learning statistics\n\t */\n\tgetStats(): LearningStats {\n\t\treturn this.learningEngine.getStats();\n\t}\n\n\t/**\n\t * Get violations summary with promotion status\n\t */\n\tgetViolationsSummary(): ViolationsSummary {\n\t\treturn this.violationTracker.getSummary();\n\t}\n\n\t// =========================================================================\n\t// VITALS (Adaptive Risk Sensing)\n\t// =========================================================================\n\n\t/**\n\t * Get or create WorkspaceVitals instance for a workspace\n\t * Singleton per workspaceId\n\t */\n\tgetVitals(workspaceId: string, config?: Partial<VitalsConfig>): WorkspaceVitals {\n\t\treturn WorkspaceVitals.for(workspaceId, config);\n\t}\n\n\t/**\n\t * Get current vitals snapshot for a workspace\n\t */\n\tgetVitalsSnapshot(workspaceId: string): VitalsSnapshot | null {\n\t\tconst vitals = WorkspaceVitals.tryGet(workspaceId);\n\t\treturn vitals?.current() ?? null;\n\t}\n\n\t/**\n\t * Get snapshot decision based on current vitals\n\t */\n\tshouldSnapshot(workspaceId: string): SnapshotDecision | null {\n\t\tconst vitals = WorkspaceVitals.tryGet(workspaceId);\n\t\treturn vitals?.shouldSnapshot() ?? null;\n\t}\n\n\t/**\n\t * Get agent guidance based on current vitals\n\t */\n\tgetAgentGuidance(workspaceId: string): AgentGuidance | null {\n\t\tconst vitals = WorkspaceVitals.tryGet(workspaceId);\n\t\treturn vitals?.getAgentGuidance() ?? null;\n\t}\n\n\t// =========================================================================\n\t// VITALS PHASE 4: Learning & Calibration\n\t// =========================================================================\n\n\t/**\n\t * Record user behavior for learning\n\t * Call when user creates/acknowledges a snapshot\n\t */\n\trecordBehavior(workspaceId: string, userCreatedSnapshot: boolean): void {\n\t\tconst vitals = WorkspaceVitals.tryGet(workspaceId);\n\t\tvitals?.recordBehavior(userCreatedSnapshot);\n\t}\n\n\t/**\n\t * Get calibrated thresholds based on learned user behavior\n\t */\n\tgetCalibratedThresholds(workspaceId: string): ThresholdAdjustments | null {\n\t\tconst vitals = WorkspaceVitals.tryGet(workspaceId);\n\t\treturn vitals?.getCalibratedThresholds() ?? null;\n\t}\n\n\t/**\n\t * Get trajectory forecast (5/10 minute predictions)\n\t */\n\tgetForecast(workspaceId: string): TrajectoryForecast | null {\n\t\tconst vitals = WorkspaceVitals.tryGet(workspaceId);\n\t\treturn vitals?.getForecast() ?? null;\n\t}\n\n\t/**\n\t * Get user behavior statistics\n\t */\n\tgetBehaviorStats(workspaceId: string): ReturnType<WorkspaceVitals[\"getBehaviorStats\"]> | null {\n\t\tconst vitals = WorkspaceVitals.tryGet(workspaceId);\n\t\treturn vitals?.getBehaviorStats() ?? null;\n\t}\n\n\t/**\n\t * Get calibration profile for workspace\n\t */\n\tgetCalibrationProfile(workspaceId: string): WorkspaceProfile | null {\n\t\tconst vitals = WorkspaceVitals.tryGet(workspaceId);\n\t\treturn vitals?.getCalibrationProfile() ?? null;\n\t}\n\n\t/**\n\t * Reset learning data for workspace\n\t */\n\tresetLearning(workspaceId: string): void {\n\t\tconst vitals = WorkspaceVitals.tryGet(workspaceId);\n\t\tvitals?.resetLearning();\n\t}\n\n\t// =========================================================================\n\t// VITALS PHASE 2: Behavioral Metadata\n\t// =========================================================================\n\n\t/**\n\t * Record a file edit event\n\t * @param workspaceId Workspace identifier\n\t * @param linesAdded Number of lines added\n\t * @param linesDeleted Number of lines deleted\n\t */\n\trecordEdit(workspaceId: string, linesAdded: number, linesDeleted: number): void {\n\t\tconst vitals = WorkspaceVitals.tryGet(workspaceId);\n\t\tvitals?.recordEdit(linesAdded, linesDeleted);\n\t}\n\n\t/**\n\t * Record a file save event\n\t */\n\trecordFileSave(workspaceId: string): void {\n\t\tconst vitals = WorkspaceVitals.tryGet(workspaceId);\n\t\tvitals?.recordFileSave();\n\t}\n\n\t/**\n\t * Record a test execution result\n\t * @param workspaceId Workspace identifier\n\t * @param passed Whether the test passed\n\t */\n\trecordTestResult(workspaceId: string, passed: boolean): void {\n\t\tconst vitals = WorkspaceVitals.tryGet(workspaceId);\n\t\tvitals?.recordTest(passed);\n\t}\n\n\t/**\n\t * Record an AI suggestion event\n\t * @param workspaceId Workspace identifier\n\t * @param accepted Whether the user accepted the suggestion\n\t */\n\trecordAISuggestionResponse(workspaceId: string, accepted: boolean): void {\n\t\tconst vitals = WorkspaceVitals.tryGet(workspaceId);\n\t\tvitals?.recordAISuggestion(accepted);\n\t}\n\n\t/**\n\t * Get current behavioral metadata for a workspace\n\t */\n\tgetBehavioralMetadata(workspaceId: string): ReturnType<WorkspaceVitals[\"getBehavioralMetadata\"]> | null {\n\t\tconst vitals = WorkspaceVitals.tryGet(workspaceId);\n\t\treturn vitals?.getBehavioralMetadata() ?? null;\n\t}\n\n\t// =========================================================================\n\t// SESSION MANAGEMENT (Phase 1)\n\t// =========================================================================\n\n\t/**\n\t * Start a new LLM session\n\t */\n\tstartSession(\n\t\tsessionId: string,\n\t\tmetadata?: {\n\t\t\tworkspaceId?: string;\n\t\t\tuserId?: string;\n\t\t\ttags?: string[];\n\t\t},\n\t): void {\n\t\tthis.sessionManager.startSession(sessionId, metadata);\n\t}\n\n\t/**\n\t * Record a tool call in the session\n\t * Returns true if allowed, false if blocked (circuit breaker/loop)\n\t */\n\trecordToolCall(sessionId: string, call: import(\"./types/session.js\").ToolCall): boolean {\n\t\treturn this.sessionManager.recordToolCall(sessionId, call);\n\t}\n\n\t/**\n\t * Record a file modification\n\t */\n\trecordFileModification(sessionId: string, mod: import(\"./types/session.js\").FileModification): void {\n\t\tthis.sessionManager.recordFileModification(sessionId, mod);\n\t}\n\n\t/**\n\t * Detect loops in session behavior\n\t */\n\tdetectLoop(sessionId: string): import(\"./types/session.js\").LoopDetectionResult {\n\t\treturn this.sessionManager.detectLoop(sessionId);\n\t}\n\n\t/**\n\t * Get session analytics\n\t */\n\tgetSessionAnalytics(sessionId: string): import(\"./types/session.js\").SessionAnalytics | null {\n\t\treturn this.sessionManager.getAnalytics(sessionId);\n\t}\n\n\t/**\n\t * End a session and get analytics\n\t */\n\tendSession(sessionId: string): import(\"./types/session.js\").SessionAnalytics | null {\n\t\treturn this.sessionManager.endSession(sessionId);\n\t}\n\n\t/**\n\t * Get file modifications for a session\n\t * Returns canonical FileModification type from @snapback/contracts\n\t * @param sessionId - Session to query\n\t * @param since - Optional timestamp filter (return modifications >= since)\n\t */\n\tgetFileModifications(sessionId: string, since?: number): ContractsFileModification[] {\n\t\tconst mods = this.sessionManager.getFileModifications(sessionId, since);\n\t\treturn mods.map((mod) => fromIntelligenceFileModification(mod, \"extension\"));\n\t}\n\n\t// =========================================================================\n\t// ADVISORY CONTEXT\n\t// =========================================================================\n\n\t/**\n\t * Enrich context with advisory guidance\n\t * Used to add warnings/suggestions to tool responses\n\t */\n\tenrichAdvisory(context: AdvisoryTriggerContext): AdvisoryContext {\n\t\treturn this.advisoryEngine.enrich(context);\n\t}\n\n\t/**\n\t * Get file history for a specific file\n\t */\n\tgetFileHistory(file: string): FileHistory {\n\t\treturn this.advisoryEngine.getFileHistory(file);\n\t}\n\n\t// =========================================================================\n\t// CACHING (for Anthropic prompt caching)\n\t// =========================================================================\n\n\t/**\n\t * Get static context suitable for prompt caching\n\t * Content changes rarely - cache for 5+ minutes\n\t */\n\tgetStaticContext(): CacheableContext {\n\t\treturn this.configStore.getStaticContext();\n\t}\n\n\t// =========================================================================\n\t// UTILITIES\n\t// =========================================================================\n\n\t/**\n\t * Resolve config with defaults using Zod schema\n\t */\n\tprivate resolveConfig(config: IntelligenceConfig): ResolvedConfig {\n\t\treturn IntelligenceConfigSchema.parse(config);\n\t}\n\n\t/**\n\t * Get the resolved configuration\n\t */\n\tgetConfig(): ResolvedConfig {\n\t\treturn this.config;\n\t}\n\n\t/**\n\t * Dispose resources\n\t */\n\tasync dispose(): Promise<void> {\n\t\tawait this.contextEngine.dispose();\n\t\tthis.initialized = false;\n\t}\n}\n","/**\n * 3-Layer Confidence Scoring\n *\n * Per ADR specification, confidence is calculated from three signal layers:\n * Layer 1: Retrieval Confidence (from search results - semantic/keyword scores)\n * Layer 2: Historical Confidence (from outcomes - success rate, usage)\n * Layer 3: Action Confidence (from context - authority, status, recency)\n *\n * @module confidence\n */\n\nimport type { Chunk, HistoricalSignals, KnowledgeStore, OutcomeType } from \"./store.js\";\n\nexport interface ConfidenceScore {\n\toverall: number;\n\tlayers: {\n\t\tretrieval: number;\n\t\thistorical: number;\n\t\taction: number;\n\t};\n\tfactors: {\n\t\tcrossAgreement: boolean;\n\t\tsemanticSimilarity: number;\n\t\tsuccessRate: number;\n\t\trecentUsage: boolean;\n\t\tcontextMatch: number;\n\t};\n}\n\nexport interface OutcomeStats {\n\ttotal: number;\n\taccepted: number;\n\tignored: number;\n\ttestPass: number;\n\ttestFail: number;\n\tviolationPrevented: number;\n\tsuccessRate: number;\n\tlastOutcome: string | null;\n}\n\nexport class ConfidenceCalculator {\n\tconstructor(private store: KnowledgeStore) {}\n\n\t/**\n\t * Calculate confidence for a retrieval result\n\t */\n\tcalculate(\n\t\tchunk: Chunk,\n\t\tretrievalFactors: {\n\t\t\tsemanticRank?: number;\n\t\t\tsemanticSimilarity?: number;\n\t\t\tkeywordRank?: number;\n\t\t\ttotalResults: number;\n\t\t},\n\t\tcontext?: {\n\t\t\ttaskType?: string;\n\t\t\tfileTypes?: string[];\n\t\t\trecentViolations?: string[];\n\t\t},\n\t): ConfidenceScore {\n\t\t// Layer 1: Retrieval Confidence\n\t\tconst retrieval = this.calculateRetrievalConfidence(retrievalFactors);\n\n\t\t// Layer 2: Historical Confidence\n\t\tconst historical = this.calculateHistoricalConfidence(chunk.id);\n\n\t\t// Layer 3: Action Confidence\n\t\tconst action = this.calculateActionConfidence(chunk, context);\n\n\t\t// Weighted combination\n\t\tconst overall = retrieval.score * 0.4 + historical.score * 0.35 + action.score * 0.25;\n\n\t\treturn {\n\t\t\toverall: Math.min(1.0, Math.max(0, overall)),\n\t\t\tlayers: {\n\t\t\t\tretrieval: retrieval.score,\n\t\t\t\thistorical: historical.score,\n\t\t\t\taction: action.score,\n\t\t\t},\n\t\t\tfactors: {\n\t\t\t\tcrossAgreement: retrieval.crossAgreement,\n\t\t\t\tsemanticSimilarity: retrievalFactors.semanticSimilarity || 0,\n\t\t\t\tsuccessRate: historical.successRate,\n\t\t\t\trecentUsage: historical.recentUsage,\n\t\t\t\tcontextMatch: action.contextMatch,\n\t\t\t},\n\t\t};\n\t}\n\n\t/**\n\t * Layer 1: Retrieval Confidence\n\t */\n\tprivate calculateRetrievalConfidence(factors: {\n\t\tsemanticRank?: number;\n\t\tsemanticSimilarity?: number;\n\t\tkeywordRank?: number;\n\t\ttotalResults: number;\n\t}): { score: number; crossAgreement: boolean } {\n\t\tlet score = 0.5; // Base score\n\n\t\t// Cross-agreement: found by both semantic AND keyword\n\t\tconst crossAgreement = factors.semanticRank !== undefined && factors.keywordRank !== undefined;\n\t\tif (crossAgreement) {\n\t\t\tscore += 0.2;\n\t\t}\n\n\t\t// Semantic similarity bonus\n\t\tif (factors.semanticSimilarity) {\n\t\t\tif (factors.semanticSimilarity > 0.8) {\n\t\t\t\tscore += 0.2;\n\t\t\t} else if (factors.semanticSimilarity > 0.6) {\n\t\t\t\tscore += 0.1;\n\t\t\t} else if (factors.semanticSimilarity > 0.4) {\n\t\t\t\tscore += 0.05;\n\t\t\t}\n\t\t}\n\n\t\t// Rank bonus (top results get bonus)\n\t\tconst bestRank = Math.min(\n\t\t\tfactors.semanticRank || Number.POSITIVE_INFINITY,\n\t\t\tfactors.keywordRank || Number.POSITIVE_INFINITY,\n\t\t);\n\t\tif (bestRank === 1) {\n\t\t\tscore += 0.1;\n\t\t} else if (bestRank <= 3) {\n\t\t\tscore += 0.05;\n\t\t}\n\n\t\t// Score margin (if we're one of few results, more confident)\n\t\tif (factors.totalResults <= 3) {\n\t\t\tscore += 0.05;\n\t\t}\n\n\t\treturn { score: Math.min(1.0, score), crossAgreement };\n\t}\n\n\t/**\n\t * Layer 2: Historical Confidence\n\t */\n\tprivate calculateHistoricalConfidence(chunkId: string): {\n\t\tscore: number;\n\t\tsuccessRate: number;\n\t\trecentUsage: boolean;\n\t} {\n\t\tconst stats = this.getOutcomeStats(chunkId);\n\n\t\t// Not enough data - return neutral confidence\n\t\tif (stats.total < 3) {\n\t\t\treturn { score: 0.5, successRate: 0.5, recentUsage: false };\n\t\t}\n\n\t\t// Success rate (accepted + testPass + violationPrevented vs total)\n\t\tconst successes = stats.accepted + stats.testPass + stats.violationPrevented;\n\t\tconst failures = stats.ignored + stats.testFail;\n\t\tconst successRate = successes / (successes + failures) || 0.5;\n\n\t\t// Recent usage boost\n\t\tconst recentUsage = this.hasRecentOutcome(chunkId, 7); // Last 7 days\n\n\t\t// Calculate score\n\t\tlet score = 0.3 + successRate * 0.5; // 0.3 to 0.8 based on success rate\n\t\tif (recentUsage) {\n\t\t\tscore += 0.1;\n\t\t}\n\n\t\t// Penalty for high failure rate\n\t\tif (stats.testFail > stats.testPass) {\n\t\t\tscore -= 0.2;\n\t\t}\n\n\t\treturn {\n\t\t\tscore: Math.min(1.0, Math.max(0, score)),\n\t\t\tsuccessRate,\n\t\t\trecentUsage,\n\t\t};\n\t}\n\n\t/**\n\t * Layer 3: Action Confidence\n\t */\n\tprivate calculateActionConfidence(\n\t\tchunk: Chunk,\n\t\tcontext?: {\n\t\t\ttaskType?: string;\n\t\t\tfileTypes?: string[];\n\t\t\trecentViolations?: string[];\n\t\t},\n\t): { score: number; contextMatch: number } {\n\t\tlet score = 0.5;\n\t\tlet contextMatch = 0;\n\n\t\t// Status check\n\t\tif (chunk.status !== \"active\") {\n\t\t\tscore -= 0.3;\n\t\t}\n\n\t\t// Authority bonus\n\t\tscore += chunk.authority * 0.2;\n\n\t\t// Context matching (if provided)\n\t\tif (context) {\n\t\t\tconst chunkText = `${chunk.chunk_text} ${chunk.context_text || \"\"}`.toLowerCase();\n\n\t\t\t// Task type match\n\t\t\tif (context.taskType && chunkText.includes(context.taskType.toLowerCase())) {\n\t\t\t\tcontextMatch += 0.3;\n\t\t\t}\n\n\t\t\t// File type relevance\n\t\t\tif (context.fileTypes) {\n\t\t\t\tconst fileMatches = context.fileTypes.filter((ft) => chunkText.includes(ft.toLowerCase()));\n\t\t\t\tcontextMatch += Math.min(0.3, fileMatches.length * 0.1);\n\t\t\t}\n\n\t\t\t// Recent violation prevention\n\t\t\tif (context.recentViolations) {\n\t\t\t\tconst violationMatches = context.recentViolations.filter((v) => chunkText.includes(v.toLowerCase()));\n\t\t\t\tcontextMatch += Math.min(0.4, violationMatches.length * 0.2);\n\t\t\t}\n\n\t\t\tscore += contextMatch;\n\t\t}\n\n\t\treturn {\n\t\t\tscore: Math.min(1.0, Math.max(0, score)),\n\t\t\tcontextMatch,\n\t\t};\n\t}\n\n\t/**\n\t * Get outcome statistics for a chunk\n\t */\n\tgetOutcomeStats(chunkId: string): OutcomeStats {\n\t\tconst stmt = (this.store as any).db.prepare(`\n      SELECT\n        outcome_type,\n        COUNT(*) as count,\n        MAX(created_at) as last_at\n      FROM outcomes\n      WHERE chunk_id = ?\n      GROUP BY outcome_type\n    `);\n\n\t\tconst rows = stmt.all(chunkId) as Array<{\n\t\t\toutcome_type: string;\n\t\t\tcount: number;\n\t\t\tlast_at: string;\n\t\t}>;\n\n\t\tconst stats: OutcomeStats = {\n\t\t\ttotal: 0,\n\t\t\taccepted: 0,\n\t\t\tignored: 0,\n\t\t\ttestPass: 0,\n\t\t\ttestFail: 0,\n\t\t\tviolationPrevented: 0,\n\t\t\tsuccessRate: 0.5,\n\t\t\tlastOutcome: null,\n\t\t};\n\n\t\tlet latestDate = \"\";\n\n\t\tfor (const row of rows) {\n\t\t\tstats.total += row.count;\n\n\t\t\tswitch (row.outcome_type) {\n\t\t\t\tcase \"accepted\":\n\t\t\t\t\tstats.accepted = row.count;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"ignored\":\n\t\t\t\t\tstats.ignored = row.count;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"test_pass\":\n\t\t\t\t\tstats.testPass = row.count;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"test_fail\":\n\t\t\t\t\tstats.testFail = row.count;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"violation_prevented\":\n\t\t\t\t\tstats.violationPrevented = row.count;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (row.last_at > latestDate) {\n\t\t\t\tlatestDate = row.last_at;\n\t\t\t\tstats.lastOutcome = row.outcome_type;\n\t\t\t}\n\t\t}\n\n\t\tif (stats.total > 0) {\n\t\t\tconst successes = stats.accepted + stats.testPass + stats.violationPrevented;\n\t\t\tstats.successRate = successes / stats.total;\n\t\t}\n\n\t\treturn stats;\n\t}\n\n\t/**\n\t * Check if chunk has recent outcome\n\t */\n\tprivate hasRecentOutcome(chunkId: string, days: number): boolean {\n\t\tconst stmt = (this.store as any).db.prepare(`\n      SELECT 1 FROM outcomes\n      WHERE chunk_id = ?\n      AND created_at > datetime('now', '-' || ? || ' days')\n      LIMIT 1\n    `);\n\n\t\treturn stmt.get(chunkId, days) !== undefined;\n\t}\n\n\t/**\n\t * Record an outcome for a chunk\n\t */\n\trecordOutcome(\n\t\tchunkId: string,\n\t\toutcomeType: OutcomeType,\n\t\tcontext?: { task?: string; files?: string[]; query?: string; sessionId?: string },\n\t): void {\n\t\tconst stmt = (this.store as any).db.prepare(`\n      INSERT INTO outcomes (id, chunk_id, outcome_type, context, session_id)\n      VALUES (?, ?, ?, ?, ?)\n    `);\n\n\t\tconst id = `out_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n\n\t\tstmt.run(id, chunkId, outcomeType, context ? JSON.stringify(context) : null, context?.sessionId || null);\n\t}\n}\n\n// ============================================================\n// METADATA-AWARE CONFIDENCE (Per ADR Specification)\n// ============================================================\n\n/**\n * Source type authority weights\n * Per ADR: adr > curated/pattern > user/learning > auto/violation\n */\nexport const SOURCE_TYPE_WEIGHTS: Record<string, number> = {\n\tadr: 1.0,\n\tpattern: 0.85,\n\tlearning: 0.7,\n\tviolation: 0.5,\n};\n\n/**\n * Status penalties for deprecated/superseded content\n */\nexport const STATUS_PENALTIES: Record<string, number> = {\n\tactive: 0,\n\tdeprecated: 0.3,\n\tsuperseded: 0.5,\n};\n\n/**\n * Recency half-life in days for time decay\n */\nexport const RECENCY_HALF_LIFE_DAYS = 30;\n\n/**\n * Calculate metadata-based reranking boost\n * Per ADR: combines authority, status, and recency signals\n */\nexport function calculateMetadataBoost(chunk: Chunk): number {\n\t// Base authority from source type\n\tconst sourceWeight = SOURCE_TYPE_WEIGHTS[chunk.source_type] ?? 0.5;\n\n\t// Blend with explicit authority field\n\tconst authorityScore = (chunk.authority + sourceWeight) / 2;\n\n\t// Apply status penalty\n\tconst statusPenalty = STATUS_PENALTIES[chunk.status] ?? 0;\n\tconst statusFactor = 1 - statusPenalty;\n\n\t// Calculate recency factor using exponential decay\n\tconst updatedDate = new Date(chunk.updated_at);\n\tconst daysSinceUpdate = (Date.now() - updatedDate.getTime()) / (1000 * 60 * 60 * 24);\n\tconst recencyFactor = Math.exp((-Math.LN2 * daysSinceUpdate) / RECENCY_HALF_LIFE_DAYS);\n\n\t// Combine: 60% authority, 20% status, 20% recency\n\tconst boost = authorityScore * 0.6 * statusFactor + statusFactor * 0.2 + recencyFactor * 0.2;\n\n\treturn Math.max(0.1, Math.min(1.0, boost));\n}\n\n/**\n * Calculate historical signals boost from outcome tracking\n * Per ADR: uses success_rate, violation_count, access_count\n */\nexport function calculateHistoricalBoost(signals: HistoricalSignals): number {\n\t// Base from success rate (already 0-1)\n\tlet boost = signals.successRate;\n\n\t// Bonus for violation prevention (high-value signal)\n\tif (signals.violationCount > 0) {\n\t\tboost += Math.min(0.15, signals.violationCount * 0.05);\n\t}\n\n\t// Usage factor: logarithmic scaling to prevent runaway\n\tconst usageBonus = Math.min(0.1, Math.log10(signals.accessCount + 1) * 0.05);\n\tboost += usageBonus;\n\n\t// Recent outcomes weighting (if available)\n\tif (signals.recentOutcomes.length > 0) {\n\t\tconst recentSuccess = signals.recentOutcomes.filter(\n\t\t\t(o) => o === \"accepted\" || o === \"test_pass\" || o === \"violation_prevented\",\n\t\t).length;\n\t\tconst recentRatio = recentSuccess / signals.recentOutcomes.length;\n\t\t// Blend: 70% historical, 30% recent\n\t\tboost = boost * 0.7 + recentRatio * 0.3;\n\t}\n\n\treturn Math.max(0, Math.min(1.0, boost));\n}\n\n/**\n * Combined reranking score that incorporates all signals\n * Per ADR: Three-layer confidence model\n *\n * @param baseScore - Original retrieval score (semantic/keyword fusion)\n * @param chunk - Chunk with metadata\n * @param historicalSignals - Optional historical signals from outcome tracking\n * @returns Adjusted score for reranking\n */\nexport function calculateRerankingScore(\n\tbaseScore: number,\n\tchunk: Chunk,\n\thistoricalSignals?: HistoricalSignals,\n): number {\n\t// Layer 1: Base retrieval score (40% weight)\n\tconst retrievalComponent = baseScore * 0.4;\n\n\t// Layer 2: Historical confidence (35% weight)\n\tconst historicalComponent = historicalSignals ? calculateHistoricalBoost(historicalSignals) * 0.35 : 0.5 * 0.35; // Default 0.5 if no history\n\n\t// Layer 3: Metadata confidence (25% weight)\n\tconst metadataComponent = calculateMetadataBoost(chunk) * 0.25;\n\n\t// Combined score\n\tconst combined = retrievalComponent + historicalComponent + metadataComponent;\n\n\treturn Math.max(0.1, Math.min(1.0, combined));\n}\n\n/**\n * Batch calculate reranking scores for multiple chunks\n * More efficient for large result sets\n */\nexport function batchRerankingScores(\n\titems: Array<{ chunk: Chunk; baseScore: number; historicalSignals?: HistoricalSignals }>,\n): Array<{ chunk: Chunk; originalScore: number; rerankScore: number }> {\n\treturn items\n\t\t.map((item) => ({\n\t\t\tchunk: item.chunk,\n\t\t\toriginalScore: item.baseScore,\n\t\t\trerankScore: calculateRerankingScore(item.baseScore, item.chunk, item.historicalSignals),\n\t\t}))\n\t\t.sort((a, b) => b.rerankScore - a.rerankScore);\n}\n\n/**\n * Get confidence level label from score\n */\nexport function getConfidenceLevel(score: number): \"high\" | \"medium\" | \"low\" {\n\tif (score >= 0.7) {\n\t\treturn \"high\";\n\t}\n\tif (score >= 0.4) {\n\t\treturn \"medium\";\n\t}\n\treturn \"low\";\n}\n","/**\n * Local Embeddings using Xenova Transformers\n *\n * Model: all-MiniLM-L6-v2 (384 dimensions)\n * - Runs entirely locally (privacy-first)\n * - ~50ms per embedding on modern hardware\n * - Quantized for smaller bundle size\n */\n\nimport { type FeatureExtractionPipeline, pipeline } from \"@xenova/transformers\";\n\n// Singleton pipeline instance\nlet embeddingPipeline: FeatureExtractionPipeline | null = null;\nlet isLoading = false;\nlet loadPromise: Promise<FeatureExtractionPipeline> | null = null;\n\n// Model configuration\nconst MODEL_NAME = \"Xenova/all-MiniLM-L6-v2\";\nconst EMBEDDING_DIM = 384;\n\n/**\n * Initialize the embedding pipeline (lazy loading)\n */\nasync function getEmbeddingPipeline(): Promise<FeatureExtractionPipeline> {\n\tif (embeddingPipeline) {\n\t\treturn embeddingPipeline;\n\t}\n\n\tif (loadPromise) {\n\t\treturn loadPromise;\n\t}\n\n\tif (isLoading) {\n\t\t// Wait for existing load\n\t\twhile (isLoading && !embeddingPipeline) {\n\t\t\tawait new Promise((resolve) => setTimeout(resolve, 100));\n\t\t}\n\t\tif (!embeddingPipeline) {\n\t\t\tthrow new Error(\"Embedding pipeline failed to load\");\n\t\t}\n\t\treturn embeddingPipeline;\n\t}\n\n\tisLoading = true;\n\n\ttry {\n\t\tloadPromise = pipeline(\"feature-extraction\", MODEL_NAME, {\n\t\t\tquantized: true, // Smaller model, slightly less accurate\n\t\t\tprogress_callback: (progress: { status: string; progress?: number }) => {\n\t\t\t\tif (progress.progress) {\n\t\t\t\t\tconsole.log(`Loading embedding model: ${(progress.progress * 100).toFixed(1)}%`);\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tembeddingPipeline = await loadPromise;\n\t\tconsole.log(\" Embedding model loaded\");\n\t\treturn embeddingPipeline;\n\t} finally {\n\t\tisLoading = false;\n\t\tloadPromise = null;\n\t}\n}\n\n/**\n * Generate embedding for a single text\n */\nexport async function getEmbedding(text: string): Promise<Float32Array> {\n\tconst pipe = await getEmbeddingPipeline();\n\n\t// Truncate long texts (model has 256 token limit)\n\tconst truncated = text.slice(0, 1000);\n\n\tconst output = await pipe(truncated, {\n\t\tpooling: \"mean\",\n\t\tnormalize: true,\n\t});\n\n\t// Extract the embedding array\n\tconst embedding = output.data as Float32Array;\n\n\tif (embedding.length !== EMBEDDING_DIM) {\n\t\tthrow new Error(`Unexpected embedding dimension: ${embedding.length}, expected ${EMBEDDING_DIM}`);\n\t}\n\n\treturn embedding;\n}\n\n/**\n * Generate embeddings for multiple texts (batched)\n */\nexport async function batchEmbeddings(\n\ttexts: string[],\n\toptions: { batchSize?: number; onProgress?: (done: number, total: number) => void } = {},\n): Promise<Float32Array[]> {\n\tconst { batchSize = 32, onProgress } = options;\n\tconst results: Float32Array[] = [];\n\n\tfor (let i = 0; i < texts.length; i += batchSize) {\n\t\tconst batch = texts.slice(i, i + batchSize);\n\t\tconst embeddings = await Promise.all(batch.map(getEmbedding));\n\t\tresults.push(...embeddings);\n\n\t\tif (onProgress) {\n\t\t\tonProgress(Math.min(i + batchSize, texts.length), texts.length);\n\t\t}\n\t}\n\n\treturn results;\n}\n\n/**\n * Calculate cosine similarity between two embeddings\n */\nexport function cosineSimilarity(a: Float32Array, b: Float32Array): number {\n\tif (a.length !== b.length) {\n\t\tthrow new Error(\"Embedding dimensions must match\");\n\t}\n\n\tlet dotProduct = 0;\n\tlet normA = 0;\n\tlet normB = 0;\n\n\tfor (let i = 0; i < a.length; i++) {\n\t\tdotProduct += a[i] * b[i];\n\t\tnormA += a[i] * a[i];\n\t\tnormB += b[i] * b[i];\n\t}\n\n\tconst magnitude = Math.sqrt(normA) * Math.sqrt(normB);\n\treturn magnitude === 0 ? 0 : dotProduct / magnitude;\n}\n\n/**\n * Get embedding dimension\n */\nexport function getEmbeddingDimension(): number {\n\treturn EMBEDDING_DIM;\n}\n\n/**\n * Check if embeddings are available (model loaded)\n */\nexport function isEmbeddingsReady(): boolean {\n\treturn embeddingPipeline !== null;\n}\n\n/**\n * Preload the embedding model (call during initialization)\n */\nexport async function preloadEmbeddings(): Promise<void> {\n\tawait getEmbeddingPipeline();\n}\n","/**\n * Hybrid Retriever: Combines semantic and keyword search using RRF\n *\n * Strategy:\n * 1. Classify query type (factual, conceptual, exploratory)\n * 2. Run semantic search (embeddings) and keyword search (FTS5) in parallel\n * 3. Fuse results using Reciprocal Rank Fusion with adaptive weights\n * 4. Apply metadata reranking (authority, status, recency)\n * 5. Return ranked results with confidence scores\n *\n * @see https://superlinked.com/vectorhub/articles/optimizing-rag-with-hybrid-search-reranking\n * @see https://www.meilisearch.com/blog/adaptive-rag\n */\n\nimport { classifyQuery, type QueryClassification, type QueryType } from \"./query-classifier.js\";\nimport type { Chunk, KnowledgeStore } from \"./store.js\";\n\n// Re-export query classifier types for convenience\nexport type { QueryClassification, QueryType } from \"./query-classifier.js\";\nexport { classifyQuery, getWeightsForType, validateWeights } from \"./query-classifier.js\";\n\nexport interface RetrievalResult {\n\tchunk: Chunk;\n\tscore: number;\n\tconfidence: number;\n\tsources: {\n\t\tsemantic?: { rank: number; similarity: number };\n\t\tkeyword?: { rank: number };\n\t};\n}\n\nexport interface AdaptiveRetrievalResult {\n\tresults: RetrievalResult[];\n\tclassification: QueryClassification;\n\tstats: {\n\t\tsemanticCandidates: number;\n\t\tkeywordCandidates: number;\n\t\tfusedCount: number;\n\t\tlatencyMs: number;\n\t};\n}\n\nexport interface RetrievalConfig {\n\t// Weight for semantic vs keyword (must sum to 1)\n\tsemanticWeight: number;\n\tkeywordWeight: number;\n\t// RRF parameter (higher = more weight to lower ranks)\n\tk: number;\n\t// Maximum results to return\n\tlimit: number;\n\t// Minimum confidence threshold\n\tminConfidence: number;\n\t// Candidate multiplier (fetch more candidates for better fusion)\n\tcandidateMultiplier: number;\n}\n\nconst DEFAULT_CONFIG: RetrievalConfig = {\n\tsemanticWeight: 0.6,\n\tkeywordWeight: 0.4,\n\tk: 60,\n\tlimit: 10,\n\tminConfidence: 0.1,\n\tcandidateMultiplier: 3,\n};\n\nexport class HybridRetriever {\n\tprivate config: RetrievalConfig;\n\n\tconstructor(\n\t\tprivate store: KnowledgeStore,\n\t\tconfig: Partial<RetrievalConfig> = {},\n\t) {\n\t\tthis.config = { ...DEFAULT_CONFIG, ...config };\n\n\t\t// Validate weights\n\t\tconst totalWeight = this.config.semanticWeight + this.config.keywordWeight;\n\t\tif (Math.abs(totalWeight - 1.0) > 0.01) {\n\t\t\tconsole.warn(`Weights should sum to 1.0, got ${totalWeight}. Normalizing.`);\n\t\t\tthis.config.semanticWeight /= totalWeight;\n\t\t\tthis.config.keywordWeight /= totalWeight;\n\t\t}\n\t}\n\n\t/**\n\t * Main retrieval method (uses static weights from config)\n\t */\n\tasync retrieve(query: string): Promise<RetrievalResult[]> {\n\t\tconst startTime = performance.now();\n\t\tconst candidateLimit = this.config.limit * this.config.candidateMultiplier;\n\n\t\t// Run searches in parallel\n\t\tconst [semanticResults, keywordResults] = await Promise.all([\n\t\t\tthis.semanticSearch(query, candidateLimit),\n\t\t\tthis.keywordSearch(query, candidateLimit),\n\t\t]);\n\n\t\t// Reciprocal Rank Fusion\n\t\tconst fused = this.reciprocalRankFusion(semanticResults, keywordResults);\n\n\t\t// Calculate confidence scores\n\t\tconst withConfidence = this.calculateConfidence(fused, semanticResults, keywordResults);\n\n\t\t// Filter by minimum confidence and limit\n\t\tconst filtered = withConfidence\n\t\t\t.filter((r) => r.confidence >= this.config.minConfidence)\n\t\t\t.slice(0, this.config.limit);\n\n\t\tconst elapsed = performance.now() - startTime;\n\t\tconsole.log(`Hybrid retrieval: ${filtered.length} results in ${elapsed.toFixed(2)}ms`);\n\n\t\treturn filtered;\n\t}\n\n\t/**\n\t * Adaptive retrieval with automatic query classification\n\t *\n\t * This is the recommended method for production use. It:\n\t * 1. Classifies the query type (factual, conceptual, exploratory)\n\t * 2. Applies optimal weights based on query type\n\t * 3. Returns results with classification metadata\n\t *\n\t * @example\n\t * ```typescript\n\t * const { results, classification } = await retriever.retrieveAdaptive(\n\t *   \"What is the import path for RuntimeRouter?\"\n\t * );\n\t * // classification.type === \"factual\"\n\t * // classification.weights === { semantic: 0.3, keyword: 0.7 }\n\t * ```\n\t */\n\tasync retrieveAdaptive(query: string): Promise<AdaptiveRetrievalResult> {\n\t\tconst startTime = performance.now();\n\n\t\t// Step 1: Classify the query\n\t\tconst classification = classifyQuery(query);\n\n\t\t// Step 2: Temporarily apply adaptive weights\n\t\tconst originalWeights = {\n\t\t\tsemantic: this.config.semanticWeight,\n\t\t\tkeyword: this.config.keywordWeight,\n\t\t};\n\n\t\tthis.config.semanticWeight = classification.weights.semantic;\n\t\tthis.config.keywordWeight = classification.weights.keyword;\n\n\t\tconst candidateLimit = this.config.limit * this.config.candidateMultiplier;\n\n\t\ttry {\n\t\t\t// Step 3: Run searches in parallel\n\t\t\tconst [semanticResults, keywordResults] = await Promise.all([\n\t\t\t\tthis.semanticSearch(query, candidateLimit),\n\t\t\t\tthis.keywordSearch(query, candidateLimit),\n\t\t\t]);\n\n\t\t\t// Step 4: RRF fusion with adaptive weights\n\t\t\tconst fused = this.reciprocalRankFusion(semanticResults, keywordResults);\n\n\t\t\t// Step 5: Calculate confidence scores\n\t\t\tconst withConfidence = this.calculateConfidence(fused, semanticResults, keywordResults);\n\n\t\t\t// Step 6: Filter and limit\n\t\t\tconst filtered = withConfidence\n\t\t\t\t.filter((r) => r.confidence >= this.config.minConfidence)\n\t\t\t\t.slice(0, this.config.limit);\n\n\t\t\tconst elapsed = performance.now() - startTime;\n\n\t\t\tconsole.log(\n\t\t\t\t`Adaptive retrieval [${classification.type}]: ${filtered.length} results in ${elapsed.toFixed(2)}ms ` +\n\t\t\t\t\t`(weights: sem=${classification.weights.semantic}, kw=${classification.weights.keyword})`,\n\t\t\t);\n\n\t\t\treturn {\n\t\t\t\tresults: filtered,\n\t\t\t\tclassification,\n\t\t\t\tstats: {\n\t\t\t\t\tsemanticCandidates: semanticResults.length,\n\t\t\t\t\tkeywordCandidates: keywordResults.length,\n\t\t\t\t\tfusedCount: fused.length,\n\t\t\t\t\tlatencyMs: elapsed,\n\t\t\t\t},\n\t\t\t};\n\t\t} finally {\n\t\t\t// Restore original weights\n\t\t\tthis.config.semanticWeight = originalWeights.semantic;\n\t\t\tthis.config.keywordWeight = originalWeights.keyword;\n\t\t}\n\t}\n\n\t/**\n\t * Retrieve with explicit query type (skip classification)\n\t *\n\t * Use this when you already know the query type or want to\n\t * override the automatic classification.\n\t */\n\tasync retrieveWithType(query: string, queryType: QueryType): Promise<AdaptiveRetrievalResult> {\n\t\tconst startTime = performance.now();\n\n\t\t// Get weights for the specified type\n\t\tconst { getWeightsForType } = await import(\"./query-classifier.js\");\n\t\tconst weights = getWeightsForType(queryType);\n\n\t\t// Create a synthetic classification\n\t\tconst { calculateComplexity } = await import(\"./query-classifier.js\");\n\t\tconst classification: QueryClassification = {\n\t\t\ttype: queryType,\n\t\t\tcomplexity: calculateComplexity(query),\n\t\t\tconfidence: 1.0, // Explicit type = full confidence\n\t\t\tweights,\n\t\t\treason: `Explicit type: ${queryType}`,\n\t\t};\n\n\t\t// Apply weights temporarily\n\t\tconst originalWeights = {\n\t\t\tsemantic: this.config.semanticWeight,\n\t\t\tkeyword: this.config.keywordWeight,\n\t\t};\n\n\t\tthis.config.semanticWeight = weights.semantic;\n\t\tthis.config.keywordWeight = weights.keyword;\n\n\t\tconst candidateLimit = this.config.limit * this.config.candidateMultiplier;\n\n\t\ttry {\n\t\t\tconst [semanticResults, keywordResults] = await Promise.all([\n\t\t\t\tthis.semanticSearch(query, candidateLimit),\n\t\t\t\tthis.keywordSearch(query, candidateLimit),\n\t\t\t]);\n\n\t\t\tconst fused = this.reciprocalRankFusion(semanticResults, keywordResults);\n\t\t\tconst withConfidence = this.calculateConfidence(fused, semanticResults, keywordResults);\n\n\t\t\tconst filtered = withConfidence\n\t\t\t\t.filter((r) => r.confidence >= this.config.minConfidence)\n\t\t\t\t.slice(0, this.config.limit);\n\n\t\t\tconst elapsed = performance.now() - startTime;\n\n\t\t\treturn {\n\t\t\t\tresults: filtered,\n\t\t\t\tclassification,\n\t\t\t\tstats: {\n\t\t\t\t\tsemanticCandidates: semanticResults.length,\n\t\t\t\t\tkeywordCandidates: keywordResults.length,\n\t\t\t\t\tfusedCount: fused.length,\n\t\t\t\t\tlatencyMs: elapsed,\n\t\t\t\t},\n\t\t\t};\n\t\t} finally {\n\t\t\tthis.config.semanticWeight = originalWeights.semantic;\n\t\t\tthis.config.keywordWeight = originalWeights.keyword;\n\t\t}\n\t}\n\n\t/**\n\t * Semantic search using embeddings\n\t */\n\tprivate async semanticSearch(\n\t\tquery: string,\n\t\tlimit: number,\n\t): Promise<Array<{ chunkId: string; similarity: number; rank: number }>> {\n\t\tconst results = await this.store.searchSemantic(query, limit);\n\n\t\treturn results.map((r, index) => ({\n\t\t\tchunkId: r.chunk.id,\n\t\t\tsimilarity: r.similarity,\n\t\t\trank: index + 1,\n\t\t}));\n\t}\n\n\t/**\n\t * Keyword search using FTS5\n\t */\n\tprivate keywordSearch(query: string, limit: number): Array<{ chunkId: string; rank: number }> {\n\t\tconst results = this.store.searchKeyword(query, limit);\n\n\t\treturn results.map((chunk, index) => ({\n\t\t\tchunkId: chunk.id,\n\t\t\trank: index + 1,\n\t\t}));\n\t}\n\n\t/**\n\t * Reciprocal Rank Fusion\n\t * Combines rankings from multiple sources into a unified score\n\t */\n\tprivate reciprocalRankFusion(\n\t\tsemantic: Array<{ chunkId: string; similarity: number; rank: number }>,\n\t\tkeyword: Array<{ chunkId: string; rank: number }>,\n\t): Array<{ chunkId: string; score: number; sources: RetrievalResult[\"sources\"] }> {\n\t\tconst scores = new Map<string, number>();\n\t\tconst sources = new Map<string, RetrievalResult[\"sources\"]>();\n\n\t\tconst { k, semanticWeight, keywordWeight } = this.config;\n\n\t\t// Score semantic results\n\t\tfor (const { chunkId, similarity, rank } of semantic) {\n\t\t\tconst rrfScore = semanticWeight * (1 / (k + rank));\n\t\t\tscores.set(chunkId, (scores.get(chunkId) || 0) + rrfScore);\n\n\t\t\tconst existing = sources.get(chunkId) || {};\n\t\t\texisting.semantic = { rank, similarity };\n\t\t\tsources.set(chunkId, existing);\n\t\t}\n\n\t\t// Score keyword results\n\t\tfor (const { chunkId, rank } of keyword) {\n\t\t\tconst rrfScore = keywordWeight * (1 / (k + rank));\n\t\t\tscores.set(chunkId, (scores.get(chunkId) || 0) + rrfScore);\n\n\t\t\tconst existing = sources.get(chunkId) || {};\n\t\t\texisting.keyword = { rank };\n\t\t\tsources.set(chunkId, existing);\n\t\t}\n\n\t\t// Sort by fused score\n\t\treturn Array.from(scores.entries())\n\t\t\t.map(([chunkId, score]) => ({\n\t\t\t\tchunkId,\n\t\t\t\tscore,\n\t\t\t\tsources: sources.get(chunkId) ?? {},\n\t\t\t}))\n\t\t\t.sort((a, b) => b.score - a.score);\n\t}\n\n\t/**\n\t * Calculate confidence scores using 3-layer model\n\t */\n\tprivate calculateConfidence(\n\t\tfused: Array<{ chunkId: string; score: number; sources: RetrievalResult[\"sources\"] }>,\n\t\tsemantic: Array<{ chunkId: string; similarity: number; rank: number }>,\n\t\tkeyword: Array<{ chunkId: string; rank: number }>,\n\t): RetrievalResult[] {\n\t\tconst results: RetrievalResult[] = [];\n\n\t\tfor (const { chunkId, score, sources } of fused) {\n\t\t\tconst chunk = this.store.getChunk(chunkId);\n\t\t\tif (!chunk) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Layer 1: Retrieval Confidence\n\t\t\tconst retrievalConfidence = this.calculateRetrievalConfidence(sources, semantic, keyword);\n\n\t\t\t// Layer 2: Historical Confidence (from outcomes - simplified for now)\n\t\t\tconst historicalConfidence = chunk.authority; // Use authority as proxy\n\n\t\t\t// Layer 3: Action Confidence (context-dependent - simplified)\n\t\t\tconst actionConfidence = chunk.status === \"active\" ? 1.0 : 0.5;\n\n\t\t\t// Combine layers (weighted average)\n\t\t\tconst confidence = retrievalConfidence * 0.5 + historicalConfidence * 0.3 + actionConfidence * 0.2;\n\n\t\t\tresults.push({\n\t\t\t\tchunk,\n\t\t\t\tscore,\n\t\t\t\tconfidence,\n\t\t\t\tsources,\n\t\t\t});\n\t\t}\n\n\t\treturn results;\n\t}\n\n\t/**\n\t * Layer 1: Retrieval Confidence\n\t * Based on: cross-agreement, score margin, semantic similarity\n\t */\n\tprivate calculateRetrievalConfidence(\n\t\tsources: RetrievalResult[\"sources\"],\n\t\t_semantic: Array<{ chunkId: string; similarity: number; rank: number }>,\n\t\t_keyword: Array<{ chunkId: string; rank: number }>,\n\t): number {\n\t\tlet confidence = 0.5; // Base confidence\n\n\t\t// Cross-agreement bonus: found in both semantic AND keyword\n\t\tconst inBoth = sources.semantic && sources.keyword;\n\t\tif (inBoth) {\n\t\t\tconfidence += 0.2;\n\t\t}\n\n\t\t// Semantic similarity bonus\n\t\tif (sources.semantic) {\n\t\t\tconst sim = sources.semantic.similarity;\n\t\t\tif (sim > 0.8) {\n\t\t\t\tconfidence += 0.2;\n\t\t\t} else if (sim > 0.6) {\n\t\t\t\tconfidence += 0.1;\n\t\t\t}\n\t\t}\n\n\t\t// High rank bonus\n\t\tconst bestRank = Math.min(\n\t\t\tsources.semantic?.rank || Number.POSITIVE_INFINITY,\n\t\t\tsources.keyword?.rank || Number.POSITIVE_INFINITY,\n\t\t);\n\t\tif (bestRank === 1) {\n\t\t\tconfidence += 0.1;\n\t\t} else if (bestRank <= 3) {\n\t\t\tconfidence += 0.05;\n\t\t}\n\n\t\treturn Math.min(1.0, confidence);\n\t}\n\n\t/**\n\t * Get retriever configuration\n\t */\n\tgetConfig(): RetrievalConfig {\n\t\treturn { ...this.config };\n\t}\n\n\t/**\n\t * Update retriever configuration\n\t */\n\tupdateConfig(config: Partial<RetrievalConfig>): void {\n\t\tthis.config = { ...this.config, ...config };\n\n\t\t// Re-validate weights\n\t\tconst totalWeight = this.config.semanticWeight + this.config.keywordWeight;\n\t\tif (Math.abs(totalWeight - 1.0) > 0.01) {\n\t\t\tconsole.warn(`Weights should sum to 1.0, got ${totalWeight}. Normalizing.`);\n\t\t\tthis.config.semanticWeight /= totalWeight;\n\t\t\tthis.config.keywordWeight /= totalWeight;\n\t\t}\n\t}\n}\n","import { existsSync, mkdirSync } from \"node:fs\";\nimport { homedir } from \"node:os\";\nimport path from \"node:path\";\nimport Database from \"better-sqlite3\";\nimport { cosineSimilarity, getEmbedding } from \"./embeddings.js\";\nimport { KNOWLEDGE_SCHEMA } from \"./schema.sql.js\";\n\nexport interface Chunk {\n\tid: string;\n\tsource_type: \"learning\" | \"adr\" | \"pattern\" | \"violation\";\n\tsource_id: string;\n\tchunk_text: string;\n\tcontext_text?: string;\n\tauthority: number;\n\tstatus: \"active\" | \"deprecated\" | \"superseded\";\n\tcreated_at: string;\n\tupdated_at: string;\n\tmetadata?: Record<string, unknown>;\n}\n\n/**\n * Outcome types for confidence feedback loop.\n * Per ADR: outcomes table tracks accepted/ignored/test_pass/test_fail/violation_prevented\n */\nexport type OutcomeType = \"accepted\" | \"ignored\" | \"test_pass\" | \"test_fail\" | \"violation_prevented\";\n\nexport interface Outcome {\n\tid: string;\n\tchunk_id: string;\n\toutcome_type: OutcomeType;\n\tcontext?: Record<string, unknown>;\n\tcreated_at: string;\n}\n\n/**\n * Historical signals for three-layer confidence model.\n * Per ADR: HistoricalSignals includes success_rate, violation_count, access_count\n */\nexport interface HistoricalSignals {\n\tsuccessRate: number; // 0-1: (accepted + test_pass) / total outcomes\n\tviolationCount: number; // Count of violation_prevented outcomes\n\taccessCount: number; // Total outcome count (proxy for usage)\n\trecentOutcomes: OutcomeType[]; // Last 5 outcomes for recency weighting\n}\n\nexport interface KnowledgeStoreConfig {\n\tdbPath?: string;\n\tinMemory?: boolean;\n}\n\nexport class KnowledgeStore {\n\tprivate db: Database.Database;\n\tprivate readonly dbPath: string;\n\n\tconstructor(config: KnowledgeStoreConfig = {}) {\n\t\tthis.dbPath = config.dbPath ?? path.join(homedir(), \".snapback\", \"knowledge.db\");\n\n\t\tif (config.inMemory) {\n\t\t\tthis.db = new Database(\":memory:\");\n\t\t} else {\n\t\t\tconst dir = path.dirname(this.dbPath);\n\t\t\tif (!existsSync(dir)) {\n\t\t\t\tmkdirSync(dir, { recursive: true });\n\t\t\t}\n\t\t\tthis.db = new Database(this.dbPath);\n\t\t}\n\n\t\tthis.db.pragma(\"journal_mode = WAL\");\n\t\tthis.db.pragma(\"synchronous = NORMAL\");\n\t\tthis.db.pragma(\"foreign_keys = ON\");\n\n\t\tthis.initSchema();\n\t}\n\n\tprivate initSchema(): void {\n\t\tthis.db.exec(KNOWLEDGE_SCHEMA);\n\t}\n\n\t// CRUD operations\n\tinsertChunk(chunk: Omit<Chunk, \"created_at\" | \"updated_at\">): void {\n\t\tconst stmt = this.db.prepare(`\n      INSERT INTO chunks (id, source_type, source_id, chunk_text, context_text, authority, status, metadata)\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?)\n    `);\n\n\t\tstmt.run(\n\t\t\tchunk.id,\n\t\t\tchunk.source_type,\n\t\t\tchunk.source_id,\n\t\t\tchunk.chunk_text,\n\t\t\tchunk.context_text ?? null,\n\t\t\tchunk.authority,\n\t\t\tchunk.status,\n\t\t\tchunk.metadata ? JSON.stringify(chunk.metadata) : null,\n\t\t);\n\t}\n\n\tgetChunk(id: string): Chunk | null {\n\t\tconst stmt = this.db.prepare(\"SELECT * FROM chunks WHERE id = ?\");\n\t\tconst row = stmt.get(id) as Record<string, unknown> | undefined;\n\n\t\tif (!row) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\t...row,\n\t\t\tmetadata: row.metadata ? JSON.parse(row.metadata as string) : undefined,\n\t\t} as Chunk;\n\t}\n\n\t/**\n\t * Search chunks using FTS5 keyword matching\n\t * @param query - Search query (special characters will be escaped)\n\t * @param limit - Maximum results to return\n\t */\n\tsearchKeyword(query: string, limit = 10): Chunk[] {\n\t\t// Escape FTS5 special characters and extract meaningful keywords\n\t\tconst keywords = query\n\t\t\t.toLowerCase()\n\t\t\t// Remove FTS5 operators and special characters\n\t\t\t.replace(/[\"\\-*():@?!.,;'`~#$%^&+=[\\]{}|\\\\<>]/g, \" \")\n\t\t\t// Split into words\n\t\t\t.split(/\\s+/)\n\t\t\t// Filter short words and common stop words\n\t\t\t.filter((word) => {\n\t\t\t\tif (word.length < 3) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tconst stopWords = new Set([\n\t\t\t\t\t\"the\",\n\t\t\t\t\t\"and\",\n\t\t\t\t\t\"for\",\n\t\t\t\t\t\"how\",\n\t\t\t\t\t\"what\",\n\t\t\t\t\t\"why\",\n\t\t\t\t\t\"when\",\n\t\t\t\t\t\"where\",\n\t\t\t\t\t\"which\",\n\t\t\t\t\t\"does\",\n\t\t\t\t\t\"should\",\n\t\t\t\t\t\"would\",\n\t\t\t\t\t\"could\",\n\t\t\t\t\t\"can\",\n\t\t\t\t\t\"will\",\n\t\t\t\t\t\"has\",\n\t\t\t\t\t\"have\",\n\t\t\t\t\t\"been\",\n\t\t\t\t\t\"being\",\n\t\t\t\t\t\"was\",\n\t\t\t\t\t\"were\",\n\t\t\t\t\t\"are\",\n\t\t\t\t\t\"this\",\n\t\t\t\t\t\"that\",\n\t\t\t\t\t\"these\",\n\t\t\t\t\t\"those\",\n\t\t\t\t\t\"with\",\n\t\t\t\t\t\"from\",\n\t\t\t\t\t\"into\",\n\t\t\t\t\t\"about\",\n\t\t\t\t\t\"than\",\n\t\t\t\t\t\"then\",\n\t\t\t\t\t\"they\",\n\t\t\t\t]);\n\t\t\t\treturn !stopWords.has(word);\n\t\t\t});\n\n\t\t// Return empty if no valid keywords\n\t\tif (keywords.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\t// Build FTS5 query - use OR for broader matching\n\t\tconst ftsQuery = keywords.join(\" OR \");\n\n\t\ttry {\n\t\t\tconst stmt = this.db.prepare(`\n        SELECT c.* FROM chunks c\n        JOIN chunks_fts fts ON c.rowid = fts.rowid\n        WHERE chunks_fts MATCH ?\n        ORDER BY bm25(chunks_fts)\n        LIMIT ?\n      `);\n\n\t\t\tconst rows = stmt.all(ftsQuery, limit) as Array<Record<string, unknown>>;\n\n\t\t\treturn rows.map((row) => ({\n\t\t\t\t...row,\n\t\t\t\tmetadata: row.metadata ? JSON.parse(row.metadata as string) : undefined,\n\t\t\t})) as Chunk[];\n\t\t} catch (error) {\n\t\t\t// Log but don't crash on FTS5 errors\n\t\t\tconsole.warn(`FTS5 search failed for query \"${ftsQuery}\":`, error);\n\t\t\treturn [];\n\t\t}\n\t}\n\n\t/**\n\t * Store embedding for a chunk\n\t */\n\tstoreEmbedding(chunkId: string, embedding: Float32Array): void {\n\t\tconst stmt = this.db.prepare(`\n      INSERT OR REPLACE INTO chunk_embeddings (chunk_id, embedding, dimension)\n      VALUES (?, ?, ?)\n    `);\n\n\t\t// Convert Float32Array to Buffer for SQLite BLOB\n\t\tconst buffer = Buffer.from(embedding.buffer);\n\t\tstmt.run(chunkId, buffer, embedding.length);\n\t}\n\n\t/**\n\t * Get embedding for a chunk\n\t */\n\tgetEmbedding(chunkId: string): Float32Array | null {\n\t\tconst stmt = this.db.prepare(`\n      SELECT embedding, dimension FROM chunk_embeddings WHERE chunk_id = ?\n    `);\n\n\t\tconst row = stmt.get(chunkId) as { embedding: Buffer; dimension: number } | undefined;\n\n\t\tif (!row) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Convert Buffer back to Float32Array\n\t\treturn new Float32Array(row.embedding.buffer, row.embedding.byteOffset, row.dimension);\n\t}\n\n\t/**\n\t * Get all embeddings (for brute-force search)\n\t */\n\tgetAllEmbeddings(): Array<{ chunkId: string; embedding: Float32Array }> {\n\t\tconst stmt = this.db.prepare(`\n      SELECT chunk_id, embedding, dimension FROM chunk_embeddings\n    `);\n\n\t\tconst rows = stmt.all() as Array<{ chunk_id: string; embedding: Buffer; dimension: number }>;\n\n\t\treturn rows.map((row) => ({\n\t\t\tchunkId: row.chunk_id,\n\t\t\tembedding: new Float32Array(row.embedding.buffer, row.embedding.byteOffset, row.dimension),\n\t\t}));\n\t}\n\n\t/**\n\t * Check if chunk has an embedding\n\t */\n\thasEmbedding(chunkId: string): boolean {\n\t\tconst stmt = this.db.prepare(`\n      SELECT 1 FROM chunk_embeddings WHERE chunk_id = ? LIMIT 1\n    `);\n\t\treturn stmt.get(chunkId) !== undefined;\n\t}\n\n\t/**\n\t * Get embedding statistics\n\t */\n\tgetEmbeddingStats(): { total: number; withEmbedding: number; missing: number } {\n\t\tconst totalStmt = this.db.prepare(\"SELECT COUNT(*) as count FROM chunks\");\n\t\tconst embeddedStmt = this.db.prepare(\"SELECT COUNT(*) as count FROM chunk_embeddings\");\n\n\t\tconst total = (totalStmt.get() as { count: number }).count;\n\t\tconst withEmbedding = (embeddedStmt.get() as { count: number }).count;\n\n\t\treturn {\n\t\t\ttotal,\n\t\t\twithEmbedding,\n\t\t\tmissing: total - withEmbedding,\n\t\t};\n\t}\n\n\t/**\n\t * Semantic search using embeddings (brute-force for now)\n\t * For <1000 chunks, brute-force is acceptable (~10-20ms)\n\t */\n\tasync searchSemantic(query: string, limit = 10): Promise<Array<{ chunk: Chunk; similarity: number }>> {\n\t\tconst queryEmbedding = await getEmbedding(query);\n\t\tconst allEmbeddings = this.getAllEmbeddings();\n\n\t\tif (allEmbeddings.length === 0) {\n\t\t\treturn [];\n\t\t}\n\n\t\t// Calculate similarities\n\t\tconst scored = allEmbeddings.map(({ chunkId, embedding }) => ({\n\t\t\tchunkId,\n\t\t\tsimilarity: cosineSimilarity(queryEmbedding, embedding),\n\t\t}));\n\n\t\t// Sort by similarity descending\n\t\tscored.sort((a, b) => b.similarity - a.similarity);\n\n\t\t// Get top results with chunk data\n\t\tconst topIds = scored.slice(0, limit);\n\t\tconst results: Array<{ chunk: Chunk; similarity: number }> = [];\n\n\t\tfor (const { chunkId, similarity } of topIds) {\n\t\t\tconst chunk = this.getChunk(chunkId);\n\t\t\tif (chunk) {\n\t\t\t\tresults.push({ chunk, similarity });\n\t\t\t}\n\t\t}\n\n\t\treturn results;\n\t}\n\n\t// Vector search (deprecated - use searchSemantic instead)\n\tsearchVector(_embedding: Float32Array, _limit = 10): Array<{ chunk: Chunk; distance: number }> {\n\t\t// TODO: Implement in Block 2 with sqlite-vec if needed\n\t\treturn [];\n\t}\n\n\t// Stats\n\tgetStats(): { totalChunks: number; byType: Record<string, number> } {\n\t\tconst total = this.db.prepare(\"SELECT COUNT(*) as count FROM chunks\").get() as { count: number };\n\t\tconst byType = this.db\n\t\t\t.prepare(`\n      SELECT source_type, COUNT(*) as count FROM chunks GROUP BY source_type\n    `)\n\t\t\t.all() as Array<{ source_type: string; count: number }>;\n\n\t\treturn {\n\t\t\ttotalChunks: total.count,\n\t\t\tbyType: Object.fromEntries(byType.map((r) => [r.source_type, r.count])),\n\t\t};\n\t}\n\n\t// ============================================================\n\t// OUTCOME TRACKING (Three-Layer Confidence Feedback Loop)\n\t// ============================================================\n\n\t/**\n\t * Record an outcome for a chunk (accepted, ignored, test_pass, etc.)\n\t * Per ADR: outcomes table feeds into confidence calculations\n\t */\n\trecordOutcome(chunkId: string, outcomeType: OutcomeType, context?: Record<string, unknown>): string {\n\t\tconst id = `outcome_${Date.now()}_${Math.random().toString(36).slice(2, 8)}`;\n\n\t\tconst stmt = this.db.prepare(`\n\t\t\tINSERT INTO outcomes (id, chunk_id, outcome_type, context)\n\t\t\tVALUES (?, ?, ?, ?)\n\t\t`);\n\n\t\tstmt.run(id, chunkId, outcomeType, context ? JSON.stringify(context) : null);\n\n\t\treturn id;\n\t}\n\n\t/**\n\t * Get all outcomes for a chunk\n\t */\n\tgetChunkOutcomes(chunkId: string, limit = 100): Outcome[] {\n\t\tconst stmt = this.db.prepare(`\n\t\t\tSELECT * FROM outcomes\n\t\t\tWHERE chunk_id = ?\n\t\t\tORDER BY created_at DESC\n\t\t\tLIMIT ?\n\t\t`);\n\n\t\tconst rows = stmt.all(chunkId, limit) as Array<Record<string, unknown>>;\n\n\t\treturn rows.map((row) => ({\n\t\t\tid: row.id as string,\n\t\t\tchunk_id: row.chunk_id as string,\n\t\t\toutcome_type: row.outcome_type as OutcomeType,\n\t\t\tcontext: row.context ? JSON.parse(row.context as string) : undefined,\n\t\t\tcreated_at: row.created_at as string,\n\t\t}));\n\t}\n\n\t/**\n\t * Get historical signals for a chunk (for three-layer confidence model)\n\t * Per ADR: HistoricalSignals includes success_rate, violation_count, access_count\n\t */\n\tgetHistoricalSignals(chunkId: string): HistoricalSignals {\n\t\t// Get outcome counts by type\n\t\tconst countStmt = this.db.prepare(`\n\t\t\tSELECT outcome_type, COUNT(*) as count\n\t\t\tFROM outcomes\n\t\t\tWHERE chunk_id = ?\n\t\t\tGROUP BY outcome_type\n\t\t`);\n\t\tconst counts = countStmt.all(chunkId) as Array<{ outcome_type: string; count: number }>;\n\n\t\t// Build counts map\n\t\tconst countMap: Record<string, number> = {};\n\t\tlet totalCount = 0;\n\t\tfor (const row of counts) {\n\t\t\tcountMap[row.outcome_type] = row.count;\n\t\t\ttotalCount += row.count;\n\t\t}\n\n\t\t// Calculate success rate: (accepted + test_pass + violation_prevented) / total\n\t\tconst successCount = (countMap.accepted ?? 0) + (countMap.test_pass ?? 0) + (countMap.violation_prevented ?? 0);\n\t\tconst successRate = totalCount > 0 ? successCount / totalCount : 0.5; // Default 0.5 for no data\n\n\t\t// Get recent outcomes (last 5)\n\t\tconst recentStmt = this.db.prepare(`\n\t\t\tSELECT outcome_type FROM outcomes\n\t\t\tWHERE chunk_id = ?\n\t\t\tORDER BY created_at DESC\n\t\t\tLIMIT 5\n\t\t`);\n\t\tconst recentRows = recentStmt.all(chunkId) as Array<{ outcome_type: string }>;\n\t\tconst recentOutcomes = recentRows.map((r) => r.outcome_type as OutcomeType);\n\n\t\treturn {\n\t\t\tsuccessRate,\n\t\t\tviolationCount: countMap.violation_prevented ?? 0,\n\t\t\taccessCount: totalCount,\n\t\t\trecentOutcomes,\n\t\t};\n\t}\n\n\t/**\n\t * Get chunks with their historical signals (batch operation for efficiency)\n\t */\n\tgetChunksWithSignals(chunkIds: string[]): Map<string, HistoricalSignals> {\n\t\tconst result = new Map<string, HistoricalSignals>();\n\n\t\t// For small batches, iterate; for large batches, use single query\n\t\tif (chunkIds.length <= 10) {\n\t\t\tfor (const id of chunkIds) {\n\t\t\t\tresult.set(id, this.getHistoricalSignals(id));\n\t\t\t}\n\t\t} else {\n\t\t\t// Batch query for counts\n\t\t\tconst placeholders = chunkIds.map(() => \"?\").join(\",\");\n\t\t\tconst countStmt = this.db.prepare(`\n\t\t\t\tSELECT chunk_id, outcome_type, COUNT(*) as count\n\t\t\t\tFROM outcomes\n\t\t\t\tWHERE chunk_id IN (${placeholders})\n\t\t\t\tGROUP BY chunk_id, outcome_type\n\t\t\t`);\n\t\t\tconst counts = countStmt.all(...chunkIds) as Array<{\n\t\t\t\tchunk_id: string;\n\t\t\t\toutcome_type: string;\n\t\t\t\tcount: number;\n\t\t\t}>;\n\n\t\t\t// Group by chunk_id\n\t\t\tconst chunkCounts = new Map<string, Map<string, number>>();\n\t\t\tfor (const row of counts) {\n\t\t\t\tlet chunkMap = chunkCounts.get(row.chunk_id);\n\t\t\t\tif (!chunkMap) {\n\t\t\t\t\tchunkMap = new Map();\n\t\t\t\t\tchunkCounts.set(row.chunk_id, chunkMap);\n\t\t\t\t}\n\t\t\t\tchunkMap.set(row.outcome_type, row.count);\n\t\t\t}\n\n\t\t\t// Calculate signals for each chunk\n\t\t\tfor (const id of chunkIds) {\n\t\t\t\tconst countMap = chunkCounts.get(id) ?? new Map();\n\t\t\t\tconst totalCount = Array.from(countMap.values()).reduce((a, b) => a + b, 0);\n\n\t\t\t\tconst successCount =\n\t\t\t\t\t(countMap.get(\"accepted\") ?? 0) +\n\t\t\t\t\t(countMap.get(\"test_pass\") ?? 0) +\n\t\t\t\t\t(countMap.get(\"violation_prevented\") ?? 0);\n\t\t\t\tconst successRate = totalCount > 0 ? successCount / totalCount : 0.5;\n\n\t\t\t\tresult.set(id, {\n\t\t\t\t\tsuccessRate,\n\t\t\t\t\tviolationCount: countMap.get(\"violation_prevented\") ?? 0,\n\t\t\t\t\taccessCount: totalCount,\n\t\t\t\t\trecentOutcomes: [], // Skip recent for batch (optimization)\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Update chunk authority based on outcome history\n\t * Per ADR: Confidence should evolve based on historical signals\n\t */\n\tupdateChunkAuthority(chunkId: string): void {\n\t\tconst signals = this.getHistoricalSignals(chunkId);\n\n\t\t// Authority formula: base * success_rate * recency_factor\n\t\t// - Start with current authority\n\t\t// - Adjust by success rate (higher success = higher authority)\n\t\t// - Apply recency weighting (recent failures weigh more)\n\t\tconst chunk = this.getChunk(chunkId);\n\t\tif (!chunk) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst baseAuthority = chunk.authority;\n\n\t\t// Calculate recency factor from recent outcomes\n\t\tlet recencyFactor = 1.0;\n\t\tconst weights = [0.3, 0.25, 0.2, 0.15, 0.1]; // Most recent weighted highest\n\t\tfor (let i = 0; i < signals.recentOutcomes.length; i++) {\n\t\t\tconst outcome = signals.recentOutcomes[i];\n\t\t\tconst isSuccess = outcome === \"accepted\" || outcome === \"test_pass\" || outcome === \"violation_prevented\";\n\t\t\trecencyFactor += weights[i] * (isSuccess ? 0.1 : -0.15);\n\t\t}\n\t\trecencyFactor = Math.max(0.5, Math.min(1.5, recencyFactor)); // Clamp to [0.5, 1.5]\n\n\t\t// Calculate new authority\n\t\t// Blend: 50% base authority, 30% success rate, 20% recency adjustment\n\t\tconst newAuthority = Math.max(\n\t\t\t0.1,\n\t\t\tMath.min(1.0, baseAuthority * 0.5 + signals.successRate * 0.3 + (recencyFactor - 1.0) * 0.2 + 0.5),\n\t\t);\n\n\t\t// Update in database\n\t\tconst stmt = this.db.prepare(`\n\t\t\tUPDATE chunks SET authority = ?, updated_at = datetime('now')\n\t\t\tWHERE id = ?\n\t\t`);\n\t\tstmt.run(newAuthority, chunkId);\n\t}\n\n\tclose(): void {\n\t\tthis.db.close();\n\t}\n}\n","/**\n * Mock Leakage Detector - Identifies test mocks and fixtures in production code\n */\n\nexport interface MockFinding {\n\ttype: string;\n\tline: number;\n\tsnippet: string;\n\tseverity: \"low\" | \"medium\" | \"high\" | \"critical\";\n\truleId: string;\n}\n\nexport interface MockDetectionResult {\n\tfindings: MockFinding[];\n\triskScore: number;\n}\n\n// Test library imports that shouldn't be in production code\nconst TEST_IMPORTS = [\n\t\"vitest\",\n\t\"jest\",\n\t\"@testing-library/react\",\n\t\"@testing-library/dom\",\n\t\"@testing-library/user-event\",\n\t\"@jest/globals\",\n\t\"mocha\",\n\t\"chai\",\n\t\"sinon\",\n\t\"@vitest/spy\",\n];\n\n// Mock data patterns - match variable/property names\nconst MOCK_PATTERNS = [\n\t/\\b(mock|mocked)\\w+/gi,\n\t/\\bfake\\w+/gi,\n\t/\\bdummy\\w+/gi,\n\t/\\b(stub|stubbed)\\w+/gi,\n\t/\\btest(?:Data|User|Response|Api)/gi,\n];\n\nexport class MockDetector {\n\t/**\n\t * Detect mock/test code leakage in production files\n\t */\n\tdetect(content: string, filePath: string): MockDetectionResult {\n\t\tconst findings: MockFinding[] = [];\n\n\t\t// Skip test files and config files\n\t\tif (this.isTestOrConfigFile(filePath)) {\n\t\t\treturn { findings: [], riskScore: 0 };\n\t\t}\n\n\t\tconst lines = content.split(\"\\n\");\n\n\t\t// Detect test library imports in production code\n\t\tthis.detectTestImports(lines, findings);\n\n\t\t// Detect mock data patterns\n\t\tthis.detectMockPatterns(lines, findings);\n\n\t\t// Calculate risk score\n\t\tconst riskScore = this.calculateRiskScore(findings);\n\n\t\treturn { findings, riskScore };\n\t}\n\n\t/**\n\t * Detect test library imports\n\t */\n\tprivate detectTestImports(lines: string[], findings: MockFinding[]): void {\n\t\tconst importPattern = /(?:import|require)\\s*.*?[\"']([^\"']+)[\"']/g;\n\n\t\tfor (let lineNum = 0; lineNum < lines.length; lineNum++) {\n\t\t\tconst line = lines[lineNum];\n\t\t\tconst matches = line.matchAll(importPattern);\n\n\t\t\tfor (const match of matches) {\n\t\t\t\tconst importPath = match[1];\n\n\t\t\t\t// Check if it's a test library\n\t\t\t\tfor (const testLib of TEST_IMPORTS) {\n\t\t\t\t\tif (importPath === testLib || importPath.startsWith(`${testLib}/`)) {\n\t\t\t\t\t\tfindings.push({\n\t\t\t\t\t\t\ttype: \"Test Library Import\",\n\t\t\t\t\t\t\tline: lineNum + 1,\n\t\t\t\t\t\t\tsnippet: line.trim().substring(0, 80),\n\t\t\t\t\t\t\tseverity: \"high\",\n\t\t\t\t\t\t\truleId: \"mock-detection/test-import\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Detect mock data patterns\n\t */\n\tprivate detectMockPatterns(lines: string[], findings: MockFinding[]): void {\n\t\tfor (let lineNum = 0; lineNum < lines.length; lineNum++) {\n\t\t\tconst line = lines[lineNum];\n\n\t\t\t// Skip comments\n\t\t\tif (line.trim().startsWith(\"//\") || line.trim().startsWith(\"*\")) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tfor (const pattern of MOCK_PATTERNS) {\n\t\t\t\t// Reset lastIndex to avoid stateful regex issues\n\t\t\t\tpattern.lastIndex = 0;\n\t\t\t\tif (pattern.test(line)) {\n\t\t\t\t\t// Check if it's a large data structure (potential fixture)\n\t\t\t\t\tconst isLargeStructure = line.includes(\"[\") || line.includes(\"{\");\n\n\t\t\t\t\tfindings.push({\n\t\t\t\t\t\ttype: \"Mock Data Pattern\",\n\t\t\t\t\t\tline: lineNum + 1,\n\t\t\t\t\t\tsnippet: line.trim().substring(0, 80),\n\t\t\t\t\t\tseverity: isLargeStructure ? \"medium\" : \"low\",\n\t\t\t\t\t\truleId: \"mock-detection/mock-pattern\",\n\t\t\t\t\t});\n\n\t\t\t\t\t// Only report once per line\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Check if file is a test or config file\n\t */\n\tprivate isTestOrConfigFile(filePath: string): boolean {\n\t\tconst allowedPatterns = [\n\t\t\t/\\.test\\.[jt]sx?$/,\n\t\t\t/\\.spec\\.[jt]sx?$/,\n\t\t\t/__tests__\\//,\n\t\t\t/\\/test\\//,\n\t\t\t/\\/tests\\//,\n\t\t\t/\\.fixture\\.[jt]sx?$/,\n\t\t\t/\\.seed\\.[jt]sx?$/,\n\t\t\t/vitest\\.config\\.[jt]s$/,\n\t\t\t/jest\\.config\\.[jt]s$/,\n\t\t\t/playwright\\.config\\.[jt]s$/,\n\t\t\t/setupTests\\.[jt]s$/,\n\t\t\t/test-utils\\.[jt]sx?$/,\n\t\t];\n\n\t\treturn allowedPatterns.some((pattern) => pattern.test(filePath));\n\t}\n\n\t/**\n\t * Calculate risk score (0-10)\n\t */\n\tprivate calculateRiskScore(findings: MockFinding[]): number {\n\t\tif (findings.length === 0) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tconst severityWeights = {\n\t\t\tcritical: 10,\n\t\t\thigh: 7,\n\t\t\tmedium: 4,\n\t\t\tlow: 2,\n\t\t};\n\n\t\tlet totalScore = 0;\n\t\tfor (const finding of findings) {\n\t\t\ttotalScore += severityWeights[finding.severity];\n\t\t}\n\n\t\t// Cap at 10\n\t\treturn Math.min(10, totalScore / findings.length);\n\t}\n}\n","/**\n * Phantom Dependency Detector - Identifies unused dependencies in package.json\n */\n\nexport interface PhantomDependencyFinding {\n\tpackageName: string;\n\tdeclaredIn: \"dependencies\" | \"devDependencies\";\n\tseverity: \"low\" | \"medium\";\n\truleId: string;\n}\n\nexport interface PhantomDependencyResult {\n\tfindings: PhantomDependencyFinding[];\n\tphantomDeps: string[];\n\ttotalDeps: number;\n\tusageReport: Record<string, number>;\n\triskScore: number;\n}\n\n// Framework-specific exceptions (implicitly used)\nconst FRAMEWORK_EXCEPTIONS: Record<string, string[]> = {\n\tnext: [\"react\", \"react-dom\", \"next\"],\n\tvite: [\"vite\"],\n\t\"@vitejs/plugin-react\": [\"react\", \"react-dom\"],\n\tnuxt: [\"vue\", \"nuxt\"],\n\t\"@angular/core\": [\"@angular/common\", \"@angular/platform-browser\"],\n};\n\n// Build tool and CLI exceptions (not directly imported)\nconst BUILD_TOOL_EXCEPTIONS = [\n\t\"typescript\",\n\t\"tsup\",\n\t\"vite\",\n\t\"esbuild\",\n\t\"webpack\",\n\t\"rollup\",\n\t\"biome\",\n\t\"eslint\",\n\t\"prettier\",\n\t\"@biomejs/biome\",\n\t\"vitest\",\n\t\"jest\",\n\t\"playwright\",\n\t\"@playwright/test\",\n\t\"turbo\",\n\t\"tsx\",\n\t\"node-gyp\",\n\t\"@types/node\",\n\t\"@changesets/cli\",\n\t\"lefthook\",\n\t\"@evilmartians/lefthook\",\n\t\"commitlint\",\n\t\"lint-staged\",\n];\n\nexport class PhantomDependencyDetector {\n\t/**\n\t * Detect unused dependencies by analyzing imports\n\t */\n\tasync detect(\n\t\tpackageJsonContent: string,\n\t\tcodebaseFiles: Array<{ path: string; content: string }>,\n\t): Promise<PhantomDependencyResult> {\n\t\tconst findings: PhantomDependencyFinding[] = [];\n\t\tconst usageReport: Record<string, number> = {};\n\n\t\t// Parse package.json\n\t\tlet packageJson: any;\n\t\ttry {\n\t\t\tpackageJson = JSON.parse(packageJsonContent);\n\t\t} catch {\n\t\t\treturn {\n\t\t\t\tfindings: [],\n\t\t\t\tphantomDeps: [],\n\t\t\t\ttotalDeps: 0,\n\t\t\t\tusageReport: {},\n\t\t\t\triskScore: 0,\n\t\t\t};\n\t\t}\n\n\t\tconst dependencies = packageJson.dependencies || {};\n\t\tconst devDependencies = packageJson.devDependencies || {};\n\t\tconst allDeps = { ...dependencies, ...devDependencies };\n\t\tconst totalDeps = Object.keys(allDeps).length;\n\n\t\t// Initialize usage report\n\t\tfor (const dep of Object.keys(allDeps)) {\n\t\t\tusageReport[dep] = 0;\n\t\t}\n\n\t\t// Scan all files for imports\n\t\tfor (const file of codebaseFiles) {\n\t\t\t// Skip node_modules and build outputs\n\t\t\tif (file.path.includes(\"node_modules\") || file.path.includes(\"dist/\") || file.path.includes(\"build/\")) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.scanFileForImports(file.content, usageReport);\n\t\t}\n\n\t\t// Determine framework exceptions based on dependencies\n\t\tconst frameworkExceptions = this.getFrameworkExceptions(allDeps);\n\n\t\t// Find phantom dependencies\n\t\tconst phantomDeps: string[] = [];\n\t\tfor (const [dep, usage] of Object.entries(usageReport)) {\n\t\t\t// Skip if used\n\t\t\tif (usage > 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Skip build tools\n\t\t\tif (BUILD_TOOL_EXCEPTIONS.includes(dep)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Skip framework exceptions\n\t\t\tif (frameworkExceptions.includes(dep)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Skip @types packages (TypeScript type definitions)\n\t\t\tif (dep.startsWith(\"@types/\")) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Skip transitive dependencies (packages starting with @)\n\t\t\t// This is a heuristic - in production you'd use dependency tree analysis\n\t\t\tif (dep.startsWith(\"@\") && !dep.includes(\"/\")) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// It's a phantom dependency\n\t\t\tphantomDeps.push(dep);\n\n\t\t\tconst declaredIn = dep in dependencies ? \"dependencies\" : \"devDependencies\";\n\t\t\tfindings.push({\n\t\t\t\tpackageName: dep,\n\t\t\t\tdeclaredIn,\n\t\t\t\tseverity: declaredIn === \"dependencies\" ? \"medium\" : \"low\",\n\t\t\t\truleId: \"phantom-deps/unused-dependency\",\n\t\t\t});\n\t\t}\n\n\t\t// Calculate risk score\n\t\tconst riskScore = this.calculateRiskScore(phantomDeps.length, totalDeps);\n\n\t\treturn {\n\t\t\tfindings,\n\t\t\tphantomDeps,\n\t\t\ttotalDeps,\n\t\t\tusageReport,\n\t\t\triskScore,\n\t\t};\n\t}\n\n\t/**\n\t * Scan file content for import/require statements\n\t */\n\tprivate scanFileForImports(content: string, usageReport: Record<string, number>): void {\n\t\t// Match various import patterns\n\t\tconst patterns = [\n\t\t\t/import\\s+.*?from\\s+[\"']([^\"']+)[\"']/g,\n\t\t\t/require\\s*\\(\\s*[\"']([^\"']+)[\"']\\s*\\)/g,\n\t\t\t/import\\s*\\(\\s*[\"']([^\"']+)[\"']\\s*\\)/g, // Dynamic imports\n\t\t];\n\n\t\tfor (const pattern of patterns) {\n\t\t\tconst matches = content.matchAll(pattern);\n\t\t\tfor (const match of matches) {\n\t\t\t\tconst importPath = match[1];\n\n\t\t\t\t// Extract package name from import path\n\t\t\t\t// e.g., \"react\" from \"react\"\n\t\t\t\t// e.g., \"@snapback/sdk\" from \"@snapback/sdk/storage\"\n\t\t\t\t// e.g., \"lodash\" from \"lodash/fp\"\n\t\t\t\tconst packageName = this.extractPackageName(importPath);\n\n\t\t\t\tif (packageName && packageName in usageReport) {\n\t\t\t\t\tusageReport[packageName]++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Extract package name from import path\n\t */\n\tprivate extractPackageName(importPath: string): string {\n\t\t// Skip relative imports\n\t\tif (importPath.startsWith(\".\")) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\t// Handle scoped packages (@org/package)\n\t\tif (importPath.startsWith(\"@\")) {\n\t\t\tconst parts = importPath.split(\"/\");\n\t\t\tif (parts.length >= 2) {\n\t\t\t\treturn `${parts[0]}/${parts[1]}`;\n\t\t\t}\n\t\t\treturn parts[0];\n\t\t}\n\n\t\t// Handle regular packages\n\t\tconst parts = importPath.split(\"/\");\n\t\treturn parts[0];\n\t}\n\n\t/**\n\t * Get framework-specific exceptions\n\t */\n\tprivate getFrameworkExceptions(allDeps: Record<string, string>): string[] {\n\t\tconst exceptions: string[] = [];\n\n\t\tfor (const [framework, deps] of Object.entries(FRAMEWORK_EXCEPTIONS)) {\n\t\t\tif (framework in allDeps) {\n\t\t\t\texceptions.push(...deps);\n\t\t\t}\n\t\t}\n\n\t\treturn exceptions;\n\t}\n\n\t/**\n\t * Calculate risk score (0-10)\n\t */\n\tprivate calculateRiskScore(phantomCount: number, totalCount: number): number {\n\t\tif (totalCount === 0) {\n\t\t\treturn 0;\n\t\t}\n\n\t\tconst ratio = phantomCount / totalCount;\n\n\t\t// Risk levels:\n\t\t// 0-10%: Low (score 0-3)\n\t\t// 10-25%: Medium (score 3-6)\n\t\t// 25%+: High (score 6-10)\n\n\t\tif (ratio <= 0.1) {\n\t\t\treturn ratio * 30; // 0-3\n\t\t}\n\t\tif (ratio <= 0.25) {\n\t\t\treturn 3 + (ratio - 0.1) * 20; // 3-6\n\t\t}\n\t\treturn Math.min(10, 6 + (ratio - 0.25) * 13.3); // 6-10\n\t}\n}\n","/**\n * Policy Engine - Orchestrates detectors and enforces policies\n * Provides watch/warn/block actions based on detection results\n */\n\nimport { type MockDetectionResult, MockDetector } from \"./detectors/MockDetector.js\";\nimport { PhantomDependencyDetector, type PhantomDependencyResult } from \"./detectors/PhantomDependencyDetector.js\";\nimport { type SecretDetectionResult, SecretDetector } from \"./detectors/SecretDetector.js\";\n\nexport type PolicyAction = \"watch\" | \"warn\" | \"block\";\n\nexport interface PolicyRule {\n\tid: string;\n\tname: string;\n\tdetector: \"secret\" | \"mock\" | \"phantom-dependency\";\n\taction: PolicyAction;\n\tseverity?: \"low\" | \"medium\" | \"high\" | \"critical\";\n\tenabled: boolean;\n}\n\nexport interface PolicyEngineConfig {\n\trules: PolicyRule[];\n\tdefaultAction?: PolicyAction;\n}\n\nexport interface DetectionEvent {\n\truleId: string;\n\tdetector: string;\n\taction: PolicyAction;\n\tfindings: any[];\n\triskScore: number;\n\ttimestamp: string;\n}\n\nexport interface PolicyEngineResult {\n\taction: PolicyAction;\n\tevents: DetectionEvent[];\n\tsummary: {\n\t\ttotalFindings: number;\n\t\tbyDetector: Record<string, number>;\n\t\thighestAction: PolicyAction;\n\t};\n}\n\n/**\n * Default policy rules configuration\n */\nconst DEFAULT_RULES: PolicyRule[] = [\n\t{\n\t\tid: \"secret-detection-critical\",\n\t\tname: \"Critical Secret Detection\",\n\t\tdetector: \"secret\",\n\t\taction: \"block\",\n\t\tseverity: \"critical\",\n\t\tenabled: true,\n\t},\n\t{\n\t\tid: \"secret-detection-high\",\n\t\tname: \"High Severity Secret Detection\",\n\t\tdetector: \"secret\",\n\t\taction: \"warn\",\n\t\tseverity: \"high\",\n\t\tenabled: true,\n\t},\n\t{\n\t\tid: \"mock-detection\",\n\t\tname: \"Mock/Test Leakage Detection\",\n\t\tdetector: \"mock\",\n\t\taction: \"warn\",\n\t\tenabled: true,\n\t},\n\t{\n\t\tid: \"phantom-dependency\",\n\t\tname: \"Phantom Dependency Detection\",\n\t\tdetector: \"phantom-dependency\",\n\t\taction: \"watch\",\n\t\tenabled: true,\n\t},\n];\n\nexport class PolicyEngine {\n\tprivate secretDetector: SecretDetector;\n\tprivate mockDetector: MockDetector;\n\tprivate phantomDependencyDetector: PhantomDependencyDetector;\n\tprivate config: PolicyEngineConfig;\n\n\tconstructor(config?: Partial<PolicyEngineConfig>) {\n\t\tthis.secretDetector = new SecretDetector();\n\t\tthis.mockDetector = new MockDetector();\n\t\tthis.phantomDependencyDetector = new PhantomDependencyDetector();\n\n\t\tthis.config = {\n\t\t\t// Deep copy DEFAULT_RULES to avoid mutation across instances\n\t\t\trules: config?.rules || DEFAULT_RULES.map((rule) => ({ ...rule })),\n\t\t\tdefaultAction: config?.defaultAction || \"watch\",\n\t\t};\n\t}\n\n\t/**\n\t * Run all enabled detectors on a file\n\t */\n\tasync analyzeFile(filePath: string, content: string): Promise<PolicyEngineResult> {\n\t\tconst events: DetectionEvent[] = [];\n\t\tlet totalFindings = 0;\n\t\tconst byDetector: Record<string, number> = {};\n\n\t\t// Run secret detection\n\t\tif (this.isDetectorEnabled(\"secret\")) {\n\t\t\tconst result = this.secretDetector.detect(content, filePath);\n\t\t\tconst action = this.determineAction(\"secret\", result);\n\n\t\t\tif (result.findings.length > 0) {\n\t\t\t\tevents.push({\n\t\t\t\t\truleId: \"secret-detection\",\n\t\t\t\t\tdetector: \"secret\",\n\t\t\t\t\taction,\n\t\t\t\t\tfindings: result.findings,\n\t\t\t\t\triskScore: result.riskScore,\n\t\t\t\t\ttimestamp: new Date().toISOString(),\n\t\t\t\t});\n\n\t\t\t\ttotalFindings += result.findings.length;\n\t\t\t\tbyDetector.secret = result.findings.length;\n\t\t\t}\n\t\t}\n\n\t\t// Run mock detection\n\t\tif (this.isDetectorEnabled(\"mock\")) {\n\t\t\tconst result = this.mockDetector.detect(content, filePath);\n\t\t\tconst action = this.determineAction(\"mock\", result);\n\n\t\t\tif (result.findings.length > 0) {\n\t\t\t\tevents.push({\n\t\t\t\t\truleId: \"mock-detection\",\n\t\t\t\t\tdetector: \"mock\",\n\t\t\t\t\taction,\n\t\t\t\t\tfindings: result.findings,\n\t\t\t\t\triskScore: result.riskScore,\n\t\t\t\t\ttimestamp: new Date().toISOString(),\n\t\t\t\t});\n\n\t\t\t\ttotalFindings += result.findings.length;\n\t\t\t\tbyDetector.mock = result.findings.length;\n\t\t\t}\n\t\t}\n\n\t\t// Determine highest action\n\t\tconst highestAction = this.getHighestAction(events.map((e) => e.action));\n\n\t\treturn {\n\t\t\taction: highestAction,\n\t\t\tevents,\n\t\t\tsummary: {\n\t\t\t\ttotalFindings,\n\t\t\t\tbyDetector,\n\t\t\t\thighestAction,\n\t\t\t},\n\t\t};\n\t}\n\n\t/**\n\t * Analyze package.json for phantom dependencies\n\t */\n\tasync analyzePackageJson(\n\t\tpackageJsonContent: string,\n\t\tcodebaseFiles: Array<{ path: string; content: string }>,\n\t): Promise<PolicyEngineResult> {\n\t\tconst events: DetectionEvent[] = [];\n\n\t\tif (this.isDetectorEnabled(\"phantom-dependency\")) {\n\t\t\tconst result = await this.phantomDependencyDetector.detect(packageJsonContent, codebaseFiles);\n\t\t\tconst action = this.determineAction(\"phantom-dependency\", result);\n\n\t\t\tif (result.findings.length > 0) {\n\t\t\t\tevents.push({\n\t\t\t\t\truleId: \"phantom-dependency\",\n\t\t\t\t\tdetector: \"phantom-dependency\",\n\t\t\t\t\taction,\n\t\t\t\t\tfindings: result.findings,\n\t\t\t\t\triskScore: result.riskScore,\n\t\t\t\t\ttimestamp: new Date().toISOString(),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tconst highestAction = this.getHighestAction(events.map((e) => e.action));\n\n\t\tconst byDetector: Record<string, number> = {};\n\t\tfor (const e of events) {\n\t\t\tbyDetector[e.detector] = e.findings.length;\n\t\t}\n\n\t\treturn {\n\t\t\taction: highestAction,\n\t\t\tevents,\n\t\t\tsummary: {\n\t\t\t\ttotalFindings: events.reduce((sum, e) => sum + e.findings.length, 0),\n\t\t\t\tbyDetector,\n\t\t\t\thighestAction,\n\t\t\t},\n\t\t};\n\t}\n\n\t/**\n\t * Check if a detector is enabled in the policy\n\t */\n\tprivate isDetectorEnabled(detector: \"secret\" | \"mock\" | \"phantom-dependency\"): boolean {\n\t\treturn this.config.rules.some((rule) => rule.detector === detector && rule.enabled);\n\t}\n\n\t/**\n\t * Determine action based on detection results and configured rules\n\t */\n\tprivate determineAction(\n\t\tdetector: \"secret\" | \"mock\" | \"phantom-dependency\",\n\t\tresult: SecretDetectionResult | MockDetectionResult | PhantomDependencyResult,\n\t): PolicyAction {\n\t\t// Find the most severe matching rule\n\t\tlet highestAction: PolicyAction = this.config.defaultAction || \"watch\";\n\n\t\tfor (const rule of this.config.rules) {\n\t\t\tif (rule.detector !== detector || !rule.enabled) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// For secret detection, check severity\n\t\t\tif (detector === \"secret\" && rule.severity) {\n\t\t\t\tconst secretResult = result as SecretDetectionResult;\n\t\t\t\tconst hasSeverity = secretResult.findings.some((f) => f.severity === rule.severity);\n\t\t\t\tif (hasSeverity) {\n\t\t\t\t\thighestAction = this.getHigherAction(highestAction, rule.action);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// For other detectors, apply rule action if there are findings\n\t\t\t\tif (result.findings.length > 0) {\n\t\t\t\t\thighestAction = this.getHigherAction(highestAction, rule.action);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn highestAction;\n\t}\n\n\t/**\n\t * Get the higher priority action\n\t */\n\tprivate getHigherAction(current: PolicyAction, candidate: PolicyAction): PolicyAction {\n\t\tconst priority: Record<PolicyAction, number> = {\n\t\t\twatch: 1,\n\t\t\twarn: 2,\n\t\t\tblock: 3,\n\t\t};\n\n\t\treturn priority[candidate] > priority[current] ? candidate : current;\n\t}\n\n\t/**\n\t * Get the highest action from a list\n\t */\n\tprivate getHighestAction(actions: PolicyAction[]): PolicyAction {\n\t\tif (actions.length === 0) {\n\t\t\treturn this.config.defaultAction || \"watch\";\n\t\t}\n\n\t\treturn actions.reduce((highest, current) => this.getHigherAction(highest, current), \"watch\" as PolicyAction);\n\t}\n\n\t/**\n\t * Update policy configuration\n\t */\n\tupdateConfig(config: Partial<PolicyEngineConfig>): void {\n\t\tif (config.rules) {\n\t\t\tthis.config.rules = config.rules;\n\t\t}\n\t\tif (config.defaultAction) {\n\t\t\tthis.config.defaultAction = config.defaultAction;\n\t\t}\n\t}\n\n\t/**\n\t * Get current policy configuration\n\t */\n\tgetConfig(): PolicyEngineConfig {\n\t\treturn { ...this.config };\n\t}\n\n\t/**\n\t * Enable a specific rule\n\t */\n\tenableRule(ruleId: string): void {\n\t\tconst rule = this.config.rules.find((r) => r.id === ruleId);\n\t\tif (rule) {\n\t\t\trule.enabled = true;\n\t\t}\n\t}\n\n\t/**\n\t * Disable a specific rule\n\t */\n\tdisableRule(ruleId: string): void {\n\t\tconst rule = this.config.rules.find((r) => r.id === ruleId);\n\t\tif (rule) {\n\t\t\trule.enabled = false;\n\t\t}\n\t}\n}\n","/**\n * SARIF Formatter - Converts detection results to SARIF format\n * SARIF (Static Analysis Results Interchange Format) v2.1.0\n * https://docs.oasis-open.org/sarif/sarif/v2.1.0/sarif-v2.1.0.html\n */\n\nimport type { MockFinding } from \"./detectors/MockDetector.js\";\nimport type { PhantomDependencyFinding } from \"./detectors/PhantomDependencyDetector.js\";\nimport type { SecretFinding } from \"./detectors/SecretDetector.js\";\nimport type { PolicyEngineResult } from \"./PolicyEngine.js\";\n\nexport interface SarifLog {\n\tversion: \"2.1.0\";\n\t$schema: string;\n\truns: SarifRun[];\n}\n\nexport interface SarifRun {\n\ttool: {\n\t\tdriver: {\n\t\t\tname: string;\n\t\t\tversion: string;\n\t\t\tinformationUri?: string;\n\t\t\trules?: SarifRule[];\n\t\t};\n\t};\n\tresults: SarifResult[];\n}\n\nexport interface SarifRule {\n\tid: string;\n\tname: string;\n\tshortDescription: {\n\t\ttext: string;\n\t};\n\tfullDescription?: {\n\t\ttext: string;\n\t};\n\tdefaultConfiguration?: {\n\t\tlevel: \"error\" | \"warning\" | \"note\";\n\t};\n\thelpUri?: string;\n}\n\nexport interface SarifResult {\n\truleId: string;\n\tlevel: \"error\" | \"warning\" | \"note\";\n\tmessage: {\n\t\ttext: string;\n\t};\n\tlocations?: Array<{\n\t\tphysicalLocation: {\n\t\t\tartifactLocation: {\n\t\t\t\turi: string;\n\t\t\t};\n\t\t\tregion?: {\n\t\t\t\tstartLine: number;\n\t\t\t\tstartColumn?: number;\n\t\t\t};\n\t\t};\n\t}>;\n\tproperties?: {\n\t\tseverity?: string;\n\t\tconfidence?: number;\n\t\t[key: string]: any;\n\t};\n}\n\nexport class SarifFormatter {\n\tprivate toolName = \"SnapBack Guardian\";\n\tprivate toolVersion = \"1.0.0\";\n\tprivate toolUri = \"https://snapback.dev\";\n\n\t/**\n\t * Convert PolicyEngineResult to SARIF format\n\t */\n\ttoSarif(result: PolicyEngineResult, analysisSource?: string): SarifLog {\n\t\tconst rules: SarifRule[] = [];\n\t\tconst results: SarifResult[] = [];\n\n\t\t// Process each detection event\n\t\tfor (const event of result.events) {\n\t\t\t// Add rule definitions\n\t\t\tthis.addRulesForEvent(event.detector, rules);\n\n\t\t\t// Convert findings to SARIF results\n\t\t\tfor (const finding of event.findings) {\n\t\t\t\tconst sarifResult = this.convertFindingToResult(finding, event.detector, analysisSource);\n\t\t\t\tif (sarifResult) {\n\t\t\t\t\tresults.push(sarifResult);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tversion: \"2.1.0\",\n\t\t\t$schema: \"https://raw.githubusercontent.com/oasis-tcs/sarif-spec/master/Schemata/sarif-schema-2.1.0.json\",\n\t\t\truns: [\n\t\t\t\t{\n\t\t\t\t\ttool: {\n\t\t\t\t\t\tdriver: {\n\t\t\t\t\t\t\tname: this.toolName,\n\t\t\t\t\t\t\tversion: this.toolVersion,\n\t\t\t\t\t\t\tinformationUri: this.toolUri,\n\t\t\t\t\t\t\trules: this.deduplicateRules(rules),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tresults,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\t/**\n\t * Add rule definitions based on detector type\n\t */\n\tprivate addRulesForEvent(detector: string, rules: SarifRule[]): void {\n\t\tswitch (detector) {\n\t\t\tcase \"secret\":\n\t\t\t\trules.push({\n\t\t\t\t\tid: \"secret-detection/aws-key\",\n\t\t\t\t\tname: \"AWS Access Key Detection\",\n\t\t\t\t\tshortDescription: {\n\t\t\t\t\t\ttext: \"Detects AWS access keys in code\",\n\t\t\t\t\t},\n\t\t\t\t\tdefaultConfiguration: {\n\t\t\t\t\t\tlevel: \"error\",\n\t\t\t\t\t},\n\t\t\t\t\thelpUri: \"https://snapback.dev/docs/detectors/secret-detection\",\n\t\t\t\t});\n\t\t\t\trules.push({\n\t\t\t\t\tid: \"secret-detection/github-token\",\n\t\t\t\t\tname: \"GitHub Token Detection\",\n\t\t\t\t\tshortDescription: {\n\t\t\t\t\t\ttext: \"Detects GitHub personal access tokens\",\n\t\t\t\t\t},\n\t\t\t\t\tdefaultConfiguration: {\n\t\t\t\t\t\tlevel: \"error\",\n\t\t\t\t\t},\n\t\t\t\t\thelpUri: \"https://snapback.dev/docs/detectors/secret-detection\",\n\t\t\t\t});\n\t\t\t\trules.push({\n\t\t\t\t\tid: \"secret-detection/high-entropy-string\",\n\t\t\t\t\tname: \"High Entropy String Detection\",\n\t\t\t\t\tshortDescription: {\n\t\t\t\t\t\ttext: \"Detects high-entropy strings that may be secrets\",\n\t\t\t\t\t},\n\t\t\t\t\tdefaultConfiguration: {\n\t\t\t\t\t\tlevel: \"warning\",\n\t\t\t\t\t},\n\t\t\t\t\thelpUri: \"https://snapback.dev/docs/detectors/secret-detection\",\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"mock\":\n\t\t\t\trules.push({\n\t\t\t\t\tid: \"mock-detection/test-import\",\n\t\t\t\t\tname: \"Test Library Import Detection\",\n\t\t\t\t\tshortDescription: {\n\t\t\t\t\t\ttext: \"Detects test library imports in production code\",\n\t\t\t\t\t},\n\t\t\t\t\tdefaultConfiguration: {\n\t\t\t\t\t\tlevel: \"warning\",\n\t\t\t\t\t},\n\t\t\t\t\thelpUri: \"https://snapback.dev/docs/detectors/mock-detection\",\n\t\t\t\t});\n\t\t\t\trules.push({\n\t\t\t\t\tid: \"mock-detection/mock-pattern\",\n\t\t\t\t\tname: \"Mock Pattern Detection\",\n\t\t\t\t\tshortDescription: {\n\t\t\t\t\t\ttext: \"Detects mock/test patterns in production code\",\n\t\t\t\t\t},\n\t\t\t\t\tdefaultConfiguration: {\n\t\t\t\t\t\tlevel: \"warning\",\n\t\t\t\t\t},\n\t\t\t\t\thelpUri: \"https://snapback.dev/docs/detectors/mock-detection\",\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"phantom-dependency\":\n\t\t\t\trules.push({\n\t\t\t\t\tid: \"phantom-deps/unused-dependency\",\n\t\t\t\t\tname: \"Unused Dependency Detection\",\n\t\t\t\t\tshortDescription: {\n\t\t\t\t\t\ttext: \"Detects declared dependencies that are not imported\",\n\t\t\t\t\t},\n\t\t\t\t\tdefaultConfiguration: {\n\t\t\t\t\t\tlevel: \"note\",\n\t\t\t\t\t},\n\t\t\t\t\thelpUri: \"https://snapback.dev/docs/detectors/phantom-dependency\",\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Convert a finding to SARIF result format\n\t */\n\tprivate convertFindingToResult(finding: any, detector: string, source?: string): SarifResult | null {\n\t\tif (detector === \"secret\") {\n\t\t\treturn this.convertSecretFinding(finding as SecretFinding, source);\n\t\t}\n\t\tif (detector === \"mock\") {\n\t\t\treturn this.convertMockFinding(finding as MockFinding, source);\n\t\t}\n\t\tif (detector === \"phantom-dependency\") {\n\t\t\treturn this.convertPhantomDependencyFinding(finding as PhantomDependencyFinding);\n\t\t}\n\t\treturn null;\n\t}\n\n\t/**\n\t * Convert secret finding to SARIF result\n\t */\n\tprivate convertSecretFinding(finding: SecretFinding, source?: string): SarifResult {\n\t\treturn {\n\t\t\truleId: finding.ruleId,\n\t\t\tlevel: this.mapSeverityToLevel(finding.severity),\n\t\t\tmessage: {\n\t\t\t\ttext: `${finding.type} detected: ${finding.snippet.substring(0, 50)}...`,\n\t\t\t},\n\t\t\tlocations: source\n\t\t\t\t? [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tphysicalLocation: {\n\t\t\t\t\t\t\t\tartifactLocation: {\n\t\t\t\t\t\t\t\t\turi: source,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tregion: {\n\t\t\t\t\t\t\t\t\tstartLine: finding.line,\n\t\t\t\t\t\t\t\t\tstartColumn: finding.column,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t]\n\t\t\t\t: undefined,\n\t\t\tproperties: {\n\t\t\t\tseverity: finding.severity,\n\t\t\t\tentropy: finding.entropy,\n\t\t\t},\n\t\t};\n\t}\n\n\t/**\n\t * Convert mock finding to SARIF result\n\t */\n\tprivate convertMockFinding(finding: MockFinding, source?: string): SarifResult {\n\t\treturn {\n\t\t\truleId: finding.ruleId,\n\t\t\tlevel: this.mapSeverityToLevel(finding.severity),\n\t\t\tmessage: {\n\t\t\t\ttext: `${finding.type} detected: ${finding.snippet}`,\n\t\t\t},\n\t\t\tlocations: source\n\t\t\t\t? [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tphysicalLocation: {\n\t\t\t\t\t\t\t\tartifactLocation: {\n\t\t\t\t\t\t\t\t\turi: source,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tregion: {\n\t\t\t\t\t\t\t\t\tstartLine: finding.line,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t]\n\t\t\t\t: undefined,\n\t\t\tproperties: {\n\t\t\t\tseverity: finding.severity,\n\t\t\t},\n\t\t};\n\t}\n\n\t/**\n\t * Convert phantom dependency finding to SARIF result\n\t */\n\tprivate convertPhantomDependencyFinding(finding: PhantomDependencyFinding): SarifResult {\n\t\treturn {\n\t\t\truleId: finding.ruleId,\n\t\t\tlevel: this.mapSeverityToLevel(finding.severity),\n\t\t\tmessage: {\n\t\t\t\ttext: `Unused dependency '${finding.packageName}' in ${finding.declaredIn}`,\n\t\t\t},\n\t\t\tlocations: [\n\t\t\t\t{\n\t\t\t\t\tphysicalLocation: {\n\t\t\t\t\t\tartifactLocation: {\n\t\t\t\t\t\t\turi: \"package.json\",\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tproperties: {\n\t\t\t\tseverity: finding.severity,\n\t\t\t\tpackageName: finding.packageName,\n\t\t\t\tdeclaredIn: finding.declaredIn,\n\t\t\t},\n\t\t};\n\t}\n\n\t/**\n\t * Map internal severity to SARIF level\n\t */\n\tprivate mapSeverityToLevel(severity: \"low\" | \"medium\" | \"high\" | \"critical\"): \"error\" | \"warning\" | \"note\" {\n\t\tswitch (severity) {\n\t\t\tcase \"critical\":\n\t\t\tcase \"high\":\n\t\t\t\treturn \"error\";\n\t\t\tcase \"medium\":\n\t\t\t\treturn \"warning\";\n\t\t\tdefault:\n\t\t\t\treturn \"note\";\n\t\t}\n\t}\n\n\t/**\n\t * Deduplicate rules by ID\n\t */\n\tprivate deduplicateRules(rules: SarifRule[]): SarifRule[] {\n\t\tconst seen = new Set<string>();\n\t\tconst deduplicated: SarifRule[] = [];\n\n\t\tfor (const rule of rules) {\n\t\t\tif (!seen.has(rule.id)) {\n\t\t\t\tseen.add(rule.id);\n\t\t\t\tdeduplicated.push(rule);\n\t\t\t}\n\t\t}\n\n\t\treturn deduplicated;\n\t}\n\n\t/**\n\t * Export to SARIF JSON string\n\t */\n\ttoJson(result: PolicyEngineResult, analysisSource?: string): string {\n\t\tconst sarif = this.toSarif(result, analysisSource);\n\t\treturn JSON.stringify(sarif, null, 2);\n\t}\n\n\t/**\n\t * Static method to format PolicyEngineResult to SARIF (matches export API)\n\t */\n\tstatic format(result: PolicyEngineResult, options: { toolVersion: string; baseUri?: string }): SarifLog {\n\t\tconst formatter = new SarifFormatter();\n\t\tformatter.toolVersion = options.toolVersion;\n\t\treturn formatter.toSarif(result);\n\t}\n\n\t/**\n\t * Static method to convert SARIF log to JSON string (matches export API)\n\t */\n\tstatic toJSON(log: SarifLog): string {\n\t\treturn JSON.stringify(log, null, 2);\n\t}\n\n\t/**\n\t * Static method to write SARIF log to file (matches export API)\n\t */\n\tstatic toFile(log: SarifLog, filePath: string): void {\n\t\tconst fs = require(\"node:fs\");\n\t\tfs.writeFileSync(filePath, SarifFormatter.toJSON(log), \"utf-8\");\n\t}\n}\n","/**\n * Policy Engine - Migrated from @snapback/policy-engine\n *\n * Provides policy evaluation, SARIF formatting, and detection capabilities.\n *\n * @example\n * ```typescript\n * import { evaluate, PolicyEngine, SecretDetector } from \"@snapback/intelligence/policy\";\n *\n * // Evaluate SARIF against policy\n * const decision = evaluate(sarifLog);\n *\n * // Use PolicyEngine for comprehensive analysis\n * const engine = new PolicyEngine();\n * const result = await engine.analyzeFile(filePath, content);\n *\n * // Use individual detectors\n * const detector = new SecretDetector();\n * const findings = detector.detect(content, filePath);\n * ```\n */\n\nimport * as fs from \"node:fs\";\nimport * as path from \"node:path\";\n\n/**\n * Policy engine for SnapBack\n * Evaluates SARIF results against policy rules defined in .snapbackrc\n */\n\n// Default policy configuration\nconst DEFAULT_POLICY = {\n\tthresholds: {\n\t\tcritical: 0, // Block on any critical issues\n\t\thigh: 0, // Block on any high issues\n\t\tmedium: 100, // Allow medium issues\n\t\tlow: 100, // Allow low issues\n\t},\n\tblockOn: {\n\t\tcritical: true,\n\t\thigh: true,\n\t\tmedium: false,\n\t\tlow: false,\n\t},\n\tpathRules: [] as {\n\t\tglob: string;\n\t\tthresholds: any;\n\t\tblockOn?: { critical: boolean; high: boolean; medium: boolean; low: boolean };\n\t}[],\n};\n\n// Policy version information\nconst POLICY_VERSION = \"1.0.0\";\nconst POLICY_ETAG = \"abc123def456\";\n\nexport interface PolicyConfig {\n\tthresholds: {\n\t\tcritical: number;\n\t\thigh: number;\n\t\tmedium: number;\n\t\tlow: number;\n\t};\n\tblockOn: {\n\t\tcritical: boolean;\n\t\thigh: boolean;\n\t\tmedium: boolean;\n\t\tlow: boolean;\n\t};\n\tpathRules: {\n\t\tglob: string;\n\t\tthresholds: any;\n\t\tblockOn?: {\n\t\t\tcritical: boolean;\n\t\t\thigh: boolean;\n\t\t\tmedium: boolean;\n\t\t\tlow: boolean;\n\t\t};\n\t}[];\n}\n\nexport interface PolicyDecision {\n\taction: \"apply\" | \"review\" | \"block\";\n\treason: string;\n\trules_hit: string[];\n\tconfidence: number;\n\tpolicyVersion: string;\n\tetag: string;\n\tdetails: {\n\t\tissueCounts: {\n\t\t\tcritical: number;\n\t\t\thigh: number;\n\t\t\tmedium: number;\n\t\t\tlow: number;\n\t\t};\n\t\t[path: string]: unknown;\n\t};\n}\n\n/**\n * Evaluate SARIF results against policy rules\n * @param sarif SARIF data to evaluate\n * @param config Policy configuration\n * @param filePath Optional file path for path-based rules\n * @returns Policy decision\n */\nexport function evaluate(sarif: any, config: PolicyConfig = DEFAULT_POLICY, filePath?: string): PolicyDecision {\n\t// Merge with default policy to ensure all fields are present\n\tconst effectiveConfig = {\n\t\tthresholds: { ...DEFAULT_POLICY.thresholds, ...config.thresholds },\n\t\tblockOn: { ...DEFAULT_POLICY.blockOn, ...config.blockOn },\n\t\tpathRules: config.pathRules || DEFAULT_POLICY.pathRules,\n\t};\n\n\t// Apply path-specific rules if filePath is provided\n\tlet effectiveThresholds = effectiveConfig.thresholds;\n\tlet effectiveBlockOn = effectiveConfig.blockOn;\n\tif (filePath) {\n\t\tfor (const rule of effectiveConfig.pathRules) {\n\t\t\tif (matchesGlob(filePath, rule.glob)) {\n\t\t\t\teffectiveThresholds = { ...effectiveThresholds, ...rule.thresholds };\n\t\t\t\t// Apply path-specific blockOn settings if provided\n\t\t\t\tif (rule.blockOn) {\n\t\t\t\t\teffectiveBlockOn = { ...effectiveBlockOn, ...rule.blockOn };\n\t\t\t\t} else {\n\t\t\t\t\t// If thresholds are overridden without explicit blockOn, enable blocking for those severities\n\t\t\t\t\tconst implicitBlockOn: Partial<typeof effectiveBlockOn> = {};\n\t\t\t\t\tif (rule.thresholds.critical !== undefined) {\n\t\t\t\t\t\timplicitBlockOn.critical = true;\n\t\t\t\t\t}\n\t\t\t\t\tif (rule.thresholds.high !== undefined) {\n\t\t\t\t\t\timplicitBlockOn.high = true;\n\t\t\t\t\t}\n\t\t\t\t\tif (rule.thresholds.medium !== undefined) {\n\t\t\t\t\t\timplicitBlockOn.medium = true;\n\t\t\t\t\t}\n\t\t\t\t\tif (rule.thresholds.low !== undefined) {\n\t\t\t\t\t\timplicitBlockOn.low = true;\n\t\t\t\t\t}\n\t\t\t\t\teffectiveBlockOn = { ...effectiveBlockOn, ...implicitBlockOn };\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Track rules that are hit and count issues by severity\n\tconst rulesHit: string[] = [];\n\tconst issueCounts = {\n\t\tcritical: 0,\n\t\thigh: 0,\n\t\tmedium: 0,\n\t\tlow: 0,\n\t};\n\n\t// Extract results from SARIF\n\tif (sarif.runs && sarif.runs.length > 0) {\n\t\tconst results = sarif.runs[0].results || [];\n\t\tfor (const result of results) {\n\t\t\tconst severity = getSeverity(result);\n\t\t\tif (severity in issueCounts) {\n\t\t\t\tissueCounts[severity as keyof typeof issueCounts]++;\n\n\t\t\t\t// Track which rules are hit\n\t\t\t\tif (result.ruleId) {\n\t\t\t\t\tif (!rulesHit.includes(result.ruleId)) {\n\t\t\t\t\t\trulesHit.push(result.ruleId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Calculate confidence based on issue counts and thresholds\n\tconst confidence = calculateConfidence(issueCounts, effectiveThresholds);\n\n\t// Check if any blocking conditions are met\n\tif (effectiveBlockOn.critical && issueCounts.critical > effectiveThresholds.critical) {\n\t\treturn {\n\t\t\taction: \"block\",\n\t\t\treason: `Critical issues (${issueCounts.critical}) exceed threshold (${effectiveThresholds.critical})`,\n\t\t\trules_hit: rulesHit,\n\t\t\tconfidence: confidence,\n\t\t\tpolicyVersion: POLICY_VERSION,\n\t\t\tetag: POLICY_ETAG,\n\t\t\tdetails: {\n\t\t\t\tissueCounts,\n\t\t\t},\n\t\t};\n\t}\n\n\tif (effectiveBlockOn.high && issueCounts.high > effectiveThresholds.high) {\n\t\treturn {\n\t\t\taction: \"block\",\n\t\t\treason: `High issues (${issueCounts.high}) exceed threshold (${effectiveThresholds.high})`,\n\t\t\trules_hit: rulesHit,\n\t\t\tconfidence: confidence,\n\t\t\tpolicyVersion: POLICY_VERSION,\n\t\t\tetag: POLICY_ETAG,\n\t\t\tdetails: {\n\t\t\t\tissueCounts,\n\t\t\t},\n\t\t};\n\t}\n\n\tif (effectiveBlockOn.medium && issueCounts.medium > effectiveThresholds.medium) {\n\t\treturn {\n\t\t\taction: \"block\",\n\t\t\treason: `Medium issues (${issueCounts.medium}) exceed threshold (${effectiveThresholds.medium})`,\n\t\t\trules_hit: rulesHit,\n\t\t\tconfidence: confidence,\n\t\t\tpolicyVersion: POLICY_VERSION,\n\t\t\tetag: POLICY_ETAG,\n\t\t\tdetails: {\n\t\t\t\tissueCounts,\n\t\t\t},\n\t\t};\n\t}\n\n\tif (effectiveBlockOn.low && issueCounts.low > effectiveThresholds.low) {\n\t\treturn {\n\t\t\taction: \"block\",\n\t\t\treason: `Low issues (${issueCounts.low}) exceed threshold (${effectiveThresholds.low})`,\n\t\t\trules_hit: rulesHit,\n\t\t\tconfidence: confidence,\n\t\t\tpolicyVersion: POLICY_VERSION,\n\t\t\tetag: POLICY_ETAG,\n\t\t\tdetails: {\n\t\t\t\tissueCounts,\n\t\t\t},\n\t\t};\n\t}\n\n\t// If we have any critical or high issues that don't exceed thresholds, require review\n\t// But only if blockOn is false for those severity levels\n\tif ((issueCounts.critical > 0 && !effectiveBlockOn.critical) || (issueCounts.high > 0 && !effectiveBlockOn.high)) {\n\t\treturn {\n\t\t\taction: \"review\",\n\t\t\treason: \"Critical or high severity issues found\",\n\t\t\trules_hit: rulesHit,\n\t\t\tconfidence: confidence,\n\t\t\tpolicyVersion: POLICY_VERSION,\n\t\t\tetag: POLICY_ETAG,\n\t\t\tdetails: {\n\t\t\t\tissueCounts,\n\t\t\t},\n\t\t};\n\t}\n\n\t// Otherwise, apply automatically\n\treturn {\n\t\taction: \"apply\",\n\t\treason: \"No blocking issues found\",\n\t\trules_hit: rulesHit,\n\t\tconfidence: confidence,\n\t\tpolicyVersion: POLICY_VERSION,\n\t\tetag: POLICY_ETAG,\n\t\tdetails: {\n\t\t\tissueCounts,\n\t\t},\n\t};\n}\n\n/**\n * Calculate confidence score based on issue counts and thresholds\n */\nfunction calculateConfidence(\n\tissueCounts: { critical: number; high: number; medium: number; low: number },\n\tthresholds: { critical: number; high: number; medium: number; low: number },\n): number {\n\tlet confidence = 0.9;\n\tconst criticalRatio = thresholds.critical > 0 ? issueCounts.critical / thresholds.critical : 0;\n\tconst highRatio = thresholds.high > 0 ? issueCounts.high / thresholds.high : 0;\n\tconst mediumRatio = thresholds.medium > 0 ? issueCounts.medium / thresholds.medium : 0;\n\tconst lowRatio = thresholds.low > 0 ? issueCounts.low / thresholds.low : 0;\n\tconst thresholdProximity = Math.max(criticalRatio, highRatio, mediumRatio, lowRatio);\n\tconfidence = Math.max(0.1, confidence - thresholdProximity * 0.5);\n\treturn confidence;\n}\n\n/**\n * Get severity level from SARIF result\n */\nfunction getSeverity(result: any): string {\n\tif (result.level) {\n\t\tconst level = result.level.toLowerCase();\n\t\tswitch (level) {\n\t\t\tcase \"error\":\n\t\t\t\treturn \"critical\";\n\t\t\tcase \"warning\":\n\t\t\t\treturn \"high\";\n\t\t\tcase \"note\":\n\t\t\t\treturn \"medium\";\n\t\t\tcase \"critical\":\n\t\t\t\treturn \"critical\";\n\t\t\tcase \"high\":\n\t\t\t\treturn \"high\";\n\t\t\tcase \"medium\":\n\t\t\t\treturn \"medium\";\n\t\t\tcase \"low\":\n\t\t\t\treturn \"low\";\n\t\t\tdefault:\n\t\t\t\treturn \"medium\";\n\t\t}\n\t}\n\treturn \"medium\";\n}\n\n/**\n * Check if a file path matches a glob pattern\n */\nfunction matchesGlob(filePath: string, glob: string): boolean {\n\tif (glob === \"src/**\") {\n\t\treturn filePath.startsWith(\"src/\");\n\t}\n\tconst regexPattern = glob.replace(/\\./g, \"\\\\.\").replace(/\\*/g, \".*\").replace(/\\?/g, \".\").replace(/\\//g, \"[/\\\\\\\\]\");\n\tconst regex = new RegExp(`^${regexPattern}$`);\n\treturn regex.test(filePath);\n}\n\n/**\n * Load policy configuration from .snapbackrc file\n */\nexport function loadPolicyConfig(cwd: string = process.cwd()): PolicyConfig {\n\tconst configPath = path.join(cwd, \".snapbackrc\");\n\tif (!fs.existsSync(configPath)) {\n\t\treturn DEFAULT_POLICY;\n\t}\n\ttry {\n\t\tconst configContent = fs.readFileSync(configPath, \"utf8\");\n\t\tconst config = JSON.parse(configContent);\n\t\treturn {\n\t\t\tthresholds: { ...DEFAULT_POLICY.thresholds, ...config.thresholds },\n\t\t\tblockOn: { ...DEFAULT_POLICY.blockOn, ...config.blockOn },\n\t\t\tpathRules: config.pathRules || DEFAULT_POLICY.pathRules,\n\t\t};\n\t} catch (error) {\n\t\tconsole.warn(\"Failed to load .snapbackrc, using default policy\", error);\n\t\treturn DEFAULT_POLICY;\n\t}\n}\n\n// Re-export detectors\nexport { type MockDetectionResult, MockDetector, type MockFinding } from \"./detectors/MockDetector.js\";\nexport {\n\tPhantomDependencyDetector,\n\ttype PhantomDependencyFinding,\n\ttype PhantomDependencyResult,\n} from \"./detectors/PhantomDependencyDetector.js\";\nexport { type SecretDetectionResult, SecretDetector, type SecretFinding } from \"./detectors/SecretDetector.js\";\n\n// Re-export PolicyEngine\nexport {\n\ttype DetectionEvent,\n\ttype PolicyAction,\n\tPolicyEngine,\n\ttype PolicyEngineConfig,\n\ttype PolicyEngineResult,\n\ttype PolicyRule,\n} from \"./PolicyEngine.js\";\n\n// Re-export SarifFormatter\nexport { SarifFormatter, type SarifLog, type SarifResult, type SarifRule, type SarifRun } from \"./SarifFormatter.js\";\n","/**\n * File Fragility Tracking Types\n *\n * Tracks which files are \"fragile\" based on rollback history and co-change patterns.\n *\n * Based on research:\n * - arXiv:2501.09225 - Provenance Guided Rollback Suggestions\n * - Hybrid Change Impact Analysis - co-change pattern mining\n * - CI/CD Rollback Best Practices\n */\n\n/**\n * Fragility level classification\n */\nexport type FragilityLevel = \"stable\" | \"moderate\" | \"fragile\" | \"critical\";\n\n/**\n * Rollback event\n */\nexport interface RollbackEvent {\n\t/** File path */\n\tfile: string;\n\t/** Rollback timestamp */\n\ttimestamp: number;\n\t/** Time since last modification (ms) */\n\ttimeSinceModification: number;\n\t/** Reason (if available) */\n\treason?: string;\n\t/** Related files rolled back together */\n\trelatedFiles?: string[];\n}\n\n/**\n * Co-change pattern\n * Files that are frequently modified together\n */\nexport interface CoChangePattern {\n\t/** Primary file */\n\tfile: string;\n\t/** Co-changed file */\n\tcoChangedWith: string;\n\t/** Number of times changed together */\n\tcoChangeCount: number;\n\t/** Total changes to primary file */\n\ttotalChanges: number;\n\t/** Co-change frequency (0-1) */\n\tfrequency: number;\n\t/** Last co-change timestamp */\n\tlastCoChange: number;\n}\n\n/**\n * File fragility profile\n */\nexport interface FileFragilityProfile {\n\t/** File path */\n\tpath: string;\n\n\t/** Fragility level */\n\tlevel: FragilityLevel;\n\n\t/** Fragility score (0-1, higher = more fragile) */\n\tscore: number;\n\n\t/** Total rollback count */\n\trollbackCount: number;\n\n\t/** Average time to rollback (ms) */\n\taverageTimeToRollback: number;\n\n\t/** Last rollback timestamp */\n\tlastRollback?: number;\n\n\t/** Files frequently modified together */\n\tfrequentlyModifiedWith: string[];\n\n\t/** Co-change patterns */\n\tcoChangePatterns: CoChangePattern[];\n\n\t/** Modification velocity (changes per day) */\n\tmodificationVelocity: number;\n\n\t/** Last modified timestamp */\n\tlastModified: number;\n\n\t/** Confidence in fragility assessment (0-1) */\n\tconfidence: number;\n}\n\n/**\n * Fragility tracker configuration\n */\nexport interface FragilityConfig {\n\t/** Enable fragility tracking */\n\tenabled: boolean;\n\n\t/** Rolling window for rollback tracking (days) */\n\trollbackWindowDays: number;\n\n\t/** Minimum rollbacks to classify as fragile */\n\tminRollbacksForFragile: number;\n\n\t/** Co-change frequency threshold (0-1) */\n\tcoChangeThreshold: number;\n\n\t/** Max time for \"quick rollback\" (ms) */\n\tquickRollbackThresholdMs: number;\n\n\t/** Fragility score decay rate (daily) */\n\tscoreDecayRate: number;\n}\n\n/**\n * Default fragility configuration\n */\nexport const DEFAULT_FRAGILITY_CONFIG: FragilityConfig = {\n\tenabled: true,\n\trollbackWindowDays: 7,\n\tminRollbacksForFragile: 2,\n\tcoChangeThreshold: 0.3, // 30% co-change frequency\n\tquickRollbackThresholdMs: 3600000, // 1 hour\n\tscoreDecayRate: 0.05, // 5% daily decay\n};\n\n/**\n * Fragility analysis result\n */\nexport interface FragilityAnalysis {\n\t/** File path */\n\tfile: string;\n\n\t/** Current fragility profile */\n\tprofile: FileFragilityProfile;\n\n\t/** Warnings */\n\twarnings: Array<{\n\t\tlevel: \"error\" | \"warning\" | \"info\";\n\t\tmessage: string;\n\t}>;\n\n\t/** Recommendations */\n\trecommendations: string[];\n\n\t/** Related files to review */\n\trelatedFiles: Array<{\n\t\tpath: string;\n\t\treason: string;\n\t\tcoChangeFrequency: number;\n\t}>;\n}\n\n/**\n * Fragility store schema (JSONL)\n */\nexport interface FragilityRecord {\n\t/** File path */\n\tfile: string;\n\t/** Event type */\n\teventType: \"rollback\" | \"modification\" | \"co-change\";\n\t/** Timestamp */\n\ttimestamp: number;\n\t/** Event data */\n\tdata: {\n\t\trollback?: RollbackEvent;\n\t\tmodification?: {\n\t\t\tlinesChanged: number;\n\t\t\tauthor: string;\n\t\t};\n\t\tcoChange?: {\n\t\t\tfiles: string[];\n\t\t};\n\t};\n}\n"]}